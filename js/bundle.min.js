(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){},{}],2:[function(require,module,exports){var asn1=exports;asn1.bignum=require('bn.js');asn1.define=require('./asn1/api').define;asn1.base=require('./asn1/base');asn1.constants=require('./asn1/constants');asn1.decoders=require('./asn1/decoders');asn1.encoders=require('./asn1/encoders')},{"./asn1/api":3,"./asn1/base":5,"./asn1/constants":9,"./asn1/decoders":11,"./asn1/encoders":14,"bn.js":21}],3:[function(require,module,exports){var asn1=require('../asn1');var inherits=require('inherits');var api=exports;api.define=function define(name,body){return new Entity(name,body)};function Entity(name,body){this.name=name;this.body=body;this.decoders={};this.encoders={}};Entity.prototype._createNamed=function createNamed(base){var named;try{named=require('vm').runInThisContext('(function '+this.name+'(entity) {\n'+'  this._initNamed(entity);\n'+'})')}catch(e){named=function(entity){this._initNamed(entity)}}
inherits(named,base);named.prototype._initNamed=function initnamed(entity){base.call(this,entity)};return new named(this)};Entity.prototype._getDecoder=function _getDecoder(enc){enc=enc||'der';if(!this.decoders.hasOwnProperty(enc))
this.decoders[enc]=this._createNamed(asn1.decoders[enc]);return this.decoders[enc]};Entity.prototype.decode=function decode(data,enc,options){return this._getDecoder(enc).decode(data,options)};Entity.prototype._getEncoder=function _getEncoder(enc){enc=enc||'der';if(!this.encoders.hasOwnProperty(enc))
this.encoders[enc]=this._createNamed(asn1.encoders[enc]);return this.encoders[enc]};Entity.prototype.encode=function encode(data,enc,reporter){return this._getEncoder(enc).encode(data,reporter)}},{"../asn1":2,"inherits":108,"vm":189}],4:[function(require,module,exports){var inherits=require('inherits');var Reporter=require('../base').Reporter;var Buffer=require('buffer').Buffer;function DecoderBuffer(base,options){Reporter.call(this,options);if(!Buffer.isBuffer(base)){this.error('Input not Buffer');return}
this.base=base;this.offset=0;this.length=base.length}
inherits(DecoderBuffer,Reporter);exports.DecoderBuffer=DecoderBuffer;DecoderBuffer.prototype.save=function save(){return{offset:this.offset,reporter:Reporter.prototype.save.call(this)}};DecoderBuffer.prototype.restore=function restore(save){var res=new DecoderBuffer(this.base);res.offset=save.offset;res.length=this.offset;this.offset=save.offset;Reporter.prototype.restore.call(this,save.reporter);return res};DecoderBuffer.prototype.isEmpty=function isEmpty(){return this.offset===this.length};DecoderBuffer.prototype.readUInt8=function readUInt8(fail){if(this.offset+1<=this.length)
return this.base.readUInt8(this.offset++,!0);else return this.error(fail||'DecoderBuffer overrun')}
DecoderBuffer.prototype.skip=function skip(bytes,fail){if(!(this.offset+bytes<=this.length))
return this.error(fail||'DecoderBuffer overrun');var res=new DecoderBuffer(this.base);res._reporterState=this._reporterState;res.offset=this.offset;res.length=this.offset+bytes;this.offset+=bytes;return res}
DecoderBuffer.prototype.raw=function raw(save){return this.base.slice(save?save.offset:this.offset,this.length)}
function EncoderBuffer(value,reporter){if(Array.isArray(value)){this.length=0;this.value=value.map(function(item){if(!(item instanceof EncoderBuffer))
item=new EncoderBuffer(item,reporter);this.length+=item.length;return item},this)}else if(typeof value==='number'){if(!(0<=value&&value<=0xff))
return reporter.error('non-byte EncoderBuffer value');this.value=value;this.length=1}else if(typeof value==='string'){this.value=value;this.length=Buffer.byteLength(value)}else if(Buffer.isBuffer(value)){this.value=value;this.length=value.length}else{return reporter.error('Unsupported type: '+typeof value)}}
exports.EncoderBuffer=EncoderBuffer;EncoderBuffer.prototype.join=function join(out,offset){if(!out)
out=new Buffer(this.length);if(!offset)
offset=0;if(this.length===0)
return out;if(Array.isArray(this.value)){this.value.forEach(function(item){item.join(out,offset);offset+=item.length})}else{if(typeof this.value==='number')
out[offset]=this.value;else if(typeof this.value==='string')
out.write(this.value,offset);else if(Buffer.isBuffer(this.value))
this.value.copy(out,offset);offset+=this.length}
return out}},{"../base":5,"buffer":54,"inherits":108}],5:[function(require,module,exports){var base=exports;base.Reporter=require('./reporter').Reporter;base.DecoderBuffer=require('./buffer').DecoderBuffer;base.EncoderBuffer=require('./buffer').EncoderBuffer;base.Node=require('./node')},{"./buffer":4,"./node":6,"./reporter":7}],6:[function(require,module,exports){var Reporter=require('../base').Reporter;var EncoderBuffer=require('../base').EncoderBuffer;var DecoderBuffer=require('../base').DecoderBuffer;var assert=require('minimalistic-assert');var tags=['seq','seqof','set','setof','objid','bool','gentime','utctime','null_','enum','int','objDesc','bitstr','bmpstr','charstr','genstr','graphstr','ia5str','iso646str','numstr','octstr','printstr','t61str','unistr','utf8str','videostr'];var methods=['key','obj','use','optional','explicit','implicit','def','choice','any','contains'].concat(tags);var overrided=['_peekTag','_decodeTag','_use','_decodeStr','_decodeObjid','_decodeTime','_decodeNull','_decodeInt','_decodeBool','_decodeList','_encodeComposite','_encodeStr','_encodeObjid','_encodeTime','_encodeNull','_encodeInt','_encodeBool'];function Node(enc,parent){var state={};this._baseState=state;state.enc=enc;state.parent=parent||null;state.children=null;state.tag=null;state.args=null;state.reverseArgs=null;state.choice=null;state.optional=!1;state.any=!1;state.obj=!1;state.use=null;state.useDecoder=null;state.key=null;state['default']=null;state.explicit=null;state.implicit=null;state.contains=null;if(!state.parent){state.children=[];this._wrap()}}
module.exports=Node;var stateProps=['enc','parent','children','tag','args','reverseArgs','choice','optional','any','obj','use','alteredUse','key','default','explicit','implicit','contains'];Node.prototype.clone=function clone(){var state=this._baseState;var cstate={};stateProps.forEach(function(prop){cstate[prop]=state[prop]});var res=new this.constructor(cstate.parent);res._baseState=cstate;return res};Node.prototype._wrap=function wrap(){var state=this._baseState;methods.forEach(function(method){this[method]=function _wrappedMethod(){var clone=new this.constructor(this);state.children.push(clone);return clone[method].apply(clone,arguments)}},this)};Node.prototype._init=function init(body){var state=this._baseState;assert(state.parent===null);body.call(this);state.children=state.children.filter(function(child){return child._baseState.parent===this},this);assert.equal(state.children.length,1,'Root node can have only one child')};Node.prototype._useArgs=function useArgs(args){var state=this._baseState;var children=args.filter(function(arg){return arg instanceof this.constructor},this);args=args.filter(function(arg){return!(arg instanceof this.constructor)},this);if(children.length!==0){assert(state.children===null);state.children=children;children.forEach(function(child){child._baseState.parent=this},this)}
if(args.length!==0){assert(state.args===null);state.args=args;state.reverseArgs=args.map(function(arg){if(typeof arg!=='object'||arg.constructor!==Object)
return arg;var res={};Object.keys(arg).forEach(function(key){if(key==(key|0))
key|=0;var value=arg[key];res[value]=key});return res})}};overrided.forEach(function(method){Node.prototype[method]=function _overrided(){var state=this._baseState;throw new Error(method+' not implemented for encoding: '+state.enc)}});tags.forEach(function(tag){Node.prototype[tag]=function _tagMethod(){var state=this._baseState;var args=Array.prototype.slice.call(arguments);assert(state.tag===null);state.tag=tag;this._useArgs(args);return this}});Node.prototype.use=function use(item){assert(item);var state=this._baseState;assert(state.use===null);state.use=item;return this};Node.prototype.optional=function optional(){var state=this._baseState;state.optional=!0;return this};Node.prototype.def=function def(val){var state=this._baseState;assert(state['default']===null);state['default']=val;state.optional=!0;return this};Node.prototype.explicit=function explicit(num){var state=this._baseState;assert(state.explicit===null&&state.implicit===null);state.explicit=num;return this};Node.prototype.implicit=function implicit(num){var state=this._baseState;assert(state.explicit===null&&state.implicit===null);state.implicit=num;return this};Node.prototype.obj=function obj(){var state=this._baseState;var args=Array.prototype.slice.call(arguments);state.obj=!0;if(args.length!==0)
this._useArgs(args);return this};Node.prototype.key=function key(newKey){var state=this._baseState;assert(state.key===null);state.key=newKey;return this};Node.prototype.any=function any(){var state=this._baseState;state.any=!0;return this};Node.prototype.choice=function choice(obj){var state=this._baseState;assert(state.choice===null);state.choice=obj;this._useArgs(Object.keys(obj).map(function(key){return obj[key]}));return this};Node.prototype.contains=function contains(item){var state=this._baseState;assert(state.use===null);state.contains=item;return this};Node.prototype._decode=function decode(input,options){var state=this._baseState;if(state.parent===null)
return input.wrapResult(state.children[0]._decode(input,options));var result=state['default'];var present=!0;var prevKey=null;if(state.key!==null)
prevKey=input.enterKey(state.key);if(state.optional){var tag=null;if(state.explicit!==null)
tag=state.explicit;else if(state.implicit!==null)
tag=state.implicit;else if(state.tag!==null)
tag=state.tag;if(tag===null&&!state.any){var save=input.save();try{if(state.choice===null)
this._decodeGeneric(state.tag,input,options);else this._decodeChoice(input,options);present=!0}catch(e){present=!1}
input.restore(save)}else{present=this._peekTag(input,tag,state.any);if(input.isError(present))
return present}}
var prevObj;if(state.obj&&present)
prevObj=input.enterObject();if(present){if(state.explicit!==null){var explicit=this._decodeTag(input,state.explicit);if(input.isError(explicit))
return explicit;input=explicit}
var start=input.offset;if(state.use===null&&state.choice===null){if(state.any)
var save=input.save();var body=this._decodeTag(input,state.implicit!==null?state.implicit:state.tag,state.any);if(input.isError(body))
return body;if(state.any)
result=input.raw(save);else input=body}
if(options&&options.track&&state.tag!==null)
options.track(input.path(),start,input.length,'tagged');if(options&&options.track&&state.tag!==null)
options.track(input.path(),input.offset,input.length,'content');if(state.any)
result=result;else if(state.choice===null)
result=this._decodeGeneric(state.tag,input,options);else result=this._decodeChoice(input,options);if(input.isError(result))
return result;if(!state.any&&state.choice===null&&state.children!==null){state.children.forEach(function decodeChildren(child){child._decode(input,options)})}
if(state.contains&&(state.tag==='octstr'||state.tag==='bitstr')){var data=new DecoderBuffer(result);result=this._getUse(state.contains,input._reporterState.obj)._decode(data,options)}}
if(state.obj&&present)
result=input.leaveObject(prevObj);if(state.key!==null&&(result!==null||present===!0))
input.leaveKey(prevKey,state.key,result);else if(prevKey!==null)
input.exitKey(prevKey);return result};Node.prototype._decodeGeneric=function decodeGeneric(tag,input,options){var state=this._baseState;if(tag==='seq'||tag==='set')
return null;if(tag==='seqof'||tag==='setof')
return this._decodeList(input,tag,state.args[0],options);else if(/str$/.test(tag))
return this._decodeStr(input,tag,options);else if(tag==='objid'&&state.args)
return this._decodeObjid(input,state.args[0],state.args[1],options);else if(tag==='objid')
return this._decodeObjid(input,null,null,options);else if(tag==='gentime'||tag==='utctime')
return this._decodeTime(input,tag,options);else if(tag==='null_')
return this._decodeNull(input,options);else if(tag==='bool')
return this._decodeBool(input,options);else if(tag==='objDesc')
return this._decodeStr(input,tag,options);else if(tag==='int'||tag==='enum')
return this._decodeInt(input,state.args&&state.args[0],options);if(state.use!==null){return this._getUse(state.use,input._reporterState.obj)._decode(input,options)}else{return input.error('unknown tag: '+tag)}};Node.prototype._getUse=function _getUse(entity,obj){var state=this._baseState;state.useDecoder=this._use(entity,obj);assert(state.useDecoder._baseState.parent===null);state.useDecoder=state.useDecoder._baseState.children[0];if(state.implicit!==state.useDecoder._baseState.implicit){state.useDecoder=state.useDecoder.clone();state.useDecoder._baseState.implicit=state.implicit}
return state.useDecoder};Node.prototype._decodeChoice=function decodeChoice(input,options){var state=this._baseState;var result=null;var match=!1;Object.keys(state.choice).some(function(key){var save=input.save();var node=state.choice[key];try{var value=node._decode(input,options);if(input.isError(value))
return!1;result={type:key,value:value};match=!0}catch(e){input.restore(save);return!1}
return!0},this);if(!match)
return input.error('Choice not matched');return result};Node.prototype._createEncoderBuffer=function createEncoderBuffer(data){return new EncoderBuffer(data,this.reporter)};Node.prototype._encode=function encode(data,reporter,parent){var state=this._baseState;if(state['default']!==null&&state['default']===data)
return;var result=this._encodeValue(data,reporter,parent);if(result===undefined)
return;if(this._skipDefault(result,reporter,parent))
return;return result};Node.prototype._encodeValue=function encode(data,reporter,parent){var state=this._baseState;if(state.parent===null)
return state.children[0]._encode(data,reporter||new Reporter());var result=null;this.reporter=reporter;if(state.optional&&data===undefined){if(state['default']!==null)
data=state['default']
else return}
var content=null;var primitive=!1;if(state.any){result=this._createEncoderBuffer(data)}else if(state.choice){result=this._encodeChoice(data,reporter)}else if(state.contains){content=this._getUse(state.contains,parent)._encode(data,reporter);primitive=!0}else if(state.children){content=state.children.map(function(child){if(child._baseState.tag==='null_')
return child._encode(null,reporter,data);if(child._baseState.key===null)
return reporter.error('Child should have a key');var prevKey=reporter.enterKey(child._baseState.key);if(typeof data!=='object')
return reporter.error('Child expected, but input is not object');var res=child._encode(data[child._baseState.key],reporter,data);reporter.leaveKey(prevKey);return res},this).filter(function(child){return child});content=this._createEncoderBuffer(content)}else{if(state.tag==='seqof'||state.tag==='setof'){if(!(state.args&&state.args.length===1))
return reporter.error('Too many args for : '+state.tag);if(!Array.isArray(data))
return reporter.error('seqof/setof, but data is not Array');var child=this.clone();child._baseState.implicit=null;content=this._createEncoderBuffer(data.map(function(item){var state=this._baseState;return this._getUse(state.args[0],data)._encode(item,reporter)},child))}else if(state.use!==null){result=this._getUse(state.use,parent)._encode(data,reporter)}else{content=this._encodePrimitive(state.tag,data);primitive=!0}}
var result;if(!state.any&&state.choice===null){var tag=state.implicit!==null?state.implicit:state.tag;var cls=state.implicit===null?'universal':'context';if(tag===null){if(state.use===null)
reporter.error('Tag could be omitted only for .use()')}else{if(state.use===null)
result=this._encodeComposite(tag,primitive,cls,content)}}
if(state.explicit!==null)
result=this._encodeComposite(state.explicit,!1,'context',result);return result};Node.prototype._encodeChoice=function encodeChoice(data,reporter){var state=this._baseState;var node=state.choice[data.type];if(!node){assert(!1,data.type+' not found in '+JSON.stringify(Object.keys(state.choice)))}
return node._encode(data.value,reporter)};Node.prototype._encodePrimitive=function encodePrimitive(tag,data){var state=this._baseState;if(/str$/.test(tag))
return this._encodeStr(data,tag);else if(tag==='objid'&&state.args)
return this._encodeObjid(data,state.reverseArgs[0],state.args[1]);else if(tag==='objid')
return this._encodeObjid(data,null,null);else if(tag==='gentime'||tag==='utctime')
return this._encodeTime(data,tag);else if(tag==='null_')
return this._encodeNull();else if(tag==='int'||tag==='enum')
return this._encodeInt(data,state.args&&state.reverseArgs[0]);else if(tag==='bool')
return this._encodeBool(data);else if(tag==='objDesc')
return this._encodeStr(data,tag);else throw new Error('Unsupported tag: '+tag)};Node.prototype._isNumstr=function isNumstr(str){return/^[0-9 ]*$/.test(str)};Node.prototype._isPrintstr=function isPrintstr(str){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(str)}},{"../base":5,"minimalistic-assert":113}],7:[function(require,module,exports){var inherits=require('inherits');function Reporter(options){this._reporterState={obj:null,path:[],options:options||{},errors:[]}}
exports.Reporter=Reporter;Reporter.prototype.isError=function isError(obj){return obj instanceof ReporterError};Reporter.prototype.save=function save(){var state=this._reporterState;return{obj:state.obj,pathLen:state.path.length}};Reporter.prototype.restore=function restore(data){var state=this._reporterState;state.obj=data.obj;state.path=state.path.slice(0,data.pathLen)};Reporter.prototype.enterKey=function enterKey(key){return this._reporterState.path.push(key)};Reporter.prototype.exitKey=function exitKey(index){var state=this._reporterState;state.path=state.path.slice(0,index-1)};Reporter.prototype.leaveKey=function leaveKey(index,key,value){var state=this._reporterState;this.exitKey(index);if(state.obj!==null)
state.obj[key]=value};Reporter.prototype.path=function path(){return this._reporterState.path.join('/')};Reporter.prototype.enterObject=function enterObject(){var state=this._reporterState;var prev=state.obj;state.obj={};return prev};Reporter.prototype.leaveObject=function leaveObject(prev){var state=this._reporterState;var now=state.obj;state.obj=prev;return now};Reporter.prototype.error=function error(msg){var err;var state=this._reporterState;var inherited=msg instanceof ReporterError;if(inherited){err=msg}else{err=new ReporterError(state.path.map(function(elem){return'['+JSON.stringify(elem)+']'}).join(''),msg.message||msg,msg.stack)}
if(!state.options.partial)
throw err;if(!inherited)
state.errors.push(err);return err};Reporter.prototype.wrapResult=function wrapResult(result){var state=this._reporterState;if(!state.options.partial)
return result;return{result:this.isError(result)?null:result,errors:state.errors}};function ReporterError(path,msg){this.path=path;this.rethrow(msg)};inherits(ReporterError,Error);ReporterError.prototype.rethrow=function rethrow(msg){this.message=msg+' at: '+(this.path||'(shallow)');if(Error.captureStackTrace)
Error.captureStackTrace(this,ReporterError);if(!this.stack){try{throw new Error(this.message)}catch(e){this.stack=e.stack}}
return this}},{"inherits":108}],8:[function(require,module,exports){var constants=require('../constants');exports.tagClass={0:'universal',1:'application',2:'context',3:'private'};exports.tagClassByName=constants._reverse(exports.tagClass);exports.tag={0x00:'end',0x01:'bool',0x02:'int',0x03:'bitstr',0x04:'octstr',0x05:'null_',0x06:'objid',0x07:'objDesc',0x08:'external',0x09:'real',0x0a:'enum',0x0b:'embed',0x0c:'utf8str',0x0d:'relativeOid',0x10:'seq',0x11:'set',0x12:'numstr',0x13:'printstr',0x14:'t61str',0x15:'videostr',0x16:'ia5str',0x17:'utctime',0x18:'gentime',0x19:'graphstr',0x1a:'iso646str',0x1b:'genstr',0x1c:'unistr',0x1d:'charstr',0x1e:'bmpstr'};exports.tagByName=constants._reverse(exports.tag)},{"../constants":9}],9:[function(require,module,exports){var constants=exports;constants._reverse=function reverse(map){var res={};Object.keys(map).forEach(function(key){if((key|0)==key)
key=key|0;var value=map[key];res[value]=key});return res};constants.der=require('./der')},{"./der":8}],10:[function(require,module,exports){var inherits=require('inherits');var asn1=require('../../asn1');var base=asn1.base;var bignum=asn1.bignum;var der=asn1.constants.der;function DERDecoder(entity){this.enc='der';this.name=entity.name;this.entity=entity;this.tree=new DERNode();this.tree._init(entity.body)};module.exports=DERDecoder;DERDecoder.prototype.decode=function decode(data,options){if(!(data instanceof base.DecoderBuffer))
data=new base.DecoderBuffer(data,options);return this.tree._decode(data,options)};function DERNode(parent){base.Node.call(this,'der',parent)}
inherits(DERNode,base.Node);DERNode.prototype._peekTag=function peekTag(buffer,tag,any){if(buffer.isEmpty())
return!1;var state=buffer.save();var decodedTag=derDecodeTag(buffer,'Failed to peek tag: "'+tag+'"');if(buffer.isError(decodedTag))
return decodedTag;buffer.restore(state);return decodedTag.tag===tag||decodedTag.tagStr===tag||(decodedTag.tagStr+'of')===tag||any};DERNode.prototype._decodeTag=function decodeTag(buffer,tag,any){var decodedTag=derDecodeTag(buffer,'Failed to decode tag of "'+tag+'"');if(buffer.isError(decodedTag))
return decodedTag;var len=derDecodeLen(buffer,decodedTag.primitive,'Failed to get length of "'+tag+'"');if(buffer.isError(len))
return len;if(!any&&decodedTag.tag!==tag&&decodedTag.tagStr!==tag&&decodedTag.tagStr+'of'!==tag){return buffer.error('Failed to match tag: "'+tag+'"')}
if(decodedTag.primitive||len!==null)
return buffer.skip(len,'Failed to match body of: "'+tag+'"');var state=buffer.save();var res=this._skipUntilEnd(buffer,'Failed to skip indefinite length body: "'+this.tag+'"');if(buffer.isError(res))
return res;len=buffer.offset-state.offset;buffer.restore(state);return buffer.skip(len,'Failed to match body of: "'+tag+'"')};DERNode.prototype._skipUntilEnd=function skipUntilEnd(buffer,fail){while(!0){var tag=derDecodeTag(buffer,fail);if(buffer.isError(tag))
return tag;var len=derDecodeLen(buffer,tag.primitive,fail);if(buffer.isError(len))
return len;var res;if(tag.primitive||len!==null)
res=buffer.skip(len)
else res=this._skipUntilEnd(buffer,fail);if(buffer.isError(res))
return res;if(tag.tagStr==='end')
break}};DERNode.prototype._decodeList=function decodeList(buffer,tag,decoder,options){var result=[];while(!buffer.isEmpty()){var possibleEnd=this._peekTag(buffer,'end');if(buffer.isError(possibleEnd))
return possibleEnd;var res=decoder.decode(buffer,'der',options);if(buffer.isError(res)&&possibleEnd)
break;result.push(res)}
return result};DERNode.prototype._decodeStr=function decodeStr(buffer,tag){if(tag==='bitstr'){var unused=buffer.readUInt8();if(buffer.isError(unused))
return unused;return{unused:unused,data:buffer.raw()}}else if(tag==='bmpstr'){var raw=buffer.raw();if(raw.length%2===1)
return buffer.error('Decoding of string type: bmpstr length mismatch');var str='';for(var i=0;i<raw.length/2;i++){str+=String.fromCharCode(raw.readUInt16BE(i*2))}
return str}else if(tag==='numstr'){var numstr=buffer.raw().toString('ascii');if(!this._isNumstr(numstr)){return buffer.error('Decoding of string type: '+'numstr unsupported characters')}
return numstr}else if(tag==='octstr'){return buffer.raw()}else if(tag==='objDesc'){return buffer.raw()}else if(tag==='printstr'){var printstr=buffer.raw().toString('ascii');if(!this._isPrintstr(printstr)){return buffer.error('Decoding of string type: '+'printstr unsupported characters')}
return printstr}else if(/str$/.test(tag)){return buffer.raw().toString()}else{return buffer.error('Decoding of string type: '+tag+' unsupported')}};DERNode.prototype._decodeObjid=function decodeObjid(buffer,values,relative){var result;var identifiers=[];var ident=0;while(!buffer.isEmpty()){var subident=buffer.readUInt8();ident<<=7;ident|=subident&0x7f;if((subident&0x80)===0){identifiers.push(ident);ident=0}}
if(subident&0x80)
identifiers.push(ident);var first=(identifiers[0]/40)|0;var second=identifiers[0]%40;if(relative)
result=identifiers;else result=[first,second].concat(identifiers.slice(1));if(values){var tmp=values[result.join(' ')];if(tmp===undefined)
tmp=values[result.join('.')];if(tmp!==undefined)
result=tmp}
return result};DERNode.prototype._decodeTime=function decodeTime(buffer,tag){var str=buffer.raw().toString();if(tag==='gentime'){var year=str.slice(0,4)|0;var mon=str.slice(4,6)|0;var day=str.slice(6,8)|0;var hour=str.slice(8,10)|0;var min=str.slice(10,12)|0;var sec=str.slice(12,14)|0}else if(tag==='utctime'){var year=str.slice(0,2)|0;var mon=str.slice(2,4)|0;var day=str.slice(4,6)|0;var hour=str.slice(6,8)|0;var min=str.slice(8,10)|0;var sec=str.slice(10,12)|0;if(year<70)
year=2000+year;else year=1900+year}else{return buffer.error('Decoding '+tag+' time is not supported yet')}
return Date.UTC(year,mon-1,day,hour,min,sec,0)};DERNode.prototype._decodeNull=function decodeNull(buffer){return null};DERNode.prototype._decodeBool=function decodeBool(buffer){var res=buffer.readUInt8();if(buffer.isError(res))
return res;else return res!==0};DERNode.prototype._decodeInt=function decodeInt(buffer,values){var raw=buffer.raw();var res=new bignum(raw);if(values)
res=values[res.toString(10)]||res;return res};DERNode.prototype._use=function use(entity,obj){if(typeof entity==='function')
entity=entity(obj);return entity._getDecoder('der').tree};function derDecodeTag(buf,fail){var tag=buf.readUInt8(fail);if(buf.isError(tag))
return tag;var cls=der.tagClass[tag>>6];var primitive=(tag&0x20)===0;if((tag&0x1f)===0x1f){var oct=tag;tag=0;while((oct&0x80)===0x80){oct=buf.readUInt8(fail);if(buf.isError(oct))
return oct;tag<<=7;tag|=oct&0x7f}}else{tag&=0x1f}
var tagStr=der.tag[tag];return{cls:cls,primitive:primitive,tag:tag,tagStr:tagStr}}
function derDecodeLen(buf,primitive,fail){var len=buf.readUInt8(fail);if(buf.isError(len))
return len;if(!primitive&&len===0x80)
return null;if((len&0x80)===0){return len}
var num=len&0x7f;if(num>4)
return buf.error('length octect is too long');len=0;for(var i=0;i<num;i++){len<<=8;var j=buf.readUInt8(fail);if(buf.isError(j))
return j;len|=j}
return len}},{"../../asn1":2,"inherits":108}],11:[function(require,module,exports){var decoders=exports;decoders.der=require('./der');decoders.pem=require('./pem')},{"./der":10,"./pem":12}],12:[function(require,module,exports){var inherits=require('inherits');var Buffer=require('buffer').Buffer;var DERDecoder=require('./der');function PEMDecoder(entity){DERDecoder.call(this,entity);this.enc='pem'};inherits(PEMDecoder,DERDecoder);module.exports=PEMDecoder;PEMDecoder.prototype.decode=function decode(data,options){var lines=data.toString().split(/[\r\n]+/g);var label=options.label.toUpperCase();var re=/^-----(BEGIN|END) ([^-]+)-----$/;var start=-1;var end=-1;for(var i=0;i<lines.length;i++){var match=lines[i].match(re);if(match===null)
continue;if(match[2]!==label)
continue;if(start===-1){if(match[1]!=='BEGIN')
break;start=i}else{if(match[1]!=='END')
break;end=i;break}}
if(start===-1||end===-1)
throw new Error('PEM section not found for: '+label);var base64=lines.slice(start+1,end).join('');base64.replace(/[^a-z0-9\+\/=]+/gi,'');var input=new Buffer(base64,'base64');return DERDecoder.prototype.decode.call(this,input,options)}},{"./der":10,"buffer":54,"inherits":108}],13:[function(require,module,exports){var inherits=require('inherits');var Buffer=require('buffer').Buffer;var asn1=require('../../asn1');var base=asn1.base;var der=asn1.constants.der;function DEREncoder(entity){this.enc='der';this.name=entity.name;this.entity=entity;this.tree=new DERNode();this.tree._init(entity.body)};module.exports=DEREncoder;DEREncoder.prototype.encode=function encode(data,reporter){return this.tree._encode(data,reporter).join()};function DERNode(parent){base.Node.call(this,'der',parent)}
inherits(DERNode,base.Node);DERNode.prototype._encodeComposite=function encodeComposite(tag,primitive,cls,content){var encodedTag=encodeTag(tag,primitive,cls,this.reporter);if(content.length<0x80){var header=new Buffer(2);header[0]=encodedTag;header[1]=content.length;return this._createEncoderBuffer([header,content])}
var lenOctets=1;for(var i=content.length;i>=0x100;i>>=8)
lenOctets++;var header=new Buffer(1+1+lenOctets);header[0]=encodedTag;header[1]=0x80|lenOctets;for(var i=1+lenOctets,j=content.length;j>0;i--,j>>=8)
header[i]=j&0xff;return this._createEncoderBuffer([header,content])};DERNode.prototype._encodeStr=function encodeStr(str,tag){if(tag==='bitstr'){return this._createEncoderBuffer([str.unused|0,str.data])}else if(tag==='bmpstr'){var buf=new Buffer(str.length*2);for(var i=0;i<str.length;i++){buf.writeUInt16BE(str.charCodeAt(i),i*2)}
return this._createEncoderBuffer(buf)}else if(tag==='numstr'){if(!this._isNumstr(str)){return this.reporter.error('Encoding of string type: numstr supports '+'only digits and space')}
return this._createEncoderBuffer(str)}else if(tag==='printstr'){if(!this._isPrintstr(str)){return this.reporter.error('Encoding of string type: printstr supports '+'only latin upper and lower case letters, '+'digits, space, apostrophe, left and rigth '+'parenthesis, plus sign, comma, hyphen, '+'dot, slash, colon, equal sign, '+'question mark')}
return this._createEncoderBuffer(str)}else if(/str$/.test(tag)){return this._createEncoderBuffer(str)}else if(tag==='objDesc'){return this._createEncoderBuffer(str)}else{return this.reporter.error('Encoding of string type: '+tag+' unsupported')}};DERNode.prototype._encodeObjid=function encodeObjid(id,values,relative){if(typeof id==='string'){if(!values)
return this.reporter.error('string objid given, but no values map found');if(!values.hasOwnProperty(id))
return this.reporter.error('objid not found in values map');id=values[id].split(/[\s\.]+/g);for(var i=0;i<id.length;i++)
id[i]|=0}else if(Array.isArray(id)){id=id.slice();for(var i=0;i<id.length;i++)
id[i]|=0}
if(!Array.isArray(id)){return this.reporter.error('objid() should be either array or string, '+'got: '+JSON.stringify(id))}
if(!relative){if(id[1]>=40)
return this.reporter.error('Second objid identifier OOB');id.splice(0,2,id[0]*40+id[1])}
var size=0;for(var i=0;i<id.length;i++){var ident=id[i];for(size++;ident>=0x80;ident>>=7)
size++}
var objid=new Buffer(size);var offset=objid.length-1;for(var i=id.length-1;i>=0;i--){var ident=id[i];objid[offset--]=ident&0x7f;while((ident>>=7)>0)
objid[offset--]=0x80|(ident&0x7f);}
return this._createEncoderBuffer(objid)};function two(num){if(num<10)
return'0'+num;else return num}
DERNode.prototype._encodeTime=function encodeTime(time,tag){var str;var date=new Date(time);if(tag==='gentime'){str=[two(date.getFullYear()),two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),'Z'].join('')}else if(tag==='utctime'){str=[two(date.getFullYear()%100),two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),'Z'].join('')}else{this.reporter.error('Encoding '+tag+' time is not supported yet')}
return this._encodeStr(str,'octstr')};DERNode.prototype._encodeNull=function encodeNull(){return this._createEncoderBuffer('')};DERNode.prototype._encodeInt=function encodeInt(num,values){if(typeof num==='string'){if(!values)
return this.reporter.error('String int or enum given, but no values map');if(!values.hasOwnProperty(num)){return this.reporter.error('Values map doesn\'t contain: '+JSON.stringify(num))}
num=values[num]}
if(typeof num!=='number'&&!Buffer.isBuffer(num)){var numArray=num.toArray();if(!num.sign&&numArray[0]&0x80){numArray.unshift(0)}
num=new Buffer(numArray)}
if(Buffer.isBuffer(num)){var size=num.length;if(num.length===0)
size++;var out=new Buffer(size);num.copy(out);if(num.length===0)
out[0]=0
return this._createEncoderBuffer(out)}
if(num<0x80)
return this._createEncoderBuffer(num);if(num<0x100)
return this._createEncoderBuffer([0,num]);var size=1;for(var i=num;i>=0x100;i>>=8)
size++;var out=new Array(size);for(var i=out.length-1;i>=0;i--){out[i]=num&0xff;num>>=8}
if(out[0]&0x80){out.unshift(0)}
return this._createEncoderBuffer(new Buffer(out))};DERNode.prototype._encodeBool=function encodeBool(value){return this._createEncoderBuffer(value?0xff:0)};DERNode.prototype._use=function use(entity,obj){if(typeof entity==='function')
entity=entity(obj);return entity._getEncoder('der').tree};DERNode.prototype._skipDefault=function skipDefault(dataBuffer,reporter,parent){var state=this._baseState;var i;if(state['default']===null)
return!1;var data=dataBuffer.join();if(state.defaultBuffer===undefined)
state.defaultBuffer=this._encodeValue(state['default'],reporter,parent).join();if(data.length!==state.defaultBuffer.length)
return!1;for(i=0;i<data.length;i++)
if(data[i]!==state.defaultBuffer[i])
return!1;return!0};function encodeTag(tag,primitive,cls,reporter){var res;if(tag==='seqof')
tag='seq';else if(tag==='setof')
tag='set';if(der.tagByName.hasOwnProperty(tag))
res=der.tagByName[tag];else if(typeof tag==='number'&&(tag|0)===tag)
res=tag;else return reporter.error('Unknown tag: '+tag);if(res>=0x1f)
return reporter.error('Multi-octet tag encoding unsupported');if(!primitive)
res|=0x20;res|=(der.tagClassByName[cls||'universal']<<6);return res}},{"../../asn1":2,"buffer":54,"inherits":108}],14:[function(require,module,exports){var encoders=exports;encoders.der=require('./der');encoders.pem=require('./pem')},{"./der":13,"./pem":15}],15:[function(require,module,exports){var inherits=require('inherits');var DEREncoder=require('./der');function PEMEncoder(entity){DEREncoder.call(this,entity);this.enc='pem'};inherits(PEMEncoder,DEREncoder);module.exports=PEMEncoder;PEMEncoder.prototype.encode=function encode(data,options){var buf=DEREncoder.prototype.encode.call(this,data);var p=buf.toString('base64');var out=['-----BEGIN '+options.label+'-----'];for(var i=0;i<p.length;i+=64)
out.push(p.slice(i,i+64));out.push('-----END '+options.label+'-----');return out.join('\n')}},{"./der":13,"inherits":108}],16:[function(require,module,exports){(function(global){'use strict';var objectAssign=require('object-assign');function compare(a,b){if(a===b){return 0}
var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}
if(x<y){return-1}
if(y<x){return 1}
return 0}
function isBuffer(b){if(global.Buffer&&typeof global.Buffer.isBuffer==='function'){return global.Buffer.isBuffer(b)}
return!!(b!=null&&b._isBuffer)}
var util=require('util/');var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames=(function(){return function foo(){}.name==='foo'}());function pToString(obj){return Object.prototype.toString.call(obj)}
function isView(arrbuf){if(isBuffer(arrbuf)){return!1}
if(typeof global.ArrayBuffer!=='function'){return!1}
if(typeof ArrayBuffer.isView==='function'){return ArrayBuffer.isView(arrbuf)}
if(!arrbuf){return!1}
if(arrbuf instanceof DataView){return!0}
if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer){return!0}
return!1}
var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func)){return}
if(functionsHaveNames){return func.name}
var str=func.toString();var match=str.match(regex);return match&&match[1]}
assert.AssertionError=function AssertionError(options){this.name='AssertionError';this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=!1}else{this.message=getMessage(this);this.generatedMessage=!0}
var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error();if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf('\n'+fn_name);if(idx>=0){var next_line=out.indexOf('\n',idx+1);out=out.substring(next_line+1)}
this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){if(typeof s==='string'){return s.length<n?s:s.slice(0,n)}else{return s}}
function inspect(something){if(functionsHaveNames||!util.isFunction(something)){return util.inspect(something)}
var rawname=getName(something);var name=rawname?': '+rawname:'';return'[Function'+name+']'}
function getMessage(self){return truncate(inspect(self.actual),128)+' '+self.operator+' '+truncate(inspect(self.expected),128)}
function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}
assert.fail=fail;function ok(value,message){if(!value)fail(value,!0,message,'==',assert.ok)}
assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,'==',assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,'!=',assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected,!1)){fail(actual,expected,message,'deepEqual',assert.deepEqual)}};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){if(!_deepEqual(actual,expected,!0)){fail(actual,expected,message,'deepStrictEqual',assert.deepStrictEqual)}};function _deepEqual(actual,expected,strict,memos){if(actual===expected){return!0}else if(isBuffer(actual)&&isBuffer(expected)){return compare(actual,expected)===0}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if((actual===null||typeof actual!=='object')&&(expected===null||typeof expected!=='object')){return strict?actual===expected:actual==expected}else if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array)){return compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer))===0}else if(isBuffer(actual)!==isBuffer(expected)){return!1}else{memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(actualIndex!==-1){if(actualIndex===memos.expected.indexOf(expected)){return!0}}
memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}}
function isArguments(object){return Object.prototype.toString.call(object)=='[object Arguments]'}
function objEquiv(a,b,strict,actualVisitedObjects){if(a===null||a===undefined||b===null||b===undefined)
return!1;if(util.isPrimitive(a)||util.isPrimitive(b))
return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))
return!1;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if((aIsArgs&&!bIsArgs)||(!aIsArgs&&bIsArgs))
return!1;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}
var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)
return!1;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!==kb[i])
return!1}
for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))
return!1}
return!0}
assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected,!1)){fail(actual,expected,message,'notDeepEqual',assert.notDeepEqual)}};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){if(_deepEqual(actual,expected,!0)){fail(actual,expected,message,'notDeepStrictEqual',notDeepStrictEqual)}}
assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,'===',assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,'!==',assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return!1}
if(Object.prototype.toString.call(expected)=='[object RegExp]'){return expected.test(actual)}
try{if(actual instanceof expected){return!0}}catch(e){}
if(Error.isPrototypeOf(expected)){return!1}
return expected.call({},actual)===!0}
function _tryBlock(block){var error;try{block()}catch(e){error=e}
return error}
function _throws(shouldThrow,block,expected,message){var actual;if(typeof block!=='function'){throw new TypeError('"block" argument must be a function')}
if(typeof expected==='string'){message=expected;expected=null}
actual=_tryBlock(block);message=(expected&&expected.name?' ('+expected.name+').':'.')+(message?' '+message:'.');if(shouldThrow&&!actual){fail(actual,expected,'Missing expected exception'+message)}
var userProvidedMessage=typeof message==='string';var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;if((isUnwantedException&&userProvidedMessage&&expectedException(actual,expected))||isUnexpectedException){fail(actual,expected,'Got unwanted exception'+message)}
if((shouldThrow&&actual&&expected&&!expectedException(actual,expected))||(!shouldThrow&&actual)){throw actual}}
assert.throws=function(block,error,message){_throws(!0,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(!1,block,error,message)};assert.ifError=function(err){if(err)throw err};function strict(value,message){if(!value)fail(value,!0,message,'==',strict)}
assert.strict=objectAssign(strict,assert,{equal:assert.strictEqual,deepEqual:assert.deepStrictEqual,notEqual:assert.notStrictEqual,notDeepEqual:assert.notDeepStrictEqual});assert.strict.strict=assert.strict;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}
return keys}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"object-assign":115,"util/":19}],17:[function(require,module,exports){if(typeof Object.create==='function'){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor
ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor
var TempCtor=function(){}
TempCtor.prototype=superCtor.prototype
ctor.prototype=new TempCtor()
ctor.prototype.constructor=ctor}}},{}],18:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==='object'&&typeof arg.copy==='function'&&typeof arg.fill==='function'&&typeof arg.readUInt8==='function'}},{}],19:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}
return objects.join(' ')}
var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==='%%')return'%';if(i>=len)return x;switch(x){case '%s':return String(args[i++]);case '%d':return Number(args[i++]);case '%j':try{return JSON.stringify(args[i++])}catch(_){return'[Circular]'}
default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=' '+x}else{str+=' '+inspect(x)}}
return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}
if(process.noDeprecation===!0){return fn}
var warned=!1;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}
warned=!0}
return fn.apply(this,arguments)}
return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))
debugEnviron=process.env.NODE_DEBUG||'';set=set.toUpperCase();if(!debugs[set]){if(new RegExp('\\b'+set+'\\b','i').test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error('%s %d: %s',set,pid,msg)}}else{debugs[set]=function(){}}}
return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}
if(isUndefined(ctx.showHidden))ctx.showHidden=!1;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=!1;if(isUndefined(ctx.customInspect))ctx.customInspect=!0;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}
exports.inspect=inspect;inspect.colors={'bold':[1,22],'italic':[3,23],'underline':[4,24],'inverse':[7,27],'white':[37,39],'grey':[90,39],'black':[30,39],'blue':[34,39],'cyan':[36,39],'green':[32,39],'magenta':[35,39],'red':[31,39],'yellow':[33,39]};inspect.styles={'special':'cyan','number':'yellow','boolean':'yellow','undefined':'grey','null':'bold','string':'green','date':'magenta','regexp':'red'};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return'\u001b['+inspect.colors[style][0]+'m'+str+'\u001b['+inspect.colors[style][1]+'m'}else{return str}}
function stylizeNoColor(str,styleType){return str}
function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=!0});return hash}
function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}
return ret}
var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}
var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}
if(isError(value)&&(keys.indexOf('message')>=0||keys.indexOf('description')>=0)){return formatError(value)}
if(keys.length===0){if(isFunction(value)){var name=value.name?': '+value.name:'';return ctx.stylize('[Function'+name+']','special')}
if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),'regexp')}
if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),'date')}
if(isError(value)){return formatError(value)}}
var base='',array=!1,braces=['{','}'];if(isArray(value)){array=!0;braces=['[',']']}
if(isFunction(value)){var n=value.name?': '+value.name:'';base=' [Function'+n+']'}
if(isRegExp(value)){base=' '+RegExp.prototype.toString.call(value)}
if(isDate(value)){base=' '+Date.prototype.toUTCString.call(value)}
if(isError(value)){base=' '+formatError(value)}
if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}
if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),'regexp')}else{return ctx.stylize('[Object]','special')}}
ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}
ctx.seen.pop();return reduceToSingleString(output,base,braces)}
function formatPrimitive(ctx,value){if(isUndefined(value))
return ctx.stylize('undefined','undefined');if(isString(value)){var simple='\''+JSON.stringify(value).replace(/^"|"$/g,'').replace(/'/g,"\\'").replace(/\\"/g,'"')+'\'';return ctx.stylize(simple,'string')}
if(isNumber(value))
return ctx.stylize(''+value,'number');if(isBoolean(value))
return ctx.stylize(''+value,'boolean');if(isNull(value))
return ctx.stylize('null','null')}
function formatError(value){return'['+Error.prototype.toString.call(value)+']'}
function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0))}else{output.push('')}}
keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}});return output}
function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize('[Getter/Setter]','special')}else{str=ctx.stylize('[Getter]','special')}}else{if(desc.set){str=ctx.stylize('[Setter]','special')}}
if(!hasOwnProperty(visibleKeys,key)){name='['+key+']'}
if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}
if(str.indexOf('\n')>-1){if(array){str=str.split('\n').map(function(line){return'  '+line}).join('\n').substr(2)}else{str='\n'+str.split('\n').map(function(line){return'   '+line}).join('\n')}}}else{str=ctx.stylize('[Circular]','special')}}
if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}
name=JSON.stringify(''+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,'name')}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,'string')}}
return name+': '+str}
function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf('\n')>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,'').length+1},0);if(length>60){return braces[0]+(base===''?'':base+'\n ')+' '+output.join(',\n  ')+' '+braces[1]}
return braces[0]+base+' '+output.join(', ')+' '+braces[1]}
function isArray(ar){return Array.isArray(ar)}
exports.isArray=isArray;function isBoolean(arg){return typeof arg==='boolean'}
exports.isBoolean=isBoolean;function isNull(arg){return arg===null}
exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}
exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==='number'}
exports.isNumber=isNumber;function isString(arg){return typeof arg==='string'}
exports.isString=isString;function isSymbol(arg){return typeof arg==='symbol'}
exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}
exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==='[object RegExp]'}
exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==='object'&&arg!==null}
exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==='[object Date]'}
exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==='[object Error]'||e instanceof Error)}
exports.isError=isError;function isFunction(arg){return typeof arg==='function'}
exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==='boolean'||typeof arg==='number'||typeof arg==='string'||typeof arg==='symbol'||typeof arg==='undefined'}
exports.isPrimitive=isPrimitive;exports.isBuffer=require('./support/isBuffer');function objectToString(o){return Object.prototype.toString.call(o)}
function pad(n){return n<10?'0'+n.toString(10):n.toString(10)}
var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];function timestamp(){var d=new Date();var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(':');return[d.getDate(),months[d.getMonth()],time].join(' ')}
exports.log=function(){console.log('%s - %s',timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require('inherits');exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}
return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":18,"_process":139,"inherits":17}],20:[function(require,module,exports){'use strict'
exports.byteLength=byteLength
exports.toByteArray=toByteArray
exports.fromByteArray=fromByteArray
var lookup=[]
var revLookup=[]
var Arr=typeof Uint8Array!=='undefined'?Uint8Array:Array
var code='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i]
revLookup[code.charCodeAt(i)]=i}
revLookup['-'.charCodeAt(0)]=62
revLookup['_'.charCodeAt(0)]=63
function getLens(b64){var len=b64.length
if(len%4>0){throw new Error('Invalid string. Length must be a multiple of 4')}
var validLen=b64.indexOf('=')
if(validLen===-1)validLen=len
var placeHoldersLen=validLen===len?0:4-(validLen%4)
return[validLen,placeHoldersLen]}
function byteLength(b64){var lens=getLens(b64)
var validLen=lens[0]
var placeHoldersLen=lens[1]
return((validLen+placeHoldersLen)*3/4)-placeHoldersLen}
function _byteLength(b64,validLen,placeHoldersLen){return((validLen+placeHoldersLen)*3/4)-placeHoldersLen}
function toByteArray(b64){var tmp
var lens=getLens(b64)
var validLen=lens[0]
var placeHoldersLen=lens[1]
var arr=new Arr(_byteLength(b64,validLen,placeHoldersLen))
var curByte=0
var len=placeHoldersLen>0?validLen-4:validLen
for(var i=0;i<len;i+=4){tmp=(revLookup[b64.charCodeAt(i)]<<18)|(revLookup[b64.charCodeAt(i+1)]<<12)|(revLookup[b64.charCodeAt(i+2)]<<6)|revLookup[b64.charCodeAt(i+3)]
arr[curByte++]=(tmp>>16)&0xFF
arr[curByte++]=(tmp>>8)&0xFF
arr[curByte++]=tmp&0xFF}
if(placeHoldersLen===2){tmp=(revLookup[b64.charCodeAt(i)]<<2)|(revLookup[b64.charCodeAt(i+1)]>>4)
arr[curByte++]=tmp&0xFF}
if(placeHoldersLen===1){tmp=(revLookup[b64.charCodeAt(i)]<<10)|(revLookup[b64.charCodeAt(i+1)]<<4)|(revLookup[b64.charCodeAt(i+2)]>>2)
arr[curByte++]=(tmp>>8)&0xFF
arr[curByte++]=tmp&0xFF}
return arr}
function tripletToBase64(num){return lookup[num>>18&0x3F]+lookup[num>>12&0x3F]+lookup[num>>6&0x3F]+lookup[num&0x3F]}
function encodeChunk(uint8,start,end){var tmp
var output=[]
for(var i=start;i<end;i+=3){tmp=((uint8[i]<<16)&0xFF0000)+((uint8[i+1]<<8)&0xFF00)+(uint8[i+2]&0xFF)
output.push(tripletToBase64(tmp))}
return output.join('')}
function fromByteArray(uint8){var tmp
var len=uint8.length
var extraBytes=len%3
var parts=[]
var maxChunkLength=16383
for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,(i+maxChunkLength)>len2?len2:(i+maxChunkLength)))}
if(extraBytes===1){tmp=uint8[len-1]
parts.push(lookup[tmp>>2]+lookup[(tmp<<4)&0x3F]+'==')}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1]
parts.push(lookup[tmp>>10]+lookup[(tmp>>4)&0x3F]+lookup[(tmp<<2)&0x3F]+'=')}
return parts.join('')}},{}],21:[function(require,module,exports){(function(module,exports){'use strict';function assert(val,msg){if(!val)throw new Error(msg||'Assertion failed')}
function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor();ctor.prototype.constructor=ctor}
function BN(number,base,endian){if(BN.isBN(number)){return number}
this.negative=0;this.words=null;this.length=0;this.red=null;if(number!==null){if(base==='le'||base==='be'){endian=base;base=10}
this._init(number||0,base||10,endian||'be')}}
if(typeof module==='object'){module.exports=BN}else{exports.BN=BN}
BN.BN=BN;BN.wordSize=26;var Buffer;try{Buffer=require('buffer').Buffer}catch(e){}
BN.isBN=function isBN(num){if(num instanceof BN){return!0}
return num!==null&&typeof num==='object'&&num.constructor.wordSize===BN.wordSize&&Array.isArray(num.words)};BN.max=function max(left,right){if(left.cmp(right)>0)return left;return right};BN.min=function min(left,right){if(left.cmp(right)<0)return left;return right};BN.prototype._init=function init(number,base,endian){if(typeof number==='number'){return this._initNumber(number,base,endian)}
if(typeof number==='object'){return this._initArray(number,base,endian)}
if(base==='hex'){base=16}
assert(base===(base|0)&&base>=2&&base<=36);number=number.toString().replace(/\s+/g,'');var start=0;if(number[0]==='-'){start++}
if(base===16){this._parseHex(number,start)}else{this._parseBase(number,base,start)}
if(number[0]==='-'){this.negative=1}
this.strip();if(endian!=='le')return;this._initArray(this.toArray(),base,endian)};BN.prototype._initNumber=function _initNumber(number,base,endian){if(number<0){this.negative=1;number=-number}
if(number<0x4000000){this.words=[number&0x3ffffff];this.length=1}else if(number<0x10000000000000){this.words=[number&0x3ffffff,(number/0x4000000)&0x3ffffff];this.length=2}else{assert(number<0x20000000000000);this.words=[number&0x3ffffff,(number/0x4000000)&0x3ffffff,1];this.length=3}
if(endian!=='le')return;this._initArray(this.toArray(),base,endian)};BN.prototype._initArray=function _initArray(number,base,endian){assert(typeof number.length==='number');if(number.length<=0){this.words=[0];this.length=1;return this}
this.length=Math.ceil(number.length/3);this.words=new Array(this.length);for(var i=0;i<this.length;i++){this.words[i]=0}
var j,w;var off=0;if(endian==='be'){for(i=number.length-1,j=0;i>=0;i-=3){w=number[i]|(number[i-1]<<8)|(number[i-2]<<16);this.words[j]|=(w<<off)&0x3ffffff;this.words[j+1]=(w>>>(26-off))&0x3ffffff;off+=24;if(off>=26){off-=26;j++}}}else if(endian==='le'){for(i=0,j=0;i<number.length;i+=3){w=number[i]|(number[i+1]<<8)|(number[i+2]<<16);this.words[j]|=(w<<off)&0x3ffffff;this.words[j+1]=(w>>>(26-off))&0x3ffffff;off+=24;if(off>=26){off-=26;j++}}}
return this.strip()};function parseHex(str,start,end){var r=0;var len=Math.min(str.length,end);for(var i=start;i<len;i++){var c=str.charCodeAt(i)-48;r<<=4;if(c>=49&&c<=54){r|=c-49+0xa}else if(c>=17&&c<=22){r|=c-17+0xa}else{r|=c&0xf}}
return r}
BN.prototype._parseHex=function _parseHex(number,start){this.length=Math.ceil((number.length-start)/6);this.words=new Array(this.length);for(var i=0;i<this.length;i++){this.words[i]=0}
var j,w;var off=0;for(i=number.length-6,j=0;i>=start;i-=6){w=parseHex(number,i,i+6);this.words[j]|=(w<<off)&0x3ffffff;this.words[j+1]|=w>>>(26-off)&0x3fffff;off+=24;if(off>=26){off-=26;j++}}
if(i+6!==start){w=parseHex(number,start,i+6);this.words[j]|=(w<<off)&0x3ffffff;this.words[j+1]|=w>>>(26-off)&0x3fffff}
this.strip()};function parseBase(str,start,end,mul){var r=0;var len=Math.min(str.length,end);for(var i=start;i<len;i++){var c=str.charCodeAt(i)-48;r*=mul;if(c>=49){r+=c-49+0xa}else if(c>=17){r+=c-17+0xa}else{r+=c}}
return r}
BN.prototype._parseBase=function _parseBase(number,base,start){this.words=[0];this.length=1;for(var limbLen=0,limbPow=1;limbPow<=0x3ffffff;limbPow*=base){limbLen++}
limbLen--;limbPow=(limbPow/base)|0;var total=number.length-start;var mod=total%limbLen;var end=Math.min(total,total-mod)+start;var word=0;for(var i=start;i<end;i+=limbLen){word=parseBase(number,i,i+limbLen,base);this.imuln(limbPow);if(this.words[0]+word<0x4000000){this.words[0]+=word}else{this._iaddn(word)}}
if(mod!==0){var pow=1;word=parseBase(number,i,number.length,base);for(i=0;i<mod;i++){pow*=base}
this.imuln(pow);if(this.words[0]+word<0x4000000){this.words[0]+=word}else{this._iaddn(word)}}};BN.prototype.copy=function copy(dest){dest.words=new Array(this.length);for(var i=0;i<this.length;i++){dest.words[i]=this.words[i]}
dest.length=this.length;dest.negative=this.negative;dest.red=this.red};BN.prototype.clone=function clone(){var r=new BN(null);this.copy(r);return r};BN.prototype._expand=function _expand(size){while(this.length<size){this.words[this.length++]=0}
return this};BN.prototype.strip=function strip(){while(this.length>1&&this.words[this.length-1]===0){this.length--}
return this._normSign()};BN.prototype._normSign=function _normSign(){if(this.length===1&&this.words[0]===0){this.negative=0}
return this};BN.prototype.inspect=function inspect(){return(this.red?'<BN-R: ':'<BN: ')+this.toString(16)+'>'};var zeros=['','0','00','000','0000','00000','000000','0000000','00000000','000000000','0000000000','00000000000','000000000000','0000000000000','00000000000000','000000000000000','0000000000000000','00000000000000000','000000000000000000','0000000000000000000','00000000000000000000','000000000000000000000','0000000000000000000000','00000000000000000000000','000000000000000000000000','0000000000000000000000000'];var groupSizes=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];var groupBases=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,10000000,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64000000,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,24300000,28629151,33554432,39135393,45435424,52521875,60466176];BN.prototype.toString=function toString(base,padding){base=base||10;padding=padding|0||1;var out;if(base===16||base==='hex'){out='';var off=0;var carry=0;for(var i=0;i<this.length;i++){var w=this.words[i];var word=(((w<<off)|carry)&0xffffff).toString(16);carry=(w>>>(24-off))&0xffffff;if(carry!==0||i!==this.length-1){out=zeros[6-word.length]+word+out}else{out=word+out}
off+=2;if(off>=26){off-=26;i--}}
if(carry!==0){out=carry.toString(16)+out}
while(out.length%padding!==0){out='0'+out}
if(this.negative!==0){out='-'+out}
return out}
if(base===(base|0)&&base>=2&&base<=36){var groupSize=groupSizes[base];var groupBase=groupBases[base];out='';var c=this.clone();c.negative=0;while(!c.isZero()){var r=c.modn(groupBase).toString(base);c=c.idivn(groupBase);if(!c.isZero()){out=zeros[groupSize-r.length]+r+out}else{out=r+out}}
if(this.isZero()){out='0'+out}
while(out.length%padding!==0){out='0'+out}
if(this.negative!==0){out='-'+out}
return out}
assert(!1,'Base should be between 2 and 36')};BN.prototype.toNumber=function toNumber(){var ret=this.words[0];if(this.length===2){ret+=this.words[1]*0x4000000}else if(this.length===3&&this.words[2]===0x01){ret+=0x10000000000000+(this.words[1]*0x4000000)}else if(this.length>2){assert(!1,'Number can only safely store up to 53 bits')}
return(this.negative!==0)?-ret:ret};BN.prototype.toJSON=function toJSON(){return this.toString(16)};BN.prototype.toBuffer=function toBuffer(endian,length){assert(typeof Buffer!=='undefined');return this.toArrayLike(Buffer,endian,length)};BN.prototype.toArray=function toArray(endian,length){return this.toArrayLike(Array,endian,length)};BN.prototype.toArrayLike=function toArrayLike(ArrayType,endian,length){var byteLength=this.byteLength();var reqLength=length||Math.max(1,byteLength);assert(byteLength<=reqLength,'byte array longer than desired length');assert(reqLength>0,'Requested array length <= 0');this.strip();var littleEndian=endian==='le';var res=new ArrayType(reqLength);var b,i;var q=this.clone();if(!littleEndian){for(i=0;i<reqLength-byteLength;i++){res[i]=0}
for(i=0;!q.isZero();i++){b=q.andln(0xff);q.iushrn(8);res[reqLength-i-1]=b}}else{for(i=0;!q.isZero();i++){b=q.andln(0xff);q.iushrn(8);res[i]=b}
for(;i<reqLength;i++){res[i]=0}}
return res};if(Math.clz32){BN.prototype._countBits=function _countBits(w){return 32-Math.clz32(w)}}else{BN.prototype._countBits=function _countBits(w){var t=w;var r=0;if(t>=0x1000){r+=13;t>>>=13}
if(t>=0x40){r+=7;t>>>=7}
if(t>=0x8){r+=4;t>>>=4}
if(t>=0x02){r+=2;t>>>=2}
return r+t}}
BN.prototype._zeroBits=function _zeroBits(w){if(w===0)return 26;var t=w;var r=0;if((t&0x1fff)===0){r+=13;t>>>=13}
if((t&0x7f)===0){r+=7;t>>>=7}
if((t&0xf)===0){r+=4;t>>>=4}
if((t&0x3)===0){r+=2;t>>>=2}
if((t&0x1)===0){r++}
return r};BN.prototype.bitLength=function bitLength(){var w=this.words[this.length-1];var hi=this._countBits(w);return(this.length-1)*26+hi};function toBitArray(num){var w=new Array(num.bitLength());for(var bit=0;bit<w.length;bit++){var off=(bit/26)|0;var wbit=bit%26;w[bit]=(num.words[off]&(1<<wbit))>>>wbit}
return w}
BN.prototype.zeroBits=function zeroBits(){if(this.isZero())return 0;var r=0;for(var i=0;i<this.length;i++){var b=this._zeroBits(this.words[i]);r+=b;if(b!==26)break}
return r};BN.prototype.byteLength=function byteLength(){return Math.ceil(this.bitLength()/8)};BN.prototype.toTwos=function toTwos(width){if(this.negative!==0){return this.abs().inotn(width).iaddn(1)}
return this.clone()};BN.prototype.fromTwos=function fromTwos(width){if(this.testn(width-1)){return this.notn(width).iaddn(1).ineg()}
return this.clone()};BN.prototype.isNeg=function isNeg(){return this.negative!==0};BN.prototype.neg=function neg(){return this.clone().ineg()};BN.prototype.ineg=function ineg(){if(!this.isZero()){this.negative^=1}
return this};BN.prototype.iuor=function iuor(num){while(this.length<num.length){this.words[this.length++]=0}
for(var i=0;i<num.length;i++){this.words[i]=this.words[i]|num.words[i]}
return this.strip()};BN.prototype.ior=function ior(num){assert((this.negative|num.negative)===0);return this.iuor(num)};BN.prototype.or=function or(num){if(this.length>num.length)return this.clone().ior(num);return num.clone().ior(this)};BN.prototype.uor=function uor(num){if(this.length>num.length)return this.clone().iuor(num);return num.clone().iuor(this)};BN.prototype.iuand=function iuand(num){var b;if(this.length>num.length){b=num}else{b=this}
for(var i=0;i<b.length;i++){this.words[i]=this.words[i]&num.words[i]}
this.length=b.length;return this.strip()};BN.prototype.iand=function iand(num){assert((this.negative|num.negative)===0);return this.iuand(num)};BN.prototype.and=function and(num){if(this.length>num.length)return this.clone().iand(num);return num.clone().iand(this)};BN.prototype.uand=function uand(num){if(this.length>num.length)return this.clone().iuand(num);return num.clone().iuand(this)};BN.prototype.iuxor=function iuxor(num){var a;var b;if(this.length>num.length){a=this;b=num}else{a=num;b=this}
for(var i=0;i<b.length;i++){this.words[i]=a.words[i]^b.words[i]}
if(this!==a){for(;i<a.length;i++){this.words[i]=a.words[i]}}
this.length=a.length;return this.strip()};BN.prototype.ixor=function ixor(num){assert((this.negative|num.negative)===0);return this.iuxor(num)};BN.prototype.xor=function xor(num){if(this.length>num.length)return this.clone().ixor(num);return num.clone().ixor(this)};BN.prototype.uxor=function uxor(num){if(this.length>num.length)return this.clone().iuxor(num);return num.clone().iuxor(this)};BN.prototype.inotn=function inotn(width){assert(typeof width==='number'&&width>=0);var bytesNeeded=Math.ceil(width/26)|0;var bitsLeft=width%26;this._expand(bytesNeeded);if(bitsLeft>0){bytesNeeded--}
for(var i=0;i<bytesNeeded;i++){this.words[i]=~this.words[i]&0x3ffffff}
if(bitsLeft>0){this.words[i]=~this.words[i]&(0x3ffffff>>(26-bitsLeft))}
return this.strip()};BN.prototype.notn=function notn(width){return this.clone().inotn(width)};BN.prototype.setn=function setn(bit,val){assert(typeof bit==='number'&&bit>=0);var off=(bit/26)|0;var wbit=bit%26;this._expand(off+1);if(val){this.words[off]=this.words[off]|(1<<wbit)}else{this.words[off]=this.words[off]&~(1<<wbit)}
return this.strip()};BN.prototype.iadd=function iadd(num){var r;if(this.negative!==0&&num.negative===0){this.negative=0;r=this.isub(num);this.negative^=1;return this._normSign()}else if(this.negative===0&&num.negative!==0){num.negative=0;r=this.isub(num);num.negative=1;return r._normSign()}
var a,b;if(this.length>num.length){a=this;b=num}else{a=num;b=this}
var carry=0;for(var i=0;i<b.length;i++){r=(a.words[i]|0)+(b.words[i]|0)+carry;this.words[i]=r&0x3ffffff;carry=r>>>26}
for(;carry!==0&&i<a.length;i++){r=(a.words[i]|0)+carry;this.words[i]=r&0x3ffffff;carry=r>>>26}
this.length=a.length;if(carry!==0){this.words[this.length]=carry;this.length++}else if(a!==this){for(;i<a.length;i++){this.words[i]=a.words[i]}}
return this};BN.prototype.add=function add(num){var res;if(num.negative!==0&&this.negative===0){num.negative=0;res=this.sub(num);num.negative^=1;return res}else if(num.negative===0&&this.negative!==0){this.negative=0;res=num.sub(this);this.negative=1;return res}
if(this.length>num.length)return this.clone().iadd(num);return num.clone().iadd(this)};BN.prototype.isub=function isub(num){if(num.negative!==0){num.negative=0;var r=this.iadd(num);num.negative=1;return r._normSign()}else if(this.negative!==0){this.negative=0;this.iadd(num);this.negative=1;return this._normSign()}
var cmp=this.cmp(num);if(cmp===0){this.negative=0;this.length=1;this.words[0]=0;return this}
var a,b;if(cmp>0){a=this;b=num}else{a=num;b=this}
var carry=0;for(var i=0;i<b.length;i++){r=(a.words[i]|0)-(b.words[i]|0)+carry;carry=r>>26;this.words[i]=r&0x3ffffff}
for(;carry!==0&&i<a.length;i++){r=(a.words[i]|0)+carry;carry=r>>26;this.words[i]=r&0x3ffffff}
if(carry===0&&i<a.length&&a!==this){for(;i<a.length;i++){this.words[i]=a.words[i]}}
this.length=Math.max(this.length,i);if(a!==this){this.negative=1}
return this.strip()};BN.prototype.sub=function sub(num){return this.clone().isub(num)};function smallMulTo(self,num,out){out.negative=num.negative^self.negative;var len=(self.length+num.length)|0;out.length=len;len=(len-1)|0;var a=self.words[0]|0;var b=num.words[0]|0;var r=a*b;var lo=r&0x3ffffff;var carry=(r/0x4000000)|0;out.words[0]=lo;for(var k=1;k<len;k++){var ncarry=carry>>>26;var rword=carry&0x3ffffff;var maxJ=Math.min(k,num.length-1);for(var j=Math.max(0,k-self.length+1);j<=maxJ;j++){var i=(k-j)|0;a=self.words[i]|0;b=num.words[j]|0;r=a*b+rword;ncarry+=(r/0x4000000)|0;rword=r&0x3ffffff}
out.words[k]=rword|0;carry=ncarry|0}
if(carry!==0){out.words[k]=carry|0}else{out.length--}
return out.strip()}
var comb10MulTo=function comb10MulTo(self,num,out){var a=self.words;var b=num.words;var o=out.words;var c=0;var lo;var mid;var hi;var a0=a[0]|0;var al0=a0&0x1fff;var ah0=a0>>>13;var a1=a[1]|0;var al1=a1&0x1fff;var ah1=a1>>>13;var a2=a[2]|0;var al2=a2&0x1fff;var ah2=a2>>>13;var a3=a[3]|0;var al3=a3&0x1fff;var ah3=a3>>>13;var a4=a[4]|0;var al4=a4&0x1fff;var ah4=a4>>>13;var a5=a[5]|0;var al5=a5&0x1fff;var ah5=a5>>>13;var a6=a[6]|0;var al6=a6&0x1fff;var ah6=a6>>>13;var a7=a[7]|0;var al7=a7&0x1fff;var ah7=a7>>>13;var a8=a[8]|0;var al8=a8&0x1fff;var ah8=a8>>>13;var a9=a[9]|0;var al9=a9&0x1fff;var ah9=a9>>>13;var b0=b[0]|0;var bl0=b0&0x1fff;var bh0=b0>>>13;var b1=b[1]|0;var bl1=b1&0x1fff;var bh1=b1>>>13;var b2=b[2]|0;var bl2=b2&0x1fff;var bh2=b2>>>13;var b3=b[3]|0;var bl3=b3&0x1fff;var bh3=b3>>>13;var b4=b[4]|0;var bl4=b4&0x1fff;var bh4=b4>>>13;var b5=b[5]|0;var bl5=b5&0x1fff;var bh5=b5>>>13;var b6=b[6]|0;var bl6=b6&0x1fff;var bh6=b6>>>13;var b7=b[7]|0;var bl7=b7&0x1fff;var bh7=b7>>>13;var b8=b[8]|0;var bl8=b8&0x1fff;var bh8=b8>>>13;var b9=b[9]|0;var bl9=b9&0x1fff;var bh9=b9>>>13;out.negative=self.negative^num.negative;out.length=19;lo=Math.imul(al0,bl0);mid=Math.imul(al0,bh0);mid=(mid+Math.imul(ah0,bl0))|0;hi=Math.imul(ah0,bh0);var w0=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w0>>>26))|0;w0&=0x3ffffff;lo=Math.imul(al1,bl0);mid=Math.imul(al1,bh0);mid=(mid+Math.imul(ah1,bl0))|0;hi=Math.imul(ah1,bh0);lo=(lo+Math.imul(al0,bl1))|0;mid=(mid+Math.imul(al0,bh1))|0;mid=(mid+Math.imul(ah0,bl1))|0;hi=(hi+Math.imul(ah0,bh1))|0;var w1=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w1>>>26))|0;w1&=0x3ffffff;lo=Math.imul(al2,bl0);mid=Math.imul(al2,bh0);mid=(mid+Math.imul(ah2,bl0))|0;hi=Math.imul(ah2,bh0);lo=(lo+Math.imul(al1,bl1))|0;mid=(mid+Math.imul(al1,bh1))|0;mid=(mid+Math.imul(ah1,bl1))|0;hi=(hi+Math.imul(ah1,bh1))|0;lo=(lo+Math.imul(al0,bl2))|0;mid=(mid+Math.imul(al0,bh2))|0;mid=(mid+Math.imul(ah0,bl2))|0;hi=(hi+Math.imul(ah0,bh2))|0;var w2=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w2>>>26))|0;w2&=0x3ffffff;lo=Math.imul(al3,bl0);mid=Math.imul(al3,bh0);mid=(mid+Math.imul(ah3,bl0))|0;hi=Math.imul(ah3,bh0);lo=(lo+Math.imul(al2,bl1))|0;mid=(mid+Math.imul(al2,bh1))|0;mid=(mid+Math.imul(ah2,bl1))|0;hi=(hi+Math.imul(ah2,bh1))|0;lo=(lo+Math.imul(al1,bl2))|0;mid=(mid+Math.imul(al1,bh2))|0;mid=(mid+Math.imul(ah1,bl2))|0;hi=(hi+Math.imul(ah1,bh2))|0;lo=(lo+Math.imul(al0,bl3))|0;mid=(mid+Math.imul(al0,bh3))|0;mid=(mid+Math.imul(ah0,bl3))|0;hi=(hi+Math.imul(ah0,bh3))|0;var w3=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w3>>>26))|0;w3&=0x3ffffff;lo=Math.imul(al4,bl0);mid=Math.imul(al4,bh0);mid=(mid+Math.imul(ah4,bl0))|0;hi=Math.imul(ah4,bh0);lo=(lo+Math.imul(al3,bl1))|0;mid=(mid+Math.imul(al3,bh1))|0;mid=(mid+Math.imul(ah3,bl1))|0;hi=(hi+Math.imul(ah3,bh1))|0;lo=(lo+Math.imul(al2,bl2))|0;mid=(mid+Math.imul(al2,bh2))|0;mid=(mid+Math.imul(ah2,bl2))|0;hi=(hi+Math.imul(ah2,bh2))|0;lo=(lo+Math.imul(al1,bl3))|0;mid=(mid+Math.imul(al1,bh3))|0;mid=(mid+Math.imul(ah1,bl3))|0;hi=(hi+Math.imul(ah1,bh3))|0;lo=(lo+Math.imul(al0,bl4))|0;mid=(mid+Math.imul(al0,bh4))|0;mid=(mid+Math.imul(ah0,bl4))|0;hi=(hi+Math.imul(ah0,bh4))|0;var w4=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w4>>>26))|0;w4&=0x3ffffff;lo=Math.imul(al5,bl0);mid=Math.imul(al5,bh0);mid=(mid+Math.imul(ah5,bl0))|0;hi=Math.imul(ah5,bh0);lo=(lo+Math.imul(al4,bl1))|0;mid=(mid+Math.imul(al4,bh1))|0;mid=(mid+Math.imul(ah4,bl1))|0;hi=(hi+Math.imul(ah4,bh1))|0;lo=(lo+Math.imul(al3,bl2))|0;mid=(mid+Math.imul(al3,bh2))|0;mid=(mid+Math.imul(ah3,bl2))|0;hi=(hi+Math.imul(ah3,bh2))|0;lo=(lo+Math.imul(al2,bl3))|0;mid=(mid+Math.imul(al2,bh3))|0;mid=(mid+Math.imul(ah2,bl3))|0;hi=(hi+Math.imul(ah2,bh3))|0;lo=(lo+Math.imul(al1,bl4))|0;mid=(mid+Math.imul(al1,bh4))|0;mid=(mid+Math.imul(ah1,bl4))|0;hi=(hi+Math.imul(ah1,bh4))|0;lo=(lo+Math.imul(al0,bl5))|0;mid=(mid+Math.imul(al0,bh5))|0;mid=(mid+Math.imul(ah0,bl5))|0;hi=(hi+Math.imul(ah0,bh5))|0;var w5=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w5>>>26))|0;w5&=0x3ffffff;lo=Math.imul(al6,bl0);mid=Math.imul(al6,bh0);mid=(mid+Math.imul(ah6,bl0))|0;hi=Math.imul(ah6,bh0);lo=(lo+Math.imul(al5,bl1))|0;mid=(mid+Math.imul(al5,bh1))|0;mid=(mid+Math.imul(ah5,bl1))|0;hi=(hi+Math.imul(ah5,bh1))|0;lo=(lo+Math.imul(al4,bl2))|0;mid=(mid+Math.imul(al4,bh2))|0;mid=(mid+Math.imul(ah4,bl2))|0;hi=(hi+Math.imul(ah4,bh2))|0;lo=(lo+Math.imul(al3,bl3))|0;mid=(mid+Math.imul(al3,bh3))|0;mid=(mid+Math.imul(ah3,bl3))|0;hi=(hi+Math.imul(ah3,bh3))|0;lo=(lo+Math.imul(al2,bl4))|0;mid=(mid+Math.imul(al2,bh4))|0;mid=(mid+Math.imul(ah2,bl4))|0;hi=(hi+Math.imul(ah2,bh4))|0;lo=(lo+Math.imul(al1,bl5))|0;mid=(mid+Math.imul(al1,bh5))|0;mid=(mid+Math.imul(ah1,bl5))|0;hi=(hi+Math.imul(ah1,bh5))|0;lo=(lo+Math.imul(al0,bl6))|0;mid=(mid+Math.imul(al0,bh6))|0;mid=(mid+Math.imul(ah0,bl6))|0;hi=(hi+Math.imul(ah0,bh6))|0;var w6=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w6>>>26))|0;w6&=0x3ffffff;lo=Math.imul(al7,bl0);mid=Math.imul(al7,bh0);mid=(mid+Math.imul(ah7,bl0))|0;hi=Math.imul(ah7,bh0);lo=(lo+Math.imul(al6,bl1))|0;mid=(mid+Math.imul(al6,bh1))|0;mid=(mid+Math.imul(ah6,bl1))|0;hi=(hi+Math.imul(ah6,bh1))|0;lo=(lo+Math.imul(al5,bl2))|0;mid=(mid+Math.imul(al5,bh2))|0;mid=(mid+Math.imul(ah5,bl2))|0;hi=(hi+Math.imul(ah5,bh2))|0;lo=(lo+Math.imul(al4,bl3))|0;mid=(mid+Math.imul(al4,bh3))|0;mid=(mid+Math.imul(ah4,bl3))|0;hi=(hi+Math.imul(ah4,bh3))|0;lo=(lo+Math.imul(al3,bl4))|0;mid=(mid+Math.imul(al3,bh4))|0;mid=(mid+Math.imul(ah3,bl4))|0;hi=(hi+Math.imul(ah3,bh4))|0;lo=(lo+Math.imul(al2,bl5))|0;mid=(mid+Math.imul(al2,bh5))|0;mid=(mid+Math.imul(ah2,bl5))|0;hi=(hi+Math.imul(ah2,bh5))|0;lo=(lo+Math.imul(al1,bl6))|0;mid=(mid+Math.imul(al1,bh6))|0;mid=(mid+Math.imul(ah1,bl6))|0;hi=(hi+Math.imul(ah1,bh6))|0;lo=(lo+Math.imul(al0,bl7))|0;mid=(mid+Math.imul(al0,bh7))|0;mid=(mid+Math.imul(ah0,bl7))|0;hi=(hi+Math.imul(ah0,bh7))|0;var w7=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w7>>>26))|0;w7&=0x3ffffff;lo=Math.imul(al8,bl0);mid=Math.imul(al8,bh0);mid=(mid+Math.imul(ah8,bl0))|0;hi=Math.imul(ah8,bh0);lo=(lo+Math.imul(al7,bl1))|0;mid=(mid+Math.imul(al7,bh1))|0;mid=(mid+Math.imul(ah7,bl1))|0;hi=(hi+Math.imul(ah7,bh1))|0;lo=(lo+Math.imul(al6,bl2))|0;mid=(mid+Math.imul(al6,bh2))|0;mid=(mid+Math.imul(ah6,bl2))|0;hi=(hi+Math.imul(ah6,bh2))|0;lo=(lo+Math.imul(al5,bl3))|0;mid=(mid+Math.imul(al5,bh3))|0;mid=(mid+Math.imul(ah5,bl3))|0;hi=(hi+Math.imul(ah5,bh3))|0;lo=(lo+Math.imul(al4,bl4))|0;mid=(mid+Math.imul(al4,bh4))|0;mid=(mid+Math.imul(ah4,bl4))|0;hi=(hi+Math.imul(ah4,bh4))|0;lo=(lo+Math.imul(al3,bl5))|0;mid=(mid+Math.imul(al3,bh5))|0;mid=(mid+Math.imul(ah3,bl5))|0;hi=(hi+Math.imul(ah3,bh5))|0;lo=(lo+Math.imul(al2,bl6))|0;mid=(mid+Math.imul(al2,bh6))|0;mid=(mid+Math.imul(ah2,bl6))|0;hi=(hi+Math.imul(ah2,bh6))|0;lo=(lo+Math.imul(al1,bl7))|0;mid=(mid+Math.imul(al1,bh7))|0;mid=(mid+Math.imul(ah1,bl7))|0;hi=(hi+Math.imul(ah1,bh7))|0;lo=(lo+Math.imul(al0,bl8))|0;mid=(mid+Math.imul(al0,bh8))|0;mid=(mid+Math.imul(ah0,bl8))|0;hi=(hi+Math.imul(ah0,bh8))|0;var w8=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w8>>>26))|0;w8&=0x3ffffff;lo=Math.imul(al9,bl0);mid=Math.imul(al9,bh0);mid=(mid+Math.imul(ah9,bl0))|0;hi=Math.imul(ah9,bh0);lo=(lo+Math.imul(al8,bl1))|0;mid=(mid+Math.imul(al8,bh1))|0;mid=(mid+Math.imul(ah8,bl1))|0;hi=(hi+Math.imul(ah8,bh1))|0;lo=(lo+Math.imul(al7,bl2))|0;mid=(mid+Math.imul(al7,bh2))|0;mid=(mid+Math.imul(ah7,bl2))|0;hi=(hi+Math.imul(ah7,bh2))|0;lo=(lo+Math.imul(al6,bl3))|0;mid=(mid+Math.imul(al6,bh3))|0;mid=(mid+Math.imul(ah6,bl3))|0;hi=(hi+Math.imul(ah6,bh3))|0;lo=(lo+Math.imul(al5,bl4))|0;mid=(mid+Math.imul(al5,bh4))|0;mid=(mid+Math.imul(ah5,bl4))|0;hi=(hi+Math.imul(ah5,bh4))|0;lo=(lo+Math.imul(al4,bl5))|0;mid=(mid+Math.imul(al4,bh5))|0;mid=(mid+Math.imul(ah4,bl5))|0;hi=(hi+Math.imul(ah4,bh5))|0;lo=(lo+Math.imul(al3,bl6))|0;mid=(mid+Math.imul(al3,bh6))|0;mid=(mid+Math.imul(ah3,bl6))|0;hi=(hi+Math.imul(ah3,bh6))|0;lo=(lo+Math.imul(al2,bl7))|0;mid=(mid+Math.imul(al2,bh7))|0;mid=(mid+Math.imul(ah2,bl7))|0;hi=(hi+Math.imul(ah2,bh7))|0;lo=(lo+Math.imul(al1,bl8))|0;mid=(mid+Math.imul(al1,bh8))|0;mid=(mid+Math.imul(ah1,bl8))|0;hi=(hi+Math.imul(ah1,bh8))|0;lo=(lo+Math.imul(al0,bl9))|0;mid=(mid+Math.imul(al0,bh9))|0;mid=(mid+Math.imul(ah0,bl9))|0;hi=(hi+Math.imul(ah0,bh9))|0;var w9=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w9>>>26))|0;w9&=0x3ffffff;lo=Math.imul(al9,bl1);mid=Math.imul(al9,bh1);mid=(mid+Math.imul(ah9,bl1))|0;hi=Math.imul(ah9,bh1);lo=(lo+Math.imul(al8,bl2))|0;mid=(mid+Math.imul(al8,bh2))|0;mid=(mid+Math.imul(ah8,bl2))|0;hi=(hi+Math.imul(ah8,bh2))|0;lo=(lo+Math.imul(al7,bl3))|0;mid=(mid+Math.imul(al7,bh3))|0;mid=(mid+Math.imul(ah7,bl3))|0;hi=(hi+Math.imul(ah7,bh3))|0;lo=(lo+Math.imul(al6,bl4))|0;mid=(mid+Math.imul(al6,bh4))|0;mid=(mid+Math.imul(ah6,bl4))|0;hi=(hi+Math.imul(ah6,bh4))|0;lo=(lo+Math.imul(al5,bl5))|0;mid=(mid+Math.imul(al5,bh5))|0;mid=(mid+Math.imul(ah5,bl5))|0;hi=(hi+Math.imul(ah5,bh5))|0;lo=(lo+Math.imul(al4,bl6))|0;mid=(mid+Math.imul(al4,bh6))|0;mid=(mid+Math.imul(ah4,bl6))|0;hi=(hi+Math.imul(ah4,bh6))|0;lo=(lo+Math.imul(al3,bl7))|0;mid=(mid+Math.imul(al3,bh7))|0;mid=(mid+Math.imul(ah3,bl7))|0;hi=(hi+Math.imul(ah3,bh7))|0;lo=(lo+Math.imul(al2,bl8))|0;mid=(mid+Math.imul(al2,bh8))|0;mid=(mid+Math.imul(ah2,bl8))|0;hi=(hi+Math.imul(ah2,bh8))|0;lo=(lo+Math.imul(al1,bl9))|0;mid=(mid+Math.imul(al1,bh9))|0;mid=(mid+Math.imul(ah1,bl9))|0;hi=(hi+Math.imul(ah1,bh9))|0;var w10=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w10>>>26))|0;w10&=0x3ffffff;lo=Math.imul(al9,bl2);mid=Math.imul(al9,bh2);mid=(mid+Math.imul(ah9,bl2))|0;hi=Math.imul(ah9,bh2);lo=(lo+Math.imul(al8,bl3))|0;mid=(mid+Math.imul(al8,bh3))|0;mid=(mid+Math.imul(ah8,bl3))|0;hi=(hi+Math.imul(ah8,bh3))|0;lo=(lo+Math.imul(al7,bl4))|0;mid=(mid+Math.imul(al7,bh4))|0;mid=(mid+Math.imul(ah7,bl4))|0;hi=(hi+Math.imul(ah7,bh4))|0;lo=(lo+Math.imul(al6,bl5))|0;mid=(mid+Math.imul(al6,bh5))|0;mid=(mid+Math.imul(ah6,bl5))|0;hi=(hi+Math.imul(ah6,bh5))|0;lo=(lo+Math.imul(al5,bl6))|0;mid=(mid+Math.imul(al5,bh6))|0;mid=(mid+Math.imul(ah5,bl6))|0;hi=(hi+Math.imul(ah5,bh6))|0;lo=(lo+Math.imul(al4,bl7))|0;mid=(mid+Math.imul(al4,bh7))|0;mid=(mid+Math.imul(ah4,bl7))|0;hi=(hi+Math.imul(ah4,bh7))|0;lo=(lo+Math.imul(al3,bl8))|0;mid=(mid+Math.imul(al3,bh8))|0;mid=(mid+Math.imul(ah3,bl8))|0;hi=(hi+Math.imul(ah3,bh8))|0;lo=(lo+Math.imul(al2,bl9))|0;mid=(mid+Math.imul(al2,bh9))|0;mid=(mid+Math.imul(ah2,bl9))|0;hi=(hi+Math.imul(ah2,bh9))|0;var w11=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w11>>>26))|0;w11&=0x3ffffff;lo=Math.imul(al9,bl3);mid=Math.imul(al9,bh3);mid=(mid+Math.imul(ah9,bl3))|0;hi=Math.imul(ah9,bh3);lo=(lo+Math.imul(al8,bl4))|0;mid=(mid+Math.imul(al8,bh4))|0;mid=(mid+Math.imul(ah8,bl4))|0;hi=(hi+Math.imul(ah8,bh4))|0;lo=(lo+Math.imul(al7,bl5))|0;mid=(mid+Math.imul(al7,bh5))|0;mid=(mid+Math.imul(ah7,bl5))|0;hi=(hi+Math.imul(ah7,bh5))|0;lo=(lo+Math.imul(al6,bl6))|0;mid=(mid+Math.imul(al6,bh6))|0;mid=(mid+Math.imul(ah6,bl6))|0;hi=(hi+Math.imul(ah6,bh6))|0;lo=(lo+Math.imul(al5,bl7))|0;mid=(mid+Math.imul(al5,bh7))|0;mid=(mid+Math.imul(ah5,bl7))|0;hi=(hi+Math.imul(ah5,bh7))|0;lo=(lo+Math.imul(al4,bl8))|0;mid=(mid+Math.imul(al4,bh8))|0;mid=(mid+Math.imul(ah4,bl8))|0;hi=(hi+Math.imul(ah4,bh8))|0;lo=(lo+Math.imul(al3,bl9))|0;mid=(mid+Math.imul(al3,bh9))|0;mid=(mid+Math.imul(ah3,bl9))|0;hi=(hi+Math.imul(ah3,bh9))|0;var w12=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w12>>>26))|0;w12&=0x3ffffff;lo=Math.imul(al9,bl4);mid=Math.imul(al9,bh4);mid=(mid+Math.imul(ah9,bl4))|0;hi=Math.imul(ah9,bh4);lo=(lo+Math.imul(al8,bl5))|0;mid=(mid+Math.imul(al8,bh5))|0;mid=(mid+Math.imul(ah8,bl5))|0;hi=(hi+Math.imul(ah8,bh5))|0;lo=(lo+Math.imul(al7,bl6))|0;mid=(mid+Math.imul(al7,bh6))|0;mid=(mid+Math.imul(ah7,bl6))|0;hi=(hi+Math.imul(ah7,bh6))|0;lo=(lo+Math.imul(al6,bl7))|0;mid=(mid+Math.imul(al6,bh7))|0;mid=(mid+Math.imul(ah6,bl7))|0;hi=(hi+Math.imul(ah6,bh7))|0;lo=(lo+Math.imul(al5,bl8))|0;mid=(mid+Math.imul(al5,bh8))|0;mid=(mid+Math.imul(ah5,bl8))|0;hi=(hi+Math.imul(ah5,bh8))|0;lo=(lo+Math.imul(al4,bl9))|0;mid=(mid+Math.imul(al4,bh9))|0;mid=(mid+Math.imul(ah4,bl9))|0;hi=(hi+Math.imul(ah4,bh9))|0;var w13=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w13>>>26))|0;w13&=0x3ffffff;lo=Math.imul(al9,bl5);mid=Math.imul(al9,bh5);mid=(mid+Math.imul(ah9,bl5))|0;hi=Math.imul(ah9,bh5);lo=(lo+Math.imul(al8,bl6))|0;mid=(mid+Math.imul(al8,bh6))|0;mid=(mid+Math.imul(ah8,bl6))|0;hi=(hi+Math.imul(ah8,bh6))|0;lo=(lo+Math.imul(al7,bl7))|0;mid=(mid+Math.imul(al7,bh7))|0;mid=(mid+Math.imul(ah7,bl7))|0;hi=(hi+Math.imul(ah7,bh7))|0;lo=(lo+Math.imul(al6,bl8))|0;mid=(mid+Math.imul(al6,bh8))|0;mid=(mid+Math.imul(ah6,bl8))|0;hi=(hi+Math.imul(ah6,bh8))|0;lo=(lo+Math.imul(al5,bl9))|0;mid=(mid+Math.imul(al5,bh9))|0;mid=(mid+Math.imul(ah5,bl9))|0;hi=(hi+Math.imul(ah5,bh9))|0;var w14=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w14>>>26))|0;w14&=0x3ffffff;lo=Math.imul(al9,bl6);mid=Math.imul(al9,bh6);mid=(mid+Math.imul(ah9,bl6))|0;hi=Math.imul(ah9,bh6);lo=(lo+Math.imul(al8,bl7))|0;mid=(mid+Math.imul(al8,bh7))|0;mid=(mid+Math.imul(ah8,bl7))|0;hi=(hi+Math.imul(ah8,bh7))|0;lo=(lo+Math.imul(al7,bl8))|0;mid=(mid+Math.imul(al7,bh8))|0;mid=(mid+Math.imul(ah7,bl8))|0;hi=(hi+Math.imul(ah7,bh8))|0;lo=(lo+Math.imul(al6,bl9))|0;mid=(mid+Math.imul(al6,bh9))|0;mid=(mid+Math.imul(ah6,bl9))|0;hi=(hi+Math.imul(ah6,bh9))|0;var w15=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w15>>>26))|0;w15&=0x3ffffff;lo=Math.imul(al9,bl7);mid=Math.imul(al9,bh7);mid=(mid+Math.imul(ah9,bl7))|0;hi=Math.imul(ah9,bh7);lo=(lo+Math.imul(al8,bl8))|0;mid=(mid+Math.imul(al8,bh8))|0;mid=(mid+Math.imul(ah8,bl8))|0;hi=(hi+Math.imul(ah8,bh8))|0;lo=(lo+Math.imul(al7,bl9))|0;mid=(mid+Math.imul(al7,bh9))|0;mid=(mid+Math.imul(ah7,bl9))|0;hi=(hi+Math.imul(ah7,bh9))|0;var w16=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w16>>>26))|0;w16&=0x3ffffff;lo=Math.imul(al9,bl8);mid=Math.imul(al9,bh8);mid=(mid+Math.imul(ah9,bl8))|0;hi=Math.imul(ah9,bh8);lo=(lo+Math.imul(al8,bl9))|0;mid=(mid+Math.imul(al8,bh9))|0;mid=(mid+Math.imul(ah8,bl9))|0;hi=(hi+Math.imul(ah8,bh9))|0;var w17=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w17>>>26))|0;w17&=0x3ffffff;lo=Math.imul(al9,bl9);mid=Math.imul(al9,bh9);mid=(mid+Math.imul(ah9,bl9))|0;hi=Math.imul(ah9,bh9);var w18=(((c+lo)|0)+((mid&0x1fff)<<13))|0;c=(((hi+(mid>>>13))|0)+(w18>>>26))|0;w18&=0x3ffffff;o[0]=w0;o[1]=w1;o[2]=w2;o[3]=w3;o[4]=w4;o[5]=w5;o[6]=w6;o[7]=w7;o[8]=w8;o[9]=w9;o[10]=w10;o[11]=w11;o[12]=w12;o[13]=w13;o[14]=w14;o[15]=w15;o[16]=w16;o[17]=w17;o[18]=w18;if(c!==0){o[19]=c;out.length++}
return out};if(!Math.imul){comb10MulTo=smallMulTo}
function bigMulTo(self,num,out){out.negative=num.negative^self.negative;out.length=self.length+num.length;var carry=0;var hncarry=0;for(var k=0;k<out.length-1;k++){var ncarry=hncarry;hncarry=0;var rword=carry&0x3ffffff;var maxJ=Math.min(k,num.length-1);for(var j=Math.max(0,k-self.length+1);j<=maxJ;j++){var i=k-j;var a=self.words[i]|0;var b=num.words[j]|0;var r=a*b;var lo=r&0x3ffffff;ncarry=(ncarry+((r/0x4000000)|0))|0;lo=(lo+rword)|0;rword=lo&0x3ffffff;ncarry=(ncarry+(lo>>>26))|0;hncarry+=ncarry>>>26;ncarry&=0x3ffffff}
out.words[k]=rword;carry=ncarry;ncarry=hncarry}
if(carry!==0){out.words[k]=carry}else{out.length--}
return out.strip()}
function jumboMulTo(self,num,out){var fftm=new FFTM();return fftm.mulp(self,num,out)}
BN.prototype.mulTo=function mulTo(num,out){var res;var len=this.length+num.length;if(this.length===10&&num.length===10){res=comb10MulTo(this,num,out)}else if(len<63){res=smallMulTo(this,num,out)}else if(len<1024){res=bigMulTo(this,num,out)}else{res=jumboMulTo(this,num,out)}
return res};function FFTM(x,y){this.x=x;this.y=y}
FFTM.prototype.makeRBT=function makeRBT(N){var t=new Array(N);var l=BN.prototype._countBits(N)-1;for(var i=0;i<N;i++){t[i]=this.revBin(i,l,N)}
return t};FFTM.prototype.revBin=function revBin(x,l,N){if(x===0||x===N-1)return x;var rb=0;for(var i=0;i<l;i++){rb|=(x&1)<<(l-i-1);x>>=1}
return rb};FFTM.prototype.permute=function permute(rbt,rws,iws,rtws,itws,N){for(var i=0;i<N;i++){rtws[i]=rws[rbt[i]];itws[i]=iws[rbt[i]]}};FFTM.prototype.transform=function transform(rws,iws,rtws,itws,N,rbt){this.permute(rbt,rws,iws,rtws,itws,N);for(var s=1;s<N;s<<=1){var l=s<<1;var rtwdf=Math.cos(2*Math.PI/l);var itwdf=Math.sin(2*Math.PI/l);for(var p=0;p<N;p+=l){var rtwdf_=rtwdf;var itwdf_=itwdf;for(var j=0;j<s;j++){var re=rtws[p+j];var ie=itws[p+j];var ro=rtws[p+j+s];var io=itws[p+j+s];var rx=rtwdf_*ro-itwdf_*io;io=rtwdf_*io+itwdf_*ro;ro=rx;rtws[p+j]=re+ro;itws[p+j]=ie+io;rtws[p+j+s]=re-ro;itws[p+j+s]=ie-io;if(j!==l){rx=rtwdf*rtwdf_-itwdf*itwdf_;itwdf_=rtwdf*itwdf_+itwdf*rtwdf_;rtwdf_=rx}}}}};FFTM.prototype.guessLen13b=function guessLen13b(n,m){var N=Math.max(m,n)|1;var odd=N&1;var i=0;for(N=N/2|0;N;N=N>>>1){i++}
return 1<<i+1+odd};FFTM.prototype.conjugate=function conjugate(rws,iws,N){if(N<=1)return;for(var i=0;i<N/2;i++){var t=rws[i];rws[i]=rws[N-i-1];rws[N-i-1]=t;t=iws[i];iws[i]=-iws[N-i-1];iws[N-i-1]=-t}};FFTM.prototype.normalize13b=function normalize13b(ws,N){var carry=0;for(var i=0;i<N/2;i++){var w=Math.round(ws[2*i+1]/N)*0x2000+Math.round(ws[2*i]/N)+carry;ws[i]=w&0x3ffffff;if(w<0x4000000){carry=0}else{carry=w/0x4000000|0}}
return ws};FFTM.prototype.convert13b=function convert13b(ws,len,rws,N){var carry=0;for(var i=0;i<len;i++){carry=carry+(ws[i]|0);rws[2*i]=carry&0x1fff;carry=carry>>>13;rws[2*i+1]=carry&0x1fff;carry=carry>>>13}
for(i=2*len;i<N;++i){rws[i]=0}
assert(carry===0);assert((carry&~0x1fff)===0)};FFTM.prototype.stub=function stub(N){var ph=new Array(N);for(var i=0;i<N;i++){ph[i]=0}
return ph};FFTM.prototype.mulp=function mulp(x,y,out){var N=2*this.guessLen13b(x.length,y.length);var rbt=this.makeRBT(N);var _=this.stub(N);var rws=new Array(N);var rwst=new Array(N);var iwst=new Array(N);var nrws=new Array(N);var nrwst=new Array(N);var niwst=new Array(N);var rmws=out.words;rmws.length=N;this.convert13b(x.words,x.length,rws,N);this.convert13b(y.words,y.length,nrws,N);this.transform(rws,_,rwst,iwst,N,rbt);this.transform(nrws,_,nrwst,niwst,N,rbt);for(var i=0;i<N;i++){var rx=rwst[i]*nrwst[i]-iwst[i]*niwst[i];iwst[i]=rwst[i]*niwst[i]+iwst[i]*nrwst[i];rwst[i]=rx}
this.conjugate(rwst,iwst,N);this.transform(rwst,iwst,rmws,_,N,rbt);this.conjugate(rmws,_,N);this.normalize13b(rmws,N);out.negative=x.negative^y.negative;out.length=x.length+y.length;return out.strip()};BN.prototype.mul=function mul(num){var out=new BN(null);out.words=new Array(this.length+num.length);return this.mulTo(num,out)};BN.prototype.mulf=function mulf(num){var out=new BN(null);out.words=new Array(this.length+num.length);return jumboMulTo(this,num,out)};BN.prototype.imul=function imul(num){return this.clone().mulTo(num,this)};BN.prototype.imuln=function imuln(num){assert(typeof num==='number');assert(num<0x4000000);var carry=0;for(var i=0;i<this.length;i++){var w=(this.words[i]|0)*num;var lo=(w&0x3ffffff)+(carry&0x3ffffff);carry>>=26;carry+=(w/0x4000000)|0;carry+=lo>>>26;this.words[i]=lo&0x3ffffff}
if(carry!==0){this.words[i]=carry;this.length++}
return this};BN.prototype.muln=function muln(num){return this.clone().imuln(num)};BN.prototype.sqr=function sqr(){return this.mul(this)};BN.prototype.isqr=function isqr(){return this.imul(this.clone())};BN.prototype.pow=function pow(num){var w=toBitArray(num);if(w.length===0)return new BN(1);var res=this;for(var i=0;i<w.length;i++,res=res.sqr()){if(w[i]!==0)break}
if(++i<w.length){for(var q=res.sqr();i<w.length;i++,q=q.sqr()){if(w[i]===0)continue;res=res.mul(q)}}
return res};BN.prototype.iushln=function iushln(bits){assert(typeof bits==='number'&&bits>=0);var r=bits%26;var s=(bits-r)/26;var carryMask=(0x3ffffff>>>(26-r))<<(26-r);var i;if(r!==0){var carry=0;for(i=0;i<this.length;i++){var newCarry=this.words[i]&carryMask;var c=((this.words[i]|0)-newCarry)<<r;this.words[i]=c|carry;carry=newCarry>>>(26-r)}
if(carry){this.words[i]=carry;this.length++}}
if(s!==0){for(i=this.length-1;i>=0;i--){this.words[i+s]=this.words[i]}
for(i=0;i<s;i++){this.words[i]=0}
this.length+=s}
return this.strip()};BN.prototype.ishln=function ishln(bits){assert(this.negative===0);return this.iushln(bits)};BN.prototype.iushrn=function iushrn(bits,hint,extended){assert(typeof bits==='number'&&bits>=0);var h;if(hint){h=(hint-(hint%26))/26}else{h=0}
var r=bits%26;var s=Math.min((bits-r)/26,this.length);var mask=0x3ffffff^((0x3ffffff>>>r)<<r);var maskedWords=extended;h-=s;h=Math.max(0,h);if(maskedWords){for(var i=0;i<s;i++){maskedWords.words[i]=this.words[i]}
maskedWords.length=s}
if(s===0){}else if(this.length>s){this.length-=s;for(i=0;i<this.length;i++){this.words[i]=this.words[i+s]}}else{this.words[0]=0;this.length=1}
var carry=0;for(i=this.length-1;i>=0&&(carry!==0||i>=h);i--){var word=this.words[i]|0;this.words[i]=(carry<<(26-r))|(word>>>r);carry=word&mask}
if(maskedWords&&carry!==0){maskedWords.words[maskedWords.length++]=carry}
if(this.length===0){this.words[0]=0;this.length=1}
return this.strip()};BN.prototype.ishrn=function ishrn(bits,hint,extended){assert(this.negative===0);return this.iushrn(bits,hint,extended)};BN.prototype.shln=function shln(bits){return this.clone().ishln(bits)};BN.prototype.ushln=function ushln(bits){return this.clone().iushln(bits)};BN.prototype.shrn=function shrn(bits){return this.clone().ishrn(bits)};BN.prototype.ushrn=function ushrn(bits){return this.clone().iushrn(bits)};BN.prototype.testn=function testn(bit){assert(typeof bit==='number'&&bit>=0);var r=bit%26;var s=(bit-r)/26;var q=1<<r;if(this.length<=s)return!1;var w=this.words[s];return!!(w&q)};BN.prototype.imaskn=function imaskn(bits){assert(typeof bits==='number'&&bits>=0);var r=bits%26;var s=(bits-r)/26;assert(this.negative===0,'imaskn works only with positive numbers');if(this.length<=s){return this}
if(r!==0){s++}
this.length=Math.min(s,this.length);if(r!==0){var mask=0x3ffffff^((0x3ffffff>>>r)<<r);this.words[this.length-1]&=mask}
return this.strip()};BN.prototype.maskn=function maskn(bits){return this.clone().imaskn(bits)};BN.prototype.iaddn=function iaddn(num){assert(typeof num==='number');assert(num<0x4000000);if(num<0)return this.isubn(-num);if(this.negative!==0){if(this.length===1&&(this.words[0]|0)<num){this.words[0]=num-(this.words[0]|0);this.negative=0;return this}
this.negative=0;this.isubn(num);this.negative=1;return this}
return this._iaddn(num)};BN.prototype._iaddn=function _iaddn(num){this.words[0]+=num;for(var i=0;i<this.length&&this.words[i]>=0x4000000;i++){this.words[i]-=0x4000000;if(i===this.length-1){this.words[i+1]=1}else{this.words[i+1]++}}
this.length=Math.max(this.length,i+1);return this};BN.prototype.isubn=function isubn(num){assert(typeof num==='number');assert(num<0x4000000);if(num<0)return this.iaddn(-num);if(this.negative!==0){this.negative=0;this.iaddn(num);this.negative=1;return this}
this.words[0]-=num;if(this.length===1&&this.words[0]<0){this.words[0]=-this.words[0];this.negative=1}else{for(var i=0;i<this.length&&this.words[i]<0;i++){this.words[i]+=0x4000000;this.words[i+1]-=1}}
return this.strip()};BN.prototype.addn=function addn(num){return this.clone().iaddn(num)};BN.prototype.subn=function subn(num){return this.clone().isubn(num)};BN.prototype.iabs=function iabs(){this.negative=0;return this};BN.prototype.abs=function abs(){return this.clone().iabs()};BN.prototype._ishlnsubmul=function _ishlnsubmul(num,mul,shift){var len=num.length+shift;var i;this._expand(len);var w;var carry=0;for(i=0;i<num.length;i++){w=(this.words[i+shift]|0)+carry;var right=(num.words[i]|0)*mul;w-=right&0x3ffffff;carry=(w>>26)-((right/0x4000000)|0);this.words[i+shift]=w&0x3ffffff}
for(;i<this.length-shift;i++){w=(this.words[i+shift]|0)+carry;carry=w>>26;this.words[i+shift]=w&0x3ffffff}
if(carry===0)return this.strip();assert(carry===-1);carry=0;for(i=0;i<this.length;i++){w=-(this.words[i]|0)+carry;carry=w>>26;this.words[i]=w&0x3ffffff}
this.negative=1;return this.strip()};BN.prototype._wordDiv=function _wordDiv(num,mode){var shift=this.length-num.length;var a=this.clone();var b=num;var bhi=b.words[b.length-1]|0;var bhiBits=this._countBits(bhi);shift=26-bhiBits;if(shift!==0){b=b.ushln(shift);a.iushln(shift);bhi=b.words[b.length-1]|0}
var m=a.length-b.length;var q;if(mode!=='mod'){q=new BN(null);q.length=m+1;q.words=new Array(q.length);for(var i=0;i<q.length;i++){q.words[i]=0}}
var diff=a.clone()._ishlnsubmul(b,1,m);if(diff.negative===0){a=diff;if(q){q.words[m]=1}}
for(var j=m-1;j>=0;j--){var qj=(a.words[b.length+j]|0)*0x4000000+(a.words[b.length+j-1]|0);qj=Math.min((qj/bhi)|0,0x3ffffff);a._ishlnsubmul(b,qj,j);while(a.negative!==0){qj--;a.negative=0;a._ishlnsubmul(b,1,j);if(!a.isZero()){a.negative^=1}}
if(q){q.words[j]=qj}}
if(q){q.strip()}
a.strip();if(mode!=='div'&&shift!==0){a.iushrn(shift)}
return{div:q||null,mod:a}};BN.prototype.divmod=function divmod(num,mode,positive){assert(!num.isZero());if(this.isZero()){return{div:new BN(0),mod:new BN(0)}}
var div,mod,res;if(this.negative!==0&&num.negative===0){res=this.neg().divmod(num,mode);if(mode!=='mod'){div=res.div.neg()}
if(mode!=='div'){mod=res.mod.neg();if(positive&&mod.negative!==0){mod.iadd(num)}}
return{div:div,mod:mod}}
if(this.negative===0&&num.negative!==0){res=this.divmod(num.neg(),mode);if(mode!=='mod'){div=res.div.neg()}
return{div:div,mod:res.mod}}
if((this.negative&num.negative)!==0){res=this.neg().divmod(num.neg(),mode);if(mode!=='div'){mod=res.mod.neg();if(positive&&mod.negative!==0){mod.isub(num)}}
return{div:res.div,mod:mod}}
if(num.length>this.length||this.cmp(num)<0){return{div:new BN(0),mod:this}}
if(num.length===1){if(mode==='div'){return{div:this.divn(num.words[0]),mod:null}}
if(mode==='mod'){return{div:null,mod:new BN(this.modn(num.words[0]))}}
return{div:this.divn(num.words[0]),mod:new BN(this.modn(num.words[0]))}}
return this._wordDiv(num,mode)};BN.prototype.div=function div(num){return this.divmod(num,'div',!1).div};BN.prototype.mod=function mod(num){return this.divmod(num,'mod',!1).mod};BN.prototype.umod=function umod(num){return this.divmod(num,'mod',!0).mod};BN.prototype.divRound=function divRound(num){var dm=this.divmod(num);if(dm.mod.isZero())return dm.div;var mod=dm.div.negative!==0?dm.mod.isub(num):dm.mod;var half=num.ushrn(1);var r2=num.andln(1);var cmp=mod.cmp(half);if(cmp<0||r2===1&&cmp===0)return dm.div;return dm.div.negative!==0?dm.div.isubn(1):dm.div.iaddn(1)};BN.prototype.modn=function modn(num){assert(num<=0x3ffffff);var p=(1<<26)%num;var acc=0;for(var i=this.length-1;i>=0;i--){acc=(p*acc+(this.words[i]|0))%num}
return acc};BN.prototype.idivn=function idivn(num){assert(num<=0x3ffffff);var carry=0;for(var i=this.length-1;i>=0;i--){var w=(this.words[i]|0)+carry*0x4000000;this.words[i]=(w/num)|0;carry=w%num}
return this.strip()};BN.prototype.divn=function divn(num){return this.clone().idivn(num)};BN.prototype.egcd=function egcd(p){assert(p.negative===0);assert(!p.isZero());var x=this;var y=p.clone();if(x.negative!==0){x=x.umod(p)}else{x=x.clone()}
var A=new BN(1);var B=new BN(0);var C=new BN(0);var D=new BN(1);var g=0;while(x.isEven()&&y.isEven()){x.iushrn(1);y.iushrn(1);++g}
var yp=y.clone();var xp=x.clone();while(!x.isZero()){for(var i=0,im=1;(x.words[0]&im)===0&&i<26;++i,im<<=1);if(i>0){x.iushrn(i);while(i-->0){if(A.isOdd()||B.isOdd()){A.iadd(yp);B.isub(xp)}
A.iushrn(1);B.iushrn(1)}}
for(var j=0,jm=1;(y.words[0]&jm)===0&&j<26;++j,jm<<=1);if(j>0){y.iushrn(j);while(j-->0){if(C.isOdd()||D.isOdd()){C.iadd(yp);D.isub(xp)}
C.iushrn(1);D.iushrn(1)}}
if(x.cmp(y)>=0){x.isub(y);A.isub(C);B.isub(D)}else{y.isub(x);C.isub(A);D.isub(B)}}
return{a:C,b:D,gcd:y.iushln(g)}};BN.prototype._invmp=function _invmp(p){assert(p.negative===0);assert(!p.isZero());var a=this;var b=p.clone();if(a.negative!==0){a=a.umod(p)}else{a=a.clone()}
var x1=new BN(1);var x2=new BN(0);var delta=b.clone();while(a.cmpn(1)>0&&b.cmpn(1)>0){for(var i=0,im=1;(a.words[0]&im)===0&&i<26;++i,im<<=1);if(i>0){a.iushrn(i);while(i-->0){if(x1.isOdd()){x1.iadd(delta)}
x1.iushrn(1)}}
for(var j=0,jm=1;(b.words[0]&jm)===0&&j<26;++j,jm<<=1);if(j>0){b.iushrn(j);while(j-->0){if(x2.isOdd()){x2.iadd(delta)}
x2.iushrn(1)}}
if(a.cmp(b)>=0){a.isub(b);x1.isub(x2)}else{b.isub(a);x2.isub(x1)}}
var res;if(a.cmpn(1)===0){res=x1}else{res=x2}
if(res.cmpn(0)<0){res.iadd(p)}
return res};BN.prototype.gcd=function gcd(num){if(this.isZero())return num.abs();if(num.isZero())return this.abs();var a=this.clone();var b=num.clone();a.negative=0;b.negative=0;for(var shift=0;a.isEven()&&b.isEven();shift++){a.iushrn(1);b.iushrn(1)}
do{while(a.isEven()){a.iushrn(1)}
while(b.isEven()){b.iushrn(1)}
var r=a.cmp(b);if(r<0){var t=a;a=b;b=t}else if(r===0||b.cmpn(1)===0){break}
a.isub(b)}while(!0);return b.iushln(shift)};BN.prototype.invm=function invm(num){return this.egcd(num).a.umod(num)};BN.prototype.isEven=function isEven(){return(this.words[0]&1)===0};BN.prototype.isOdd=function isOdd(){return(this.words[0]&1)===1};BN.prototype.andln=function andln(num){return this.words[0]&num};BN.prototype.bincn=function bincn(bit){assert(typeof bit==='number');var r=bit%26;var s=(bit-r)/26;var q=1<<r;if(this.length<=s){this._expand(s+1);this.words[s]|=q;return this}
var carry=q;for(var i=s;carry!==0&&i<this.length;i++){var w=this.words[i]|0;w+=carry;carry=w>>>26;w&=0x3ffffff;this.words[i]=w}
if(carry!==0){this.words[i]=carry;this.length++}
return this};BN.prototype.isZero=function isZero(){return this.length===1&&this.words[0]===0};BN.prototype.cmpn=function cmpn(num){var negative=num<0;if(this.negative!==0&&!negative)return-1;if(this.negative===0&&negative)return 1;this.strip();var res;if(this.length>1){res=1}else{if(negative){num=-num}
assert(num<=0x3ffffff,'Number is too big');var w=this.words[0]|0;res=w===num?0:w<num?-1:1}
if(this.negative!==0)return-res|0;return res};BN.prototype.cmp=function cmp(num){if(this.negative!==0&&num.negative===0)return-1;if(this.negative===0&&num.negative!==0)return 1;var res=this.ucmp(num);if(this.negative!==0)return-res|0;return res};BN.prototype.ucmp=function ucmp(num){if(this.length>num.length)return 1;if(this.length<num.length)return-1;var res=0;for(var i=this.length-1;i>=0;i--){var a=this.words[i]|0;var b=num.words[i]|0;if(a===b)continue;if(a<b){res=-1}else if(a>b){res=1}
break}
return res};BN.prototype.gtn=function gtn(num){return this.cmpn(num)===1};BN.prototype.gt=function gt(num){return this.cmp(num)===1};BN.prototype.gten=function gten(num){return this.cmpn(num)>=0};BN.prototype.gte=function gte(num){return this.cmp(num)>=0};BN.prototype.ltn=function ltn(num){return this.cmpn(num)===-1};BN.prototype.lt=function lt(num){return this.cmp(num)===-1};BN.prototype.lten=function lten(num){return this.cmpn(num)<=0};BN.prototype.lte=function lte(num){return this.cmp(num)<=0};BN.prototype.eqn=function eqn(num){return this.cmpn(num)===0};BN.prototype.eq=function eq(num){return this.cmp(num)===0};BN.red=function red(num){return new Red(num)};BN.prototype.toRed=function toRed(ctx){assert(!this.red,'Already a number in reduction context');assert(this.negative===0,'red works only with positives');return ctx.convertTo(this)._forceRed(ctx)};BN.prototype.fromRed=function fromRed(){assert(this.red,'fromRed works only with numbers in reduction context');return this.red.convertFrom(this)};BN.prototype._forceRed=function _forceRed(ctx){this.red=ctx;return this};BN.prototype.forceRed=function forceRed(ctx){assert(!this.red,'Already a number in reduction context');return this._forceRed(ctx)};BN.prototype.redAdd=function redAdd(num){assert(this.red,'redAdd works only with red numbers');return this.red.add(this,num)};BN.prototype.redIAdd=function redIAdd(num){assert(this.red,'redIAdd works only with red numbers');return this.red.iadd(this,num)};BN.prototype.redSub=function redSub(num){assert(this.red,'redSub works only with red numbers');return this.red.sub(this,num)};BN.prototype.redISub=function redISub(num){assert(this.red,'redISub works only with red numbers');return this.red.isub(this,num)};BN.prototype.redShl=function redShl(num){assert(this.red,'redShl works only with red numbers');return this.red.shl(this,num)};BN.prototype.redMul=function redMul(num){assert(this.red,'redMul works only with red numbers');this.red._verify2(this,num);return this.red.mul(this,num)};BN.prototype.redIMul=function redIMul(num){assert(this.red,'redMul works only with red numbers');this.red._verify2(this,num);return this.red.imul(this,num)};BN.prototype.redSqr=function redSqr(){assert(this.red,'redSqr works only with red numbers');this.red._verify1(this);return this.red.sqr(this)};BN.prototype.redISqr=function redISqr(){assert(this.red,'redISqr works only with red numbers');this.red._verify1(this);return this.red.isqr(this)};BN.prototype.redSqrt=function redSqrt(){assert(this.red,'redSqrt works only with red numbers');this.red._verify1(this);return this.red.sqrt(this)};BN.prototype.redInvm=function redInvm(){assert(this.red,'redInvm works only with red numbers');this.red._verify1(this);return this.red.invm(this)};BN.prototype.redNeg=function redNeg(){assert(this.red,'redNeg works only with red numbers');this.red._verify1(this);return this.red.neg(this)};BN.prototype.redPow=function redPow(num){assert(this.red&&!num.red,'redPow(normalNum)');this.red._verify1(this);return this.red.pow(this,num)};var primes={k256:null,p224:null,p192:null,p25519:null};function MPrime(name,p){this.name=name;this.p=new BN(p,16);this.n=this.p.bitLength();this.k=new BN(1).iushln(this.n).isub(this.p);this.tmp=this._tmp()}
MPrime.prototype._tmp=function _tmp(){var tmp=new BN(null);tmp.words=new Array(Math.ceil(this.n/13));return tmp};MPrime.prototype.ireduce=function ireduce(num){var r=num;var rlen;do{this.split(r,this.tmp);r=this.imulK(r);r=r.iadd(this.tmp);rlen=r.bitLength()}while(rlen>this.n);var cmp=rlen<this.n?-1:r.ucmp(this.p);if(cmp===0){r.words[0]=0;r.length=1}else if(cmp>0){r.isub(this.p)}else{r.strip()}
return r};MPrime.prototype.split=function split(input,out){input.iushrn(this.n,0,out)};MPrime.prototype.imulK=function imulK(num){return num.imul(this.k)};function K256(){MPrime.call(this,'k256','ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f')}
inherits(K256,MPrime);K256.prototype.split=function split(input,output){var mask=0x3fffff;var outLen=Math.min(input.length,9);for(var i=0;i<outLen;i++){output.words[i]=input.words[i]}
output.length=outLen;if(input.length<=9){input.words[0]=0;input.length=1;return}
var prev=input.words[9];output.words[output.length++]=prev&mask;for(i=10;i<input.length;i++){var next=input.words[i]|0;input.words[i-10]=((next&mask)<<4)|(prev>>>22);prev=next}
prev>>>=22;input.words[i-10]=prev;if(prev===0&&input.length>10){input.length-=10}else{input.length-=9}};K256.prototype.imulK=function imulK(num){num.words[num.length]=0;num.words[num.length+1]=0;num.length+=2;var lo=0;for(var i=0;i<num.length;i++){var w=num.words[i]|0;lo+=w*0x3d1;num.words[i]=lo&0x3ffffff;lo=w*0x40+((lo/0x4000000)|0)}
if(num.words[num.length-1]===0){num.length--;if(num.words[num.length-1]===0){num.length--}}
return num};function P224(){MPrime.call(this,'p224','ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001')}
inherits(P224,MPrime);function P192(){MPrime.call(this,'p192','ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff')}
inherits(P192,MPrime);function P25519(){MPrime.call(this,'25519','7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed')}
inherits(P25519,MPrime);P25519.prototype.imulK=function imulK(num){var carry=0;for(var i=0;i<num.length;i++){var hi=(num.words[i]|0)*0x13+carry;var lo=hi&0x3ffffff;hi>>>=26;num.words[i]=lo;carry=hi}
if(carry!==0){num.words[num.length++]=carry}
return num};BN._prime=function prime(name){if(primes[name])return primes[name];var prime;if(name==='k256'){prime=new K256()}else if(name==='p224'){prime=new P224()}else if(name==='p192'){prime=new P192()}else if(name==='p25519'){prime=new P25519()}else{throw new Error('Unknown prime '+name)}
primes[name]=prime;return prime};function Red(m){if(typeof m==='string'){var prime=BN._prime(m);this.m=prime.p;this.prime=prime}else{assert(m.gtn(1),'modulus must be greater than 1');this.m=m;this.prime=null}}
Red.prototype._verify1=function _verify1(a){assert(a.negative===0,'red works only with positives');assert(a.red,'red works only with red numbers')};Red.prototype._verify2=function _verify2(a,b){assert((a.negative|b.negative)===0,'red works only with positives');assert(a.red&&a.red===b.red,'red works only with red numbers')};Red.prototype.imod=function imod(a){if(this.prime)return this.prime.ireduce(a)._forceRed(this);return a.umod(this.m)._forceRed(this)};Red.prototype.neg=function neg(a){if(a.isZero()){return a.clone()}
return this.m.sub(a)._forceRed(this)};Red.prototype.add=function add(a,b){this._verify2(a,b);var res=a.add(b);if(res.cmp(this.m)>=0){res.isub(this.m)}
return res._forceRed(this)};Red.prototype.iadd=function iadd(a,b){this._verify2(a,b);var res=a.iadd(b);if(res.cmp(this.m)>=0){res.isub(this.m)}
return res};Red.prototype.sub=function sub(a,b){this._verify2(a,b);var res=a.sub(b);if(res.cmpn(0)<0){res.iadd(this.m)}
return res._forceRed(this)};Red.prototype.isub=function isub(a,b){this._verify2(a,b);var res=a.isub(b);if(res.cmpn(0)<0){res.iadd(this.m)}
return res};Red.prototype.shl=function shl(a,num){this._verify1(a);return this.imod(a.ushln(num))};Red.prototype.imul=function imul(a,b){this._verify2(a,b);return this.imod(a.imul(b))};Red.prototype.mul=function mul(a,b){this._verify2(a,b);return this.imod(a.mul(b))};Red.prototype.isqr=function isqr(a){return this.imul(a,a.clone())};Red.prototype.sqr=function sqr(a){return this.mul(a,a)};Red.prototype.sqrt=function sqrt(a){if(a.isZero())return a.clone();var mod3=this.m.andln(3);assert(mod3%2===1);if(mod3===3){var pow=this.m.add(new BN(1)).iushrn(2);return this.pow(a,pow)}
var q=this.m.subn(1);var s=0;while(!q.isZero()&&q.andln(1)===0){s++;q.iushrn(1)}
assert(!q.isZero());var one=new BN(1).toRed(this);var nOne=one.redNeg();var lpow=this.m.subn(1).iushrn(1);var z=this.m.bitLength();z=new BN(2*z*z).toRed(this);while(this.pow(z,lpow).cmp(nOne)!==0){z.redIAdd(nOne)}
var c=this.pow(z,q);var r=this.pow(a,q.addn(1).iushrn(1));var t=this.pow(a,q);var m=s;while(t.cmp(one)!==0){var tmp=t;for(var i=0;tmp.cmp(one)!==0;i++){tmp=tmp.redSqr()}
assert(i<m);var b=this.pow(c,new BN(1).iushln(m-i-1));r=r.redMul(b);c=b.redSqr();t=t.redMul(c);m=i}
return r};Red.prototype.invm=function invm(a){var inv=a._invmp(this.m);if(inv.negative!==0){inv.negative=0;return this.imod(inv).redNeg()}else{return this.imod(inv)}};Red.prototype.pow=function pow(a,num){if(num.isZero())return new BN(1).toRed(this);if(num.cmpn(1)===0)return a.clone();var windowSize=4;var wnd=new Array(1<<windowSize);wnd[0]=new BN(1).toRed(this);wnd[1]=a;for(var i=2;i<wnd.length;i++){wnd[i]=this.mul(wnd[i-1],a)}
var res=wnd[0];var current=0;var currentLen=0;var start=num.bitLength()%26;if(start===0){start=26}
for(i=num.length-1;i>=0;i--){var word=num.words[i];for(var j=start-1;j>=0;j--){var bit=(word>>j)&1;if(res!==wnd[0]){res=this.sqr(res)}
if(bit===0&&current===0){currentLen=0;continue}
current<<=1;current|=bit;currentLen++;if(currentLen!==windowSize&&(i!==0||j!==0))continue;res=this.mul(res,wnd[current]);currentLen=0;current=0}
start=26}
return res};Red.prototype.convertTo=function convertTo(num){var r=num.umod(this.m);return r===num?r.clone():r};Red.prototype.convertFrom=function convertFrom(num){var res=num.clone();res.red=null;return res};BN.mont=function mont(num){return new Mont(num)};function Mont(m){Red.call(this,m);this.shift=this.m.bitLength();if(this.shift%26!==0){this.shift+=26-(this.shift%26)}
this.r=new BN(1).iushln(this.shift);this.r2=this.imod(this.r.sqr());this.rinv=this.r._invmp(this.m);this.minv=this.rinv.mul(this.r).isubn(1).div(this.m);this.minv=this.minv.umod(this.r);this.minv=this.r.sub(this.minv)}
inherits(Mont,Red);Mont.prototype.convertTo=function convertTo(num){return this.imod(num.ushln(this.shift))};Mont.prototype.convertFrom=function convertFrom(num){var r=this.imod(num.mul(this.rinv));r.red=null;return r};Mont.prototype.imul=function imul(a,b){if(a.isZero()||b.isZero()){a.words[0]=0;a.length=1;return a}
var t=a.imul(b);var c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);var u=t.isub(c).iushrn(this.shift);var res=u;if(u.cmp(this.m)>=0){res=u.isub(this.m)}else if(u.cmpn(0)<0){res=u.iadd(this.m)}
return res._forceRed(this)};Mont.prototype.mul=function mul(a,b){if(a.isZero()||b.isZero())return new BN(0)._forceRed(this);var t=a.mul(b);var c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);var u=t.isub(c).iushrn(this.shift);var res=u;if(u.cmp(this.m)>=0){res=u.isub(this.m)}else if(u.cmpn(0)<0){res=u.iadd(this.m)}
return res._forceRed(this)};Mont.prototype.invm=function invm(a){var res=this.imod(a._invmp(this.m).mul(this.r2));return res._forceRed(this)}})(typeof module==='undefined'||module,this)},{"buffer":23}],22:[function(require,module,exports){var r;module.exports=function rand(len){if(!r)
r=new Rand(null);return r.generate(len)};function Rand(rand){this.rand=rand}
module.exports.Rand=Rand;Rand.prototype.generate=function generate(len){return this._rand(len)};Rand.prototype._rand=function _rand(n){if(this.rand.getBytes)
return this.rand.getBytes(n);var res=new Uint8Array(n);for(var i=0;i<res.length;i++)
res[i]=this.rand.getByte();return res};if(typeof self==='object'){if(self.crypto&&self.crypto.getRandomValues){Rand.prototype._rand=function _rand(n){var arr=new Uint8Array(n);self.crypto.getRandomValues(arr);return arr}}else if(self.msCrypto&&self.msCrypto.getRandomValues){Rand.prototype._rand=function _rand(n){var arr=new Uint8Array(n);self.msCrypto.getRandomValues(arr);return arr}}else if(typeof window==='object'){Rand.prototype._rand=function(){throw new Error('Not implemented yet')}}}else{try{var crypto=require('crypto');if(typeof crypto.randomBytes!=='function')
throw new Error('Not supported');Rand.prototype._rand=function _rand(n){return crypto.randomBytes(n)}}catch(e){}}},{"crypto":23}],23:[function(require,module,exports){arguments[4][1][0].apply(exports,arguments)},{"dup":1}],24:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
function asUInt32Array(buf){if(!Buffer.isBuffer(buf))buf=Buffer.from(buf)
var len=(buf.length/4)|0
var out=new Array(len)
for(var i=0;i<len;i++){out[i]=buf.readUInt32BE(i*4)}
return out}
function scrubVec(v){for(var i=0;i<v.length;v++){v[i]=0}}
function cryptBlock(M,keySchedule,SUB_MIX,SBOX,nRounds){var SUB_MIX0=SUB_MIX[0]
var SUB_MIX1=SUB_MIX[1]
var SUB_MIX2=SUB_MIX[2]
var SUB_MIX3=SUB_MIX[3]
var s0=M[0]^keySchedule[0]
var s1=M[1]^keySchedule[1]
var s2=M[2]^keySchedule[2]
var s3=M[3]^keySchedule[3]
var t0,t1,t2,t3
var ksRow=4
for(var round=1;round<nRounds;round++){t0=SUB_MIX0[s0>>>24]^SUB_MIX1[(s1>>>16)&0xff]^SUB_MIX2[(s2>>>8)&0xff]^SUB_MIX3[s3&0xff]^keySchedule[ksRow++]
t1=SUB_MIX0[s1>>>24]^SUB_MIX1[(s2>>>16)&0xff]^SUB_MIX2[(s3>>>8)&0xff]^SUB_MIX3[s0&0xff]^keySchedule[ksRow++]
t2=SUB_MIX0[s2>>>24]^SUB_MIX1[(s3>>>16)&0xff]^SUB_MIX2[(s0>>>8)&0xff]^SUB_MIX3[s1&0xff]^keySchedule[ksRow++]
t3=SUB_MIX0[s3>>>24]^SUB_MIX1[(s0>>>16)&0xff]^SUB_MIX2[(s1>>>8)&0xff]^SUB_MIX3[s2&0xff]^keySchedule[ksRow++]
s0=t0
s1=t1
s2=t2
s3=t3}
t0=((SBOX[s0>>>24]<<24)|(SBOX[(s1>>>16)&0xff]<<16)|(SBOX[(s2>>>8)&0xff]<<8)|SBOX[s3&0xff])^keySchedule[ksRow++]
t1=((SBOX[s1>>>24]<<24)|(SBOX[(s2>>>16)&0xff]<<16)|(SBOX[(s3>>>8)&0xff]<<8)|SBOX[s0&0xff])^keySchedule[ksRow++]
t2=((SBOX[s2>>>24]<<24)|(SBOX[(s3>>>16)&0xff]<<16)|(SBOX[(s0>>>8)&0xff]<<8)|SBOX[s1&0xff])^keySchedule[ksRow++]
t3=((SBOX[s3>>>24]<<24)|(SBOX[(s0>>>16)&0xff]<<16)|(SBOX[(s1>>>8)&0xff]<<8)|SBOX[s2&0xff])^keySchedule[ksRow++]
t0=t0>>>0
t1=t1>>>0
t2=t2>>>0
t3=t3>>>0
return[t0,t1,t2,t3]}
var RCON=[0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x1b,0x36]
var G=(function(){var d=new Array(256)
for(var j=0;j<256;j++){if(j<128){d[j]=j<<1}else{d[j]=(j<<1)^0x11b}}
var SBOX=[]
var INV_SBOX=[]
var SUB_MIX=[[],[],[],[]]
var INV_SUB_MIX=[[],[],[],[]]
var x=0
var xi=0
for(var i=0;i<256;++i){var sx=xi^(xi<<1)^(xi<<2)^(xi<<3)^(xi<<4)
sx=(sx>>>8)^(sx&0xff)^0x63
SBOX[x]=sx
INV_SBOX[sx]=x
var x2=d[x]
var x4=d[x2]
var x8=d[x4]
var t=(d[sx]*0x101)^(sx*0x1010100)
SUB_MIX[0][x]=(t<<24)|(t>>>8)
SUB_MIX[1][x]=(t<<16)|(t>>>16)
SUB_MIX[2][x]=(t<<8)|(t>>>24)
SUB_MIX[3][x]=t
t=(x8*0x1010101)^(x4*0x10001)^(x2*0x101)^(x*0x1010100)
INV_SUB_MIX[0][sx]=(t<<24)|(t>>>8)
INV_SUB_MIX[1][sx]=(t<<16)|(t>>>16)
INV_SUB_MIX[2][sx]=(t<<8)|(t>>>24)
INV_SUB_MIX[3][sx]=t
if(x===0){x=xi=1}else{x=x2^d[d[d[x8^x2]]]
xi^=d[d[xi]]}}
return{SBOX:SBOX,INV_SBOX:INV_SBOX,SUB_MIX:SUB_MIX,INV_SUB_MIX:INV_SUB_MIX}})()
function AES(key){this._key=asUInt32Array(key)
this._reset()}
AES.blockSize=4*4
AES.keySize=256/8
AES.prototype.blockSize=AES.blockSize
AES.prototype.keySize=AES.keySize
AES.prototype._reset=function(){var keyWords=this._key
var keySize=keyWords.length
var nRounds=keySize+6
var ksRows=(nRounds+1)*4
var keySchedule=[]
for(var k=0;k<keySize;k++){keySchedule[k]=keyWords[k]}
for(k=keySize;k<ksRows;k++){var t=keySchedule[k-1]
if(k%keySize===0){t=(t<<8)|(t>>>24)
t=(G.SBOX[t>>>24]<<24)|(G.SBOX[(t>>>16)&0xff]<<16)|(G.SBOX[(t>>>8)&0xff]<<8)|(G.SBOX[t&0xff])
t^=RCON[(k/keySize)|0]<<24}else if(keySize>6&&k%keySize===4){t=(G.SBOX[t>>>24]<<24)|(G.SBOX[(t>>>16)&0xff]<<16)|(G.SBOX[(t>>>8)&0xff]<<8)|(G.SBOX[t&0xff])}
keySchedule[k]=keySchedule[k-keySize]^t}
var invKeySchedule=[]
for(var ik=0;ik<ksRows;ik++){var ksR=ksRows-ik
var tt=keySchedule[ksR-(ik%4?0:4)]
if(ik<4||ksR<=4){invKeySchedule[ik]=tt}else{invKeySchedule[ik]=G.INV_SUB_MIX[0][G.SBOX[tt>>>24]]^G.INV_SUB_MIX[1][G.SBOX[(tt>>>16)&0xff]]^G.INV_SUB_MIX[2][G.SBOX[(tt>>>8)&0xff]]^G.INV_SUB_MIX[3][G.SBOX[tt&0xff]]}}
this._nRounds=nRounds
this._keySchedule=keySchedule
this._invKeySchedule=invKeySchedule}
AES.prototype.encryptBlockRaw=function(M){M=asUInt32Array(M)
return cryptBlock(M,this._keySchedule,G.SUB_MIX,G.SBOX,this._nRounds)}
AES.prototype.encryptBlock=function(M){var out=this.encryptBlockRaw(M)
var buf=Buffer.allocUnsafe(16)
buf.writeUInt32BE(out[0],0)
buf.writeUInt32BE(out[1],4)
buf.writeUInt32BE(out[2],8)
buf.writeUInt32BE(out[3],12)
return buf}
AES.prototype.decryptBlock=function(M){M=asUInt32Array(M)
var m1=M[1]
M[1]=M[3]
M[3]=m1
var out=cryptBlock(M,this._invKeySchedule,G.INV_SUB_MIX,G.INV_SBOX,this._nRounds)
var buf=Buffer.allocUnsafe(16)
buf.writeUInt32BE(out[0],0)
buf.writeUInt32BE(out[3],4)
buf.writeUInt32BE(out[2],8)
buf.writeUInt32BE(out[1],12)
return buf}
AES.prototype.scrub=function(){scrubVec(this._keySchedule)
scrubVec(this._invKeySchedule)
scrubVec(this._key)}
module.exports.AES=AES},{"safe-buffer":167}],25:[function(require,module,exports){var aes=require('./aes')
var Buffer=require('safe-buffer').Buffer
var Transform=require('cipher-base')
var inherits=require('inherits')
var GHASH=require('./ghash')
var xor=require('buffer-xor')
var incr32=require('./incr32')
function xorTest(a,b){var out=0
if(a.length!==b.length)out++
var len=Math.min(a.length,b.length)
for(var i=0;i<len;++i){out+=(a[i]^b[i])}
return out}
function calcIv(self,iv,ck){if(iv.length===12){self._finID=Buffer.concat([iv,Buffer.from([0,0,0,1])])
return Buffer.concat([iv,Buffer.from([0,0,0,2])])}
var ghash=new GHASH(ck)
var len=iv.length
var toPad=len%16
ghash.update(iv)
if(toPad){toPad=16-toPad
ghash.update(Buffer.alloc(toPad,0))}
ghash.update(Buffer.alloc(8,0))
var ivBits=len*8
var tail=Buffer.alloc(8)
tail.writeUIntBE(ivBits,0,8)
ghash.update(tail)
self._finID=ghash.state
var out=Buffer.from(self._finID)
incr32(out)
return out}
function StreamCipher(mode,key,iv,decrypt){Transform.call(this)
var h=Buffer.alloc(4,0)
this._cipher=new aes.AES(key)
var ck=this._cipher.encryptBlock(h)
this._ghash=new GHASH(ck)
iv=calcIv(this,iv,ck)
this._prev=Buffer.from(iv)
this._cache=Buffer.allocUnsafe(0)
this._secCache=Buffer.allocUnsafe(0)
this._decrypt=decrypt
this._alen=0
this._len=0
this._mode=mode
this._authTag=null
this._called=!1}
inherits(StreamCipher,Transform)
StreamCipher.prototype._update=function(chunk){if(!this._called&&this._alen){var rump=16-(this._alen%16)
if(rump<16){rump=Buffer.alloc(rump,0)
this._ghash.update(rump)}}
this._called=!0
var out=this._mode.encrypt(this,chunk)
if(this._decrypt){this._ghash.update(chunk)}else{this._ghash.update(out)}
this._len+=chunk.length
return out}
StreamCipher.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error('Unsupported state or unable to authenticate data')
var tag=xor(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID))
if(this._decrypt&&xorTest(tag,this._authTag))throw new Error('Unsupported state or unable to authenticate data')
this._authTag=tag
this._cipher.scrub()}
StreamCipher.prototype.getAuthTag=function getAuthTag(){if(this._decrypt||!Buffer.isBuffer(this._authTag))throw new Error('Attempting to get auth tag in unsupported state')
return this._authTag}
StreamCipher.prototype.setAuthTag=function setAuthTag(tag){if(!this._decrypt)throw new Error('Attempting to set auth tag in unsupported state')
this._authTag=tag}
StreamCipher.prototype.setAAD=function setAAD(buf){if(this._called)throw new Error('Attempting to set AAD in unsupported state')
this._ghash.update(buf)
this._alen+=buf.length}
module.exports=StreamCipher},{"./aes":24,"./ghash":29,"./incr32":30,"buffer-xor":53,"cipher-base":56,"inherits":108,"safe-buffer":167}],26:[function(require,module,exports){var ciphers=require('./encrypter')
var deciphers=require('./decrypter')
var modes=require('./modes/list.json')
function getCiphers(){return Object.keys(modes)}
exports.createCipher=exports.Cipher=ciphers.createCipher
exports.createCipheriv=exports.Cipheriv=ciphers.createCipheriv
exports.createDecipher=exports.Decipher=deciphers.createDecipher
exports.createDecipheriv=exports.Decipheriv=deciphers.createDecipheriv
exports.listCiphers=exports.getCiphers=getCiphers},{"./decrypter":27,"./encrypter":28,"./modes/list.json":38}],27:[function(require,module,exports){var AuthCipher=require('./authCipher')
var Buffer=require('safe-buffer').Buffer
var MODES=require('./modes')
var StreamCipher=require('./streamCipher')
var Transform=require('cipher-base')
var aes=require('./aes')
var ebtk=require('evp_bytestokey')
var inherits=require('inherits')
function Decipher(mode,key,iv){Transform.call(this)
this._cache=new Splitter()
this._last=void 0
this._cipher=new aes.AES(key)
this._prev=Buffer.from(iv)
this._mode=mode
this._autopadding=!0}
inherits(Decipher,Transform)
Decipher.prototype._update=function(data){this._cache.add(data)
var chunk
var thing
var out=[]
while((chunk=this._cache.get(this._autopadding))){thing=this._mode.decrypt(this,chunk)
out.push(thing)}
return Buffer.concat(out)}
Decipher.prototype._final=function(){var chunk=this._cache.flush()
if(this._autopadding){return unpad(this._mode.decrypt(this,chunk))}else if(chunk){throw new Error('data not multiple of block length')}}
Decipher.prototype.setAutoPadding=function(setTo){this._autopadding=!!setTo
return this}
function Splitter(){this.cache=Buffer.allocUnsafe(0)}
Splitter.prototype.add=function(data){this.cache=Buffer.concat([this.cache,data])}
Splitter.prototype.get=function(autoPadding){var out
if(autoPadding){if(this.cache.length>16){out=this.cache.slice(0,16)
this.cache=this.cache.slice(16)
return out}}else{if(this.cache.length>=16){out=this.cache.slice(0,16)
this.cache=this.cache.slice(16)
return out}}
return null}
Splitter.prototype.flush=function(){if(this.cache.length)return this.cache}
function unpad(last){var padded=last[15]
if(padded<1||padded>16){throw new Error('unable to decrypt data')}
var i=-1
while(++i<padded){if(last[(i+(16-padded))]!==padded){throw new Error('unable to decrypt data')}}
if(padded===16)return
return last.slice(0,16-padded)}
function createDecipheriv(suite,password,iv){var config=MODES[suite.toLowerCase()]
if(!config)throw new TypeError('invalid suite type')
if(typeof iv==='string')iv=Buffer.from(iv)
if(config.mode!=='GCM'&&iv.length!==config.iv)throw new TypeError('invalid iv length '+iv.length)
if(typeof password==='string')password=Buffer.from(password)
if(password.length!==config.key/8)throw new TypeError('invalid key length '+password.length)
if(config.type==='stream'){return new StreamCipher(config.module,password,iv,!0)}else if(config.type==='auth'){return new AuthCipher(config.module,password,iv,!0)}
return new Decipher(config.module,password,iv)}
function createDecipher(suite,password){var config=MODES[suite.toLowerCase()]
if(!config)throw new TypeError('invalid suite type')
var keys=ebtk(password,!1,config.key,config.iv)
return createDecipheriv(suite,keys.key,keys.iv)}
exports.createDecipher=createDecipher
exports.createDecipheriv=createDecipheriv},{"./aes":24,"./authCipher":25,"./modes":37,"./streamCipher":40,"cipher-base":56,"evp_bytestokey":91,"inherits":108,"safe-buffer":167}],28:[function(require,module,exports){var MODES=require('./modes')
var AuthCipher=require('./authCipher')
var Buffer=require('safe-buffer').Buffer
var StreamCipher=require('./streamCipher')
var Transform=require('cipher-base')
var aes=require('./aes')
var ebtk=require('evp_bytestokey')
var inherits=require('inherits')
function Cipher(mode,key,iv){Transform.call(this)
this._cache=new Splitter()
this._cipher=new aes.AES(key)
this._prev=Buffer.from(iv)
this._mode=mode
this._autopadding=!0}
inherits(Cipher,Transform)
Cipher.prototype._update=function(data){this._cache.add(data)
var chunk
var thing
var out=[]
while((chunk=this._cache.get())){thing=this._mode.encrypt(this,chunk)
out.push(thing)}
return Buffer.concat(out)}
var PADDING=Buffer.alloc(16,0x10)
Cipher.prototype._final=function(){var chunk=this._cache.flush()
if(this._autopadding){chunk=this._mode.encrypt(this,chunk)
this._cipher.scrub()
return chunk}
if(!chunk.equals(PADDING)){this._cipher.scrub()
throw new Error('data not multiple of block length')}}
Cipher.prototype.setAutoPadding=function(setTo){this._autopadding=!!setTo
return this}
function Splitter(){this.cache=Buffer.allocUnsafe(0)}
Splitter.prototype.add=function(data){this.cache=Buffer.concat([this.cache,data])}
Splitter.prototype.get=function(){if(this.cache.length>15){var out=this.cache.slice(0,16)
this.cache=this.cache.slice(16)
return out}
return null}
Splitter.prototype.flush=function(){var len=16-this.cache.length
var padBuff=Buffer.allocUnsafe(len)
var i=-1
while(++i<len){padBuff.writeUInt8(len,i)}
return Buffer.concat([this.cache,padBuff])}
function createCipheriv(suite,password,iv){var config=MODES[suite.toLowerCase()]
if(!config)throw new TypeError('invalid suite type')
if(typeof password==='string')password=Buffer.from(password)
if(password.length!==config.key/8)throw new TypeError('invalid key length '+password.length)
if(typeof iv==='string')iv=Buffer.from(iv)
if(config.mode!=='GCM'&&iv.length!==config.iv)throw new TypeError('invalid iv length '+iv.length)
if(config.type==='stream'){return new StreamCipher(config.module,password,iv)}else if(config.type==='auth'){return new AuthCipher(config.module,password,iv)}
return new Cipher(config.module,password,iv)}
function createCipher(suite,password){var config=MODES[suite.toLowerCase()]
if(!config)throw new TypeError('invalid suite type')
var keys=ebtk(password,!1,config.key,config.iv)
return createCipheriv(suite,keys.key,keys.iv)}
exports.createCipheriv=createCipheriv
exports.createCipher=createCipher},{"./aes":24,"./authCipher":25,"./modes":37,"./streamCipher":40,"cipher-base":56,"evp_bytestokey":91,"inherits":108,"safe-buffer":167}],29:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
var ZEROES=Buffer.alloc(16,0)
function toArray(buf){return[buf.readUInt32BE(0),buf.readUInt32BE(4),buf.readUInt32BE(8),buf.readUInt32BE(12)]}
function fromArray(out){var buf=Buffer.allocUnsafe(16)
buf.writeUInt32BE(out[0]>>>0,0)
buf.writeUInt32BE(out[1]>>>0,4)
buf.writeUInt32BE(out[2]>>>0,8)
buf.writeUInt32BE(out[3]>>>0,12)
return buf}
function GHASH(key){this.h=key
this.state=Buffer.alloc(16,0)
this.cache=Buffer.allocUnsafe(0)}
GHASH.prototype.ghash=function(block){var i=-1
while(++i<block.length){this.state[i]^=block[i]}
this._multiply()}
GHASH.prototype._multiply=function(){var Vi=toArray(this.h)
var Zi=[0,0,0,0]
var j,xi,lsbVi
var i=-1
while(++i<128){xi=(this.state[~~(i/8)]&(1<<(7-(i%8))))!==0
if(xi){Zi[0]^=Vi[0]
Zi[1]^=Vi[1]
Zi[2]^=Vi[2]
Zi[3]^=Vi[3]}
lsbVi=(Vi[3]&1)!==0
for(j=3;j>0;j--){Vi[j]=(Vi[j]>>>1)|((Vi[j-1]&1)<<31)}
Vi[0]=Vi[0]>>>1
if(lsbVi){Vi[0]=Vi[0]^(0xe1<<24)}}
this.state=fromArray(Zi)}
GHASH.prototype.update=function(buf){this.cache=Buffer.concat([this.cache,buf])
var chunk
while(this.cache.length>=16){chunk=this.cache.slice(0,16)
this.cache=this.cache.slice(16)
this.ghash(chunk)}}
GHASH.prototype.final=function(abl,bl){if(this.cache.length){this.ghash(Buffer.concat([this.cache,ZEROES],16))}
this.ghash(fromArray([0,abl,0,bl]))
return this.state}
module.exports=GHASH},{"safe-buffer":167}],30:[function(require,module,exports){function incr32(iv){var len=iv.length
var item
while(len--){item=iv.readUInt8(len)
if(item===255){iv.writeUInt8(0,len)}else{item++
iv.writeUInt8(item,len)
break}}}
module.exports=incr32},{}],31:[function(require,module,exports){var xor=require('buffer-xor')
exports.encrypt=function(self,block){var data=xor(block,self._prev)
self._prev=self._cipher.encryptBlock(data)
return self._prev}
exports.decrypt=function(self,block){var pad=self._prev
self._prev=block
var out=self._cipher.decryptBlock(block)
return xor(out,pad)}},{"buffer-xor":53}],32:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
var xor=require('buffer-xor')
function encryptStart(self,data,decrypt){var len=data.length
var out=xor(data,self._cache)
self._cache=self._cache.slice(len)
self._prev=Buffer.concat([self._prev,decrypt?data:out])
return out}
exports.encrypt=function(self,data,decrypt){var out=Buffer.allocUnsafe(0)
var len
while(data.length){if(self._cache.length===0){self._cache=self._cipher.encryptBlock(self._prev)
self._prev=Buffer.allocUnsafe(0)}
if(self._cache.length<=data.length){len=self._cache.length
out=Buffer.concat([out,encryptStart(self,data.slice(0,len),decrypt)])
data=data.slice(len)}else{out=Buffer.concat([out,encryptStart(self,data,decrypt)])
break}}
return out}},{"buffer-xor":53,"safe-buffer":167}],33:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
function encryptByte(self,byteParam,decrypt){var pad
var i=-1
var len=8
var out=0
var bit,value
while(++i<len){pad=self._cipher.encryptBlock(self._prev)
bit=(byteParam&(1<<(7-i)))?0x80:0
value=pad[0]^bit
out+=((value&0x80)>>(i%8))
self._prev=shiftIn(self._prev,decrypt?bit:value)}
return out}
function shiftIn(buffer,value){var len=buffer.length
var i=-1
var out=Buffer.allocUnsafe(buffer.length)
buffer=Buffer.concat([buffer,Buffer.from([value])])
while(++i<len){out[i]=buffer[i]<<1|buffer[i+1]>>(7)}
return out}
exports.encrypt=function(self,chunk,decrypt){var len=chunk.length
var out=Buffer.allocUnsafe(len)
var i=-1
while(++i<len){out[i]=encryptByte(self,chunk[i],decrypt)}
return out}},{"safe-buffer":167}],34:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
function encryptByte(self,byteParam,decrypt){var pad=self._cipher.encryptBlock(self._prev)
var out=pad[0]^byteParam
self._prev=Buffer.concat([self._prev.slice(1),Buffer.from([decrypt?byteParam:out])])
return out}
exports.encrypt=function(self,chunk,decrypt){var len=chunk.length
var out=Buffer.allocUnsafe(len)
var i=-1
while(++i<len){out[i]=encryptByte(self,chunk[i],decrypt)}
return out}},{"safe-buffer":167}],35:[function(require,module,exports){var xor=require('buffer-xor')
var Buffer=require('safe-buffer').Buffer
var incr32=require('../incr32')
function getBlock(self){var out=self._cipher.encryptBlockRaw(self._prev)
incr32(self._prev)
return out}
var blockSize=16
exports.encrypt=function(self,chunk){var chunkNum=Math.ceil(chunk.length/blockSize)
var start=self._cache.length
self._cache=Buffer.concat([self._cache,Buffer.allocUnsafe(chunkNum*blockSize)])
for(var i=0;i<chunkNum;i++){var out=getBlock(self)
var offset=start+i*blockSize
self._cache.writeUInt32BE(out[0],offset+0)
self._cache.writeUInt32BE(out[1],offset+4)
self._cache.writeUInt32BE(out[2],offset+8)
self._cache.writeUInt32BE(out[3],offset+12)}
var pad=self._cache.slice(0,chunk.length)
self._cache=self._cache.slice(chunk.length)
return xor(chunk,pad)}},{"../incr32":30,"buffer-xor":53,"safe-buffer":167}],36:[function(require,module,exports){exports.encrypt=function(self,block){return self._cipher.encryptBlock(block)}
exports.decrypt=function(self,block){return self._cipher.decryptBlock(block)}},{}],37:[function(require,module,exports){var modeModules={ECB:require('./ecb'),CBC:require('./cbc'),CFB:require('./cfb'),CFB8:require('./cfb8'),CFB1:require('./cfb1'),OFB:require('./ofb'),CTR:require('./ctr'),GCM:require('./ctr')}
var modes=require('./list.json')
for(var key in modes){modes[key].module=modeModules[modes[key].mode]}
module.exports=modes},{"./cbc":31,"./cfb":32,"./cfb1":33,"./cfb8":34,"./ctr":35,"./ecb":36,"./list.json":38,"./ofb":39}],38:[function(require,module,exports){module.exports={"aes-128-ecb":{"cipher":"AES","key":128,"iv":0,"mode":"ECB","type":"block"},"aes-192-ecb":{"cipher":"AES","key":192,"iv":0,"mode":"ECB","type":"block"},"aes-256-ecb":{"cipher":"AES","key":256,"iv":0,"mode":"ECB","type":"block"},"aes-128-cbc":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes-192-cbc":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes-256-cbc":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes128":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes192":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes256":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes-128-cfb":{"cipher":"AES","key":128,"iv":16,"mode":"CFB","type":"stream"},"aes-192-cfb":{"cipher":"AES","key":192,"iv":16,"mode":"CFB","type":"stream"},"aes-256-cfb":{"cipher":"AES","key":256,"iv":16,"mode":"CFB","type":"stream"},"aes-128-cfb8":{"cipher":"AES","key":128,"iv":16,"mode":"CFB8","type":"stream"},"aes-192-cfb8":{"cipher":"AES","key":192,"iv":16,"mode":"CFB8","type":"stream"},"aes-256-cfb8":{"cipher":"AES","key":256,"iv":16,"mode":"CFB8","type":"stream"},"aes-128-cfb1":{"cipher":"AES","key":128,"iv":16,"mode":"CFB1","type":"stream"},"aes-192-cfb1":{"cipher":"AES","key":192,"iv":16,"mode":"CFB1","type":"stream"},"aes-256-cfb1":{"cipher":"AES","key":256,"iv":16,"mode":"CFB1","type":"stream"},"aes-128-ofb":{"cipher":"AES","key":128,"iv":16,"mode":"OFB","type":"stream"},"aes-192-ofb":{"cipher":"AES","key":192,"iv":16,"mode":"OFB","type":"stream"},"aes-256-ofb":{"cipher":"AES","key":256,"iv":16,"mode":"OFB","type":"stream"},"aes-128-ctr":{"cipher":"AES","key":128,"iv":16,"mode":"CTR","type":"stream"},"aes-192-ctr":{"cipher":"AES","key":192,"iv":16,"mode":"CTR","type":"stream"},"aes-256-ctr":{"cipher":"AES","key":256,"iv":16,"mode":"CTR","type":"stream"},"aes-128-gcm":{"cipher":"AES","key":128,"iv":12,"mode":"GCM","type":"auth"},"aes-192-gcm":{"cipher":"AES","key":192,"iv":12,"mode":"GCM","type":"auth"},"aes-256-gcm":{"cipher":"AES","key":256,"iv":12,"mode":"GCM","type":"auth"}}},{}],39:[function(require,module,exports){(function(Buffer){var xor=require('buffer-xor')
function getBlock(self){self._prev=self._cipher.encryptBlock(self._prev)
return self._prev}
exports.encrypt=function(self,chunk){while(self._cache.length<chunk.length){self._cache=Buffer.concat([self._cache,getBlock(self)])}
var pad=self._cache.slice(0,chunk.length)
self._cache=self._cache.slice(chunk.length)
return xor(chunk,pad)}}).call(this,require("buffer").Buffer)},{"buffer":54,"buffer-xor":53}],40:[function(require,module,exports){var aes=require('./aes')
var Buffer=require('safe-buffer').Buffer
var Transform=require('cipher-base')
var inherits=require('inherits')
function StreamCipher(mode,key,iv,decrypt){Transform.call(this)
this._cipher=new aes.AES(key)
this._prev=Buffer.from(iv)
this._cache=Buffer.allocUnsafe(0)
this._secCache=Buffer.allocUnsafe(0)
this._decrypt=decrypt
this._mode=mode}
inherits(StreamCipher,Transform)
StreamCipher.prototype._update=function(chunk){return this._mode.encrypt(this,chunk,this._decrypt)}
StreamCipher.prototype._final=function(){this._cipher.scrub()}
module.exports=StreamCipher},{"./aes":24,"cipher-base":56,"inherits":108,"safe-buffer":167}],41:[function(require,module,exports){var DES=require('browserify-des')
var aes=require('browserify-aes/browser')
var aesModes=require('browserify-aes/modes')
var desModes=require('browserify-des/modes')
var ebtk=require('evp_bytestokey')
function createCipher(suite,password){suite=suite.toLowerCase()
var keyLen,ivLen
if(aesModes[suite]){keyLen=aesModes[suite].key
ivLen=aesModes[suite].iv}else if(desModes[suite]){keyLen=desModes[suite].key*8
ivLen=desModes[suite].iv}else{throw new TypeError('invalid suite type')}
var keys=ebtk(password,!1,keyLen,ivLen)
return createCipheriv(suite,keys.key,keys.iv)}
function createDecipher(suite,password){suite=suite.toLowerCase()
var keyLen,ivLen
if(aesModes[suite]){keyLen=aesModes[suite].key
ivLen=aesModes[suite].iv}else if(desModes[suite]){keyLen=desModes[suite].key*8
ivLen=desModes[suite].iv}else{throw new TypeError('invalid suite type')}
var keys=ebtk(password,!1,keyLen,ivLen)
return createDecipheriv(suite,keys.key,keys.iv)}
function createCipheriv(suite,key,iv){suite=suite.toLowerCase()
if(aesModes[suite])return aes.createCipheriv(suite,key,iv)
if(desModes[suite])return new DES({key:key,iv:iv,mode:suite})
throw new TypeError('invalid suite type')}
function createDecipheriv(suite,key,iv){suite=suite.toLowerCase()
if(aesModes[suite])return aes.createDecipheriv(suite,key,iv)
if(desModes[suite])return new DES({key:key,iv:iv,mode:suite,decrypt:!0})
throw new TypeError('invalid suite type')}
function getCiphers(){return Object.keys(desModes).concat(aes.getCiphers())}
exports.createCipher=exports.Cipher=createCipher
exports.createCipheriv=exports.Cipheriv=createCipheriv
exports.createDecipher=exports.Decipher=createDecipher
exports.createDecipheriv=exports.Decipheriv=createDecipheriv
exports.listCiphers=exports.getCiphers=getCiphers},{"browserify-aes/browser":26,"browserify-aes/modes":37,"browserify-des":42,"browserify-des/modes":43,"evp_bytestokey":91}],42:[function(require,module,exports){var CipherBase=require('cipher-base')
var des=require('des.js')
var inherits=require('inherits')
var Buffer=require('safe-buffer').Buffer
var modes={'des-ede3-cbc':des.CBC.instantiate(des.EDE),'des-ede3':des.EDE,'des-ede-cbc':des.CBC.instantiate(des.EDE),'des-ede':des.EDE,'des-cbc':des.CBC.instantiate(des.DES),'des-ecb':des.DES}
modes.des=modes['des-cbc']
modes.des3=modes['des-ede3-cbc']
module.exports=DES
inherits(DES,CipherBase)
function DES(opts){CipherBase.call(this)
var modeName=opts.mode.toLowerCase()
var mode=modes[modeName]
var type
if(opts.decrypt){type='decrypt'}else{type='encrypt'}
var key=opts.key
if(!Buffer.isBuffer(key)){key=Buffer.from(key)}
if(modeName==='des-ede'||modeName==='des-ede-cbc'){key=Buffer.concat([key,key.slice(0,8)])}
var iv=opts.iv
if(!Buffer.isBuffer(iv)){iv=Buffer.from(iv)}
this._des=mode.create({key:key,iv:iv,type:type})}
DES.prototype._update=function(data){return Buffer.from(this._des.update(data))}
DES.prototype._final=function(){return Buffer.from(this._des.final())}},{"cipher-base":56,"des.js":64,"inherits":108,"safe-buffer":167}],43:[function(require,module,exports){exports['des-ecb']={key:8,iv:0}
exports['des-cbc']=exports.des={key:8,iv:8}
exports['des-ede3-cbc']=exports.des3={key:24,iv:8}
exports['des-ede3']={key:24,iv:0}
exports['des-ede-cbc']={key:16,iv:8}
exports['des-ede']={key:16,iv:0}},{}],44:[function(require,module,exports){(function(Buffer){var bn=require('bn.js');var randomBytes=require('randombytes');module.exports=crt;function blind(priv){var r=getr(priv);var blinder=r.toRed(bn.mont(priv.modulus)).redPow(new bn(priv.publicExponent)).fromRed();return{blinder:blinder,unblinder:r.invm(priv.modulus)}}
function crt(msg,priv){var blinds=blind(priv);var len=priv.modulus.byteLength();var mod=bn.mont(priv.modulus);var blinded=new bn(msg).mul(blinds.blinder).umod(priv.modulus);var c1=blinded.toRed(bn.mont(priv.prime1));var c2=blinded.toRed(bn.mont(priv.prime2));var qinv=priv.coefficient;var p=priv.prime1;var q=priv.prime2;var m1=c1.redPow(priv.exponent1);var m2=c2.redPow(priv.exponent2);m1=m1.fromRed();m2=m2.fromRed();var h=m1.isub(m2).imul(qinv).umod(p);h.imul(q);m2.iadd(h);return new Buffer(m2.imul(blinds.unblinder).umod(priv.modulus).toArray(!1,len))}
crt.getr=getr;function getr(priv){var len=priv.modulus.byteLength();var r=new bn(randomBytes(len));while(r.cmp(priv.modulus)>=0||!r.umod(priv.prime1)||!r.umod(priv.prime2)){r=new bn(randomBytes(len))}
return r}}).call(this,require("buffer").Buffer)},{"bn.js":21,"buffer":54,"randombytes":150}],45:[function(require,module,exports){module.exports=require('./browser/algorithms.json')},{"./browser/algorithms.json":46}],46:[function(require,module,exports){module.exports={"sha224WithRSAEncryption":{"sign":"rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"RSA-SHA224":{"sign":"ecdsa/rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"sha256WithRSAEncryption":{"sign":"rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"RSA-SHA256":{"sign":"ecdsa/rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"sha384WithRSAEncryption":{"sign":"rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"RSA-SHA384":{"sign":"ecdsa/rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"sha512WithRSAEncryption":{"sign":"rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA512":{"sign":"ecdsa/rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA1":{"sign":"rsa","hash":"sha1","id":"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{"sign":"ecdsa","hash":"sha1","id":""},"sha256":{"sign":"ecdsa","hash":"sha256","id":""},"sha224":{"sign":"ecdsa","hash":"sha224","id":""},"sha384":{"sign":"ecdsa","hash":"sha384","id":""},"sha512":{"sign":"ecdsa","hash":"sha512","id":""},"DSA-SHA":{"sign":"dsa","hash":"sha1","id":""},"DSA-SHA1":{"sign":"dsa","hash":"sha1","id":""},"DSA":{"sign":"dsa","hash":"sha1","id":""},"DSA-WITH-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-WITH-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-WITH-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-WITH-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-RIPEMD160":{"sign":"dsa","hash":"rmd160","id":""},"ripemd160WithRSA":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"RSA-RIPEMD160":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"md5WithRSAEncryption":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"},"RSA-MD5":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"}}},{}],47:[function(require,module,exports){module.exports={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}},{}],48:[function(require,module,exports){(function(Buffer){var createHash=require('create-hash')
var stream=require('stream')
var inherits=require('inherits')
var sign=require('./sign')
var verify=require('./verify')
var algorithms=require('./algorithms.json')
Object.keys(algorithms).forEach(function(key){algorithms[key].id=new Buffer(algorithms[key].id,'hex')
algorithms[key.toLowerCase()]=algorithms[key]})
function Sign(algorithm){stream.Writable.call(this)
var data=algorithms[algorithm]
if(!data)throw new Error('Unknown message digest')
this._hashType=data.hash
this._hash=createHash(data.hash)
this._tag=data.id
this._signType=data.sign}
inherits(Sign,stream.Writable)
Sign.prototype._write=function _write(data,_,done){this._hash.update(data)
done()}
Sign.prototype.update=function update(data,enc){if(typeof data==='string')data=new Buffer(data,enc)
this._hash.update(data)
return this}
Sign.prototype.sign=function signMethod(key,enc){this.end()
var hash=this._hash.digest()
var sig=sign(hash,key,this._hashType,this._signType,this._tag)
return enc?sig.toString(enc):sig}
function Verify(algorithm){stream.Writable.call(this)
var data=algorithms[algorithm]
if(!data)throw new Error('Unknown message digest')
this._hash=createHash(data.hash)
this._tag=data.id
this._signType=data.sign}
inherits(Verify,stream.Writable)
Verify.prototype._write=function _write(data,_,done){this._hash.update(data)
done()}
Verify.prototype.update=function update(data,enc){if(typeof data==='string')data=new Buffer(data,enc)
this._hash.update(data)
return this}
Verify.prototype.verify=function verifyMethod(key,sig,enc){if(typeof sig==='string')sig=new Buffer(sig,enc)
this.end()
var hash=this._hash.digest()
return verify(sig,hash,key,this._signType,this._tag)}
function createSign(algorithm){return new Sign(algorithm)}
function createVerify(algorithm){return new Verify(algorithm)}
module.exports={Sign:createSign,Verify:createVerify,createSign:createSign,createVerify:createVerify}}).call(this,require("buffer").Buffer)},{"./algorithms.json":46,"./sign":49,"./verify":50,"buffer":54,"create-hash":59,"inherits":108,"stream":176}],49:[function(require,module,exports){(function(Buffer){var createHmac=require('create-hmac')
var crt=require('browserify-rsa')
var EC=require('elliptic').ec
var BN=require('bn.js')
var parseKeys=require('parse-asn1')
var curves=require('./curves.json')
function sign(hash,key,hashType,signType,tag){var priv=parseKeys(key)
if(priv.curve){if(signType!=='ecdsa'&&signType!=='ecdsa/rsa')throw new Error('wrong private key type')
return ecSign(hash,priv)}else if(priv.type==='dsa'){if(signType!=='dsa')throw new Error('wrong private key type')
return dsaSign(hash,priv,hashType)}else{if(signType!=='rsa'&&signType!=='ecdsa/rsa')throw new Error('wrong private key type')}
hash=Buffer.concat([tag,hash])
var len=priv.modulus.byteLength()
var pad=[0,1]
while(hash.length+pad.length+1<len)pad.push(0xff)
pad.push(0x00)
var i=-1
while(++i<hash.length)pad.push(hash[i])
var out=crt(pad,priv)
return out}
function ecSign(hash,priv){var curveId=curves[priv.curve.join('.')]
if(!curveId)throw new Error('unknown curve '+priv.curve.join('.'))
var curve=new EC(curveId)
var key=curve.keyFromPrivate(priv.privateKey)
var out=key.sign(hash)
return new Buffer(out.toDER())}
function dsaSign(hash,priv,algo){var x=priv.params.priv_key
var p=priv.params.p
var q=priv.params.q
var g=priv.params.g
var r=new BN(0)
var k
var H=bits2int(hash,q).mod(q)
var s=!1
var kv=getKey(x,q,hash,algo)
while(s===!1){k=makeKey(q,kv,algo)
r=makeR(g,k,p,q)
s=k.invm(q).imul(H.add(x.mul(r))).mod(q)
if(s.cmpn(0)===0){s=!1
r=new BN(0)}}
return toDER(r,s)}
function toDER(r,s){r=r.toArray()
s=s.toArray()
if(r[0]&0x80)r=[0].concat(r)
if(s[0]&0x80)s=[0].concat(s)
var total=r.length+s.length+4
var res=[0x30,total,0x02,r.length]
res=res.concat(r,[0x02,s.length],s)
return new Buffer(res)}
function getKey(x,q,hash,algo){x=new Buffer(x.toArray())
if(x.length<q.byteLength()){var zeros=new Buffer(q.byteLength()-x.length)
zeros.fill(0)
x=Buffer.concat([zeros,x])}
var hlen=hash.length
var hbits=bits2octets(hash,q)
var v=new Buffer(hlen)
v.fill(1)
var k=new Buffer(hlen)
k.fill(0)
k=createHmac(algo,k).update(v).update(new Buffer([0])).update(x).update(hbits).digest()
v=createHmac(algo,k).update(v).digest()
k=createHmac(algo,k).update(v).update(new Buffer([1])).update(x).update(hbits).digest()
v=createHmac(algo,k).update(v).digest()
return{k:k,v:v}}
function bits2int(obits,q){var bits=new BN(obits)
var shift=(obits.length<<3)-q.bitLength()
if(shift>0)bits.ishrn(shift)
return bits}
function bits2octets(bits,q){bits=bits2int(bits,q)
bits=bits.mod(q)
var out=new Buffer(bits.toArray())
if(out.length<q.byteLength()){var zeros=new Buffer(q.byteLength()-out.length)
zeros.fill(0)
out=Buffer.concat([zeros,out])}
return out}
function makeKey(q,kv,algo){var t
var k
do{t=new Buffer(0)
while(t.length*8<q.bitLength()){kv.v=createHmac(algo,kv.k).update(kv.v).digest()
t=Buffer.concat([t,kv.v])}
k=bits2int(t,q)
kv.k=createHmac(algo,kv.k).update(kv.v).update(new Buffer([0])).digest()
kv.v=createHmac(algo,kv.k).update(kv.v).digest()}while(k.cmp(q)!==-1)
return k}
function makeR(g,k,p,q){return g.toRed(BN.mont(p)).redPow(k).fromRed().mod(q)}
module.exports=sign
module.exports.getKey=getKey
module.exports.makeKey=makeKey}).call(this,require("buffer").Buffer)},{"./curves.json":47,"bn.js":21,"browserify-rsa":44,"buffer":54,"create-hmac":61,"elliptic":74,"parse-asn1":131}],50:[function(require,module,exports){(function(Buffer){var BN=require('bn.js')
var EC=require('elliptic').ec
var parseKeys=require('parse-asn1')
var curves=require('./curves.json')
function verify(sig,hash,key,signType,tag){var pub=parseKeys(key)
if(pub.type==='ec'){if(signType!=='ecdsa'&&signType!=='ecdsa/rsa')throw new Error('wrong public key type')
return ecVerify(sig,hash,pub)}else if(pub.type==='dsa'){if(signType!=='dsa')throw new Error('wrong public key type')
return dsaVerify(sig,hash,pub)}else{if(signType!=='rsa'&&signType!=='ecdsa/rsa')throw new Error('wrong public key type')}
hash=Buffer.concat([tag,hash])
var len=pub.modulus.byteLength()
var pad=[1]
var padNum=0
while(hash.length+pad.length+2<len){pad.push(0xff)
padNum++}
pad.push(0x00)
var i=-1
while(++i<hash.length){pad.push(hash[i])}
pad=new Buffer(pad)
var red=BN.mont(pub.modulus)
sig=new BN(sig).toRed(red)
sig=sig.redPow(new BN(pub.publicExponent))
sig=new Buffer(sig.fromRed().toArray())
var out=padNum<8?1:0
len=Math.min(sig.length,pad.length)
if(sig.length!==pad.length)out=1
i=-1
while(++i<len)out|=sig[i]^pad[i]
return out===0}
function ecVerify(sig,hash,pub){var curveId=curves[pub.data.algorithm.curve.join('.')]
if(!curveId)throw new Error('unknown curve '+pub.data.algorithm.curve.join('.'))
var curve=new EC(curveId)
var pubkey=pub.data.subjectPrivateKey.data
return curve.verify(hash,sig,pubkey)}
function dsaVerify(sig,hash,pub){var p=pub.data.p
var q=pub.data.q
var g=pub.data.g
var y=pub.data.pub_key
var unpacked=parseKeys.signature.decode(sig,'der')
var s=unpacked.s
var r=unpacked.r
checkValue(s,q)
checkValue(r,q)
var montp=BN.mont(p)
var w=s.invm(q)
var v=g.toRed(montp).redPow(new BN(hash).mul(w).mod(q)).fromRed().mul(y.toRed(montp).redPow(r.mul(w).mod(q)).fromRed()).mod(p).mod(q)
return v.cmp(r)===0}
function checkValue(b,q){if(b.cmpn(0)<=0)throw new Error('invalid sig')
if(b.cmp(q)>=q)throw new Error('invalid sig')}
module.exports=verify}).call(this,require("buffer").Buffer)},{"./curves.json":47,"bn.js":21,"buffer":54,"elliptic":74,"parse-asn1":131}],51:[function(require,module,exports){(function(process,Buffer){'use strict';var assert=require('assert');var Zstream=require('pako/lib/zlib/zstream');var zlib_deflate=require('pako/lib/zlib/deflate.js');var zlib_inflate=require('pako/lib/zlib/inflate.js');var constants=require('pako/lib/zlib/constants');for(var key in constants){exports[key]=constants[key]}
exports.NONE=0;exports.DEFLATE=1;exports.INFLATE=2;exports.GZIP=3;exports.GUNZIP=4;exports.DEFLATERAW=5;exports.INFLATERAW=6;exports.UNZIP=7;var GZIP_HEADER_ID1=0x1f;var GZIP_HEADER_ID2=0x8b;function Zlib(mode){if(typeof mode!=='number'||mode<exports.DEFLATE||mode>exports.UNZIP){throw new TypeError('Bad argument')}
this.dictionary=null;this.err=0;this.flush=0;this.init_done=!1;this.level=0;this.memLevel=0;this.mode=mode;this.strategy=0;this.windowBits=0;this.write_in_progress=!1;this.pending_close=!1;this.gzip_id_bytes_read=0}
Zlib.prototype.close=function(){if(this.write_in_progress){this.pending_close=!0;return}
this.pending_close=!1;assert(this.init_done,'close before init');assert(this.mode<=exports.UNZIP);if(this.mode===exports.DEFLATE||this.mode===exports.GZIP||this.mode===exports.DEFLATERAW){zlib_deflate.deflateEnd(this.strm)}else if(this.mode===exports.INFLATE||this.mode===exports.GUNZIP||this.mode===exports.INFLATERAW||this.mode===exports.UNZIP){zlib_inflate.inflateEnd(this.strm)}
this.mode=exports.NONE;this.dictionary=null};Zlib.prototype.write=function(flush,input,in_off,in_len,out,out_off,out_len){return this._write(!0,flush,input,in_off,in_len,out,out_off,out_len)};Zlib.prototype.writeSync=function(flush,input,in_off,in_len,out,out_off,out_len){return this._write(!1,flush,input,in_off,in_len,out,out_off,out_len)};Zlib.prototype._write=function(async,flush,input,in_off,in_len,out,out_off,out_len){assert.equal(arguments.length,8);assert(this.init_done,'write before init');assert(this.mode!==exports.NONE,'already finalized');assert.equal(!1,this.write_in_progress,'write already in progress');assert.equal(!1,this.pending_close,'close is pending');this.write_in_progress=!0;assert.equal(!1,flush===undefined,'must provide flush value');this.write_in_progress=!0;if(flush!==exports.Z_NO_FLUSH&&flush!==exports.Z_PARTIAL_FLUSH&&flush!==exports.Z_SYNC_FLUSH&&flush!==exports.Z_FULL_FLUSH&&flush!==exports.Z_FINISH&&flush!==exports.Z_BLOCK){throw new Error('Invalid flush value')}
if(input==null){input=Buffer.alloc(0);in_len=0;in_off=0}
this.strm.avail_in=in_len;this.strm.input=input;this.strm.next_in=in_off;this.strm.avail_out=out_len;this.strm.output=out;this.strm.next_out=out_off;this.flush=flush;if(!async){this._process();if(this._checkError()){return this._afterSync()}
return}
var self=this;process.nextTick(function(){self._process();self._after()});return this};Zlib.prototype._afterSync=function(){var avail_out=this.strm.avail_out;var avail_in=this.strm.avail_in;this.write_in_progress=!1;return[avail_in,avail_out]};Zlib.prototype._process=function(){var next_expected_header_byte=null;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:this.err=zlib_deflate.deflate(this.strm,this.flush);break;case exports.UNZIP:if(this.strm.avail_in>0){next_expected_header_byte=this.strm.next_in}
switch(this.gzip_id_bytes_read){case 0:if(next_expected_header_byte===null){break}
if(this.strm.input[next_expected_header_byte]===GZIP_HEADER_ID1){this.gzip_id_bytes_read=1;next_expected_header_byte++;if(this.strm.avail_in===1){break}}else{this.mode=exports.INFLATE;break}
case 1:if(next_expected_header_byte===null){break}
if(this.strm.input[next_expected_header_byte]===GZIP_HEADER_ID2){this.gzip_id_bytes_read=2;this.mode=exports.GUNZIP}else{this.mode=exports.INFLATE}
break;default:throw new Error('invalid number of gzip magic number bytes read')}
case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:this.err=zlib_inflate.inflate(this.strm,this.flush);if(this.err===exports.Z_NEED_DICT&&this.dictionary){this.err=zlib_inflate.inflateSetDictionary(this.strm,this.dictionary);if(this.err===exports.Z_OK){this.err=zlib_inflate.inflate(this.strm,this.flush)}else if(this.err===exports.Z_DATA_ERROR){this.err=exports.Z_NEED_DICT}}
while(this.strm.avail_in>0&&this.mode===exports.GUNZIP&&this.err===exports.Z_STREAM_END&&this.strm.next_in[0]!==0x00){this.reset();this.err=zlib_inflate.inflate(this.strm,this.flush)}
break;default:throw new Error('Unknown mode '+this.mode)}};Zlib.prototype._checkError=function(){switch(this.err){case exports.Z_OK:case exports.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===exports.Z_FINISH){this._error('unexpected end of file');return!1}
break;case exports.Z_STREAM_END:break;case exports.Z_NEED_DICT:if(this.dictionary==null){this._error('Missing dictionary')}else{this._error('Bad dictionary')}
return!1;default:this._error('Zlib error');return!1}
return!0};Zlib.prototype._after=function(){if(!this._checkError()){return}
var avail_out=this.strm.avail_out;var avail_in=this.strm.avail_in;this.write_in_progress=!1;this.callback(avail_in,avail_out);if(this.pending_close){this.close()}};Zlib.prototype._error=function(message){if(this.strm.msg){message=this.strm.msg}
this.onerror(message,this.err);this.write_in_progress=!1;if(this.pending_close){this.close()}};Zlib.prototype.init=function(windowBits,level,memLevel,strategy,dictionary){assert(arguments.length===4||arguments.length===5,'init(windowBits, level, memLevel, strategy, [dictionary])');assert(windowBits>=8&&windowBits<=15,'invalid windowBits');assert(level>=-1&&level<=9,'invalid compression level');assert(memLevel>=1&&memLevel<=9,'invalid memlevel');assert(strategy===exports.Z_FILTERED||strategy===exports.Z_HUFFMAN_ONLY||strategy===exports.Z_RLE||strategy===exports.Z_FIXED||strategy===exports.Z_DEFAULT_STRATEGY,'invalid strategy');this._init(level,windowBits,memLevel,strategy,dictionary);this._setDictionary()};Zlib.prototype.params=function(){throw new Error('deflateParams Not supported')};Zlib.prototype.reset=function(){this._reset();this._setDictionary()};Zlib.prototype._init=function(level,windowBits,memLevel,strategy,dictionary){this.level=level;this.windowBits=windowBits;this.memLevel=memLevel;this.strategy=strategy;this.flush=exports.Z_NO_FLUSH;this.err=exports.Z_OK;if(this.mode===exports.GZIP||this.mode===exports.GUNZIP){this.windowBits+=16}
if(this.mode===exports.UNZIP){this.windowBits+=32}
if(this.mode===exports.DEFLATERAW||this.mode===exports.INFLATERAW){this.windowBits=-1*this.windowBits}
this.strm=new Zstream();switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:this.err=zlib_deflate.deflateInit2(this.strm,this.level,exports.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:case exports.UNZIP:this.err=zlib_inflate.inflateInit2(this.strm,this.windowBits);break;default:throw new Error('Unknown mode '+this.mode)}
if(this.err!==exports.Z_OK){this._error('Init error')}
this.dictionary=dictionary;this.write_in_progress=!1;this.init_done=!0};Zlib.prototype._setDictionary=function(){if(this.dictionary==null){return}
this.err=exports.Z_OK;switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:this.err=zlib_deflate.deflateSetDictionary(this.strm,this.dictionary);break;default:break}
if(this.err!==exports.Z_OK){this._error('Failed to set dictionary')}};Zlib.prototype._reset=function(){this.err=exports.Z_OK;switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:case exports.GZIP:this.err=zlib_deflate.deflateReset(this.strm);break;case exports.INFLATE:case exports.INFLATERAW:case exports.GUNZIP:this.err=zlib_inflate.inflateReset(this.strm);break;default:break}
if(this.err!==exports.Z_OK){this._error('Failed to reset stream')}};exports.Zlib=Zlib}).call(this,require('_process'),require("buffer").Buffer)},{"_process":139,"assert":16,"buffer":54,"pako/lib/zlib/constants":118,"pako/lib/zlib/deflate.js":120,"pako/lib/zlib/inflate.js":122,"pako/lib/zlib/zstream":126}],52:[function(require,module,exports){(function(process){'use strict';var Buffer=require('buffer').Buffer;var Transform=require('stream').Transform;var binding=require('./binding');var util=require('util');var assert=require('assert').ok;var kMaxLength=require('buffer').kMaxLength;var kRangeErrorMessage='Cannot create final Buffer. It would be larger '+'than 0x'+kMaxLength.toString(16)+' bytes';binding.Z_MIN_WINDOWBITS=8;binding.Z_MAX_WINDOWBITS=15;binding.Z_DEFAULT_WINDOWBITS=15;binding.Z_MIN_CHUNK=64;binding.Z_MAX_CHUNK=Infinity;binding.Z_DEFAULT_CHUNK=16*1024;binding.Z_MIN_MEMLEVEL=1;binding.Z_MAX_MEMLEVEL=9;binding.Z_DEFAULT_MEMLEVEL=8;binding.Z_MIN_LEVEL=-1;binding.Z_MAX_LEVEL=9;binding.Z_DEFAULT_LEVEL=binding.Z_DEFAULT_COMPRESSION;var bkeys=Object.keys(binding);for(var bk=0;bk<bkeys.length;bk++){var bkey=bkeys[bk];if(bkey.match(/^Z/)){Object.defineProperty(exports,bkey,{enumerable:!0,value:binding[bkey],writable:!1})}}
var codes={Z_OK:binding.Z_OK,Z_STREAM_END:binding.Z_STREAM_END,Z_NEED_DICT:binding.Z_NEED_DICT,Z_ERRNO:binding.Z_ERRNO,Z_STREAM_ERROR:binding.Z_STREAM_ERROR,Z_DATA_ERROR:binding.Z_DATA_ERROR,Z_MEM_ERROR:binding.Z_MEM_ERROR,Z_BUF_ERROR:binding.Z_BUF_ERROR,Z_VERSION_ERROR:binding.Z_VERSION_ERROR};var ckeys=Object.keys(codes);for(var ck=0;ck<ckeys.length;ck++){var ckey=ckeys[ck];codes[codes[ckey]]=ckey}
Object.defineProperty(exports,'codes',{enumerable:!0,value:Object.freeze(codes),writable:!1});exports.Deflate=Deflate;exports.Inflate=Inflate;exports.Gzip=Gzip;exports.Gunzip=Gunzip;exports.DeflateRaw=DeflateRaw;exports.InflateRaw=InflateRaw;exports.Unzip=Unzip;exports.createDeflate=function(o){return new Deflate(o)};exports.createInflate=function(o){return new Inflate(o)};exports.createDeflateRaw=function(o){return new DeflateRaw(o)};exports.createInflateRaw=function(o){return new InflateRaw(o)};exports.createGzip=function(o){return new Gzip(o)};exports.createGunzip=function(o){return new Gunzip(o)};exports.createUnzip=function(o){return new Unzip(o)};exports.deflate=function(buffer,opts,callback){if(typeof opts==='function'){callback=opts;opts={}}
return zlibBuffer(new Deflate(opts),buffer,callback)};exports.deflateSync=function(buffer,opts){return zlibBufferSync(new Deflate(opts),buffer)};exports.gzip=function(buffer,opts,callback){if(typeof opts==='function'){callback=opts;opts={}}
return zlibBuffer(new Gzip(opts),buffer,callback)};exports.gzipSync=function(buffer,opts){return zlibBufferSync(new Gzip(opts),buffer)};exports.deflateRaw=function(buffer,opts,callback){if(typeof opts==='function'){callback=opts;opts={}}
return zlibBuffer(new DeflateRaw(opts),buffer,callback)};exports.deflateRawSync=function(buffer,opts){return zlibBufferSync(new DeflateRaw(opts),buffer)};exports.unzip=function(buffer,opts,callback){if(typeof opts==='function'){callback=opts;opts={}}
return zlibBuffer(new Unzip(opts),buffer,callback)};exports.unzipSync=function(buffer,opts){return zlibBufferSync(new Unzip(opts),buffer)};exports.inflate=function(buffer,opts,callback){if(typeof opts==='function'){callback=opts;opts={}}
return zlibBuffer(new Inflate(opts),buffer,callback)};exports.inflateSync=function(buffer,opts){return zlibBufferSync(new Inflate(opts),buffer)};exports.gunzip=function(buffer,opts,callback){if(typeof opts==='function'){callback=opts;opts={}}
return zlibBuffer(new Gunzip(opts),buffer,callback)};exports.gunzipSync=function(buffer,opts){return zlibBufferSync(new Gunzip(opts),buffer)};exports.inflateRaw=function(buffer,opts,callback){if(typeof opts==='function'){callback=opts;opts={}}
return zlibBuffer(new InflateRaw(opts),buffer,callback)};exports.inflateRawSync=function(buffer,opts){return zlibBufferSync(new InflateRaw(opts),buffer)};function zlibBuffer(engine,buffer,callback){var buffers=[];var nread=0;engine.on('error',onError);engine.on('end',onEnd);engine.end(buffer);flow();function flow(){var chunk;while(null!==(chunk=engine.read())){buffers.push(chunk);nread+=chunk.length}
engine.once('readable',flow)}
function onError(err){engine.removeListener('end',onEnd);engine.removeListener('readable',flow);callback(err)}
function onEnd(){var buf;var err=null;if(nread>=kMaxLength){err=new RangeError(kRangeErrorMessage)}else{buf=Buffer.concat(buffers,nread)}
buffers=[];engine.close();callback(err,buf)}}
function zlibBufferSync(engine,buffer){if(typeof buffer==='string')buffer=Buffer.from(buffer);if(!Buffer.isBuffer(buffer))throw new TypeError('Not a string or buffer');var flushFlag=engine._finishFlushFlag;return engine._processChunk(buffer,flushFlag)}
function Deflate(opts){if(!(this instanceof Deflate))return new Deflate(opts);Zlib.call(this,opts,binding.DEFLATE)}
function Inflate(opts){if(!(this instanceof Inflate))return new Inflate(opts);Zlib.call(this,opts,binding.INFLATE)}
function Gzip(opts){if(!(this instanceof Gzip))return new Gzip(opts);Zlib.call(this,opts,binding.GZIP)}
function Gunzip(opts){if(!(this instanceof Gunzip))return new Gunzip(opts);Zlib.call(this,opts,binding.GUNZIP)}
function DeflateRaw(opts){if(!(this instanceof DeflateRaw))return new DeflateRaw(opts);Zlib.call(this,opts,binding.DEFLATERAW)}
function InflateRaw(opts){if(!(this instanceof InflateRaw))return new InflateRaw(opts);Zlib.call(this,opts,binding.INFLATERAW)}
function Unzip(opts){if(!(this instanceof Unzip))return new Unzip(opts);Zlib.call(this,opts,binding.UNZIP)}
function isValidFlushFlag(flag){return flag===binding.Z_NO_FLUSH||flag===binding.Z_PARTIAL_FLUSH||flag===binding.Z_SYNC_FLUSH||flag===binding.Z_FULL_FLUSH||flag===binding.Z_FINISH||flag===binding.Z_BLOCK}
function Zlib(opts,mode){var _this=this;this._opts=opts=opts||{};this._chunkSize=opts.chunkSize||exports.Z_DEFAULT_CHUNK;Transform.call(this,opts);if(opts.flush&&!isValidFlushFlag(opts.flush)){throw new Error('Invalid flush flag: '+opts.flush)}
if(opts.finishFlush&&!isValidFlushFlag(opts.finishFlush)){throw new Error('Invalid flush flag: '+opts.finishFlush)}
this._flushFlag=opts.flush||binding.Z_NO_FLUSH;this._finishFlushFlag=typeof opts.finishFlush!=='undefined'?opts.finishFlush:binding.Z_FINISH;if(opts.chunkSize){if(opts.chunkSize<exports.Z_MIN_CHUNK||opts.chunkSize>exports.Z_MAX_CHUNK){throw new Error('Invalid chunk size: '+opts.chunkSize)}}
if(opts.windowBits){if(opts.windowBits<exports.Z_MIN_WINDOWBITS||opts.windowBits>exports.Z_MAX_WINDOWBITS){throw new Error('Invalid windowBits: '+opts.windowBits)}}
if(opts.level){if(opts.level<exports.Z_MIN_LEVEL||opts.level>exports.Z_MAX_LEVEL){throw new Error('Invalid compression level: '+opts.level)}}
if(opts.memLevel){if(opts.memLevel<exports.Z_MIN_MEMLEVEL||opts.memLevel>exports.Z_MAX_MEMLEVEL){throw new Error('Invalid memLevel: '+opts.memLevel)}}
if(opts.strategy){if(opts.strategy!=exports.Z_FILTERED&&opts.strategy!=exports.Z_HUFFMAN_ONLY&&opts.strategy!=exports.Z_RLE&&opts.strategy!=exports.Z_FIXED&&opts.strategy!=exports.Z_DEFAULT_STRATEGY){throw new Error('Invalid strategy: '+opts.strategy)}}
if(opts.dictionary){if(!Buffer.isBuffer(opts.dictionary)){throw new Error('Invalid dictionary: it should be a Buffer instance')}}
this._handle=new binding.Zlib(mode);var self=this;this._hadError=!1;this._handle.onerror=function(message,errno){_close(self);self._hadError=!0;var error=new Error(message);error.errno=errno;error.code=exports.codes[errno];self.emit('error',error)};var level=exports.Z_DEFAULT_COMPRESSION;if(typeof opts.level==='number')level=opts.level;var strategy=exports.Z_DEFAULT_STRATEGY;if(typeof opts.strategy==='number')strategy=opts.strategy;this._handle.init(opts.windowBits||exports.Z_DEFAULT_WINDOWBITS,level,opts.memLevel||exports.Z_DEFAULT_MEMLEVEL,strategy,opts.dictionary);this._buffer=Buffer.allocUnsafe(this._chunkSize);this._offset=0;this._level=level;this._strategy=strategy;this.once('end',this.close);Object.defineProperty(this,'_closed',{get:function(){return!_this._handle},configurable:!0,enumerable:!0})}
util.inherits(Zlib,Transform);Zlib.prototype.params=function(level,strategy,callback){if(level<exports.Z_MIN_LEVEL||level>exports.Z_MAX_LEVEL){throw new RangeError('Invalid compression level: '+level)}
if(strategy!=exports.Z_FILTERED&&strategy!=exports.Z_HUFFMAN_ONLY&&strategy!=exports.Z_RLE&&strategy!=exports.Z_FIXED&&strategy!=exports.Z_DEFAULT_STRATEGY){throw new TypeError('Invalid strategy: '+strategy)}
if(this._level!==level||this._strategy!==strategy){var self=this;this.flush(binding.Z_SYNC_FLUSH,function(){assert(self._handle,'zlib binding closed');self._handle.params(level,strategy);if(!self._hadError){self._level=level;self._strategy=strategy;if(callback)callback()}})}else{process.nextTick(callback)}};Zlib.prototype.reset=function(){assert(this._handle,'zlib binding closed');return this._handle.reset()};Zlib.prototype._flush=function(callback){this._transform(Buffer.alloc(0),'',callback)};Zlib.prototype.flush=function(kind,callback){var _this2=this;var ws=this._writableState;if(typeof kind==='function'||kind===undefined&&!callback){callback=kind;kind=binding.Z_FULL_FLUSH}
if(ws.ended){if(callback)process.nextTick(callback)}else if(ws.ending){if(callback)this.once('end',callback)}else if(ws.needDrain){if(callback){this.once('drain',function(){return _this2.flush(kind,callback)})}}else{this._flushFlag=kind;this.write(Buffer.alloc(0),'',callback)}};Zlib.prototype.close=function(callback){_close(this,callback);process.nextTick(emitCloseNT,this)};function _close(engine,callback){if(callback)process.nextTick(callback);if(!engine._handle)return;engine._handle.close();engine._handle=null}
function emitCloseNT(self){self.emit('close')}
Zlib.prototype._transform=function(chunk,encoding,cb){var flushFlag;var ws=this._writableState;var ending=ws.ending||ws.ended;var last=ending&&(!chunk||ws.length===chunk.length);if(chunk!==null&&!Buffer.isBuffer(chunk))return cb(new Error('invalid input'));if(!this._handle)return cb(new Error('zlib binding closed'));if(last)flushFlag=this._finishFlushFlag;else{flushFlag=this._flushFlag;if(chunk.length>=ws.length){this._flushFlag=this._opts.flush||binding.Z_NO_FLUSH}}
this._processChunk(chunk,flushFlag,cb)};Zlib.prototype._processChunk=function(chunk,flushFlag,cb){var availInBefore=chunk&&chunk.length;var availOutBefore=this._chunkSize-this._offset;var inOff=0;var self=this;var async=typeof cb==='function';if(!async){var buffers=[];var nread=0;var error;this.on('error',function(er){error=er});assert(this._handle,'zlib binding closed');do{var res=this._handle.writeSync(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore)}while(!this._hadError&&callback(res[0],res[1]));if(this._hadError){throw error}
if(nread>=kMaxLength){_close(this);throw new RangeError(kRangeErrorMessage)}
var buf=Buffer.concat(buffers,nread);_close(this);return buf}
assert(this._handle,'zlib binding closed');var req=this._handle.write(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore);req.buffer=chunk;req.callback=callback;function callback(availInAfter,availOutAfter){if(this){this.buffer=null;this.callback=null}
if(self._hadError)return;var have=availOutBefore-availOutAfter;assert(have>=0,'have should not go down');if(have>0){var out=self._buffer.slice(self._offset,self._offset+have);self._offset+=have;if(async){self.push(out)}else{buffers.push(out);nread+=out.length}}
if(availOutAfter===0||self._offset>=self._chunkSize){availOutBefore=self._chunkSize;self._offset=0;self._buffer=Buffer.allocUnsafe(self._chunkSize)}
if(availOutAfter===0){inOff+=availInBefore-availInAfter;availInBefore=availInAfter;if(!async)return!0;var newReq=self._handle.write(flushFlag,chunk,inOff,availInBefore,self._buffer,self._offset,self._chunkSize);newReq.callback=callback;newReq.buffer=chunk;return}
if(!async)return!1;cb()}};util.inherits(Deflate,Zlib);util.inherits(Inflate,Zlib);util.inherits(Gzip,Zlib);util.inherits(Gunzip,Zlib);util.inherits(DeflateRaw,Zlib);util.inherits(InflateRaw,Zlib);util.inherits(Unzip,Zlib)}).call(this,require('_process'))},{"./binding":51,"_process":139,"assert":16,"buffer":54,"stream":176,"util":188}],53:[function(require,module,exports){(function(Buffer){module.exports=function xor(a,b){var length=Math.min(a.length,b.length)
var buffer=new Buffer(length)
for(var i=0;i<length;++i){buffer[i]=a[i]^b[i]}
return buffer}}).call(this,require("buffer").Buffer)},{"buffer":54}],54:[function(require,module,exports){(function(Buffer){'use strict'
var base64=require('base64-js')
var ieee754=require('ieee754')
exports.Buffer=Buffer
exports.SlowBuffer=SlowBuffer
exports.INSPECT_MAX_BYTES=50
var K_MAX_LENGTH=0x7fffffff
exports.kMaxLength=K_MAX_LENGTH
Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport()
if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=='undefined'&&typeof console.error==='function'){console.error('This browser lacks typed array (Uint8Array) support which is required by '+'`buffer` v5.x. Use `buffer` v4.x if you require old browser support.')}
function typedArraySupport(){try{var arr=new Uint8Array(1)
arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}}
return arr.foo()===42}catch(e){return!1}}
Object.defineProperty(Buffer.prototype,'parent',{enumerable:!0,get:function(){if(!Buffer.isBuffer(this))return undefined
return this.buffer}})
Object.defineProperty(Buffer.prototype,'offset',{enumerable:!0,get:function(){if(!Buffer.isBuffer(this))return undefined
return this.byteOffset}})
function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError('The value "'+length+'" is invalid for option "size"')}
var buf=new Uint8Array(length)
buf.__proto__=Buffer.prototype
return buf}
function Buffer(arg,encodingOrOffset,length){if(typeof arg==='number'){if(typeof encodingOrOffset==='string'){throw new TypeError('The "string" argument must be of type string. Received type number')}
return allocUnsafe(arg)}
return from(arg,encodingOrOffset,length)}
if(typeof Symbol!=='undefined'&&Symbol.species!=null&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1})}
Buffer.poolSize=8192
function from(value,encodingOrOffset,length){if(typeof value==='string'){return fromString(value,encodingOrOffset)}
if(ArrayBuffer.isView(value)){return fromArrayLike(value)}
if(value==null){throw TypeError('The first argument must be one of type string, Buffer, ArrayBuffer, Array, '+'or Array-like Object. Received type '+(typeof value))}
if(isInstance(value,ArrayBuffer)||(value&&isInstance(value.buffer,ArrayBuffer))){return fromArrayBuffer(value,encodingOrOffset,length)}
if(typeof value==='number'){throw new TypeError('The "value" argument must not be of type number. Received type number')}
var valueOf=value.valueOf&&value.valueOf()
if(valueOf!=null&&valueOf!==value){return Buffer.from(valueOf,encodingOrOffset,length)}
var b=fromObject(value)
if(b)return b
if(typeof Symbol!=='undefined'&&Symbol.toPrimitive!=null&&typeof value[Symbol.toPrimitive]==='function'){return Buffer.from(value[Symbol.toPrimitive]('string'),encodingOrOffset,length)}
throw new TypeError('The first argument must be one of type string, Buffer, ArrayBuffer, Array, '+'or Array-like Object. Received type '+(typeof value))}
Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)}
Buffer.prototype.__proto__=Uint8Array.prototype
Buffer.__proto__=Uint8Array
function assertSize(size){if(typeof size!=='number'){throw new TypeError('"size" argument must be of type number')}else if(size<0){throw new RangeError('The value "'+size+'" is invalid for option "size"')}}
function alloc(size,fill,encoding){assertSize(size)
if(size<=0){return createBuffer(size)}
if(fill!==undefined){return typeof encoding==='string'?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}
return createBuffer(size)}
Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)}
function allocUnsafe(size){assertSize(size)
return createBuffer(size<0?0:checked(size)|0)}
Buffer.allocUnsafe=function(size){return allocUnsafe(size)}
Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)}
function fromString(string,encoding){if(typeof encoding!=='string'||encoding===''){encoding='utf8'}
if(!Buffer.isEncoding(encoding)){throw new TypeError('Unknown encoding: '+encoding)}
var length=byteLength(string,encoding)|0
var buf=createBuffer(length)
var actual=buf.write(string,encoding)
if(actual!==length){buf=buf.slice(0,actual)}
return buf}
function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0
var buf=createBuffer(length)
for(var i=0;i<length;i+=1){buf[i]=array[i]&255}
return buf}
function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError('"offset" is outside of buffer bounds')}
if(array.byteLength<byteOffset+(length||0)){throw new RangeError('"length" is outside of buffer bounds')}
var buf
if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}
buf.__proto__=Buffer.prototype
return buf}
function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0
var buf=createBuffer(len)
if(buf.length===0){return buf}
obj.copy(buf,0,0,len)
return buf}
if(obj.length!==undefined){if(typeof obj.length!=='number'||numberIsNaN(obj.length)){return createBuffer(0)}
return fromArrayLike(obj)}
if(obj.type==='Buffer'&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}
function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError('Attempt to allocate Buffer larger than maximum '+'size: 0x'+K_MAX_LENGTH.toString(16)+' bytes')}
return length|0}
function SlowBuffer(length){if(+length!=length){length=0}
return Buffer.alloc(+length)}
Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===!0&&b!==Buffer.prototype}
Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array))a=Buffer.from(a,a.offset,a.byteLength)
if(isInstance(b,Uint8Array))b=Buffer.from(b,b.offset,b.byteLength)
if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}
if(a===b)return 0
var x=a.length
var y=b.length
for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i]
y=b[i]
break}}
if(x<y)return-1
if(y<x)return 1
return 0}
Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case 'hex':case 'utf8':case 'utf-8':case 'ascii':case 'latin1':case 'binary':case 'base64':case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':return!0
default:return!1}}
Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}
if(list.length===0){return Buffer.alloc(0)}
var i
if(length===undefined){length=0
for(i=0;i<list.length;++i){length+=list[i].length}}
var buffer=Buffer.allocUnsafe(length)
var pos=0
for(i=0;i<list.length;++i){var buf=list[i]
if(isInstance(buf,Uint8Array)){buf=Buffer.from(buf)}
if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}
buf.copy(buffer,pos)
pos+=buf.length}
return buffer}
function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}
if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer)){return string.byteLength}
if(typeof string!=='string'){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+'Received type '+typeof string)}
var len=string.length
var mustMatch=(arguments.length>2&&arguments[2]===!0)
if(!mustMatch&&len===0)return 0
var loweredCase=!1
for(;;){switch(encoding){case 'ascii':case 'latin1':case 'binary':return len
case 'utf8':case 'utf-8':return utf8ToBytes(string).length
case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':return len*2
case 'hex':return len>>>1
case 'base64':return base64ToBytes(string).length
default:if(loweredCase){return mustMatch?-1:utf8ToBytes(string).length}
encoding=(''+encoding).toLowerCase()
loweredCase=!0}}}
Buffer.byteLength=byteLength
function slowToString(encoding,start,end){var loweredCase=!1
if(start===undefined||start<0){start=0}
if(start>this.length){return''}
if(end===undefined||end>this.length){end=this.length}
if(end<=0){return''}
end>>>=0
start>>>=0
if(end<=start){return''}
if(!encoding)encoding='utf8'
while(!0){switch(encoding){case 'hex':return hexSlice(this,start,end)
case 'utf8':case 'utf-8':return utf8Slice(this,start,end)
case 'ascii':return asciiSlice(this,start,end)
case 'latin1':case 'binary':return latin1Slice(this,start,end)
case 'base64':return base64Slice(this,start,end)
case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':return utf16leSlice(this,start,end)
default:if(loweredCase)throw new TypeError('Unknown encoding: '+encoding)
encoding=(encoding+'').toLowerCase()
loweredCase=!0}}}
Buffer.prototype._isBuffer=!0
function swap(b,n,m){var i=b[n]
b[n]=b[m]
b[m]=i}
Buffer.prototype.swap16=function swap16(){var len=this.length
if(len%2!==0){throw new RangeError('Buffer size must be a multiple of 16-bits')}
for(var i=0;i<len;i+=2){swap(this,i,i+1)}
return this}
Buffer.prototype.swap32=function swap32(){var len=this.length
if(len%4!==0){throw new RangeError('Buffer size must be a multiple of 32-bits')}
for(var i=0;i<len;i+=4){swap(this,i,i+3)
swap(this,i+1,i+2)}
return this}
Buffer.prototype.swap64=function swap64(){var len=this.length
if(len%8!==0){throw new RangeError('Buffer size must be a multiple of 64-bits')}
for(var i=0;i<len;i+=8){swap(this,i,i+7)
swap(this,i+1,i+6)
swap(this,i+2,i+5)
swap(this,i+3,i+4)}
return this}
Buffer.prototype.toString=function toString(){var length=this.length
if(length===0)return''
if(arguments.length===0)return utf8Slice(this,0,length)
return slowToString.apply(this,arguments)}
Buffer.prototype.toLocaleString=Buffer.prototype.toString
Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError('Argument must be a Buffer')
if(this===b)return!0
return Buffer.compare(this,b)===0}
Buffer.prototype.inspect=function inspect(){var str=''
var max=exports.INSPECT_MAX_BYTES
str=this.toString('hex',0,max).replace(/(.{2})/g,'$1 ').trim()
if(this.length>max)str+=' ... '
return'<Buffer '+str+'>'}
Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)){target=Buffer.from(target,target.offset,target.byteLength)}
if(!Buffer.isBuffer(target)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+'Received type '+(typeof target))}
if(start===undefined){start=0}
if(end===undefined){end=target?target.length:0}
if(thisStart===undefined){thisStart=0}
if(thisEnd===undefined){thisEnd=this.length}
if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError('out of range index')}
if(thisStart>=thisEnd&&start>=end){return 0}
if(thisStart>=thisEnd){return-1}
if(start>=end){return 1}
start>>>=0
end>>>=0
thisStart>>>=0
thisEnd>>>=0
if(this===target)return 0
var x=thisEnd-thisStart
var y=end-start
var len=Math.min(x,y)
var thisCopy=this.slice(thisStart,thisEnd)
var targetCopy=target.slice(start,end)
for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i]
y=targetCopy[i]
break}}
if(x<y)return-1
if(y<x)return 1
return 0}
function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1
if(typeof byteOffset==='string'){encoding=byteOffset
byteOffset=0}else if(byteOffset>0x7fffffff){byteOffset=0x7fffffff}else if(byteOffset<-0x80000000){byteOffset=-0x80000000}
byteOffset=+byteOffset
if(numberIsNaN(byteOffset)){byteOffset=dir?0:(buffer.length-1)}
if(byteOffset<0)byteOffset=buffer.length+byteOffset
if(byteOffset>=buffer.length){if(dir)return-1
else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0
else return-1}
if(typeof val==='string'){val=Buffer.from(val,encoding)}
if(Buffer.isBuffer(val)){if(val.length===0){return-1}
return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==='number'){val=val&0xFF
if(typeof Uint8Array.prototype.indexOf==='function'){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}
return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}
throw new TypeError('val must be string, number or Buffer')}
function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1
var arrLength=arr.length
var valLength=val.length
if(encoding!==undefined){encoding=String(encoding).toLowerCase()
if(encoding==='ucs2'||encoding==='ucs-2'||encoding==='utf16le'||encoding==='utf-16le'){if(arr.length<2||val.length<2){return-1}
indexSize=2
arrLength/=2
valLength/=2
byteOffset/=2}}
function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}
var i
if(dir){var foundIndex=-1
for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i
if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex
foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength
for(i=byteOffset;i>=0;i--){var found=!0
for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=!1
break}}
if(found)return i}}
return-1}
Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1}
Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)}
Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)}
function hexWrite(buf,string,offset,length){offset=Number(offset)||0
var remaining=buf.length-offset
if(!length){length=remaining}else{length=Number(length)
if(length>remaining){length=remaining}}
var strLen=string.length
if(length>strLen/2){length=strLen/2}
for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16)
if(numberIsNaN(parsed))return i
buf[offset+i]=parsed}
return i}
function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}
function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}
function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}
function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}
function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}
Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding='utf8'
length=this.length
offset=0}else if(length===undefined&&typeof offset==='string'){encoding=offset
length=this.length
offset=0}else if(isFinite(offset)){offset=offset>>>0
if(isFinite(length)){length=length>>>0
if(encoding===undefined)encoding='utf8'}else{encoding=length
length=undefined}}else{throw new Error('Buffer.write(string, encoding, offset[, length]) is no longer supported')}
var remaining=this.length-offset
if(length===undefined||length>remaining)length=remaining
if((string.length>0&&(length<0||offset<0))||offset>this.length){throw new RangeError('Attempt to write outside buffer bounds')}
if(!encoding)encoding='utf8'
var loweredCase=!1
for(;;){switch(encoding){case 'hex':return hexWrite(this,string,offset,length)
case 'utf8':case 'utf-8':return utf8Write(this,string,offset,length)
case 'ascii':return asciiWrite(this,string,offset,length)
case 'latin1':case 'binary':return latin1Write(this,string,offset,length)
case 'base64':return base64Write(this,string,offset,length)
case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':return ucs2Write(this,string,offset,length)
default:if(loweredCase)throw new TypeError('Unknown encoding: '+encoding)
encoding=(''+encoding).toLowerCase()
loweredCase=!0}}}
Buffer.prototype.toJSON=function toJSON(){return{type:'Buffer',data:Array.prototype.slice.call(this._arr||this,0)}}
function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}
function utf8Slice(buf,start,end){end=Math.min(buf.length,end)
var res=[]
var i=start
while(i<end){var firstByte=buf[i]
var codePoint=null
var bytesPerSequence=(firstByte>0xEF)?4:(firstByte>0xDF)?3:(firstByte>0xBF)?2:1
if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint
switch(bytesPerSequence){case 1:if(firstByte<0x80){codePoint=firstByte}
break
case 2:secondByte=buf[i+1]
if((secondByte&0xC0)===0x80){tempCodePoint=(firstByte&0x1F)<<0x6|(secondByte&0x3F)
if(tempCodePoint>0x7F){codePoint=tempCodePoint}}
break
case 3:secondByte=buf[i+1]
thirdByte=buf[i+2]
if((secondByte&0xC0)===0x80&&(thirdByte&0xC0)===0x80){tempCodePoint=(firstByte&0xF)<<0xC|(secondByte&0x3F)<<0x6|(thirdByte&0x3F)
if(tempCodePoint>0x7FF&&(tempCodePoint<0xD800||tempCodePoint>0xDFFF)){codePoint=tempCodePoint}}
break
case 4:secondByte=buf[i+1]
thirdByte=buf[i+2]
fourthByte=buf[i+3]
if((secondByte&0xC0)===0x80&&(thirdByte&0xC0)===0x80&&(fourthByte&0xC0)===0x80){tempCodePoint=(firstByte&0xF)<<0x12|(secondByte&0x3F)<<0xC|(thirdByte&0x3F)<<0x6|(fourthByte&0x3F)
if(tempCodePoint>0xFFFF&&tempCodePoint<0x110000){codePoint=tempCodePoint}}}}
if(codePoint===null){codePoint=0xFFFD
bytesPerSequence=1}else if(codePoint>0xFFFF){codePoint-=0x10000
res.push(codePoint>>>10&0x3FF|0xD800)
codePoint=0xDC00|codePoint&0x3FF}
res.push(codePoint)
i+=bytesPerSequence}
return decodeCodePointsArray(res)}
var MAX_ARGUMENTS_LENGTH=0x1000
function decodeCodePointsArray(codePoints){var len=codePoints.length
if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}
var res=''
var i=0
while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}
return res}
function asciiSlice(buf,start,end){var ret=''
end=Math.min(buf.length,end)
for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&0x7F)}
return ret}
function latin1Slice(buf,start,end){var ret=''
end=Math.min(buf.length,end)
for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}
return ret}
function hexSlice(buf,start,end){var len=buf.length
if(!start||start<0)start=0
if(!end||end<0||end>len)end=len
var out=''
for(var i=start;i<end;++i){out+=toHex(buf[i])}
return out}
function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end)
var res=''
for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+(bytes[i+1]*256))}
return res}
Buffer.prototype.slice=function slice(start,end){var len=this.length
start=~~start
end=end===undefined?len:~~end
if(start<0){start+=len
if(start<0)start=0}else if(start>len){start=len}
if(end<0){end+=len
if(end<0)end=0}else if(end>len){end=len}
if(end<start)end=start
var newBuf=this.subarray(start,end)
newBuf.__proto__=Buffer.prototype
return newBuf}
function checkOffset(offset,ext,length){if((offset%1)!==0||offset<0)throw new RangeError('offset is not uint')
if(offset+ext>length)throw new RangeError('Trying to access beyond buffer length')}
Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0
byteLength=byteLength>>>0
if(!noAssert)checkOffset(offset,byteLength,this.length)
var val=this[offset]
var mul=1
var i=0
while(++i<byteLength&&(mul*=0x100)){val+=this[offset+i]*mul}
return val}
Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0
byteLength=byteLength>>>0
if(!noAssert){checkOffset(offset,byteLength,this.length)}
var val=this[offset+ --byteLength]
var mul=1
while(byteLength>0&&(mul*=0x100)){val+=this[offset+ --byteLength]*mul}
return val}
Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,1,this.length)
return this[offset]}
Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,2,this.length)
return this[offset]|(this[offset+1]<<8)}
Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,2,this.length)
return(this[offset]<<8)|this[offset+1]}
Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,4,this.length)
return((this[offset])|(this[offset+1]<<8)|(this[offset+2]<<16))+(this[offset+3]*0x1000000)}
Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,4,this.length)
return(this[offset]*0x1000000)+((this[offset+1]<<16)|(this[offset+2]<<8)|this[offset+3])}
Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0
byteLength=byteLength>>>0
if(!noAssert)checkOffset(offset,byteLength,this.length)
var val=this[offset]
var mul=1
var i=0
while(++i<byteLength&&(mul*=0x100)){val+=this[offset+i]*mul}
mul*=0x80
if(val>=mul)val-=Math.pow(2,8*byteLength)
return val}
Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0
byteLength=byteLength>>>0
if(!noAssert)checkOffset(offset,byteLength,this.length)
var i=byteLength
var mul=1
var val=this[offset+ --i]
while(i>0&&(mul*=0x100)){val+=this[offset+ --i]*mul}
mul*=0x80
if(val>=mul)val-=Math.pow(2,8*byteLength)
return val}
Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,1,this.length)
if(!(this[offset]&0x80))return(this[offset])
return((0xff-this[offset]+1)*-1)}
Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,2,this.length)
var val=this[offset]|(this[offset+1]<<8)
return(val&0x8000)?val|0xFFFF0000:val}
Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,2,this.length)
var val=this[offset+1]|(this[offset]<<8)
return(val&0x8000)?val|0xFFFF0000:val}
Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,4,this.length)
return(this[offset])|(this[offset+1]<<8)|(this[offset+2]<<16)|(this[offset+3]<<24)}
Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,4,this.length)
return(this[offset]<<24)|(this[offset+1]<<16)|(this[offset+2]<<8)|(this[offset+3])}
Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,4,this.length)
return ieee754.read(this,offset,!0,23,4)}
Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,4,this.length)
return ieee754.read(this,offset,!1,23,4)}
Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,8,this.length)
return ieee754.read(this,offset,!0,52,8)}
Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0
if(!noAssert)checkOffset(offset,8,this.length)
return ieee754.read(this,offset,!1,52,8)}
function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance')
if(value>max||value<min)throw new RangeError('"value" argument is out of bounds')
if(offset+ext>buf.length)throw new RangeError('Index out of range')}
Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value
offset=offset>>>0
byteLength=byteLength>>>0
if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1
checkInt(this,value,offset,byteLength,maxBytes,0)}
var mul=1
var i=0
this[offset]=value&0xFF
while(++i<byteLength&&(mul*=0x100)){this[offset+i]=(value/mul)&0xFF}
return offset+byteLength}
Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value
offset=offset>>>0
byteLength=byteLength>>>0
if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1
checkInt(this,value,offset,byteLength,maxBytes,0)}
var i=byteLength-1
var mul=1
this[offset+i]=value&0xFF
while(--i>=0&&(mul*=0x100)){this[offset+i]=(value/mul)&0xFF}
return offset+byteLength}
Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,1,0xff,0)
this[offset]=(value&0xff)
return offset+1}
Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,2,0xffff,0)
this[offset]=(value&0xff)
this[offset+1]=(value>>>8)
return offset+2}
Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,2,0xffff,0)
this[offset]=(value>>>8)
this[offset+1]=(value&0xff)
return offset+2}
Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,4,0xffffffff,0)
this[offset+3]=(value>>>24)
this[offset+2]=(value>>>16)
this[offset+1]=(value>>>8)
this[offset]=(value&0xff)
return offset+4}
Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,4,0xffffffff,0)
this[offset]=(value>>>24)
this[offset+1]=(value>>>16)
this[offset+2]=(value>>>8)
this[offset+3]=(value&0xff)
return offset+4}
Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value
offset=offset>>>0
if(!noAssert){var limit=Math.pow(2,(8*byteLength)-1)
checkInt(this,value,offset,byteLength,limit-1,-limit)}
var i=0
var mul=1
var sub=0
this[offset]=value&0xFF
while(++i<byteLength&&(mul*=0x100)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}
this[offset+i]=((value/mul)>>0)-sub&0xFF}
return offset+byteLength}
Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value
offset=offset>>>0
if(!noAssert){var limit=Math.pow(2,(8*byteLength)-1)
checkInt(this,value,offset,byteLength,limit-1,-limit)}
var i=byteLength-1
var mul=1
var sub=0
this[offset+i]=value&0xFF
while(--i>=0&&(mul*=0x100)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}
this[offset+i]=((value/mul)>>0)-sub&0xFF}
return offset+byteLength}
Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,1,0x7f,-0x80)
if(value<0)value=0xff+value+1
this[offset]=(value&0xff)
return offset+1}
Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,2,0x7fff,-0x8000)
this[offset]=(value&0xff)
this[offset+1]=(value>>>8)
return offset+2}
Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,2,0x7fff,-0x8000)
this[offset]=(value>>>8)
this[offset+1]=(value&0xff)
return offset+2}
Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,4,0x7fffffff,-0x80000000)
this[offset]=(value&0xff)
this[offset+1]=(value>>>8)
this[offset+2]=(value>>>16)
this[offset+3]=(value>>>24)
return offset+4}
Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value
offset=offset>>>0
if(!noAssert)checkInt(this,value,offset,4,0x7fffffff,-0x80000000)
if(value<0)value=0xffffffff+value+1
this[offset]=(value>>>24)
this[offset+1]=(value>>>16)
this[offset+2]=(value>>>8)
this[offset+3]=(value&0xff)
return offset+4}
function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError('Index out of range')
if(offset<0)throw new RangeError('Index out of range')}
function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value
offset=offset>>>0
if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e+38,-3.4028234663852886e+38)}
ieee754.write(buf,value,offset,littleEndian,23,4)
return offset+4}
Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)}
Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)}
function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value
offset=offset>>>0
if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157E+308,-1.7976931348623157E+308)}
ieee754.write(buf,value,offset,littleEndian,52,8)
return offset+8}
Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)}
Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)}
Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError('argument should be a Buffer')
if(!start)start=0
if(!end&&end!==0)end=this.length
if(targetStart>=target.length)targetStart=target.length
if(!targetStart)targetStart=0
if(end>0&&end<start)end=start
if(end===start)return 0
if(target.length===0||this.length===0)return 0
if(targetStart<0){throw new RangeError('targetStart out of bounds')}
if(start<0||start>=this.length)throw new RangeError('Index out of range')
if(end<0)throw new RangeError('sourceEnd out of bounds')
if(end>this.length)end=this.length
if(target.length-targetStart<end-start){end=target.length-targetStart+start}
var len=end-start
if(this===target&&typeof Uint8Array.prototype.copyWithin==='function'){this.copyWithin(targetStart,start,end)}else if(this===target&&start<targetStart&&targetStart<end){for(var i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart)}
return len}
Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==='string'){if(typeof start==='string'){encoding=start
start=0
end=this.length}else if(typeof end==='string'){encoding=end
end=this.length}
if(encoding!==undefined&&typeof encoding!=='string'){throw new TypeError('encoding must be a string')}
if(typeof encoding==='string'&&!Buffer.isEncoding(encoding)){throw new TypeError('Unknown encoding: '+encoding)}
if(val.length===1){var code=val.charCodeAt(0)
if((encoding==='utf8'&&code<128)||encoding==='latin1'){val=code}}}else if(typeof val==='number'){val=val&255}
if(start<0||this.length<start||this.length<end){throw new RangeError('Out of range index')}
if(end<=start){return this}
start=start>>>0
end=end===undefined?this.length:end>>>0
if(!val)val=0
var i
if(typeof val==='number'){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding)
var len=bytes.length
if(len===0){throw new TypeError('The value "'+val+'" is invalid for argument "value"')}
for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}
return this}
var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g
function base64clean(str){str=str.split('=')[0]
str=str.trim().replace(INVALID_BASE64_RE,'')
if(str.length<2)return''
while(str.length%4!==0){str=str+'='}
return str}
function toHex(n){if(n<16)return'0'+n.toString(16)
return n.toString(16)}
function utf8ToBytes(string,units){units=units||Infinity
var codePoint
var length=string.length
var leadSurrogate=null
var bytes=[]
for(var i=0;i<length;++i){codePoint=string.charCodeAt(i)
if(codePoint>0xD7FF&&codePoint<0xE000){if(!leadSurrogate){if(codePoint>0xDBFF){if((units-=3)>-1)bytes.push(0xEF,0xBF,0xBD)
continue}else if(i+1===length){if((units-=3)>-1)bytes.push(0xEF,0xBF,0xBD)
continue}
leadSurrogate=codePoint
continue}
if(codePoint<0xDC00){if((units-=3)>-1)bytes.push(0xEF,0xBF,0xBD)
leadSurrogate=codePoint
continue}
codePoint=(leadSurrogate-0xD800<<10|codePoint-0xDC00)+0x10000}else if(leadSurrogate){if((units-=3)>-1)bytes.push(0xEF,0xBF,0xBD)}
leadSurrogate=null
if(codePoint<0x80){if((units-=1)<0)break
bytes.push(codePoint)}else if(codePoint<0x800){if((units-=2)<0)break
bytes.push(codePoint>>0x6|0xC0,codePoint&0x3F|0x80)}else if(codePoint<0x10000){if((units-=3)<0)break
bytes.push(codePoint>>0xC|0xE0,codePoint>>0x6&0x3F|0x80,codePoint&0x3F|0x80)}else if(codePoint<0x110000){if((units-=4)<0)break
bytes.push(codePoint>>0x12|0xF0,codePoint>>0xC&0x3F|0x80,codePoint>>0x6&0x3F|0x80,codePoint&0x3F|0x80)}else{throw new Error('Invalid code point')}}
return bytes}
function asciiToBytes(str){var byteArray=[]
for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&0xFF)}
return byteArray}
function utf16leToBytes(str,units){var c,hi,lo
var byteArray=[]
for(var i=0;i<str.length;++i){if((units-=2)<0)break
c=str.charCodeAt(i)
hi=c>>8
lo=c%256
byteArray.push(lo)
byteArray.push(hi)}
return byteArray}
function base64ToBytes(str){return base64.toByteArray(base64clean(str))}
function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if((i+offset>=dst.length)||(i>=src.length))break
dst[i+offset]=src[i]}
return i}
function isInstance(obj,type){return obj instanceof type||(obj!=null&&obj.constructor!=null&&obj.constructor.name!=null&&obj.constructor.name===type.name)}
function numberIsNaN(obj){return obj!==obj}}).call(this,require("buffer").Buffer)},{"base64-js":20,"buffer":54,"ieee754":107}],55:[function(require,module,exports){module.exports={"100":"Continue","101":"Switching Protocols","102":"Processing","200":"OK","201":"Created","202":"Accepted","203":"Non-Authoritative Information","204":"No Content","205":"Reset Content","206":"Partial Content","207":"Multi-Status","208":"Already Reported","226":"IM Used","300":"Multiple Choices","301":"Moved Permanently","302":"Found","303":"See Other","304":"Not Modified","305":"Use Proxy","307":"Temporary Redirect","308":"Permanent Redirect","400":"Bad Request","401":"Unauthorized","402":"Payment Required","403":"Forbidden","404":"Not Found","405":"Method Not Allowed","406":"Not Acceptable","407":"Proxy Authentication Required","408":"Request Timeout","409":"Conflict","410":"Gone","411":"Length Required","412":"Precondition Failed","413":"Payload Too Large","414":"URI Too Long","415":"Unsupported Media Type","416":"Range Not Satisfiable","417":"Expectation Failed","418":"I'm a teapot","421":"Misdirected Request","422":"Unprocessable Entity","423":"Locked","424":"Failed Dependency","425":"Unordered Collection","426":"Upgrade Required","428":"Precondition Required","429":"Too Many Requests","431":"Request Header Fields Too Large","451":"Unavailable For Legal Reasons","500":"Internal Server Error","501":"Not Implemented","502":"Bad Gateway","503":"Service Unavailable","504":"Gateway Timeout","505":"HTTP Version Not Supported","506":"Variant Also Negotiates","507":"Insufficient Storage","508":"Loop Detected","509":"Bandwidth Limit Exceeded","510":"Not Extended","511":"Network Authentication Required"}},{}],56:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
var Transform=require('stream').Transform
var StringDecoder=require('string_decoder').StringDecoder
var inherits=require('inherits')
function CipherBase(hashMode){Transform.call(this)
this.hashMode=typeof hashMode==='string'
if(this.hashMode){this[hashMode]=this._finalOrDigest}else{this.final=this._finalOrDigest}
if(this._final){this.__final=this._final
this._final=null}
this._decoder=null
this._encoding=null}
inherits(CipherBase,Transform)
CipherBase.prototype.update=function(data,inputEnc,outputEnc){if(typeof data==='string'){data=Buffer.from(data,inputEnc)}
var outData=this._update(data)
if(this.hashMode)return this
if(outputEnc){outData=this._toString(outData,outputEnc)}
return outData}
CipherBase.prototype.setAutoPadding=function(){}
CipherBase.prototype.getAuthTag=function(){throw new Error('trying to get auth tag in unsupported state')}
CipherBase.prototype.setAuthTag=function(){throw new Error('trying to set auth tag in unsupported state')}
CipherBase.prototype.setAAD=function(){throw new Error('trying to set aad in unsupported state')}
CipherBase.prototype._transform=function(data,_,next){var err
try{if(this.hashMode){this._update(data)}else{this.push(this._update(data))}}catch(e){err=e}finally{next(err)}}
CipherBase.prototype._flush=function(done){var err
try{this.push(this.__final())}catch(e){err=e}
done(err)}
CipherBase.prototype._finalOrDigest=function(outputEnc){var outData=this.__final()||Buffer.alloc(0)
if(outputEnc){outData=this._toString(outData,outputEnc,!0)}
return outData}
CipherBase.prototype._toString=function(value,enc,fin){if(!this._decoder){this._decoder=new StringDecoder(enc)
this._encoding=enc}
if(this._encoding!==enc)throw new Error('can\'t switch encodings')
var out=this._decoder.write(value)
if(fin){out+=this._decoder.end()}
return out}
module.exports=CipherBase},{"inherits":108,"safe-buffer":167,"stream":176,"string_decoder":181}],57:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}
return objectToString(arg)==='[object Array]'}
exports.isArray=isArray;function isBoolean(arg){return typeof arg==='boolean'}
exports.isBoolean=isBoolean;function isNull(arg){return arg===null}
exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}
exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==='number'}
exports.isNumber=isNumber;function isString(arg){return typeof arg==='string'}
exports.isString=isString;function isSymbol(arg){return typeof arg==='symbol'}
exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}
exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==='[object RegExp]'}
exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==='object'&&arg!==null}
exports.isObject=isObject;function isDate(d){return objectToString(d)==='[object Date]'}
exports.isDate=isDate;function isError(e){return(objectToString(e)==='[object Error]'||e instanceof Error)}
exports.isError=isError;function isFunction(arg){return typeof arg==='function'}
exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==='boolean'||typeof arg==='number'||typeof arg==='string'||typeof arg==='symbol'||typeof arg==='undefined'}
exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{"isBuffer":require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":109}],58:[function(require,module,exports){(function(Buffer){var elliptic=require('elliptic')
var BN=require('bn.js')
module.exports=function createECDH(curve){return new ECDH(curve)}
var aliases={secp256k1:{name:'secp256k1',byteLength:32},secp224r1:{name:'p224',byteLength:28},prime256v1:{name:'p256',byteLength:32},prime192v1:{name:'p192',byteLength:24},ed25519:{name:'ed25519',byteLength:32},secp384r1:{name:'p384',byteLength:48},secp521r1:{name:'p521',byteLength:66}}
aliases.p224=aliases.secp224r1
aliases.p256=aliases.secp256r1=aliases.prime256v1
aliases.p192=aliases.secp192r1=aliases.prime192v1
aliases.p384=aliases.secp384r1
aliases.p521=aliases.secp521r1
function ECDH(curve){this.curveType=aliases[curve]
if(!this.curveType){this.curveType={name:curve}}
this.curve=new elliptic.ec(this.curveType.name)
this.keys=void 0}
ECDH.prototype.generateKeys=function(enc,format){this.keys=this.curve.genKeyPair()
return this.getPublicKey(enc,format)}
ECDH.prototype.computeSecret=function(other,inenc,enc){inenc=inenc||'utf8'
if(!Buffer.isBuffer(other)){other=new Buffer(other,inenc)}
var otherPub=this.curve.keyFromPublic(other).getPublic()
var out=otherPub.mul(this.keys.getPrivate()).getX()
return formatReturnValue(out,enc,this.curveType.byteLength)}
ECDH.prototype.getPublicKey=function(enc,format){var key=this.keys.getPublic(format==='compressed',!0)
if(format==='hybrid'){if(key[key.length-1]%2){key[0]=7}else{key[0]=6}}
return formatReturnValue(key,enc)}
ECDH.prototype.getPrivateKey=function(enc){return formatReturnValue(this.keys.getPrivate(),enc)}
ECDH.prototype.setPublicKey=function(pub,enc){enc=enc||'utf8'
if(!Buffer.isBuffer(pub)){pub=new Buffer(pub,enc)}
this.keys._importPublic(pub)
return this}
ECDH.prototype.setPrivateKey=function(priv,enc){enc=enc||'utf8'
if(!Buffer.isBuffer(priv)){priv=new Buffer(priv,enc)}
var _priv=new BN(priv)
_priv=_priv.toString(16)
this.keys=this.curve.genKeyPair()
this.keys._importPrivate(_priv)
return this}
function formatReturnValue(bn,enc,len){if(!Array.isArray(bn)){bn=bn.toArray()}
var buf=new Buffer(bn)
if(len&&buf.length<len){var zeros=new Buffer(len-buf.length)
zeros.fill(0)
buf=Buffer.concat([zeros,buf])}
if(!enc){return buf}else{return buf.toString(enc)}}}).call(this,require("buffer").Buffer)},{"bn.js":21,"buffer":54,"elliptic":74}],59:[function(require,module,exports){'use strict'
var inherits=require('inherits')
var MD5=require('md5.js')
var RIPEMD160=require('ripemd160')
var sha=require('sha.js')
var Base=require('cipher-base')
function Hash(hash){Base.call(this,'digest')
this._hash=hash}
inherits(Hash,Base)
Hash.prototype._update=function(data){this._hash.update(data)}
Hash.prototype._final=function(){return this._hash.digest()}
module.exports=function createHash(alg){alg=alg.toLowerCase()
if(alg==='md5')return new MD5()
if(alg==='rmd160'||alg==='ripemd160')return new RIPEMD160()
return new Hash(sha(alg))}},{"cipher-base":56,"inherits":108,"md5.js":111,"ripemd160":166,"sha.js":169}],60:[function(require,module,exports){var MD5=require('md5.js')
module.exports=function(buffer){return new MD5().update(buffer).digest()}},{"md5.js":111}],61:[function(require,module,exports){'use strict'
var inherits=require('inherits')
var Legacy=require('./legacy')
var Base=require('cipher-base')
var Buffer=require('safe-buffer').Buffer
var md5=require('create-hash/md5')
var RIPEMD160=require('ripemd160')
var sha=require('sha.js')
var ZEROS=Buffer.alloc(128)
function Hmac(alg,key){Base.call(this,'digest')
if(typeof key==='string'){key=Buffer.from(key)}
var blocksize=(alg==='sha512'||alg==='sha384')?128:64
this._alg=alg
this._key=key
if(key.length>blocksize){var hash=alg==='rmd160'?new RIPEMD160():sha(alg)
key=hash.update(key).digest()}else if(key.length<blocksize){key=Buffer.concat([key,ZEROS],blocksize)}
var ipad=this._ipad=Buffer.allocUnsafe(blocksize)
var opad=this._opad=Buffer.allocUnsafe(blocksize)
for(var i=0;i<blocksize;i++){ipad[i]=key[i]^0x36
opad[i]=key[i]^0x5C}
this._hash=alg==='rmd160'?new RIPEMD160():sha(alg)
this._hash.update(ipad)}
inherits(Hmac,Base)
Hmac.prototype._update=function(data){this._hash.update(data)}
Hmac.prototype._final=function(){var h=this._hash.digest()
var hash=this._alg==='rmd160'?new RIPEMD160():sha(this._alg)
return hash.update(this._opad).update(h).digest()}
module.exports=function createHmac(alg,key){alg=alg.toLowerCase()
if(alg==='rmd160'||alg==='ripemd160'){return new Hmac('rmd160',key)}
if(alg==='md5'){return new Legacy(md5,key)}
return new Hmac(alg,key)}},{"./legacy":62,"cipher-base":56,"create-hash/md5":60,"inherits":108,"ripemd160":166,"safe-buffer":167,"sha.js":169}],62:[function(require,module,exports){'use strict'
var inherits=require('inherits')
var Buffer=require('safe-buffer').Buffer
var Base=require('cipher-base')
var ZEROS=Buffer.alloc(128)
var blocksize=64
function Hmac(alg,key){Base.call(this,'digest')
if(typeof key==='string'){key=Buffer.from(key)}
this._alg=alg
this._key=key
if(key.length>blocksize){key=alg(key)}else if(key.length<blocksize){key=Buffer.concat([key,ZEROS],blocksize)}
var ipad=this._ipad=Buffer.allocUnsafe(blocksize)
var opad=this._opad=Buffer.allocUnsafe(blocksize)
for(var i=0;i<blocksize;i++){ipad[i]=key[i]^0x36
opad[i]=key[i]^0x5C}
this._hash=[ipad]}
inherits(Hmac,Base)
Hmac.prototype._update=function(data){this._hash.push(data)}
Hmac.prototype._final=function(){var h=this._alg(Buffer.concat(this._hash))
return this._alg(Buffer.concat([this._opad,h]))}
module.exports=Hmac},{"cipher-base":56,"inherits":108,"safe-buffer":167}],63:[function(require,module,exports){'use strict'
exports.randomBytes=exports.rng=exports.pseudoRandomBytes=exports.prng=require('randombytes')
exports.createHash=exports.Hash=require('create-hash')
exports.createHmac=exports.Hmac=require('create-hmac')
var algos=require('browserify-sign/algos')
var algoKeys=Object.keys(algos)
var hashes=['sha1','sha224','sha256','sha384','sha512','md5','rmd160'].concat(algoKeys)
exports.getHashes=function(){return hashes}
var p=require('pbkdf2')
exports.pbkdf2=p.pbkdf2
exports.pbkdf2Sync=p.pbkdf2Sync
var aes=require('browserify-cipher')
exports.Cipher=aes.Cipher
exports.createCipher=aes.createCipher
exports.Cipheriv=aes.Cipheriv
exports.createCipheriv=aes.createCipheriv
exports.Decipher=aes.Decipher
exports.createDecipher=aes.createDecipher
exports.Decipheriv=aes.Decipheriv
exports.createDecipheriv=aes.createDecipheriv
exports.getCiphers=aes.getCiphers
exports.listCiphers=aes.listCiphers
var dh=require('diffie-hellman')
exports.DiffieHellmanGroup=dh.DiffieHellmanGroup
exports.createDiffieHellmanGroup=dh.createDiffieHellmanGroup
exports.getDiffieHellman=dh.getDiffieHellman
exports.createDiffieHellman=dh.createDiffieHellman
exports.DiffieHellman=dh.DiffieHellman
var sign=require('browserify-sign')
exports.createSign=sign.createSign
exports.Sign=sign.Sign
exports.createVerify=sign.createVerify
exports.Verify=sign.Verify
exports.createECDH=require('create-ecdh')
var publicEncrypt=require('public-encrypt')
exports.publicEncrypt=publicEncrypt.publicEncrypt
exports.privateEncrypt=publicEncrypt.privateEncrypt
exports.publicDecrypt=publicEncrypt.publicDecrypt
exports.privateDecrypt=publicEncrypt.privateDecrypt
var rf=require('randomfill')
exports.randomFill=rf.randomFill
exports.randomFillSync=rf.randomFillSync
exports.createCredentials=function(){throw new Error(['sorry, createCredentials is not implemented yet','we accept pull requests','https://github.com/crypto-browserify/crypto-browserify'].join('\n'))}
exports.constants={'DH_CHECK_P_NOT_SAFE_PRIME':2,'DH_CHECK_P_NOT_PRIME':1,'DH_UNABLE_TO_CHECK_GENERATOR':4,'DH_NOT_SUITABLE_GENERATOR':8,'NPN_ENABLED':1,'ALPN_ENABLED':1,'RSA_PKCS1_PADDING':1,'RSA_SSLV23_PADDING':2,'RSA_NO_PADDING':3,'RSA_PKCS1_OAEP_PADDING':4,'RSA_X931_PADDING':5,'RSA_PKCS1_PSS_PADDING':6,'POINT_CONVERSION_COMPRESSED':2,'POINT_CONVERSION_UNCOMPRESSED':4,'POINT_CONVERSION_HYBRID':6}},{"browserify-cipher":41,"browserify-sign":48,"browserify-sign/algos":45,"create-ecdh":58,"create-hash":59,"create-hmac":61,"diffie-hellman":70,"pbkdf2":133,"public-encrypt":140,"randombytes":150,"randomfill":151}],64:[function(require,module,exports){'use strict';exports.utils=require('./des/utils');exports.Cipher=require('./des/cipher');exports.DES=require('./des/des');exports.CBC=require('./des/cbc');exports.EDE=require('./des/ede')},{"./des/cbc":65,"./des/cipher":66,"./des/des":67,"./des/ede":68,"./des/utils":69}],65:[function(require,module,exports){'use strict';var assert=require('minimalistic-assert');var inherits=require('inherits');var proto={};function CBCState(iv){assert.equal(iv.length,8,'Invalid IV length');this.iv=new Array(8);for(var i=0;i<this.iv.length;i++)
this.iv[i]=iv[i]}
function instantiate(Base){function CBC(options){Base.call(this,options);this._cbcInit()}
inherits(CBC,Base);var keys=Object.keys(proto);for(var i=0;i<keys.length;i++){var key=keys[i];CBC.prototype[key]=proto[key]}
CBC.create=function create(options){return new CBC(options)};return CBC}
exports.instantiate=instantiate;proto._cbcInit=function _cbcInit(){var state=new CBCState(this.options.iv);this._cbcState=state};proto._update=function _update(inp,inOff,out,outOff){var state=this._cbcState;var superProto=this.constructor.super_.prototype;var iv=state.iv;if(this.type==='encrypt'){for(var i=0;i<this.blockSize;i++)
iv[i]^=inp[inOff+i];superProto._update.call(this,iv,0,out,outOff);for(var i=0;i<this.blockSize;i++)
iv[i]=out[outOff+i]}else{superProto._update.call(this,inp,inOff,out,outOff);for(var i=0;i<this.blockSize;i++)
out[outOff+i]^=iv[i];for(var i=0;i<this.blockSize;i++)
iv[i]=inp[inOff+i]}}},{"inherits":108,"minimalistic-assert":113}],66:[function(require,module,exports){'use strict';var assert=require('minimalistic-assert');function Cipher(options){this.options=options;this.type=this.options.type;this.blockSize=8;this._init();this.buffer=new Array(this.blockSize);this.bufferOff=0}
module.exports=Cipher;Cipher.prototype._init=function _init(){};Cipher.prototype.update=function update(data){if(data.length===0)
return[];if(this.type==='decrypt')
return this._updateDecrypt(data);else return this._updateEncrypt(data)};Cipher.prototype._buffer=function _buffer(data,off){var min=Math.min(this.buffer.length-this.bufferOff,data.length-off);for(var i=0;i<min;i++)
this.buffer[this.bufferOff+i]=data[off+i];this.bufferOff+=min;return min};Cipher.prototype._flushBuffer=function _flushBuffer(out,off){this._update(this.buffer,0,out,off);this.bufferOff=0;return this.blockSize};Cipher.prototype._updateEncrypt=function _updateEncrypt(data){var inputOff=0;var outputOff=0;var count=((this.bufferOff+data.length)/this.blockSize)|0;var out=new Array(count*this.blockSize);if(this.bufferOff!==0){inputOff+=this._buffer(data,inputOff);if(this.bufferOff===this.buffer.length)
outputOff+=this._flushBuffer(out,outputOff)}
var max=data.length-((data.length-inputOff)%this.blockSize);for(;inputOff<max;inputOff+=this.blockSize){this._update(data,inputOff,out,outputOff);outputOff+=this.blockSize}
for(;inputOff<data.length;inputOff++,this.bufferOff++)
this.buffer[this.bufferOff]=data[inputOff];return out};Cipher.prototype._updateDecrypt=function _updateDecrypt(data){var inputOff=0;var outputOff=0;var count=Math.ceil((this.bufferOff+data.length)/this.blockSize)-1;var out=new Array(count*this.blockSize);for(;count>0;count--){inputOff+=this._buffer(data,inputOff);outputOff+=this._flushBuffer(out,outputOff)}
inputOff+=this._buffer(data,inputOff);return out};Cipher.prototype.final=function final(buffer){var first;if(buffer)
first=this.update(buffer);var last;if(this.type==='encrypt')
last=this._finalEncrypt();else last=this._finalDecrypt();if(first)
return first.concat(last);else return last};Cipher.prototype._pad=function _pad(buffer,off){if(off===0)
return!1;while(off<buffer.length)
buffer[off++]=0;return!0};Cipher.prototype._finalEncrypt=function _finalEncrypt(){if(!this._pad(this.buffer,this.bufferOff))
return[];var out=new Array(this.blockSize);this._update(this.buffer,0,out,0);return out};Cipher.prototype._unpad=function _unpad(buffer){return buffer};Cipher.prototype._finalDecrypt=function _finalDecrypt(){assert.equal(this.bufferOff,this.blockSize,'Not enough data to decrypt');var out=new Array(this.blockSize);this._flushBuffer(out,0);return this._unpad(out)}},{"minimalistic-assert":113}],67:[function(require,module,exports){'use strict';var assert=require('minimalistic-assert');var inherits=require('inherits');var des=require('../des');var utils=des.utils;var Cipher=des.Cipher;function DESState(){this.tmp=new Array(2);this.keys=null}
function DES(options){Cipher.call(this,options);var state=new DESState();this._desState=state;this.deriveKeys(state,options.key)}
inherits(DES,Cipher);module.exports=DES;DES.create=function create(options){return new DES(options)};var shiftTable=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];DES.prototype.deriveKeys=function deriveKeys(state,key){state.keys=new Array(16*2);assert.equal(key.length,this.blockSize,'Invalid key length');var kL=utils.readUInt32BE(key,0);var kR=utils.readUInt32BE(key,4);utils.pc1(kL,kR,state.tmp,0);kL=state.tmp[0];kR=state.tmp[1];for(var i=0;i<state.keys.length;i+=2){var shift=shiftTable[i>>>1];kL=utils.r28shl(kL,shift);kR=utils.r28shl(kR,shift);utils.pc2(kL,kR,state.keys,i)}};DES.prototype._update=function _update(inp,inOff,out,outOff){var state=this._desState;var l=utils.readUInt32BE(inp,inOff);var r=utils.readUInt32BE(inp,inOff+4);utils.ip(l,r,state.tmp,0);l=state.tmp[0];r=state.tmp[1];if(this.type==='encrypt')
this._encrypt(state,l,r,state.tmp,0);else this._decrypt(state,l,r,state.tmp,0);l=state.tmp[0];r=state.tmp[1];utils.writeUInt32BE(out,l,outOff);utils.writeUInt32BE(out,r,outOff+4)};DES.prototype._pad=function _pad(buffer,off){var value=buffer.length-off;for(var i=off;i<buffer.length;i++)
buffer[i]=value;return!0};DES.prototype._unpad=function _unpad(buffer){var pad=buffer[buffer.length-1];for(var i=buffer.length-pad;i<buffer.length;i++)
assert.equal(buffer[i],pad);return buffer.slice(0,buffer.length-pad)};DES.prototype._encrypt=function _encrypt(state,lStart,rStart,out,off){var l=lStart;var r=rStart;for(var i=0;i<state.keys.length;i+=2){var keyL=state.keys[i];var keyR=state.keys[i+1];utils.expand(r,state.tmp,0);keyL^=state.tmp[0];keyR^=state.tmp[1];var s=utils.substitute(keyL,keyR);var f=utils.permute(s);var t=r;r=(l^f)>>>0;l=t}
utils.rip(r,l,out,off)};DES.prototype._decrypt=function _decrypt(state,lStart,rStart,out,off){var l=rStart;var r=lStart;for(var i=state.keys.length-2;i>=0;i-=2){var keyL=state.keys[i];var keyR=state.keys[i+1];utils.expand(l,state.tmp,0);keyL^=state.tmp[0];keyR^=state.tmp[1];var s=utils.substitute(keyL,keyR);var f=utils.permute(s);var t=l;l=(r^f)>>>0;r=t}
utils.rip(l,r,out,off)}},{"../des":64,"inherits":108,"minimalistic-assert":113}],68:[function(require,module,exports){'use strict';var assert=require('minimalistic-assert');var inherits=require('inherits');var des=require('../des');var Cipher=des.Cipher;var DES=des.DES;function EDEState(type,key){assert.equal(key.length,24,'Invalid key length');var k1=key.slice(0,8);var k2=key.slice(8,16);var k3=key.slice(16,24);if(type==='encrypt'){this.ciphers=[DES.create({type:'encrypt',key:k1}),DES.create({type:'decrypt',key:k2}),DES.create({type:'encrypt',key:k3})]}else{this.ciphers=[DES.create({type:'decrypt',key:k3}),DES.create({type:'encrypt',key:k2}),DES.create({type:'decrypt',key:k1})]}}
function EDE(options){Cipher.call(this,options);var state=new EDEState(this.type,this.options.key);this._edeState=state}
inherits(EDE,Cipher);module.exports=EDE;EDE.create=function create(options){return new EDE(options)};EDE.prototype._update=function _update(inp,inOff,out,outOff){var state=this._edeState;state.ciphers[0]._update(inp,inOff,out,outOff);state.ciphers[1]._update(out,outOff,out,outOff);state.ciphers[2]._update(out,outOff,out,outOff)};EDE.prototype._pad=DES.prototype._pad;EDE.prototype._unpad=DES.prototype._unpad},{"../des":64,"inherits":108,"minimalistic-assert":113}],69:[function(require,module,exports){'use strict';exports.readUInt32BE=function readUInt32BE(bytes,off){var res=(bytes[0+off]<<24)|(bytes[1+off]<<16)|(bytes[2+off]<<8)|bytes[3+off];return res>>>0};exports.writeUInt32BE=function writeUInt32BE(bytes,value,off){bytes[0+off]=value>>>24;bytes[1+off]=(value>>>16)&0xff;bytes[2+off]=(value>>>8)&0xff;bytes[3+off]=value&0xff};exports.ip=function ip(inL,inR,out,off){var outL=0;var outR=0;for(var i=6;i>=0;i-=2){for(var j=0;j<=24;j+=8){outL<<=1;outL|=(inR>>>(j+i))&1}
for(var j=0;j<=24;j+=8){outL<<=1;outL|=(inL>>>(j+i))&1}}
for(var i=6;i>=0;i-=2){for(var j=1;j<=25;j+=8){outR<<=1;outR|=(inR>>>(j+i))&1}
for(var j=1;j<=25;j+=8){outR<<=1;outR|=(inL>>>(j+i))&1}}
out[off+0]=outL>>>0;out[off+1]=outR>>>0};exports.rip=function rip(inL,inR,out,off){var outL=0;var outR=0;for(var i=0;i<4;i++){for(var j=24;j>=0;j-=8){outL<<=1;outL|=(inR>>>(j+i))&1;outL<<=1;outL|=(inL>>>(j+i))&1}}
for(var i=4;i<8;i++){for(var j=24;j>=0;j-=8){outR<<=1;outR|=(inR>>>(j+i))&1;outR<<=1;outR|=(inL>>>(j+i))&1}}
out[off+0]=outL>>>0;out[off+1]=outR>>>0};exports.pc1=function pc1(inL,inR,out,off){var outL=0;var outR=0;for(var i=7;i>=5;i--){for(var j=0;j<=24;j+=8){outL<<=1;outL|=(inR>>(j+i))&1}
for(var j=0;j<=24;j+=8){outL<<=1;outL|=(inL>>(j+i))&1}}
for(var j=0;j<=24;j+=8){outL<<=1;outL|=(inR>>(j+i))&1}
for(var i=1;i<=3;i++){for(var j=0;j<=24;j+=8){outR<<=1;outR|=(inR>>(j+i))&1}
for(var j=0;j<=24;j+=8){outR<<=1;outR|=(inL>>(j+i))&1}}
for(var j=0;j<=24;j+=8){outR<<=1;outR|=(inL>>(j+i))&1}
out[off+0]=outL>>>0;out[off+1]=outR>>>0};exports.r28shl=function r28shl(num,shift){return((num<<shift)&0xfffffff)|(num>>>(28-shift))};var pc2table=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];exports.pc2=function pc2(inL,inR,out,off){var outL=0;var outR=0;var len=pc2table.length>>>1;for(var i=0;i<len;i++){outL<<=1;outL|=(inL>>>pc2table[i])&0x1}
for(var i=len;i<pc2table.length;i++){outR<<=1;outR|=(inR>>>pc2table[i])&0x1}
out[off+0]=outL>>>0;out[off+1]=outR>>>0};exports.expand=function expand(r,out,off){var outL=0;var outR=0;outL=((r&1)<<5)|(r>>>27);for(var i=23;i>=15;i-=4){outL<<=6;outL|=(r>>>i)&0x3f}
for(var i=11;i>=3;i-=4){outR|=(r>>>i)&0x3f;outR<<=6}
outR|=((r&0x1f)<<1)|(r>>>31);out[off+0]=outL>>>0;out[off+1]=outR>>>0};var sTable=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];exports.substitute=function substitute(inL,inR){var out=0;for(var i=0;i<4;i++){var b=(inL>>>(18-i*6))&0x3f;var sb=sTable[i*0x40+b];out<<=4;out|=sb}
for(var i=0;i<4;i++){var b=(inR>>>(18-i*6))&0x3f;var sb=sTable[4*0x40+i*0x40+b];out<<=4;out|=sb}
return out>>>0};var permuteTable=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];exports.permute=function permute(num){var out=0;for(var i=0;i<permuteTable.length;i++){out<<=1;out|=(num>>>permuteTable[i])&0x1}
return out>>>0};exports.padSplit=function padSplit(num,size,group){var str=num.toString(2);while(str.length<size)
str='0'+str;var out=[];for(var i=0;i<size;i+=group)
out.push(str.slice(i,i+group));return out.join(' ')}},{}],70:[function(require,module,exports){(function(Buffer){var generatePrime=require('./lib/generatePrime')
var primes=require('./lib/primes.json')
var DH=require('./lib/dh')
function getDiffieHellman(mod){var prime=new Buffer(primes[mod].prime,'hex')
var gen=new Buffer(primes[mod].gen,'hex')
return new DH(prime,gen)}
var ENCODINGS={'binary':!0,'hex':!0,'base64':!0}
function createDiffieHellman(prime,enc,generator,genc){if(Buffer.isBuffer(enc)||ENCODINGS[enc]===undefined){return createDiffieHellman(prime,'binary',enc,generator)}
enc=enc||'binary'
genc=genc||'binary'
generator=generator||new Buffer([2])
if(!Buffer.isBuffer(generator)){generator=new Buffer(generator,genc)}
if(typeof prime==='number'){return new DH(generatePrime(prime,generator),generator,!0)}
if(!Buffer.isBuffer(prime)){prime=new Buffer(prime,enc)}
return new DH(prime,generator,!0)}
exports.DiffieHellmanGroup=exports.createDiffieHellmanGroup=exports.getDiffieHellman=getDiffieHellman
exports.createDiffieHellman=exports.DiffieHellman=createDiffieHellman}).call(this,require("buffer").Buffer)},{"./lib/dh":71,"./lib/generatePrime":72,"./lib/primes.json":73,"buffer":54}],71:[function(require,module,exports){(function(Buffer){var BN=require('bn.js');var MillerRabin=require('miller-rabin');var millerRabin=new MillerRabin();var TWENTYFOUR=new BN(24);var ELEVEN=new BN(11);var TEN=new BN(10);var THREE=new BN(3);var SEVEN=new BN(7);var primes=require('./generatePrime');var randomBytes=require('randombytes');module.exports=DH;function setPublicKey(pub,enc){enc=enc||'utf8';if(!Buffer.isBuffer(pub)){pub=new Buffer(pub,enc)}
this._pub=new BN(pub);return this}
function setPrivateKey(priv,enc){enc=enc||'utf8';if(!Buffer.isBuffer(priv)){priv=new Buffer(priv,enc)}
this._priv=new BN(priv);return this}
var primeCache={};function checkPrime(prime,generator){var gen=generator.toString('hex');var hex=[gen,prime.toString(16)].join('_');if(hex in primeCache){return primeCache[hex]}
var error=0;if(prime.isEven()||!primes.simpleSieve||!primes.fermatTest(prime)||!millerRabin.test(prime)){error+=1;if(gen==='02'||gen==='05'){error+=8}else{error+=4}
primeCache[hex]=error;return error}
if(!millerRabin.test(prime.shrn(1))){error+=2}
var rem;switch(gen){case '02':if(prime.mod(TWENTYFOUR).cmp(ELEVEN)){error+=8}
break;case '05':rem=prime.mod(TEN);if(rem.cmp(THREE)&&rem.cmp(SEVEN)){error+=8}
break;default:error+=4}
primeCache[hex]=error;return error}
function DH(prime,generator,malleable){this.setGenerator(generator);this.__prime=new BN(prime);this._prime=BN.mont(this.__prime);this._primeLen=prime.length;this._pub=undefined;this._priv=undefined;this._primeCode=undefined;if(malleable){this.setPublicKey=setPublicKey;this.setPrivateKey=setPrivateKey}else{this._primeCode=8}}
Object.defineProperty(DH.prototype,'verifyError',{enumerable:!0,get:function(){if(typeof this._primeCode!=='number'){this._primeCode=checkPrime(this.__prime,this.__gen)}
return this._primeCode}});DH.prototype.generateKeys=function(){if(!this._priv){this._priv=new BN(randomBytes(this._primeLen))}
this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed();return this.getPublicKey()};DH.prototype.computeSecret=function(other){other=new BN(other);other=other.toRed(this._prime);var secret=other.redPow(this._priv).fromRed();var out=new Buffer(secret.toArray());var prime=this.getPrime();if(out.length<prime.length){var front=new Buffer(prime.length-out.length);front.fill(0);out=Buffer.concat([front,out])}
return out};DH.prototype.getPublicKey=function getPublicKey(enc){return formatReturnValue(this._pub,enc)};DH.prototype.getPrivateKey=function getPrivateKey(enc){return formatReturnValue(this._priv,enc)};DH.prototype.getPrime=function(enc){return formatReturnValue(this.__prime,enc)};DH.prototype.getGenerator=function(enc){return formatReturnValue(this._gen,enc)};DH.prototype.setGenerator=function(gen,enc){enc=enc||'utf8';if(!Buffer.isBuffer(gen)){gen=new Buffer(gen,enc)}
this.__gen=gen;this._gen=new BN(gen);return this};function formatReturnValue(bn,enc){var buf=new Buffer(bn.toArray());if(!enc){return buf}else{return buf.toString(enc)}}}).call(this,require("buffer").Buffer)},{"./generatePrime":72,"bn.js":21,"buffer":54,"miller-rabin":112,"randombytes":150}],72:[function(require,module,exports){var randomBytes=require('randombytes');module.exports=findPrime;findPrime.simpleSieve=simpleSieve;findPrime.fermatTest=fermatTest;var BN=require('bn.js');var TWENTYFOUR=new BN(24);var MillerRabin=require('miller-rabin');var millerRabin=new MillerRabin();var ONE=new BN(1);var TWO=new BN(2);var FIVE=new BN(5);var SIXTEEN=new BN(16);var EIGHT=new BN(8);var TEN=new BN(10);var THREE=new BN(3);var SEVEN=new BN(7);var ELEVEN=new BN(11);var FOUR=new BN(4);var TWELVE=new BN(12);var primes=null;function _getPrimes(){if(primes!==null)
return primes;var limit=0x100000;var res=[];res[0]=2;for(var i=1,k=3;k<limit;k+=2){var sqrt=Math.ceil(Math.sqrt(k));for(var j=0;j<i&&res[j]<=sqrt;j++)
if(k%res[j]===0)
break;if(i!==j&&res[j]<=sqrt)
continue;res[i++]=k}
primes=res;return res}
function simpleSieve(p){var primes=_getPrimes();for(var i=0;i<primes.length;i++)
if(p.modn(primes[i])===0){if(p.cmpn(primes[i])===0){return!0}else{return!1}}
return!0}
function fermatTest(p){var red=BN.mont(p);return TWO.toRed(red).redPow(p.subn(1)).fromRed().cmpn(1)===0}
function findPrime(bits,gen){if(bits<16){if(gen===2||gen===5){return new BN([0x8c,0x7b])}else{return new BN([0x8c,0x27])}}
gen=new BN(gen);var num,n2;while(!0){num=new BN(randomBytes(Math.ceil(bits/8)));while(num.bitLength()>bits){num.ishrn(1)}
if(num.isEven()){num.iadd(ONE)}
if(!num.testn(1)){num.iadd(TWO)}
if(!gen.cmp(TWO)){while(num.mod(TWENTYFOUR).cmp(ELEVEN)){num.iadd(FOUR)}}else if(!gen.cmp(FIVE)){while(num.mod(TEN).cmp(THREE)){num.iadd(FOUR)}}
n2=num.shrn(1);if(simpleSieve(n2)&&simpleSieve(num)&&fermatTest(n2)&&fermatTest(num)&&millerRabin.test(n2)&&millerRabin.test(num)){return num}}}},{"bn.js":21,"miller-rabin":112,"randombytes":150}],73:[function(require,module,exports){module.exports={"modp1":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},"modp2":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},"modp5":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},"modp14":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},"modp15":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},"modp16":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},"modp17":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},"modp18":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}},{}],74:[function(require,module,exports){'use strict';var elliptic=exports;elliptic.version=require('../package.json').version;elliptic.utils=require('./elliptic/utils');elliptic.rand=require('brorand');elliptic.curve=require('./elliptic/curve');elliptic.curves=require('./elliptic/curves');elliptic.ec=require('./elliptic/ec');elliptic.eddsa=require('./elliptic/eddsa')},{"../package.json":89,"./elliptic/curve":77,"./elliptic/curves":80,"./elliptic/ec":81,"./elliptic/eddsa":84,"./elliptic/utils":88,"brorand":22}],75:[function(require,module,exports){'use strict';var BN=require('bn.js');var elliptic=require('../../elliptic');var utils=elliptic.utils;var getNAF=utils.getNAF;var getJSF=utils.getJSF;var assert=utils.assert;function BaseCurve(type,conf){this.type=type;this.p=new BN(conf.p,16);this.red=conf.prime?BN.red(conf.prime):BN.mont(this.p);this.zero=new BN(0).toRed(this.red);this.one=new BN(1).toRed(this.red);this.two=new BN(2).toRed(this.red);this.n=conf.n&&new BN(conf.n,16);this.g=conf.g&&this.pointFromJSON(conf.g,conf.gRed);this._wnafT1=new Array(4);this._wnafT2=new Array(4);this._wnafT3=new Array(4);this._wnafT4=new Array(4);var adjustCount=this.n&&this.p.div(this.n);if(!adjustCount||adjustCount.cmpn(100)>0){this.redN=null}else{this._maxwellTrick=!0;this.redN=this.n.toRed(this.red)}}
module.exports=BaseCurve;BaseCurve.prototype.point=function point(){throw new Error('Not implemented')};BaseCurve.prototype.validate=function validate(){throw new Error('Not implemented')};BaseCurve.prototype._fixedNafMul=function _fixedNafMul(p,k){assert(p.precomputed);var doubles=p._getDoubles();var naf=getNAF(k,1);var I=(1<<(doubles.step+1))-(doubles.step%2===0?2:1);I/=3;var repr=[];for(var j=0;j<naf.length;j+=doubles.step){var nafW=0;for(var k=j+doubles.step-1;k>=j;k--)
nafW=(nafW<<1)+naf[k];repr.push(nafW)}
var a=this.jpoint(null,null,null);var b=this.jpoint(null,null,null);for(var i=I;i>0;i--){for(var j=0;j<repr.length;j++){var nafW=repr[j];if(nafW===i)
b=b.mixedAdd(doubles.points[j]);else if(nafW===-i)
b=b.mixedAdd(doubles.points[j].neg())}
a=a.add(b)}
return a.toP()};BaseCurve.prototype._wnafMul=function _wnafMul(p,k){var w=4;var nafPoints=p._getNAFPoints(w);w=nafPoints.wnd;var wnd=nafPoints.points;var naf=getNAF(k,w);var acc=this.jpoint(null,null,null);for(var i=naf.length-1;i>=0;i--){for(var k=0;i>=0&&naf[i]===0;i--)
k++;if(i>=0)
k++;acc=acc.dblp(k);if(i<0)
break;var z=naf[i];assert(z!==0);if(p.type==='affine'){if(z>0)
acc=acc.mixedAdd(wnd[(z-1)>>1]);else acc=acc.mixedAdd(wnd[(-z-1)>>1].neg())}else{if(z>0)
acc=acc.add(wnd[(z-1)>>1]);else acc=acc.add(wnd[(-z-1)>>1].neg())}}
return p.type==='affine'?acc.toP():acc};BaseCurve.prototype._wnafMulAdd=function _wnafMulAdd(defW,points,coeffs,len,jacobianResult){var wndWidth=this._wnafT1;var wnd=this._wnafT2;var naf=this._wnafT3;var max=0;for(var i=0;i<len;i++){var p=points[i];var nafPoints=p._getNAFPoints(defW);wndWidth[i]=nafPoints.wnd;wnd[i]=nafPoints.points}
for(var i=len-1;i>=1;i-=2){var a=i-1;var b=i;if(wndWidth[a]!==1||wndWidth[b]!==1){naf[a]=getNAF(coeffs[a],wndWidth[a]);naf[b]=getNAF(coeffs[b],wndWidth[b]);max=Math.max(naf[a].length,max);max=Math.max(naf[b].length,max);continue}
var comb=[points[a],null,null,points[b]];if(points[a].y.cmp(points[b].y)===0){comb[1]=points[a].add(points[b]);comb[2]=points[a].toJ().mixedAdd(points[b].neg())}else if(points[a].y.cmp(points[b].y.redNeg())===0){comb[1]=points[a].toJ().mixedAdd(points[b]);comb[2]=points[a].add(points[b].neg())}else{comb[1]=points[a].toJ().mixedAdd(points[b]);comb[2]=points[a].toJ().mixedAdd(points[b].neg())}
var index=[-3,-1,-5,-7,0,7,5,1,3];var jsf=getJSF(coeffs[a],coeffs[b]);max=Math.max(jsf[0].length,max);naf[a]=new Array(max);naf[b]=new Array(max);for(var j=0;j<max;j++){var ja=jsf[0][j]|0;var jb=jsf[1][j]|0;naf[a][j]=index[(ja+1)*3+(jb+1)];naf[b][j]=0;wnd[a]=comb}}
var acc=this.jpoint(null,null,null);var tmp=this._wnafT4;for(var i=max;i>=0;i--){var k=0;while(i>=0){var zero=!0;for(var j=0;j<len;j++){tmp[j]=naf[j][i]|0;if(tmp[j]!==0)
zero=!1}
if(!zero)
break;k++;i--}
if(i>=0)
k++;acc=acc.dblp(k);if(i<0)
break;for(var j=0;j<len;j++){var z=tmp[j];var p;if(z===0)
continue;else if(z>0)
p=wnd[j][(z-1)>>1];else if(z<0)
p=wnd[j][(-z-1)>>1].neg();if(p.type==='affine')
acc=acc.mixedAdd(p);else acc=acc.add(p)}}
for(var i=0;i<len;i++)
wnd[i]=null;if(jacobianResult)
return acc;else return acc.toP()};function BasePoint(curve,type){this.curve=curve;this.type=type;this.precomputed=null}
BaseCurve.BasePoint=BasePoint;BasePoint.prototype.eq=function eq(){throw new Error('Not implemented')};BasePoint.prototype.validate=function validate(){return this.curve.validate(this)};BaseCurve.prototype.decodePoint=function decodePoint(bytes,enc){bytes=utils.toArray(bytes,enc);var len=this.p.byteLength();if((bytes[0]===0x04||bytes[0]===0x06||bytes[0]===0x07)&&bytes.length-1===2*len){if(bytes[0]===0x06)
assert(bytes[bytes.length-1]%2===0);else if(bytes[0]===0x07)
assert(bytes[bytes.length-1]%2===1);var res=this.point(bytes.slice(1,1+len),bytes.slice(1+len,1+2*len));return res}else if((bytes[0]===0x02||bytes[0]===0x03)&&bytes.length-1===len){return this.pointFromX(bytes.slice(1,1+len),bytes[0]===0x03)}
throw new Error('Unknown point format')};BasePoint.prototype.encodeCompressed=function encodeCompressed(enc){return this.encode(enc,!0)};BasePoint.prototype._encode=function _encode(compact){var len=this.curve.p.byteLength();var x=this.getX().toArray('be',len);if(compact)
return[this.getY().isEven()?0x02:0x03].concat(x);return[0x04].concat(x,this.getY().toArray('be',len))};BasePoint.prototype.encode=function encode(enc,compact){return utils.encode(this._encode(compact),enc)};BasePoint.prototype.precompute=function precompute(power){if(this.precomputed)
return this;var precomputed={doubles:null,naf:null,beta:null};precomputed.naf=this._getNAFPoints(8);precomputed.doubles=this._getDoubles(4,power);precomputed.beta=this._getBeta();this.precomputed=precomputed;return this};BasePoint.prototype._hasDoubles=function _hasDoubles(k){if(!this.precomputed)
return!1;var doubles=this.precomputed.doubles;if(!doubles)
return!1;return doubles.points.length>=Math.ceil((k.bitLength()+1)/ doubles.step);
};

BasePoint.prototype._getDoubles = function _getDoubles(step, power) {
  if (this.precomputed && this.precomputed.doubles)
    return this.precomputed.doubles;

  var doubles = [ this ];
  var acc = this;
  for (var i = 0; i < power; i += step) {
    for (var j = 0; j < step; j++)
      acc = acc.dbl();
    doubles.push(acc);
  }
  return {
    step: step,
    points: doubles
  };
};

BasePoint.prototype._getNAFPoints = function _getNAFPoints(wnd) {
  if (this.precomputed && this.precomputed.naf)
    return this.precomputed.naf;

  var res = [ this ];
  var max = (1 << wnd) - 1;
  var dbl = max === 1 ? null : this.dbl();
  for (var i = 1; i < max; i++)
    res[i] = res[i - 1].add(dbl);
  return {
    wnd: wnd,
    points: res
  };
};

BasePoint.prototype._getBeta = function _getBeta() {
  return null;
};

BasePoint.prototype.dblp = function dblp(k) {
  var r = this;
  for (var i = 0; i < k; i++)
    r = r.dbl();
  return r;
};

},{"../../elliptic":74,"bn.js":21}],76:[function(require,module,exports){
'use strict';

var curve = require('../curve');
var elliptic = require('../../elliptic');
var BN = require('bn.js');
var inherits = require('inherits');
var Base = curve.base;

var assert = elliptic.utils.assert;

function EdwardsCurve(conf) {
  // NOTE: Important as we are creating point in Base.call()
  this.twisted = (conf.a | 0) !== 1;
  this.mOneA = this.twisted && (conf.a | 0) === -1;
  this.extended = this.mOneA;

  Base.call(this, 'edwards', conf);

  this.a = new BN(conf.a, 16).umod(this.red.m);
  this.a = this.a.toRed(this.red);
  this.c = new BN(conf.c, 16).toRed(this.red);
  this.c2 = this.c.redSqr();
  this.d = new BN(conf.d, 16).toRed(this.red);
  this.dd = this.d.redAdd(this.d);

  assert(!this.twisted || this.c.fromRed().cmpn(1) === 0);
  this.oneC = (conf.c | 0) === 1;
}
inherits(EdwardsCurve, Base);
module.exports = EdwardsCurve;

EdwardsCurve.prototype._mulA = function _mulA(num) {
  if (this.mOneA)
    return num.redNeg();
  else
    return this.a.redMul(num);
};

EdwardsCurve.prototype._mulC = function _mulC(num) {
  if (this.oneC)
    return num;
  else
    return this.c.redMul(num);
};

// Just for compatibility with Short curve
EdwardsCurve.prototype.jpoint = function jpoint(x, y, z, t) {
  return this.point(x, y, z, t);
};

EdwardsCurve.prototype.pointFromX = function pointFromX(x, odd) {
  x = new BN(x, 16);
  if (!x.red)
    x = x.toRed(this.red);

  var x2 = x.redSqr();
  var rhs = this.c2.redSub(this.a.redMul(x2));
  var lhs = this.one.redSub(this.c2.redMul(this.d).redMul(x2));

  var y2 = rhs.redMul(lhs.redInvm());
  var y = y2.redSqrt();
  if (y.redSqr().redSub(y2).cmp(this.zero) !== 0)
    throw new Error('invalid point');

  var isOdd = y.fromRed().isOdd();
  if (odd && !isOdd || !odd && isOdd)
    y = y.redNeg();

  return this.point(x, y);
};

EdwardsCurve.prototype.pointFromY = function pointFromY(y, odd) {
  y = new BN(y, 16);
  if (!y.red)
    y = y.toRed(this.red);

  // x^2 = (y^2 - c^2) / (c^2 d y^2 - a)
  var y2 = y.redSqr();
  var lhs = y2.redSub(this.c2);
  var rhs = y2.redMul(this.d).redMul(this.c2).redSub(this.a);
  var x2 = lhs.redMul(rhs.redInvm());

  if (x2.cmp(this.zero) === 0) {
    if (odd)
      throw new Error('invalid point');
    else
      return this.point(this.zero, y);
  }

  var x = x2.redSqrt();
  if (x.redSqr().redSub(x2).cmp(this.zero) !== 0)
    throw new Error('invalid point');

  if (x.fromRed().isOdd() !== odd)
    x = x.redNeg();

  return this.point(x, y);
};

EdwardsCurve.prototype.validate = function validate(point) {
  if (point.isInfinity())
    return true;

  // Curve: A * X^2 + Y^2 = C^2 * (1 + D * X^2 * Y^2)
  point.normalize();

  var x2 = point.x.redSqr();
  var y2 = point.y.redSqr();
  var lhs = x2.redMul(this.a).redAdd(y2);
  var rhs = this.c2.redMul(this.one.redAdd(this.d.redMul(x2).redMul(y2)));

  return lhs.cmp(rhs) === 0;
};

function Point(curve, x, y, z, t) {
  Base.BasePoint.call(this, curve, 'projective');
  if (x === null && y === null && z === null) {
    this.x = this.curve.zero;
    this.y = this.curve.one;
    this.z = this.curve.one;
    this.t = this.curve.zero;
    this.zOne = true;
  } else {
    this.x = new BN(x, 16);
    this.y = new BN(y, 16);
    this.z = z ? new BN(z, 16) : this.curve.one;
    this.t = t && new BN(t, 16);
    if (!this.x.red)
      this.x = this.x.toRed(this.curve.red);
    if (!this.y.red)
      this.y = this.y.toRed(this.curve.red);
    if (!this.z.red)
      this.z = this.z.toRed(this.curve.red);
    if (this.t && !this.t.red)
      this.t = this.t.toRed(this.curve.red);
    this.zOne = this.z === this.curve.one;

    // Use extended coordinates
    if (this.curve.extended && !this.t) {
      this.t = this.x.redMul(this.y);
      if (!this.zOne)
        this.t = this.t.redMul(this.z.redInvm());
    }
  }
}
inherits(Point, Base.BasePoint);

EdwardsCurve.prototype.pointFromJSON = function pointFromJSON(obj) {
  return Point.fromJSON(this, obj);
};

EdwardsCurve.prototype.point = function point(x, y, z, t) {
  return new Point(this, x, y, z, t);
};

Point.fromJSON = function fromJSON(curve, obj) {
  return new Point(curve, obj[0], obj[1], obj[2]);
};

Point.prototype.inspect = function inspect() {
  if (this.isInfinity())
    return '<EC Point Infinity>';
  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +
      ' y: ' + this.y.fromRed().toString(16, 2) +
      ' z: ' + this.z.fromRed().toString(16, 2) + '>';
};

Point.prototype.isInfinity = function isInfinity() {
  // XXX This code assumes that zero is always zero in red
  return this.x.cmpn(0) === 0 &&
    (this.y.cmp(this.z) === 0 ||
    (this.zOne && this.y.cmp(this.curve.c) === 0));
};

Point.prototype._extDbl = function _extDbl() {
  // hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html
  //     #doubling-dbl-2008-hwcd
  // 4M + 4S

  // A = X1^2
  var a = this.x.redSqr();
  // B = Y1^2
  var b = this.y.redSqr();
  // C = 2 * Z1^2
  var c = this.z.redSqr();
  c = c.redIAdd(c);
  // D = a * A
  var d = this.curve._mulA(a);
  // E = (X1 + Y1)^2 - A - B
  var e = this.x.redAdd(this.y).redSqr().redISub(a).redISub(b);
  // G = D + B
  var g = d.redAdd(b);
  // F = G - C
  var f = g.redSub(c);
  // H = D - B
  var h = d.redSub(b);
  // X3 = E * F
  var nx = e.redMul(f);
  // Y3 = G * H
  var ny = g.redMul(h);
  // T3 = E * H
  var nt = e.redMul(h);
  // Z3 = F * G
  var nz = f.redMul(g);
  return this.curve.point(nx, ny, nz, nt);
};

Point.prototype._projDbl = function _projDbl() {
  // hyperelliptic.org/EFD/g1p/auto-twisted-projective.html
  //     #doubling-dbl-2008-bbjlp
  //     #doubling-dbl-2007-bl
  // and others
  // Generally 3M + 4S or 2M + 4S

  // B = (X1 + Y1)^2
  var b = this.x.redAdd(this.y).redSqr();
  // C = X1^2
  var c = this.x.redSqr();
  // D = Y1^2
  var d = this.y.redSqr();

  var nx;
  var ny;
  var nz;
  if (this.curve.twisted) {
    // E = a * C
    var e = this.curve._mulA(c);
    // F = E + D
    var f = e.redAdd(d);
    if (this.zOne) {
      // X3 = (B - C - D) * (F - 2)
      nx = b.redSub(c).redSub(d).redMul(f.redSub(this.curve.two));
      // Y3 = F * (E - D)
      ny = f.redMul(e.redSub(d));
      // Z3 = F^2 - 2 * F
      nz = f.redSqr().redSub(f).redSub(f);
    } else {
      // H = Z1^2
      var h = this.z.redSqr();
      // J = F - 2 * H
      var j = f.redSub(h).redISub(h);
      // X3 = (B-C-D)*J
      nx = b.redSub(c).redISub(d).redMul(j);
      // Y3 = F * (E - D)
      ny = f.redMul(e.redSub(d));
      // Z3 = F * J
      nz = f.redMul(j);
    }
  } else {
    // E = C + D
    var e = c.redAdd(d);
    // H = (c * Z1)^2
    var h = this.curve._mulC(this.z).redSqr();
    // J = E - 2 * H
    var j = e.redSub(h).redSub(h);
    // X3 = c * (B - E) * J
    nx = this.curve._mulC(b.redISub(e)).redMul(j);
    // Y3 = c * E * (C - D)
    ny = this.curve._mulC(e).redMul(c.redISub(d));
    // Z3 = E * J
    nz = e.redMul(j);
  }
  return this.curve.point(nx, ny, nz);
};

Point.prototype.dbl = function dbl() {
  if (this.isInfinity())
    return this;

  // Double in extended coordinates
  if (this.curve.extended)
    return this._extDbl();
  else
    return this._projDbl();
};

Point.prototype._extAdd = function _extAdd(p) {
  // hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html
  //     #addition-add-2008-hwcd-3
  // 8M

  // A = (Y1 - X1) * (Y2 - X2)
  var a = this.y.redSub(this.x).redMul(p.y.redSub(p.x));
  // B = (Y1 + X1) * (Y2 + X2)
  var b = this.y.redAdd(this.x).redMul(p.y.redAdd(p.x));
  // C = T1 * k * T2
  var c = this.t.redMul(this.curve.dd).redMul(p.t);
  // D = Z1 * 2 * Z2
  var d = this.z.redMul(p.z.redAdd(p.z));
  // E = B - A
  var e = b.redSub(a);
  // F = D - C
  var f = d.redSub(c);
  // G = D + C
  var g = d.redAdd(c);
  // H = B + A
  var h = b.redAdd(a);
  // X3 = E * F
  var nx = e.redMul(f);
  // Y3 = G * H
  var ny = g.redMul(h);
  // T3 = E * H
  var nt = e.redMul(h);
  // Z3 = F * G
  var nz = f.redMul(g);
  return this.curve.point(nx, ny, nz, nt);
};

Point.prototype._projAdd = function _projAdd(p) {
  // hyperelliptic.org/EFD/g1p/auto-twisted-projective.html
  //     #addition-add-2008-bbjlp
  //     #addition-add-2007-bl
  // 10M + 1S

  // A = Z1 * Z2
  var a = this.z.redMul(p.z);
  // B = A^2
  var b = a.redSqr();
  // C = X1 * X2
  var c = this.x.redMul(p.x);
  // D = Y1 * Y2
  var d = this.y.redMul(p.y);
  // E = d * C * D
  var e = this.curve.d.redMul(c).redMul(d);
  // F = B - E
  var f = b.redSub(e);
  // G = B + E
  var g = b.redAdd(e);
  // X3 = A * F * ((X1 + Y1) * (X2 + Y2) - C - D)
  var tmp = this.x.redAdd(this.y).redMul(p.x.redAdd(p.y)).redISub(c).redISub(d);
  var nx = a.redMul(f).redMul(tmp);
  var ny;
  var nz;
  if (this.curve.twisted) {
    // Y3 = A * G * (D - a * C)
    ny = a.redMul(g).redMul(d.redSub(this.curve._mulA(c)));
    // Z3 = F * G
    nz = f.redMul(g);
  } else {
    // Y3 = A * G * (D - C)
    ny = a.redMul(g).redMul(d.redSub(c));
    // Z3 = c * F * G
    nz = this.curve._mulC(f).redMul(g);
  }
  return this.curve.point(nx, ny, nz);
};

Point.prototype.add = function add(p) {
  if (this.isInfinity())
    return p;
  if (p.isInfinity())
    return this;

  if (this.curve.extended)
    return this._extAdd(p);
  else
    return this._projAdd(p);
};

Point.prototype.mul = function mul(k) {
  if (this._hasDoubles(k))
    return this.curve._fixedNafMul(this, k);
  else
    return this.curve._wnafMul(this, k);
};

Point.prototype.mulAdd = function mulAdd(k1, p, k2) {
  return this.curve._wnafMulAdd(1, [ this, p ], [ k1, k2 ], 2, false);
};

Point.prototype.jmulAdd = function jmulAdd(k1, p, k2) {
  return this.curve._wnafMulAdd(1, [ this, p ], [ k1, k2 ], 2, true);
};

Point.prototype.normalize = function normalize() {
  if (this.zOne)
    return this;

  // Normalize coordinates
  var zi = this.z.redInvm();
  this.x = this.x.redMul(zi);
  this.y = this.y.redMul(zi);
  if (this.t)
    this.t = this.t.redMul(zi);
  this.z = this.curve.one;
  this.zOne = true;
  return this;
};

Point.prototype.neg = function neg() {
  return this.curve.point(this.x.redNeg(),
                          this.y,
                          this.z,
                          this.t && this.t.redNeg());
};

Point.prototype.getX = function getX() {
  this.normalize();
  return this.x.fromRed();
};

Point.prototype.getY = function getY() {
  this.normalize();
  return this.y.fromRed();
};

Point.prototype.eq = function eq(other) {
  return this === other ||
         this.getX().cmp(other.getX()) === 0 &&
         this.getY().cmp(other.getY()) === 0;
};

Point.prototype.eqXToP = function eqXToP(x) {
  var rx = x.toRed(this.curve.red).redMul(this.z);
  if (this.x.cmp(rx) === 0)
    return true;

  var xc = x.clone();
  var t = this.curve.redN.redMul(this.z);
  for (;;) {
    xc.iadd(this.curve.n);
    if (xc.cmp(this.curve.p) >= 0)
      return false;

    rx.redIAdd(t);
    if (this.x.cmp(rx) === 0)
      return true;
  }
};

// Compatibility with BaseCurve
Point.prototype.toP = Point.prototype.normalize;
Point.prototype.mixedAdd = Point.prototype.add;

},{"../../elliptic":74,"../curve":77,"bn.js":21,"inherits":108}],77:[function(require,module,exports){
'use strict';

var curve = exports;

curve.base = require('./base');
curve.short = require('./short');
curve.mont = require('./mont');
curve.edwards = require('./edwards');

},{"./base":75,"./edwards":76,"./mont":78,"./short":79}],78:[function(require,module,exports){
'use strict';

var curve = require('../curve');
var BN = require('bn.js');
var inherits = require('inherits');
var Base = curve.base;

var elliptic = require('../../elliptic');
var utils = elliptic.utils;

function MontCurve(conf) {
  Base.call(this, 'mont', conf);

  this.a = new BN(conf.a, 16).toRed(this.red);
  this.b = new BN(conf.b, 16).toRed(this.red);
  this.i4 = new BN(4).toRed(this.red).redInvm();
  this.two = new BN(2).toRed(this.red);
  this.a24 = this.i4.redMul(this.a.redAdd(this.two));
}
inherits(MontCurve, Base);
module.exports = MontCurve;

MontCurve.prototype.validate = function validate(point) {
  var x = point.normalize().x;
  var x2 = x.redSqr();
  var rhs = x2.redMul(x).redAdd(x2.redMul(this.a)).redAdd(x);
  var y = rhs.redSqrt();

  return y.redSqr().cmp(rhs) === 0;
};

function Point(curve, x, z) {
  Base.BasePoint.call(this, curve, 'projective');
  if (x === null && z === null) {
    this.x = this.curve.one;
    this.z = this.curve.zero;
  } else {
    this.x = new BN(x, 16);
    this.z = new BN(z, 16);
    if (!this.x.red)
      this.x = this.x.toRed(this.curve.red);
    if (!this.z.red)
      this.z = this.z.toRed(this.curve.red);
  }
}
inherits(Point, Base.BasePoint);

MontCurve.prototype.decodePoint = function decodePoint(bytes, enc) {
  return this.point(utils.toArray(bytes, enc), 1);
};

MontCurve.prototype.point = function point(x, z) {
  return new Point(this, x, z);
};

MontCurve.prototype.pointFromJSON = function pointFromJSON(obj) {
  return Point.fromJSON(this, obj);
};

Point.prototype.precompute = function precompute() {
  // No-op
};

Point.prototype._encode = function _encode() {
  return this.getX().toArray('be', this.curve.p.byteLength());
};

Point.fromJSON = function fromJSON(curve, obj) {
  return new Point(curve, obj[0], obj[1] || curve.one);
};

Point.prototype.inspect = function inspect() {
  if (this.isInfinity())
    return '<EC Point Infinity>';
  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +
      ' z: ' + this.z.fromRed().toString(16, 2) + '>';
};

Point.prototype.isInfinity = function isInfinity() {
  // XXX This code assumes that zero is always zero in red
  return this.z.cmpn(0) === 0;
};

Point.prototype.dbl = function dbl() {
  // http://hyperelliptic.org/EFD/g1p/auto-montgom-xz.html#doubling-dbl-1987-m-3
  // 2M + 2S + 4A

  // A = X1 + Z1
  var a = this.x.redAdd(this.z);
  // AA = A^2
  var aa = a.redSqr();
  // B = X1 - Z1
  var b = this.x.redSub(this.z);
  // BB = B^2
  var bb = b.redSqr();
  // C = AA - BB
  var c = aa.redSub(bb);
  // X3 = AA * BB
  var nx = aa.redMul(bb);
  // Z3 = C * (BB + A24 * C)
  var nz = c.redMul(bb.redAdd(this.curve.a24.redMul(c)));
  return this.curve.point(nx, nz);
};

Point.prototype.add = function add() {
  throw new Error('Not supported on Montgomery curve');
};

Point.prototype.diffAdd = function diffAdd(p, diff) {
  // http://hyperelliptic.org/EFD/g1p/auto-montgom-xz.html#diffadd-dadd-1987-m-3
  // 4M + 2S + 6A

  // A = X2 + Z2
  var a = this.x.redAdd(this.z);
  // B = X2 - Z2
  var b = this.x.redSub(this.z);
  // C = X3 + Z3
  var c = p.x.redAdd(p.z);
  // D = X3 - Z3
  var d = p.x.redSub(p.z);
  // DA = D * A
  var da = d.redMul(a);
  // CB = C * B
  var cb = c.redMul(b);
  // X5 = Z1 * (DA + CB)^2
  var nx = diff.z.redMul(da.redAdd(cb).redSqr());
  // Z5 = X1 * (DA - CB)^2
  var nz = diff.x.redMul(da.redISub(cb).redSqr());
  return this.curve.point(nx, nz);
};

Point.prototype.mul = function mul(k) {
  var t = k.clone();
  var a = this; // (N / 2) * Q + Q
  var b = this.curve.point(null, null); // (N / 2) * Q
  var c = this; // Q

  for (var bits = []; t.cmpn(0) !== 0; t.iushrn(1))
    bits.push(t.andln(1));

  for (var i = bits.length - 1; i >= 0; i--) {
    if (bits[i] === 0) {
      // N * Q + Q = ((N / 2) * Q + Q)) + (N / 2) * Q
      a = a.diffAdd(b, c);
      // N * Q = 2 * ((N / 2) * Q + Q))
      b = b.dbl();
    } else {
      // N * Q = ((N / 2) * Q + Q) + ((N / 2) * Q)
      b = a.diffAdd(b, c);
      // N * Q + Q = 2 * ((N / 2) * Q + Q)
      a = a.dbl();
    }
  }
  return b;
};

Point.prototype.mulAdd = function mulAdd() {
  throw new Error('Not supported on Montgomery curve');
};

Point.prototype.jumlAdd = function jumlAdd() {
  throw new Error('Not supported on Montgomery curve');
};

Point.prototype.eq = function eq(other) {
  return this.getX().cmp(other.getX()) === 0;
};

Point.prototype.normalize = function normalize() {
  this.x = this.x.redMul(this.z.redInvm());
  this.z = this.curve.one;
  return this;
};

Point.prototype.getX = function getX() {
  // Normalize coordinates
  this.normalize();

  return this.x.fromRed();
};

},{"../../elliptic":74,"../curve":77,"bn.js":21,"inherits":108}],79:[function(require,module,exports){
'use strict';

var curve = require('../curve');
var elliptic = require('../../elliptic');
var BN = require('bn.js');
var inherits = require('inherits');
var Base = curve.base;

var assert = elliptic.utils.assert;

function ShortCurve(conf) {
  Base.call(this, 'short', conf);

  this.a = new BN(conf.a, 16).toRed(this.red);
  this.b = new BN(conf.b, 16).toRed(this.red);
  this.tinv = this.two.redInvm();

  this.zeroA = this.a.fromRed().cmpn(0) === 0;
  this.threeA = this.a.fromRed().sub(this.p).cmpn(-3) === 0;

  // If the curve is endomorphic, precalculate beta and lambda
  this.endo = this._getEndomorphism(conf);
  this._endoWnafT1 = new Array(4);
  this._endoWnafT2 = new Array(4);
}
inherits(ShortCurve, Base);
module.exports = ShortCurve;

ShortCurve.prototype._getEndomorphism = function _getEndomorphism(conf) {
  // No efficient endomorphism
  if (!this.zeroA || !this.g || !this.n || this.p.modn(3) !== 1)
    return;

  // Compute beta and lambda, that lambda * P = (beta * Px; Py)
  var beta;
  var lambda;
  if (conf.beta) {
    beta = new BN(conf.beta, 16).toRed(this.red);
  } else {
    var betas = this._getEndoRoots(this.p);
    // Choose the smallest beta
    beta = betas[0].cmp(betas[1]) < 0 ? betas[0] : betas[1];
    beta = beta.toRed(this.red);
  }
  if (conf.lambda) {
    lambda = new BN(conf.lambda, 16);
  } else {
    // Choose the lambda that is matching selected beta
    var lambdas = this._getEndoRoots(this.n);
    if (this.g.mul(lambdas[0]).x.cmp(this.g.x.redMul(beta)) === 0) {
      lambda = lambdas[0];
    } else {
      lambda = lambdas[1];
      assert(this.g.mul(lambda).x.cmp(this.g.x.redMul(beta)) === 0);
    }
  }

  // Get basis vectors, used for balanced length-two representation
  var basis;
  if (conf.basis) {
    basis = conf.basis.map(function(vec) {
      return {
        a: new BN(vec.a, 16),
        b: new BN(vec.b, 16)
      };
    });
  } else {
    basis = this._getEndoBasis(lambda);
  }

  return {
    beta: beta,
    lambda: lambda,
    basis: basis
  };
};

ShortCurve.prototype._getEndoRoots = function _getEndoRoots(num) {
  // Find roots of for x^2 + x + 1 in F
  // Root = (-1 +- Sqrt(-3)) / 2
  //
  var red = num === this.p ? this.red : BN.mont(num);
  var tinv = new BN(2).toRed(red).redInvm();
  var ntinv = tinv.redNeg();

  var s = new BN(3).toRed(red).redNeg().redSqrt().redMul(tinv);

  var l1 = ntinv.redAdd(s).fromRed();
  var l2 = ntinv.redSub(s).fromRed();
  return [ l1, l2 ];
};

ShortCurve.prototype._getEndoBasis = function _getEndoBasis(lambda) {
  // aprxSqrt >= sqrt(this.n)
  var aprxSqrt = this.n.ushrn(Math.floor(this.n.bitLength() / 2));

  // 3.74
  // Run EGCD, until r(L + 1) < aprxSqrt
  var u = lambda;
  var v = this.n.clone();
  var x1 = new BN(1);
  var y1 = new BN(0);
  var x2 = new BN(0);
  var y2 = new BN(1);

  // NOTE: all vectors are roots of: a + b * lambda = 0 (mod n)
  var a0;
  var b0;
  // First vector
  var a1;
  var b1;
  // Second vector
  var a2;
  var b2;

  var prevR;
  var i = 0;
  var r;
  var x;
  while (u.cmpn(0) !== 0) {
    var q = v.div(u);
    r = v.sub(q.mul(u));
    x = x2.sub(q.mul(x1));
    var y = y2.sub(q.mul(y1));

    if (!a1 && r.cmp(aprxSqrt) < 0) {
      a0 = prevR.neg();
      b0 = x1;
      a1 = r.neg();
      b1 = x;
    } else if (a1 && ++i === 2) {
      break;
    }
    prevR = r;

    v = u;
    u = r;
    x2 = x1;
    x1 = x;
    y2 = y1;
    y1 = y;
  }
  a2 = r.neg();
  b2 = x;

  var len1 = a1.sqr().add(b1.sqr());
  var len2 = a2.sqr().add(b2.sqr());
  if (len2.cmp(len1) >= 0) {
    a2 = a0;
    b2 = b0;
  }

  // Normalize signs
  if (a1.negative) {
    a1 = a1.neg();
    b1 = b1.neg();
  }
  if (a2.negative) {
    a2 = a2.neg();
    b2 = b2.neg();
  }

  return [
    { a: a1, b: b1 },
    { a: a2, b: b2 }
  ];
};

ShortCurve.prototype._endoSplit = function _endoSplit(k) {
  var basis = this.endo.basis;
  var v1 = basis[0];
  var v2 = basis[1];

  var c1 = v2.b.mul(k).divRound(this.n);
  var c2 = v1.b.neg().mul(k).divRound(this.n);

  var p1 = c1.mul(v1.a);
  var p2 = c2.mul(v2.a);
  var q1 = c1.mul(v1.b);
  var q2 = c2.mul(v2.b);

  // Calculate answer
  var k1 = k.sub(p1).sub(p2);
  var k2 = q1.add(q2).neg();
  return { k1: k1, k2: k2 };
};

ShortCurve.prototype.pointFromX = function pointFromX(x, odd) {
  x = new BN(x, 16);
  if (!x.red)
    x = x.toRed(this.red);

  var y2 = x.redSqr().redMul(x).redIAdd(x.redMul(this.a)).redIAdd(this.b);
  var y = y2.redSqrt();
  if (y.redSqr().redSub(y2).cmp(this.zero) !== 0)
    throw new Error('invalid point');

  // XXX Is there any way to tell if the number is odd without converting it
  // to non-red form?
  var isOdd = y.fromRed().isOdd();
  if (odd && !isOdd || !odd && isOdd)
    y = y.redNeg();

  return this.point(x, y);
};

ShortCurve.prototype.validate = function validate(point) {
  if (point.inf)
    return true;

  var x = point.x;
  var y = point.y;

  var ax = this.a.redMul(x);
  var rhs = x.redSqr().redMul(x).redIAdd(ax).redIAdd(this.b);
  return y.redSqr().redISub(rhs).cmpn(0) === 0;
};

ShortCurve.prototype._endoWnafMulAdd =
    function _endoWnafMulAdd(points, coeffs, jacobianResult) {
  var npoints = this._endoWnafT1;
  var ncoeffs = this._endoWnafT2;
  for (var i = 0; i < points.length; i++) {
    var split = this._endoSplit(coeffs[i]);
    var p = points[i];
    var beta = p._getBeta();

    if (split.k1.negative) {
      split.k1.ineg();
      p = p.neg(true);
    }
    if (split.k2.negative) {
      split.k2.ineg();
      beta = beta.neg(true);
    }

    npoints[i * 2] = p;
    npoints[i * 2 + 1] = beta;
    ncoeffs[i * 2] = split.k1;
    ncoeffs[i * 2 + 1] = split.k2;
  }
  var res = this._wnafMulAdd(1, npoints, ncoeffs, i * 2, jacobianResult);

  // Clean-up references to points and coefficients
  for (var j = 0; j < i * 2; j++) {
    npoints[j] = null;
    ncoeffs[j] = null;
  }
  return res;
};

function Point(curve, x, y, isRed) {
  Base.BasePoint.call(this, curve, 'affine');
  if (x === null && y === null) {
    this.x = null;
    this.y = null;
    this.inf = true;
  } else {
    this.x = new BN(x, 16);
    this.y = new BN(y, 16);
    // Force redgomery representation when loading from JSON
    if (isRed) {
      this.x.forceRed(this.curve.red);
      this.y.forceRed(this.curve.red);
    }
    if (!this.x.red)
      this.x = this.x.toRed(this.curve.red);
    if (!this.y.red)
      this.y = this.y.toRed(this.curve.red);
    this.inf = false;
  }
}
inherits(Point, Base.BasePoint);

ShortCurve.prototype.point = function point(x, y, isRed) {
  return new Point(this, x, y, isRed);
};

ShortCurve.prototype.pointFromJSON = function pointFromJSON(obj, red) {
  return Point.fromJSON(this, obj, red);
};

Point.prototype._getBeta = function _getBeta() {
  if (!this.curve.endo)
    return;

  var pre = this.precomputed;
  if (pre && pre.beta)
    return pre.beta;

  var beta = this.curve.point(this.x.redMul(this.curve.endo.beta), this.y);
  if (pre) {
    var curve = this.curve;
    var endoMul = function(p) {
      return curve.point(p.x.redMul(curve.endo.beta), p.y);
    };
    pre.beta = beta;
    beta.precomputed = {
      beta: null,
      naf: pre.naf && {
        wnd: pre.naf.wnd,
        points: pre.naf.points.map(endoMul)
      },
      doubles: pre.doubles && {
        step: pre.doubles.step,
        points: pre.doubles.points.map(endoMul)
      }
    };
  }
  return beta;
};

Point.prototype.toJSON = function toJSON() {
  if (!this.precomputed)
    return [ this.x, this.y ];

  return [ this.x, this.y, this.precomputed && {
    doubles: this.precomputed.doubles && {
      step: this.precomputed.doubles.step,
      points: this.precomputed.doubles.points.slice(1)
    },
    naf: this.precomputed.naf && {
      wnd: this.precomputed.naf.wnd,
      points: this.precomputed.naf.points.slice(1)
    }
  } ];
};

Point.fromJSON = function fromJSON(curve, obj, red) {
  if (typeof obj === 'string')
    obj = JSON.parse(obj);
  var res = curve.point(obj[0], obj[1], red);
  if (!obj[2])
    return res;

  function obj2point(obj) {
    return curve.point(obj[0], obj[1], red);
  }

  var pre = obj[2];
  res.precomputed = {
    beta: null,
    doubles: pre.doubles && {
      step: pre.doubles.step,
      points: [ res ].concat(pre.doubles.points.map(obj2point))
    },
    naf: pre.naf && {
      wnd: pre.naf.wnd,
      points: [ res ].concat(pre.naf.points.map(obj2point))
    }
  };
  return res;
};

Point.prototype.inspect = function inspect() {
  if (this.isInfinity())
    return '<EC Point Infinity>';
  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +
      ' y: ' + this.y.fromRed().toString(16, 2) + '>';
};

Point.prototype.isInfinity = function isInfinity() {
  return this.inf;
};

Point.prototype.add = function add(p) {
  // O + P = P
  if (this.inf)
    return p;

  // P + O = P
  if (p.inf)
    return this;

  // P + P = 2P
  if (this.eq(p))
    return this.dbl();

  // P + (-P) = O
  if (this.neg().eq(p))
    return this.curve.point(null, null);

  // P + Q = O
  if (this.x.cmp(p.x) === 0)
    return this.curve.point(null, null);

  var c = this.y.redSub(p.y);
  if (c.cmpn(0) !== 0)
    c = c.redMul(this.x.redSub(p.x).redInvm());
  var nx = c.redSqr().redISub(this.x).redISub(p.x);
  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);
  return this.curve.point(nx, ny);
};

Point.prototype.dbl = function dbl() {
  if (this.inf)
    return this;

  // 2P = O
  var ys1 = this.y.redAdd(this.y);
  if (ys1.cmpn(0) === 0)
    return this.curve.point(null, null);

  var a = this.curve.a;

  var x2 = this.x.redSqr();
  var dyinv = ys1.redInvm();
  var c = x2.redAdd(x2).redIAdd(x2).redIAdd(a).redMul(dyinv);

  var nx = c.redSqr().redISub(this.x.redAdd(this.x));
  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);
  return this.curve.point(nx, ny);
};

Point.prototype.getX = function getX() {
  return this.x.fromRed();
};

Point.prototype.getY = function getY() {
  return this.y.fromRed();
};

Point.prototype.mul = function mul(k) {
  k = new BN(k, 16);

  if (this._hasDoubles(k))
    return this.curve._fixedNafMul(this, k);
  else if (this.curve.endo)
    return this.curve._endoWnafMulAdd([ this ], [ k ]);
  else
    return this.curve._wnafMul(this, k);
};

Point.prototype.mulAdd = function mulAdd(k1, p2, k2) {
  var points = [ this, p2 ];
  var coeffs = [ k1, k2 ];
  if (this.curve.endo)
    return this.curve._endoWnafMulAdd(points, coeffs);
  else
    return this.curve._wnafMulAdd(1, points, coeffs, 2);
};

Point.prototype.jmulAdd = function jmulAdd(k1, p2, k2) {
  var points = [ this, p2 ];
  var coeffs = [ k1, k2 ];
  if (this.curve.endo)
    return this.curve._endoWnafMulAdd(points, coeffs, true);
  else
    return this.curve._wnafMulAdd(1, points, coeffs, 2, true);
};

Point.prototype.eq = function eq(p) {
  return this === p ||
         this.inf === p.inf &&
             (this.inf || this.x.cmp(p.x) === 0 && this.y.cmp(p.y) === 0);
};

Point.prototype.neg = function neg(_precompute) {
  if (this.inf)
    return this;

  var res = this.curve.point(this.x, this.y.redNeg());
  if (_precompute && this.precomputed) {
    var pre = this.precomputed;
    var negate = function(p) {
      return p.neg();
    };
    res.precomputed = {
      naf: pre.naf && {
        wnd: pre.naf.wnd,
        points: pre.naf.points.map(negate)
      },
      doubles: pre.doubles && {
        step: pre.doubles.step,
        points: pre.doubles.points.map(negate)
      }
    };
  }
  return res;
};

Point.prototype.toJ = function toJ() {
  if (this.inf)
    return this.curve.jpoint(null, null, null);

  var res = this.curve.jpoint(this.x, this.y, this.curve.one);
  return res;
};

function JPoint(curve, x, y, z) {
  Base.BasePoint.call(this, curve, 'jacobian');
  if (x === null && y === null && z === null) {
    this.x = this.curve.one;
    this.y = this.curve.one;
    this.z = new BN(0);
  } else {
    this.x = new BN(x, 16);
    this.y = new BN(y, 16);
    this.z = new BN(z, 16);
  }
  if (!this.x.red)
    this.x = this.x.toRed(this.curve.red);
  if (!this.y.red)
    this.y = this.y.toRed(this.curve.red);
  if (!this.z.red)
    this.z = this.z.toRed(this.curve.red);

  this.zOne = this.z === this.curve.one;
}
inherits(JPoint, Base.BasePoint);

ShortCurve.prototype.jpoint = function jpoint(x, y, z) {
  return new JPoint(this, x, y, z);
};

JPoint.prototype.toP = function toP() {
  if (this.isInfinity())
    return this.curve.point(null, null);

  var zinv = this.z.redInvm();
  var zinv2 = zinv.redSqr();
  var ax = this.x.redMul(zinv2);
  var ay = this.y.redMul(zinv2).redMul(zinv);

  return this.curve.point(ax, ay);
};

JPoint.prototype.neg = function neg() {
  return this.curve.jpoint(this.x, this.y.redNeg(), this.z);
};

JPoint.prototype.add = function add(p) {
  // O + P = P
  if (this.isInfinity())
    return p;

  // P + O = P
  if (p.isInfinity())
    return this;

  // 12M + 4S + 7A
  var pz2 = p.z.redSqr();
  var z2 = this.z.redSqr();
  var u1 = this.x.redMul(pz2);
  var u2 = p.x.redMul(z2);
  var s1 = this.y.redMul(pz2.redMul(p.z));
  var s2 = p.y.redMul(z2.redMul(this.z));

  var h = u1.redSub(u2);
  var r = s1.redSub(s2);
  if (h.cmpn(0) === 0) {
    if (r.cmpn(0) !== 0)
      return this.curve.jpoint(null, null, null);
    else
      return this.dbl();
  }

  var h2 = h.redSqr();
  var h3 = h2.redMul(h);
  var v = u1.redMul(h2);

  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);
  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));
  var nz = this.z.redMul(p.z).redMul(h);

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype.mixedAdd = function mixedAdd(p) {
  // O + P = P
  if (this.isInfinity())
    return p.toJ();

  // P + O = P
  if (p.isInfinity())
    return this;

  // 8M + 3S + 7A
  var z2 = this.z.redSqr();
  var u1 = this.x;
  var u2 = p.x.redMul(z2);
  var s1 = this.y;
  var s2 = p.y.redMul(z2).redMul(this.z);

  var h = u1.redSub(u2);
  var r = s1.redSub(s2);
  if (h.cmpn(0) === 0) {
    if (r.cmpn(0) !== 0)
      return this.curve.jpoint(null, null, null);
    else
      return this.dbl();
  }

  var h2 = h.redSqr();
  var h3 = h2.redMul(h);
  var v = u1.redMul(h2);

  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);
  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));
  var nz = this.z.redMul(h);

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype.dblp = function dblp(pow) {
  if (pow === 0)
    return this;
  if (this.isInfinity())
    return this;
  if (!pow)
    return this.dbl();

  if (this.curve.zeroA || this.curve.threeA) {
    var r = this;
    for (var i = 0; i < pow; i++)
      r = r.dbl();
    return r;
  }

  // 1M + 2S + 1A + N * (4S + 5M + 8A)
  // N = 1 => 6M + 6S + 9A
  var a = this.curve.a;
  var tinv = this.curve.tinv;

  var jx = this.x;
  var jy = this.y;
  var jz = this.z;
  var jz4 = jz.redSqr().redSqr();

  // Reuse results
  var jyd = jy.redAdd(jy);
  for (var i = 0; i < pow; i++) {
    var jx2 = jx.redSqr();
    var jyd2 = jyd.redSqr();
    var jyd4 = jyd2.redSqr();
    var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));

    var t1 = jx.redMul(jyd2);
    var nx = c.redSqr().redISub(t1.redAdd(t1));
    var t2 = t1.redISub(nx);
    var dny = c.redMul(t2);
    dny = dny.redIAdd(dny).redISub(jyd4);
    var nz = jyd.redMul(jz);
    if (i + 1 < pow)
      jz4 = jz4.redMul(jyd4);

    jx = nx;
    jz = nz;
    jyd = dny;
  }

  return this.curve.jpoint(jx, jyd.redMul(tinv), jz);
};

JPoint.prototype.dbl = function dbl() {
  if (this.isInfinity())
    return this;

  if (this.curve.zeroA)
    return this._zeroDbl();
  else if (this.curve.threeA)
    return this._threeDbl();
  else
    return this._dbl();
};

JPoint.prototype._zeroDbl = function _zeroDbl() {
  var nx;
  var ny;
  var nz;
  // Z = 1
  if (this.zOne) {
    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html
    //     #doubling-mdbl-2007-bl
    // 1M + 5S + 14A

    // XX = X1^2
    var xx = this.x.redSqr();
    // YY = Y1^2
    var yy = this.y.redSqr();
    // YYYY = YY^2
    var yyyy = yy.redSqr();
    // S = 2 * ((X1 + YY)^2 - XX - YYYY)
    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);
    s = s.redIAdd(s);
    // M = 3 * XX + a; a = 0
    var m = xx.redAdd(xx).redIAdd(xx);
    // T = M ^ 2 - 2*S
    var t = m.redSqr().redISub(s).redISub(s);

    // 8 * YYYY
    var yyyy8 = yyyy.redIAdd(yyyy);
    yyyy8 = yyyy8.redIAdd(yyyy8);
    yyyy8 = yyyy8.redIAdd(yyyy8);

    // X3 = T
    nx = t;
    // Y3 = M * (S - T) - 8 * YYYY
    ny = m.redMul(s.redISub(t)).redISub(yyyy8);
    // Z3 = 2*Y1
    nz = this.y.redAdd(this.y);
  } else {
    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html
    //     #doubling-dbl-2009-l
    // 2M + 5S + 13A

    // A = X1^2
    var a = this.x.redSqr();
    // B = Y1^2
    var b = this.y.redSqr();
    // C = B^2
    var c = b.redSqr();
    // D = 2 * ((X1 + B)^2 - A - C)
    var d = this.x.redAdd(b).redSqr().redISub(a).redISub(c);
    d = d.redIAdd(d);
    // E = 3 * A
    var e = a.redAdd(a).redIAdd(a);
    // F = E^2
    var f = e.redSqr();

    // 8 * C
    var c8 = c.redIAdd(c);
    c8 = c8.redIAdd(c8);
    c8 = c8.redIAdd(c8);

    // X3 = F - 2 * D
    nx = f.redISub(d).redISub(d);
    // Y3 = E * (D - X3) - 8 * C
    ny = e.redMul(d.redISub(nx)).redISub(c8);
    // Z3 = 2 * Y1 * Z1
    nz = this.y.redMul(this.z);
    nz = nz.redIAdd(nz);
  }

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype._threeDbl = function _threeDbl() {
  var nx;
  var ny;
  var nz;
  // Z = 1
  if (this.zOne) {
    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html
    //     #doubling-mdbl-2007-bl
    // 1M + 5S + 15A

    // XX = X1^2
    var xx = this.x.redSqr();
    // YY = Y1^2
    var yy = this.y.redSqr();
    // YYYY = YY^2
    var yyyy = yy.redSqr();
    // S = 2 * ((X1 + YY)^2 - XX - YYYY)
    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);
    s = s.redIAdd(s);
    // M = 3 * XX + a
    var m = xx.redAdd(xx).redIAdd(xx).redIAdd(this.curve.a);
    // T = M^2 - 2 * S
    var t = m.redSqr().redISub(s).redISub(s);
    // X3 = T
    nx = t;
    // Y3 = M * (S - T) - 8 * YYYY
    var yyyy8 = yyyy.redIAdd(yyyy);
    yyyy8 = yyyy8.redIAdd(yyyy8);
    yyyy8 = yyyy8.redIAdd(yyyy8);
    ny = m.redMul(s.redISub(t)).redISub(yyyy8);
    // Z3 = 2 * Y1
    nz = this.y.redAdd(this.y);
  } else {
    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html#doubling-dbl-2001-b
    // 3M + 5S

    // delta = Z1^2
    var delta = this.z.redSqr();
    // gamma = Y1^2
    var gamma = this.y.redSqr();
    // beta = X1 * gamma
    var beta = this.x.redMul(gamma);
    // alpha = 3 * (X1 - delta) * (X1 + delta)
    var alpha = this.x.redSub(delta).redMul(this.x.redAdd(delta));
    alpha = alpha.redAdd(alpha).redIAdd(alpha);
    // X3 = alpha^2 - 8 * beta
    var beta4 = beta.redIAdd(beta);
    beta4 = beta4.redIAdd(beta4);
    var beta8 = beta4.redAdd(beta4);
    nx = alpha.redSqr().redISub(beta8);
    // Z3 = (Y1 + Z1)^2 - gamma - delta
    nz = this.y.redAdd(this.z).redSqr().redISub(gamma).redISub(delta);
    // Y3 = alpha * (4 * beta - X3) - 8 * gamma^2
    var ggamma8 = gamma.redSqr();
    ggamma8 = ggamma8.redIAdd(ggamma8);
    ggamma8 = ggamma8.redIAdd(ggamma8);
    ggamma8 = ggamma8.redIAdd(ggamma8);
    ny = alpha.redMul(beta4.redISub(nx)).redISub(ggamma8);
  }

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype._dbl = function _dbl() {
  var a = this.curve.a;

  // 4M + 6S + 10A
  var jx = this.x;
  var jy = this.y;
  var jz = this.z;
  var jz4 = jz.redSqr().redSqr();

  var jx2 = jx.redSqr();
  var jy2 = jy.redSqr();

  var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));

  var jxd4 = jx.redAdd(jx);
  jxd4 = jxd4.redIAdd(jxd4);
  var t1 = jxd4.redMul(jy2);
  var nx = c.redSqr().redISub(t1.redAdd(t1));
  var t2 = t1.redISub(nx);

  var jyd8 = jy2.redSqr();
  jyd8 = jyd8.redIAdd(jyd8);
  jyd8 = jyd8.redIAdd(jyd8);
  jyd8 = jyd8.redIAdd(jyd8);
  var ny = c.redMul(t2).redISub(jyd8);
  var nz = jy.redAdd(jy).redMul(jz);

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype.trpl = function trpl() {
  if (!this.curve.zeroA)
    return this.dbl().add(this);

  // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#tripling-tpl-2007-bl
  // 5M + 10S + ...

  // XX = X1^2
  var xx = this.x.redSqr();
  // YY = Y1^2
  var yy = this.y.redSqr();
  // ZZ = Z1^2
  var zz = this.z.redSqr();
  // YYYY = YY^2
  var yyyy = yy.redSqr();
  // M = 3 * XX + a * ZZ2; a = 0
  var m = xx.redAdd(xx).redIAdd(xx);
  // MM = M^2
  var mm = m.redSqr();
  // E = 6 * ((X1 + YY)^2 - XX - YYYY) - MM
  var e = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);
  e = e.redIAdd(e);
  e = e.redAdd(e).redIAdd(e);
  e = e.redISub(mm);
  // EE = E^2
  var ee = e.redSqr();
  // T = 16*YYYY
  var t = yyyy.redIAdd(yyyy);
  t = t.redIAdd(t);
  t = t.redIAdd(t);
  t = t.redIAdd(t);
  // U = (M + E)^2 - MM - EE - T
  var u = m.redIAdd(e).redSqr().redISub(mm).redISub(ee).redISub(t);
  // X3 = 4 * (X1 * EE - 4 * YY * U)
  var yyu4 = yy.redMul(u);
  yyu4 = yyu4.redIAdd(yyu4);
  yyu4 = yyu4.redIAdd(yyu4);
  var nx = this.x.redMul(ee).redISub(yyu4);
  nx = nx.redIAdd(nx);
  nx = nx.redIAdd(nx);
  // Y3 = 8 * Y1 * (U * (T - U) - E * EE)
  var ny = this.y.redMul(u.redMul(t.redISub(u)).redISub(e.redMul(ee)));
  ny = ny.redIAdd(ny);
  ny = ny.redIAdd(ny);
  ny = ny.redIAdd(ny);
  // Z3 = (Z1 + E)^2 - ZZ - EE
  var nz = this.z.redAdd(e).redSqr().redISub(zz).redISub(ee);

  return this.curve.jpoint(nx, ny, nz);
};

JPoint.prototype.mul = function mul(k, kbase) {
  k = new BN(k, kbase);

  return this.curve._wnafMul(this, k);
};

JPoint.prototype.eq = function eq(p) {
  if (p.type === 'affine')
    return this.eq(p.toJ());

  if (this === p)
    return true;

  // x1 * z2^2 == x2 * z1^2
  var z2 = this.z.redSqr();
  var pz2 = p.z.redSqr();
  if (this.x.redMul(pz2).redISub(p.x.redMul(z2)).cmpn(0) !== 0)
    return false;

  // y1 * z2^3 == y2 * z1^3
  var z3 = z2.redMul(this.z);
  var pz3 = pz2.redMul(p.z);
  return this.y.redMul(pz3).redISub(p.y.redMul(z3)).cmpn(0) === 0;
};

JPoint.prototype.eqXToP = function eqXToP(x) {
  var zs = this.z.redSqr();
  var rx = x.toRed(this.curve.red).redMul(zs);
  if (this.x.cmp(rx) === 0)
    return true;

  var xc = x.clone();
  var t = this.curve.redN.redMul(zs);
  for (;;) {
    xc.iadd(this.curve.n);
    if (xc.cmp(this.curve.p) >= 0)
      return false;

    rx.redIAdd(t);
    if (this.x.cmp(rx) === 0)
      return true;
  }
};

JPoint.prototype.inspect = function inspect() {
  if (this.isInfinity())
    return '<EC JPoint Infinity>';
  return '<EC JPoint x: ' + this.x.toString(16, 2) +
      ' y: ' + this.y.toString(16, 2) +
      ' z: ' + this.z.toString(16, 2) + '>';
};

JPoint.prototype.isInfinity = function isInfinity() {
  // XXX This code assumes that zero is always zero in red
  return this.z.cmpn(0) === 0;
};

},{"../../elliptic":74,"../curve":77,"bn.js":21,"inherits":108}],80:[function(require,module,exports){
'use strict';

var curves = exports;

var hash = require('hash.js');
var elliptic = require('../elliptic');

var assert = elliptic.utils.assert;

function PresetCurve(options) {
  if (options.type === 'short')
    this.curve = new elliptic.curve.short(options);
  else if (options.type === 'edwards')
    this.curve = new elliptic.curve.edwards(options);
  else
    this.curve = new elliptic.curve.mont(options);
  this.g = this.curve.g;
  this.n = this.curve.n;
  this.hash = options.hash;

  assert(this.g.validate(), 'Invalid curve');
  assert(this.g.mul(this.n).isInfinity(), 'Invalid curve, G*N != O');
}
curves.PresetCurve = PresetCurve;

function defineCurve(name, options) {
  Object.defineProperty(curves, name, {
    configurable: true,
    enumerable: true,
    get: function() {
      var curve = new PresetCurve(options);
      Object.defineProperty(curves, name, {
        configurable: true,
        enumerable: true,
        value: curve
      });
      return curve;
    }
  });
}

defineCurve('p192', {
  type: 'short',
  prime: 'p192',
  p: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff',
  a: 'ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc',
  b: '64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1',
  n: 'ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831',
  hash: hash.sha256,
  gRed: false,
  g: [
    '188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012',
    '07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811'
  ]
});

defineCurve('p224', {
  type: 'short',
  prime: 'p224',
  p: 'ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001',
  a: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe',
  b: 'b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4',
  n: 'ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d',
  hash: hash.sha256,
  gRed: false,
  g: [
    'b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21',
    'bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34'
  ]
});

defineCurve('p256', {
  type: 'short',
  prime: null,
  p: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff',
  a: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc',
  b: '5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b',
  n: 'ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551',
  hash: hash.sha256,
  gRed: false,
  g: [
    '6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296',
    '4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5'
  ]
});

defineCurve('p384', {
  type: 'short',
  prime: null,
  p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'fffffffe ffffffff 00000000 00000000 ffffffff',
  a: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'fffffffe ffffffff 00000000 00000000 fffffffc',
  b: 'b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f ' +
     '5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef',
  n: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 ' +
     'f4372ddf 581a0db2 48b0a77a ecec196a ccc52973',
  hash: hash.sha384,
  gRed: false,
  g: [
    'aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 ' +
    '5502f25d bf55296c 3a545e38 72760ab7',
    '3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 ' +
    '0a60b1ce 1d7e819d 7a431d7c 90ea0e5f'
  ]
});

defineCurve('p521', {
  type: 'short',
  prime: null,
  p: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff ffffffff ffffffff ffffffff',
  a: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff ffffffff ffffffff fffffffc',
  b: '00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b ' +
     '99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd ' +
     '3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00',
  n: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +
     'ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 ' +
     'f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409',
  hash: hash.sha512,
  gRed: false,
  g: [
    '000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 ' +
    '053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 ' +
    'a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66',
    '00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 ' +
    '579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 ' +
    '3fad0761 353c7086 a272c240 88be9476 9fd16650'
  ]
});

defineCurve('curve25519', {
  type: 'mont',
  prime: 'p25519',
  p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',
  a: '76d06',
  b: '1',
  n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',
  hash: hash.sha256,
  gRed: false,
  g: [
    '9'
  ]
});

defineCurve('ed25519', {
  type: 'edwards',
  prime: 'p25519',
  p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',
  a: '-1',
  c: '1',
  // -121665 * (121666^(-1)) (mod P)
  d: '52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3',
  n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',
  hash: hash.sha256,
  gRed: false,
  g: [
    '216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a',

    // 4/5
    '6666666666666666666666666666666666666666666666666666666666666658'
  ]
});

var pre;
try {
  pre = require('./precomputed/secp256k1');
} catch (e) {
  pre = undefined;
}

defineCurve('secp256k1', {
  type: 'short',
  prime: 'k256',
  p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f',
  a: '0',
  b: '7',
  n: 'ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141',
  h: '1',
  hash: hash.sha256,

  // Precomputed endomorphism
  beta: '7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee',
  lambda: '5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72',
  basis: [
    {
      a: '3086d221a7d46bcde86c90e49284eb15',
      b: '-e4437ed6010e88286f547fa90abfe4c3'
    },
    {
      a: '114ca50f7a8e2f3f657c1108d9d44cfd8',
      b: '3086d221a7d46bcde86c90e49284eb15'
    }
  ],

  gRed: false,
  g: [
    '79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798',
    '483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8',
    pre
  ]
});

},{"../elliptic":74,"./precomputed/secp256k1":87,"hash.js":93}],81:[function(require,module,exports){
'use strict';

var BN = require('bn.js');
var HmacDRBG = require('hmac-drbg');
var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;

var KeyPair = require('./key');
var Signature = require('./signature');

function EC(options) {
  if (!(this instanceof EC))
    return new EC(options);

  // Shortcut `elliptic.ec(curve-name)`
  if (typeof options === 'string') {
    assert(elliptic.curves.hasOwnProperty(options), 'Unknown curve ' + options);

    options = elliptic.curves[options];
  }

  // Shortcut for `elliptic.ec(elliptic.curves.curveName)`
  if (options instanceof elliptic.curves.PresetCurve)
    options = { curve: options };

  this.curve = options.curve.curve;
  this.n = this.curve.n;
  this.nh = this.n.ushrn(1);
  this.g = this.curve.g;

  // Point on curve
  this.g = options.curve.g;
  this.g.precompute(options.curve.n.bitLength() + 1);

  // Hash for function for DRBG
  this.hash = options.hash || options.curve.hash;
}
module.exports = EC;

EC.prototype.keyPair = function keyPair(options) {
  return new KeyPair(this, options);
};

EC.prototype.keyFromPrivate = function keyFromPrivate(priv, enc) {
  return KeyPair.fromPrivate(this, priv, enc);
};

EC.prototype.keyFromPublic = function keyFromPublic(pub, enc) {
  return KeyPair.fromPublic(this, pub, enc);
};

EC.prototype.genKeyPair = function genKeyPair(options) {
  if (!options)
    options = {};

  // Instantiate Hmac_DRBG
  var drbg = new HmacDRBG({
    hash: this.hash,
    pers: options.pers,
    persEnc: options.persEnc || 'utf8',
    entropy: options.entropy || elliptic.rand(this.hash.hmacStrength),
    entropyEnc: options.entropy && options.entropyEnc || 'utf8',
    nonce: this.n.toArray()
  });

  var bytes = this.n.byteLength();
  var ns2 = this.n.sub(new BN(2));
  do {
    var priv = new BN(drbg.generate(bytes));
    if (priv.cmp(ns2) > 0)
      continue;

    priv.iaddn(1);
    return this.keyFromPrivate(priv);
  } while (true);
};

EC.prototype._truncateToN = function truncateToN(msg, truncOnly) {
  var delta = msg.byteLength() * 8 - this.n.bitLength();
  if (delta > 0)
    msg = msg.ushrn(delta);
  if (!truncOnly && msg.cmp(this.n) >= 0)
    return msg.sub(this.n);
  else
    return msg;
};

EC.prototype.sign = function sign(msg, key, enc, options) {
  if (typeof enc === 'object') {
    options = enc;
    enc = null;
  }
  if (!options)
    options = {};

  key = this.keyFromPrivate(key, enc);
  msg = this._truncateToN(new BN(msg, 16));

  // Zero-extend key to provide enough entropy
  var bytes = this.n.byteLength();
  var bkey = key.getPrivate().toArray('be', bytes);

  // Zero-extend nonce to have the same byte size as N
  var nonce = msg.toArray('be', bytes);

  // Instantiate Hmac_DRBG
  var drbg = new HmacDRBG({
    hash: this.hash,
    entropy: bkey,
    nonce: nonce,
    pers: options.pers,
    persEnc: options.persEnc || 'utf8'
  });

  // Number of bytes to generate
  var ns1 = this.n.sub(new BN(1));

  for (var iter = 0; true; iter++) {
    var k = options.k ?
        options.k(iter) :
        new BN(drbg.generate(this.n.byteLength()));
    k = this._truncateToN(k, true);
    if (k.cmpn(1) <= 0 || k.cmp(ns1) >= 0)
      continue;

    var kp = this.g.mul(k);
    if (kp.isInfinity())
      continue;

    var kpX = kp.getX();
    var r = kpX.umod(this.n);
    if (r.cmpn(0) === 0)
      continue;

    var s = k.invm(this.n).mul(r.mul(key.getPrivate()).iadd(msg));
    s = s.umod(this.n);
    if (s.cmpn(0) === 0)
      continue;

    var recoveryParam = (kp.getY().isOdd() ? 1 : 0) |
                        (kpX.cmp(r) !== 0 ? 2 : 0);

    // Use complement of `s`, if it is > `n / 2`
    if (options.canonical && s.cmp(this.nh) > 0) {
      s = this.n.sub(s);
      recoveryParam ^= 1;
    }

    return new Signature({ r: r, s: s, recoveryParam: recoveryParam });
  }
};

EC.prototype.verify = function verify(msg, signature, key, enc) {
  msg = this._truncateToN(new BN(msg, 16));
  key = this.keyFromPublic(key, enc);
  signature = new Signature(signature, 'hex');

  // Perform primitive values validation
  var r = signature.r;
  var s = signature.s;
  if (r.cmpn(1) < 0 || r.cmp(this.n) >= 0)
    return false;
  if (s.cmpn(1) < 0 || s.cmp(this.n) >= 0)
    return false;

  // Validate signature
  var sinv = s.invm(this.n);
  var u1 = sinv.mul(msg).umod(this.n);
  var u2 = sinv.mul(r).umod(this.n);

  if (!this.curve._maxwellTrick) {
    var p = this.g.mulAdd(u1, key.getPublic(), u2);
    if (p.isInfinity())
      return false;

    return p.getX().umod(this.n).cmp(r) === 0;
  }

  // NOTE: Greg Maxwell's trick, inspired by:
  // https://git.io/vad3K

  var p = this.g.jmulAdd(u1, key.getPublic(), u2);
  if (p.isInfinity())
    return false;

  // Compare `p.x` of Jacobian point with `r`,
  // this will do `p.x == r * p.z^2` instead of multiplying `p.x` by the
  // inverse of `p.z^2`
  return p.eqXToP(r);
};

EC.prototype.recoverPubKey = function(msg, signature, j, enc) {
  assert((3 & j) === j, 'The recovery param is more than two bits');
  signature = new Signature(signature, enc);

  var n = this.n;
  var e = new BN(msg);
  var r = signature.r;
  var s = signature.s;

  // A set LSB signifies that the y-coordinate is odd
  var isYOdd = j & 1;
  var isSecondKey = j >> 1;
  if (r.cmp(this.curve.p.umod(this.curve.n)) >= 0 && isSecondKey)
    throw new Error('Unable to find sencond key candinate');

  // 1.1. Let x = r + jn.
  if (isSecondKey)
    r = this.curve.pointFromX(r.add(this.curve.n), isYOdd);
  else
    r = this.curve.pointFromX(r, isYOdd);

  var rInv = signature.r.invm(n);
  var s1 = n.sub(e).mul(rInv).umod(n);
  var s2 = s.mul(rInv).umod(n);

  // 1.6.1 Compute Q = r^-1 (sR -  eG)
  //               Q = r^-1 (sR + -eG)
  return this.g.mulAdd(s1, r, s2);
};

EC.prototype.getKeyRecoveryParam = function(e, signature, Q, enc) {
  signature = new Signature(signature, enc);
  if (signature.recoveryParam !== null)
    return signature.recoveryParam;

  for (var i = 0; i < 4; i++) {
    var Qprime;
    try {
      Qprime = this.recoverPubKey(e, signature, i);
    } catch (e) {
      continue;
    }

    if (Qprime.eq(Q))
      return i;
  }
  throw new Error('Unable to find valid recovery factor');
};

},{"../../elliptic":74,"./key":82,"./signature":83,"bn.js":21,"hmac-drbg":105}],82:[function(require,module,exports){
'use strict';

var BN = require('bn.js');
var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;

function KeyPair(ec, options) {
  this.ec = ec;
  this.priv = null;
  this.pub = null;

  // KeyPair(ec, { priv: ..., pub: ... })
  if (options.priv)
    this._importPrivate(options.priv, options.privEnc);
  if (options.pub)
    this._importPublic(options.pub, options.pubEnc);
}
module.exports = KeyPair;

KeyPair.fromPublic = function fromPublic(ec, pub, enc) {
  if (pub instanceof KeyPair)
    return pub;

  return new KeyPair(ec, {
    pub: pub,
    pubEnc: enc
  });
};

KeyPair.fromPrivate = function fromPrivate(ec, priv, enc) {
  if (priv instanceof KeyPair)
    return priv;

  return new KeyPair(ec, {
    priv: priv,
    privEnc: enc
  });
};

KeyPair.prototype.validate = function validate() {
  var pub = this.getPublic();

  if (pub.isInfinity())
    return { result: false, reason: 'Invalid public key' };
  if (!pub.validate())
    return { result: false, reason: 'Public key is not a point' };
  if (!pub.mul(this.ec.curve.n).isInfinity())
    return { result: false, reason: 'Public key * N != O' };

  return { result: true, reason: null };
};

KeyPair.prototype.getPublic = function getPublic(compact, enc) {
  // compact is optional argument
  if (typeof compact === 'string') {
    enc = compact;
    compact = null;
  }

  if (!this.pub)
    this.pub = this.ec.g.mul(this.priv);

  if (!enc)
    return this.pub;

  return this.pub.encode(enc, compact);
};

KeyPair.prototype.getPrivate = function getPrivate(enc) {
  if (enc === 'hex')
    return this.priv.toString(16, 2);
  else
    return this.priv;
};

KeyPair.prototype._importPrivate = function _importPrivate(key, enc) {
  this.priv = new BN(key, enc || 16);

  // Ensure that the priv won't be bigger than n, otherwise we may fail
  // in fixed multiplication method
  this.priv = this.priv.umod(this.ec.curve.n);
};

KeyPair.prototype._importPublic = function _importPublic(key, enc) {
  if (key.x || key.y) {
    // Montgomery points only have an `x` coordinate.
    // Weierstrass/Edwards points on the other hand have both `x` and
    // `y` coordinates.
    if (this.ec.curve.type === 'mont') {
      assert(key.x, 'Need x coordinate');
    } else if (this.ec.curve.type === 'short' ||
               this.ec.curve.type === 'edwards') {
      assert(key.x && key.y, 'Need both x and y coordinate');
    }
    this.pub = this.ec.curve.point(key.x, key.y);
    return;
  }
  this.pub = this.ec.curve.decodePoint(key, enc);
};

// ECDH
KeyPair.prototype.derive = function derive(pub) {
  return pub.mul(this.priv).getX();
};

// ECDSA
KeyPair.prototype.sign = function sign(msg, enc, options) {
  return this.ec.sign(msg, this, enc, options);
};

KeyPair.prototype.verify = function verify(msg, signature) {
  return this.ec.verify(msg, signature, this);
};

KeyPair.prototype.inspect = function inspect() {
  return '<Key priv: ' + (this.priv && this.priv.toString(16, 2)) +
         ' pub: ' + (this.pub && this.pub.inspect()) + ' >';
};

},{"../../elliptic":74,"bn.js":21}],83:[function(require,module,exports){
'use strict';

var BN = require('bn.js');

var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;

function Signature(options, enc) {
  if (options instanceof Signature)
    return options;

  if (this._importDER(options, enc))
    return;

  assert(options.r && options.s, 'Signature without r or s');
  this.r = new BN(options.r, 16);
  this.s = new BN(options.s, 16);
  if (options.recoveryParam === undefined)
    this.recoveryParam = null;
  else
    this.recoveryParam = options.recoveryParam;
}
module.exports = Signature;

function Position() {
  this.place = 0;
}

function getLength(buf, p) {
  var initial = buf[p.place++];
  if (!(initial & 0x80)) {
    return initial;
  }
  var octetLen = initial & 0xf;
  var val = 0;
  for (var i = 0, off = p.place; i < octetLen; i++, off++) {
    val <<= 8;
    val |= buf[off];
  }
  p.place = off;
  return val;
}

function rmPadding(buf) {
  var i = 0;
  var len = buf.length - 1;
  while (!buf[i] && !(buf[i + 1] & 0x80) && i < len) {
    i++;
  }
  if (i === 0) {
    return buf;
  }
  return buf.slice(i);
}

Signature.prototype._importDER = function _importDER(data, enc) {
  data = utils.toArray(data, enc);
  var p = new Position();
  if (data[p.place++] !== 0x30) {
    return false;
  }
  var len = getLength(data, p);
  if ((len + p.place) !== data.length) {
    return false;
  }
  if (data[p.place++] !== 0x02) {
    return false;
  }
  var rlen = getLength(data, p);
  var r = data.slice(p.place, rlen + p.place);
  p.place += rlen;
  if (data[p.place++] !== 0x02) {
    return false;
  }
  var slen = getLength(data, p);
  if (data.length !== slen + p.place) {
    return false;
  }
  var s = data.slice(p.place, slen + p.place);
  if (r[0] === 0 && (r[1] & 0x80)) {
    r = r.slice(1);
  }
  if (s[0] === 0 && (s[1] & 0x80)) {
    s = s.slice(1);
  }

  this.r = new BN(r);
  this.s = new BN(s);
  this.recoveryParam = null;

  return true;
};

function constructLength(arr, len) {
  if (len < 0x80) {
    arr.push(len);
    return;
  }
  var octets = 1 + (Math.log(len) / Math.LN2 >>> 3);
  arr.push(octets | 0x80);
  while (--octets) {
    arr.push((len >>> (octets << 3)) & 0xff);
  }
  arr.push(len);
}

Signature.prototype.toDER = function toDER(enc) {
  var r = this.r.toArray();
  var s = this.s.toArray();

  // Pad values
  if (r[0] & 0x80)
    r = [ 0 ].concat(r);
  // Pad values
  if (s[0] & 0x80)
    s = [ 0 ].concat(s);

  r = rmPadding(r);
  s = rmPadding(s);

  while (!s[0] && !(s[1] & 0x80)) {
    s = s.slice(1);
  }
  var arr = [ 0x02 ];
  constructLength(arr, r.length);
  arr = arr.concat(r);
  arr.push(0x02);
  constructLength(arr, s.length);
  var backHalf = arr.concat(s);
  var res = [ 0x30 ];
  constructLength(res, backHalf.length);
  res = res.concat(backHalf);
  return utils.encode(res, enc);
};

},{"../../elliptic":74,"bn.js":21}],84:[function(require,module,exports){
'use strict';

var hash = require('hash.js');
var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;
var parseBytes = utils.parseBytes;
var KeyPair = require('./key');
var Signature = require('./signature');

function EDDSA(curve) {
  assert(curve === 'ed25519', 'only tested with ed25519 so far');

  if (!(this instanceof EDDSA))
    return new EDDSA(curve);

  var curve = elliptic.curves[curve].curve;
  this.curve = curve;
  this.g = curve.g;
  this.g.precompute(curve.n.bitLength() + 1);

  this.pointClass = curve.point().constructor;
  this.encodingLength = Math.ceil(curve.n.bitLength() / 8);
  this.hash = hash.sha512;
}

module.exports = EDDSA;

/**
* @param {Array|String} message - message bytes
* @param {Array|String|KeyPair} secret - secret bytes or a keypair
* @returns {Signature} - signature
*/
EDDSA.prototype.sign = function sign(message, secret) {
  message = parseBytes(message);
  var key = this.keyFromSecret(secret);
  var r = this.hashInt(key.messagePrefix(), message);
  var R = this.g.mul(r);
  var Rencoded = this.encodePoint(R);
  var s_ = this.hashInt(Rencoded, key.pubBytes(), message)
               .mul(key.priv());
  var S = r.add(s_).umod(this.curve.n);
  return this.makeSignature({ R: R, S: S, Rencoded: Rencoded });
};

/**
* @param {Array} message - message bytes
* @param {Array|String|Signature} sig - sig bytes
* @param {Array|String|Point|KeyPair} pub - public key
* @returns {Boolean} - true if public key matches sig of message
*/
EDDSA.prototype.verify = function verify(message, sig, pub) {
  message = parseBytes(message);
  sig = this.makeSignature(sig);
  var key = this.keyFromPublic(pub);
  var h = this.hashInt(sig.Rencoded(), key.pubBytes(), message);
  var SG = this.g.mul(sig.S());
  var RplusAh = sig.R().add(key.pub().mul(h));
  return RplusAh.eq(SG);
};

EDDSA.prototype.hashInt = function hashInt() {
  var hash = this.hash();
  for (var i = 0; i < arguments.length; i++)
    hash.update(arguments[i]);
  return utils.intFromLE(hash.digest()).umod(this.curve.n);
};

EDDSA.prototype.keyFromPublic = function keyFromPublic(pub) {
  return KeyPair.fromPublic(this, pub);
};

EDDSA.prototype.keyFromSecret = function keyFromSecret(secret) {
  return KeyPair.fromSecret(this, secret);
};

EDDSA.prototype.makeSignature = function makeSignature(sig) {
  if (sig instanceof Signature)
    return sig;
  return new Signature(this, sig);
};

/**
* * https://tools.ietf.org/html/draft-josefsson-eddsa-ed25519-03#section-5.2
*
* EDDSA defines methods for encoding and decoding points and integers. These are
* helper convenience methods, that pass along to utility functions implied
* parameters.
*
*/
EDDSA.prototype.encodePoint = function encodePoint(point) {
  var enc = point.getY().toArray('le', this.encodingLength);
  enc[this.encodingLength - 1] |= point.getX().isOdd() ? 0x80 : 0;
  return enc;
};

EDDSA.prototype.decodePoint = function decodePoint(bytes) {
  bytes = utils.parseBytes(bytes);

  var lastIx = bytes.length - 1;
  var normed = bytes.slice(0, lastIx).concat(bytes[lastIx] & ~0x80);
  var xIsOdd = (bytes[lastIx] & 0x80) !== 0;

  var y = utils.intFromLE(normed);
  return this.curve.pointFromY(y, xIsOdd);
};

EDDSA.prototype.encodeInt = function encodeInt(num) {
  return num.toArray('le', this.encodingLength);
};

EDDSA.prototype.decodeInt = function decodeInt(bytes) {
  return utils.intFromLE(bytes);
};

EDDSA.prototype.isPoint = function isPoint(val) {
  return val instanceof this.pointClass;
};

},{"../../elliptic":74,"./key":85,"./signature":86,"hash.js":93}],85:[function(require,module,exports){
'use strict';

var elliptic = require('../../elliptic');
var utils = elliptic.utils;
var assert = utils.assert;
var parseBytes = utils.parseBytes;
var cachedProperty = utils.cachedProperty;

/**
* @param {EDDSA} eddsa - instance
* @param {Object} params - public/private key parameters
*
* @param {Array<Byte>} [params.secret] - secret seed bytes
* @param {Point} [params.pub] - public key point (aka `A` in eddsa terms)
* @param {Array<Byte>} [params.pub] - public key point encoded as bytes
*
*/
function KeyPair(eddsa,params){this.eddsa=eddsa;this._secret=parseBytes(params.secret);if(eddsa.isPoint(params.pub))
this._pub=params.pub;else this._pubBytes=parseBytes(params.pub)}
KeyPair.fromPublic=function fromPublic(eddsa,pub){if(pub instanceof KeyPair)
return pub;return new KeyPair(eddsa,{pub:pub})};KeyPair.fromSecret=function fromSecret(eddsa,secret){if(secret instanceof KeyPair)
return secret;return new KeyPair(eddsa,{secret:secret})};KeyPair.prototype.secret=function secret(){return this._secret};cachedProperty(KeyPair,'pubBytes',function pubBytes(){return this.eddsa.encodePoint(this.pub())});cachedProperty(KeyPair,'pub',function pub(){if(this._pubBytes)
return this.eddsa.decodePoint(this._pubBytes);return this.eddsa.g.mul(this.priv())});cachedProperty(KeyPair,'privBytes',function privBytes(){var eddsa=this.eddsa;var hash=this.hash();var lastIx=eddsa.encodingLength-1;var a=hash.slice(0,eddsa.encodingLength);a[0]&=248;a[lastIx]&=127;a[lastIx]|=64;return a});cachedProperty(KeyPair,'priv',function priv(){return this.eddsa.decodeInt(this.privBytes())});cachedProperty(KeyPair,'hash',function hash(){return this.eddsa.hash().update(this.secret()).digest()});cachedProperty(KeyPair,'messagePrefix',function messagePrefix(){return this.hash().slice(this.eddsa.encodingLength)});KeyPair.prototype.sign=function sign(message){assert(this._secret,'KeyPair can only verify');return this.eddsa.sign(message,this)};KeyPair.prototype.verify=function verify(message,sig){return this.eddsa.verify(message,sig,this)};KeyPair.prototype.getSecret=function getSecret(enc){assert(this._secret,'KeyPair is public only');return utils.encode(this.secret(),enc)};KeyPair.prototype.getPublic=function getPublic(enc){return utils.encode(this.pubBytes(),enc)};module.exports=KeyPair},{"../../elliptic":74}],86:[function(require,module,exports){'use strict';var BN=require('bn.js');var elliptic=require('../../elliptic');var utils=elliptic.utils;var assert=utils.assert;var cachedProperty=utils.cachedProperty;var parseBytes=utils.parseBytes;function Signature(eddsa,sig){this.eddsa=eddsa;if(typeof sig!=='object')
sig=parseBytes(sig);if(Array.isArray(sig)){sig={R:sig.slice(0,eddsa.encodingLength),S:sig.slice(eddsa.encodingLength)}}
assert(sig.R&&sig.S,'Signature without R or S');if(eddsa.isPoint(sig.R))
this._R=sig.R;if(sig.S instanceof BN)
this._S=sig.S;this._Rencoded=Array.isArray(sig.R)?sig.R:sig.Rencoded;this._Sencoded=Array.isArray(sig.S)?sig.S:sig.Sencoded}
cachedProperty(Signature,'S',function S(){return this.eddsa.decodeInt(this.Sencoded())});cachedProperty(Signature,'R',function R(){return this.eddsa.decodePoint(this.Rencoded())});cachedProperty(Signature,'Rencoded',function Rencoded(){return this.eddsa.encodePoint(this.R())});cachedProperty(Signature,'Sencoded',function Sencoded(){return this.eddsa.encodeInt(this.S())});Signature.prototype.toBytes=function toBytes(){return this.Rencoded().concat(this.Sencoded())};Signature.prototype.toHex=function toHex(){return utils.encode(this.toBytes(),'hex').toUpperCase()};module.exports=Signature},{"../../elliptic":74,"bn.js":21}],87:[function(require,module,exports){module.exports={doubles:{step:4,points:[['e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a','f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821'],['8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508','11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf'],['175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739','d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695'],['363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640','4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9'],['8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c','4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36'],['723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda','96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f'],['eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa','5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999'],['100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0','cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09'],['e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d','9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d'],['feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d','e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088'],['da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1','9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d'],['53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0','5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8'],['8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047','10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a'],['385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862','283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453'],['6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7','7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160'],['3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd','56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0'],['85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83','7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6'],['948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a','53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589'],['6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8','bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17'],['e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d','4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda'],['e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725','7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd'],['213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754','4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2'],['4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c','17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6'],['fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6','6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f'],['76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39','c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01'],['c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891','893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3'],['d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b','febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f'],['b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03','2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7'],['e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d','eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78'],['a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070','7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1'],['90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4','e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150'],['8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da','662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82'],['e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11','1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc'],['8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e','efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b'],['e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41','2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51'],['b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef','67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45'],['d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8','db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120'],['324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d','648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84'],['4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96','35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d'],['9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd','ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d'],['6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5','9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8'],['a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266','40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8'],['7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71','34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac'],['928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac','c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f'],['85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751','1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962'],['ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e','493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907'],['827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241','c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec'],['eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3','be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d'],['e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f','4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414'],['1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19','aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd'],['146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be','b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0'],['fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9','6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811'],['da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2','8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1'],['a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13','7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c'],['174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c','ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73'],['959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba','2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd'],['d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151','e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405'],['64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073','d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589'],['8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458','38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e'],['13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b','69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27'],['bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366','d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1'],['8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa','40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482'],['8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0','620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945'],['dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787','7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573'],['f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e','ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82']]},naf:{wnd:7,points:[['f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9','388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672'],['2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4','d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6'],['5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc','6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da'],['acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe','cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37'],['774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb','d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b'],['f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8','ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81'],['d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e','581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58'],['defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34','4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77'],['2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c','85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a'],['352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5','321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c'],['2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f','2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67'],['9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714','73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402'],['daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729','a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55'],['c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db','2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482'],['6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4','e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82'],['1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5','b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396'],['605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479','2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49'],['62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d','80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf'],['80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f','1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a'],['7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb','d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7'],['d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9','eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933'],['49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963','758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a'],['77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74','958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6'],['f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530','e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37'],['463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b','5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e'],['f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247','cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6'],['caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1','cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476'],['2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120','4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40'],['7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435','91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61'],['754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18','673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683'],['e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8','59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5'],['186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb','3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b'],['df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f','55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417'],['5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143','efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868'],['290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba','e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a'],['af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45','f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6'],['766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a','744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996'],['59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e','c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e'],['f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8','e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d'],['7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c','30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2'],['948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519','e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e'],['7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab','100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437'],['3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca','ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311'],['d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf','8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4'],['1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610','68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575'],['733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4','f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d'],['15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c','d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d'],['a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940','edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629'],['e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980','a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06'],['311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3','66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374'],['34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf','9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee'],['f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63','4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1'],['d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448','fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b'],['32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf','5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661'],['7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5','8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6'],['ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6','8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e'],['16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5','5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d'],['eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99','f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc'],['78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51','f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4'],['494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5','42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c'],['a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5','204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b'],['c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997','4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913'],['841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881','73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154'],['5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5','39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865'],['36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66','d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc'],['336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726','ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224'],['8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede','6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e'],['1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94','60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6'],['85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31','3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511'],['29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51','b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b'],['a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252','ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2'],['4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5','cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c'],['d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b','6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3'],['ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4','322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d'],['af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f','6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700'],['e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889','2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4'],['591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246','b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196'],['11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984','998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4'],['3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a','b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257'],['cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030','bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13'],['c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197','6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096'],['c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593','c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38'],['a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef','21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f'],['347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38','60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448'],['da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a','49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a'],['c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111','5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4'],['4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502','7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437'],['3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea','be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7'],['cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26','8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d'],['b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986','39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a'],['d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e','62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54'],['48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4','25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77'],['dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda','ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517'],['6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859','cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10'],['e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f','f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125'],['eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c','6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e'],['13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942','fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1'],['ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a','1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2'],['b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80','5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423'],['ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d','438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8'],['8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1','cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758'],['52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63','c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375'],['e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352','6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d'],['7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193','ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec'],['5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00','9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0'],['32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58','ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c'],['e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7','d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4'],['8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8','c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f'],['4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e','67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649'],['3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d','cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826'],['674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b','299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5'],['d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f','f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87'],['30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6','462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b'],['be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297','62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc'],['93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a','7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c'],['b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c','ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f'],['d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52','4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a'],['d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb','bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46'],['463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065','bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f'],['7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917','603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03'],['74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9','cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08'],['30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3','553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8'],['9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57','712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373'],['176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66','ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3'],['75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8','9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8'],['809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721','9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1'],['1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180','4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9']]}}},{}],88:[function(require,module,exports){'use strict';var utils=exports;var BN=require('bn.js');var minAssert=require('minimalistic-assert');var minUtils=require('minimalistic-crypto-utils');utils.assert=minAssert;utils.toArray=minUtils.toArray;utils.zero2=minUtils.zero2;utils.toHex=minUtils.toHex;utils.encode=minUtils.encode;function getNAF(num,w){var naf=[];var ws=1<<(w+1);var k=num.clone();while(k.cmpn(1)>=0){var z;if(k.isOdd()){var mod=k.andln(ws-1);if(mod>(ws>>1)-1)
z=(ws>>1)-mod;else z=mod;k.isubn(z)}else{z=0}
naf.push(z);var shift=(k.cmpn(0)!==0&&k.andln(ws-1)===0)?(w+1):1;for(var i=1;i<shift;i++)
naf.push(0);k.iushrn(shift)}
return naf}
utils.getNAF=getNAF;function getJSF(k1,k2){var jsf=[[],[]];k1=k1.clone();k2=k2.clone();var d1=0;var d2=0;while(k1.cmpn(-d1)>0||k2.cmpn(-d2)>0){var m14=(k1.andln(3)+d1)&3;var m24=(k2.andln(3)+d2)&3;if(m14===3)
m14=-1;if(m24===3)
m24=-1;var u1;if((m14&1)===0){u1=0}else{var m8=(k1.andln(7)+d1)&7;if((m8===3||m8===5)&&m24===2)
u1=-m14;else u1=m14}
jsf[0].push(u1);var u2;if((m24&1)===0){u2=0}else{var m8=(k2.andln(7)+d2)&7;if((m8===3||m8===5)&&m14===2)
u2=-m24;else u2=m24}
jsf[1].push(u2);if(2*d1===u1+1)
d1=1-d1;if(2*d2===u2+1)
d2=1-d2;k1.iushrn(1);k2.iushrn(1)}
return jsf}
utils.getJSF=getJSF;function cachedProperty(obj,name,computer){var key='_'+name;obj.prototype[name]=function cachedProperty(){return this[key]!==undefined?this[key]:this[key]=computer.call(this)}}
utils.cachedProperty=cachedProperty;function parseBytes(bytes){return typeof bytes==='string'?utils.toArray(bytes,'hex'):bytes}
utils.parseBytes=parseBytes;function intFromLE(bytes){return new BN(bytes,'hex','le')}
utils.intFromLE=intFromLE},{"bn.js":21,"minimalistic-assert":113,"minimalistic-crypto-utils":114}],89:[function(require,module,exports){module.exports={"_from":"elliptic@^6.0.0","_id":"elliptic@6.4.1","_inBundle":!1,"_integrity":"sha512-BsXLz5sqX8OHcsh7CqBMztyXARmGQ3LWPtGjJi6DiJHq5C/qvi9P3OqgswKSDftbu8+IoI/QDTAm2fFnQ9SZSQ==","_location":"/browserify/elliptic","_phantomChildren":{},"_requested":{"type":"range","registry":!0,"raw":"elliptic@^6.0.0","name":"elliptic","escapedName":"elliptic","rawSpec":"^6.0.0","saveSpec":null,"fetchSpec":"^6.0.0"},"_requiredBy":["/browserify/browserify-sign","/browserify/create-ecdh"],"_resolved":"https://registry.npmjs.org/elliptic/-/elliptic-6.4.1.tgz","_shasum":"c2d0b7776911b86722c632c3c06c60f2f819939a","_spec":"elliptic@^6.0.0","_where":"C:\\Program Files\\nodejs\\node_modules\\browserify\\node_modules\\browserify-sign","author":{"name":"Fedor Indutny","email":"fedor@indutny.com"},"bugs":{"url":"https://github.com/indutny/elliptic/issues"},"bundleDependencies":!1,"dependencies":{"bn.js":"^4.4.0","brorand":"^1.0.1","hash.js":"^1.0.0","hmac-drbg":"^1.0.0","inherits":"^2.0.1","minimalistic-assert":"^1.0.0","minimalistic-crypto-utils":"^1.0.0"},"deprecated":!1,"description":"EC cryptography","devDependencies":{"brfs":"^1.4.3","coveralls":"^2.11.3","grunt":"^0.4.5","grunt-browserify":"^5.0.0","grunt-cli":"^1.2.0","grunt-contrib-connect":"^1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^1.0.1","grunt-mocha-istanbul":"^3.0.1","grunt-saucelabs":"^8.6.2","istanbul":"^0.4.2","jscs":"^2.9.0","jshint":"^2.6.0","mocha":"^2.1.0"},"files":["lib"],"homepage":"https://github.com/indutny/elliptic","keywords":["EC","Elliptic","curve","Cryptography"],"license":"MIT","main":"lib/elliptic.js","name":"elliptic","repository":{"type":"git","url":"git+ssh://git@github.com/indutny/elliptic.git"},"scripts":{"jscs":"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js","jshint":"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js","lint":"npm run jscs && npm run jshint","test":"npm run lint && npm run unit","unit":"istanbul test _mocha --reporter=spec test/index.js","version":"grunt dist && git add dist/"},"version":"6.4.1"}},{}],90:[function(require,module,exports){var objectCreate=Object.create||objectCreatePolyfill
var objectKeys=Object.keys||objectKeysPolyfill
var bind=Function.prototype.bind||functionBindPolyfill
function EventEmitter(){if(!this._events||!Object.prototype.hasOwnProperty.call(this,'_events')){this._events=objectCreate(null);this._eventsCount=0}
this._maxListeners=this._maxListeners||undefined}
module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;var hasDefineProperty;try{var o={};if(Object.defineProperty)Object.defineProperty(o,'x',{value:0});hasDefineProperty=o.x===0}catch(err){hasDefineProperty=!1}
if(hasDefineProperty){Object.defineProperty(EventEmitter,'defaultMaxListeners',{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if(typeof arg!=='number'||arg<0||arg!==arg)
throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}})}else{EventEmitter.defaultMaxListeners=defaultMaxListeners}
EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=='number'||n<0||isNaN(n))
throw new TypeError('"n" argument must be a positive number');this._maxListeners=n;return this};function $getMaxListeners(that){if(that._maxListeners===undefined)
return EventEmitter.defaultMaxListeners;return that._maxListeners}
EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)};function emitNone(handler,isFn,self){if(isFn)
handler.call(self);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)
listeners[i].call(self);}}
function emitOne(handler,isFn,self,arg1){if(isFn)
handler.call(self,arg1);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)
listeners[i].call(self,arg1);}}
function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)
handler.call(self,arg1,arg2);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)
listeners[i].call(self,arg1,arg2);}}
function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)
handler.call(self,arg1,arg2,arg3);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)
listeners[i].call(self,arg1,arg2,arg3);}}
function emitMany(handler,isFn,self,args){if(isFn)
handler.apply(self,args);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)
listeners[i].apply(self,args);}}
EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events;var doError=(type==='error');events=this._events;if(events)
doError=(doError&&events.error==null);else if(!doError)
return!1;if(doError){if(arguments.length>1)
er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Unhandled "error" event. ('+er+')');err.context=er;throw err}
return!1}
handler=events[type];if(!handler)
return!1;var isFn=typeof handler==='function';len=arguments.length;switch(len){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:args=new Array(len-1);for(i=1;i<len;i++)
args[i-1]=arguments[i];emitMany(handler,isFn,this,args)}
return!0};function _addListener(target,type,listener,prepend){var m;var events;var existing;if(typeof listener!=='function')
throw new TypeError('"listener" argument must be a function');events=target._events;if(!events){events=target._events=objectCreate(null);target._eventsCount=0}else{if(events.newListener){target.emit('newListener',type,listener.listener?listener.listener:listener);events=target._events}
existing=events[type]}
if(!existing){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==='function'){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else{if(prepend){existing.unshift(listener)}else{existing.push(listener)}}
if(!existing.warned){m=$getMaxListeners(target);if(m&&m>0&&existing.length>m){existing.warned=!0;var w=new Error('Possible EventEmitter memory leak detected. '+existing.length+' "'+String(type)+'" listeners '+'added. Use emitter.setMaxListeners() to '+'increase limit.');w.name='MaxListenersExceededWarning';w.emitter=target;w.type=type;w.count=existing.length;if(typeof console==='object'&&console.warn){console.warn('%s: %s',w.name,w.message)}}}}
return target}
EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,!0)};function onceWrapper(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=!0;switch(arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:var args=new Array(arguments.length);for(var i=0;i<args.length;++i)
args[i]=arguments[i];this.listener.apply(this.target,args)}}}
function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=bind.call(onceWrapper,state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped}
EventEmitter.prototype.once=function once(type,listener){if(typeof listener!=='function')
throw new TypeError('"listener" argument must be a function');this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if(typeof listener!=='function')
throw new TypeError('"listener" argument must be a function');this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(typeof listener!=='function')
throw new TypeError('"listener" argument must be a function');events=this._events;if(!events)
return this;list=events[type];if(!list)
return this;if(list===listener||list.listener===listener){if(--this._eventsCount===0)
this._events=objectCreate(null);else{delete events[type];if(events.removeListener)
this.emit('removeListener',type,list.listener||listener)}}else if(typeof list!=='function'){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break}}
if(position<0)
return this;if(position===0)
list.shift();else spliceOne(list,position);if(list.length===1)
events[type]=list[0];if(events.removeListener)
this.emit('removeListener',type,originalListener||listener)}
return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(!events)
return this;if(!events.removeListener){if(arguments.length===0){this._events=objectCreate(null);this._eventsCount=0}else if(events[type]){if(--this._eventsCount===0)
this._events=objectCreate(null);else delete events[type]}
return this}
if(arguments.length===0){var keys=objectKeys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==='removeListener')continue;this.removeAllListeners(key)}
this.removeAllListeners('removeListener');this._events=objectCreate(null);this._eventsCount=0;return this}
listeners=events[type];if(typeof listeners==='function'){this.removeListener(type,listeners)}else if(listeners){for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i])}}
return this};function _listeners(target,type,unwrap){var events=target._events;if(!events)
return[];var evlistener=events[type];if(!evlistener)
return[];if(typeof evlistener==='function')
return unwrap?[evlistener.listener||evlistener]:[evlistener];return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length)}
EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,!0)};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,!1)};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==='function'){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if(typeof evlistener==='function'){return 1}else if(evlistener){return evlistener.length}}
return 0}
EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)
list[i]=list[k];list.pop()}
function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i)
copy[i]=arr[i];return copy}
function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i]}
return ret}
function objectCreatePolyfill(proto){var F=function(){};F.prototype=proto;return new F}
function objectKeysPolyfill(obj){var keys=[];for(var k in obj)if(Object.prototype.hasOwnProperty.call(obj,k)){keys.push(k)}
return k}
function functionBindPolyfill(context){var fn=this;return function(){return fn.apply(context,arguments)}}},{}],91:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
var MD5=require('md5.js')
function EVP_BytesToKey(password,salt,keyBits,ivLen){if(!Buffer.isBuffer(password))password=Buffer.from(password,'binary')
if(salt){if(!Buffer.isBuffer(salt))salt=Buffer.from(salt,'binary')
if(salt.length!==8)throw new RangeError('salt should be Buffer with 8 byte length')}
var keyLen=keyBits/8
var key=Buffer.alloc(keyLen)
var iv=Buffer.alloc(ivLen||0)
var tmp=Buffer.alloc(0)
while(keyLen>0||ivLen>0){var hash=new MD5()
hash.update(tmp)
hash.update(password)
if(salt)hash.update(salt)
tmp=hash.digest()
var used=0
if(keyLen>0){var keyStart=key.length-keyLen
used=Math.min(keyLen,tmp.length)
tmp.copy(key,keyStart,0,used)
keyLen-=used}
if(used<tmp.length&&ivLen>0){var ivStart=iv.length-ivLen
var length=Math.min(ivLen,tmp.length-used)
tmp.copy(iv,ivStart,used,used+length)
ivLen-=length}}
tmp.fill(0)
return{key:key,iv:iv}}
module.exports=EVP_BytesToKey},{"md5.js":111,"safe-buffer":167}],92:[function(require,module,exports){'use strict'
var Buffer=require('safe-buffer').Buffer
var Transform=require('stream').Transform
var inherits=require('inherits')
function throwIfNotStringOrBuffer(val,prefix){if(!Buffer.isBuffer(val)&&typeof val!=='string'){throw new TypeError(prefix+' must be a string or a buffer')}}
function HashBase(blockSize){Transform.call(this)
this._block=Buffer.allocUnsafe(blockSize)
this._blockSize=blockSize
this._blockOffset=0
this._length=[0,0,0,0]
this._finalized=!1}
inherits(HashBase,Transform)
HashBase.prototype._transform=function(chunk,encoding,callback){var error=null
try{this.update(chunk,encoding)}catch(err){error=err}
callback(error)}
HashBase.prototype._flush=function(callback){var error=null
try{this.push(this.digest())}catch(err){error=err}
callback(error)}
HashBase.prototype.update=function(data,encoding){throwIfNotStringOrBuffer(data,'Data')
if(this._finalized)throw new Error('Digest already called')
if(!Buffer.isBuffer(data))data=Buffer.from(data,encoding)
var block=this._block
var offset=0
while(this._blockOffset+data.length-offset>=this._blockSize){for(var i=this._blockOffset;i<this._blockSize;)block[i++]=data[offset++]
this._update()
this._blockOffset=0}
while(offset<data.length)block[this._blockOffset++]=data[offset++]
for(var j=0,carry=data.length*8;carry>0;++j){this._length[j]+=carry
carry=(this._length[j]/0x0100000000)|0
if(carry>0)this._length[j]-=0x0100000000*carry}
return this}
HashBase.prototype._update=function(){throw new Error('_update is not implemented')}
HashBase.prototype.digest=function(encoding){if(this._finalized)throw new Error('Digest already called')
this._finalized=!0
var digest=this._digest()
if(encoding!==undefined)digest=digest.toString(encoding)
this._block.fill(0)
this._blockOffset=0
for(var i=0;i<4;++i)this._length[i]=0
return digest}
HashBase.prototype._digest=function(){throw new Error('_digest is not implemented')}
module.exports=HashBase},{"inherits":108,"safe-buffer":167,"stream":176}],93:[function(require,module,exports){var hash=exports;hash.utils=require('./hash/utils');hash.common=require('./hash/common');hash.sha=require('./hash/sha');hash.ripemd=require('./hash/ripemd');hash.hmac=require('./hash/hmac');hash.sha1=hash.sha.sha1;hash.sha256=hash.sha.sha256;hash.sha224=hash.sha.sha224;hash.sha384=hash.sha.sha384;hash.sha512=hash.sha.sha512;hash.ripemd160=hash.ripemd.ripemd160},{"./hash/common":94,"./hash/hmac":95,"./hash/ripemd":96,"./hash/sha":97,"./hash/utils":104}],94:[function(require,module,exports){'use strict';var utils=require('./utils');var assert=require('minimalistic-assert');function BlockHash(){this.pending=null;this.pendingTotal=0;this.blockSize=this.constructor.blockSize;this.outSize=this.constructor.outSize;this.hmacStrength=this.constructor.hmacStrength;this.padLength=this.constructor.padLength/8;this.endian='big';this._delta8=this.blockSize/8;this._delta32=this.blockSize/32}
exports.BlockHash=BlockHash;BlockHash.prototype.update=function update(msg,enc){msg=utils.toArray(msg,enc);if(!this.pending)
this.pending=msg;else this.pending=this.pending.concat(msg);this.pendingTotal+=msg.length;if(this.pending.length>=this._delta8){msg=this.pending;var r=msg.length%this._delta8;this.pending=msg.slice(msg.length-r,msg.length);if(this.pending.length===0)
this.pending=null;msg=utils.join32(msg,0,msg.length-r,this.endian);for(var i=0;i<msg.length;i+=this._delta32)
this._update(msg,i,i+this._delta32);}
return this};BlockHash.prototype.digest=function digest(enc){this.update(this._pad());assert(this.pending===null);return this._digest(enc)};BlockHash.prototype._pad=function pad(){var len=this.pendingTotal;var bytes=this._delta8;var k=bytes-((len+this.padLength)%bytes);var res=new Array(k+this.padLength);res[0]=0x80;for(var i=1;i<k;i++)
res[i]=0;len<<=3;if(this.endian==='big'){for(var t=8;t<this.padLength;t++)
res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=(len>>>24)&0xff;res[i++]=(len>>>16)&0xff;res[i++]=(len>>>8)&0xff;res[i++]=len&0xff}else{res[i++]=len&0xff;res[i++]=(len>>>8)&0xff;res[i++]=(len>>>16)&0xff;res[i++]=(len>>>24)&0xff;res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=0;for(t=8;t<this.padLength;t++)
res[i++]=0}
return res}},{"./utils":104,"minimalistic-assert":113}],95:[function(require,module,exports){'use strict';var utils=require('./utils');var assert=require('minimalistic-assert');function Hmac(hash,key,enc){if(!(this instanceof Hmac))
return new Hmac(hash,key,enc);this.Hash=hash;this.blockSize=hash.blockSize/8;this.outSize=hash.outSize/8;this.inner=null;this.outer=null;this._init(utils.toArray(key,enc))}
module.exports=Hmac;Hmac.prototype._init=function init(key){if(key.length>this.blockSize)
key=new this.Hash().update(key).digest();assert(key.length<=this.blockSize);for(var i=key.length;i<this.blockSize;i++)
key.push(0);for(i=0;i<key.length;i++)
key[i]^=0x36;this.inner=new this.Hash().update(key);for(i=0;i<key.length;i++)
key[i]^=0x6a;this.outer=new this.Hash().update(key)};Hmac.prototype.update=function update(msg,enc){this.inner.update(msg,enc);return this};Hmac.prototype.digest=function digest(enc){this.outer.update(this.inner.digest());return this.outer.digest(enc)}},{"./utils":104,"minimalistic-assert":113}],96:[function(require,module,exports){'use strict';var utils=require('./utils');var common=require('./common');var rotl32=utils.rotl32;var sum32=utils.sum32;var sum32_3=utils.sum32_3;var sum32_4=utils.sum32_4;var BlockHash=common.BlockHash;function RIPEMD160(){if(!(this instanceof RIPEMD160))
return new RIPEMD160();BlockHash.call(this);this.h=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0];this.endian='little'}
utils.inherits(RIPEMD160,BlockHash);exports.ripemd160=RIPEMD160;RIPEMD160.blockSize=512;RIPEMD160.outSize=160;RIPEMD160.hmacStrength=192;RIPEMD160.padLength=64;RIPEMD160.prototype._update=function update(msg,start){var A=this.h[0];var B=this.h[1];var C=this.h[2];var D=this.h[3];var E=this.h[4];var Ah=A;var Bh=B;var Ch=C;var Dh=D;var Eh=E;for(var j=0;j<80;j++){var T=sum32(rotl32(sum32_4(A,f(j,B,C,D),msg[r[j]+start],K(j)),s[j]),E);A=E;E=D;D=rotl32(C,10);C=B;B=T;T=sum32(rotl32(sum32_4(Ah,f(79-j,Bh,Ch,Dh),msg[rh[j]+start],Kh(j)),sh[j]),Eh);Ah=Eh;Eh=Dh;Dh=rotl32(Ch,10);Ch=Bh;Bh=T}
T=sum32_3(this.h[1],C,Dh);this.h[1]=sum32_3(this.h[2],D,Eh);this.h[2]=sum32_3(this.h[3],E,Ah);this.h[3]=sum32_3(this.h[4],A,Bh);this.h[4]=sum32_3(this.h[0],B,Ch);this.h[0]=T};RIPEMD160.prototype._digest=function digest(enc){if(enc==='hex')
return utils.toHex32(this.h,'little');else return utils.split32(this.h,'little')};function f(j,x,y,z){if(j<=15)
return x^y^z;else if(j<=31)
return(x&y)|((~x)&z);else if(j<=47)
return(x|(~y))^z;else if(j<=63)
return(x&z)|(y&(~z));else return x^(y|(~z))}
function K(j){if(j<=15)
return 0x00000000;else if(j<=31)
return 0x5a827999;else if(j<=47)
return 0x6ed9eba1;else if(j<=63)
return 0x8f1bbcdc;else return 0xa953fd4e}
function Kh(j){if(j<=15)
return 0x50a28be6;else if(j<=31)
return 0x5c4dd124;else if(j<=47)
return 0x6d703ef3;else if(j<=63)
return 0x7a6d76e9;else return 0x00000000}
var r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13];var rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11];var s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6];var sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},{"./common":94,"./utils":104}],97:[function(require,module,exports){'use strict';exports.sha1=require('./sha/1');exports.sha224=require('./sha/224');exports.sha256=require('./sha/256');exports.sha384=require('./sha/384');exports.sha512=require('./sha/512')},{"./sha/1":98,"./sha/224":99,"./sha/256":100,"./sha/384":101,"./sha/512":102}],98:[function(require,module,exports){'use strict';var utils=require('../utils');var common=require('../common');var shaCommon=require('./common');var rotl32=utils.rotl32;var sum32=utils.sum32;var sum32_5=utils.sum32_5;var ft_1=shaCommon.ft_1;var BlockHash=common.BlockHash;var sha1_K=[0x5A827999,0x6ED9EBA1,0x8F1BBCDC,0xCA62C1D6];function SHA1(){if(!(this instanceof SHA1))
return new SHA1();BlockHash.call(this);this.h=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0];this.W=new Array(80)}
utils.inherits(SHA1,BlockHash);module.exports=SHA1;SHA1.blockSize=512;SHA1.outSize=160;SHA1.hmacStrength=80;SHA1.padLength=64;SHA1.prototype._update=function _update(msg,start){var W=this.W;for(var i=0;i<16;i++)
W[i]=msg[start+i];for(;i<W.length;i++)
W[i]=rotl32(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);var a=this.h[0];var b=this.h[1];var c=this.h[2];var d=this.h[3];var e=this.h[4];for(i=0;i<W.length;i++){var s=~~(i/20);var t=sum32_5(rotl32(a,5),ft_1(s,b,c,d),e,W[i],sha1_K[s]);e=d;d=c;c=rotl32(b,30);b=a;a=t}
this.h[0]=sum32(this.h[0],a);this.h[1]=sum32(this.h[1],b);this.h[2]=sum32(this.h[2],c);this.h[3]=sum32(this.h[3],d);this.h[4]=sum32(this.h[4],e)};SHA1.prototype._digest=function digest(enc){if(enc==='hex')
return utils.toHex32(this.h,'big');else return utils.split32(this.h,'big')}},{"../common":94,"../utils":104,"./common":103}],99:[function(require,module,exports){'use strict';var utils=require('../utils');var SHA256=require('./256');function SHA224(){if(!(this instanceof SHA224))
return new SHA224();SHA256.call(this);this.h=[0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]}
utils.inherits(SHA224,SHA256);module.exports=SHA224;SHA224.blockSize=512;SHA224.outSize=224;SHA224.hmacStrength=192;SHA224.padLength=64;SHA224.prototype._digest=function digest(enc){if(enc==='hex')
return utils.toHex32(this.h.slice(0,7),'big');else return utils.split32(this.h.slice(0,7),'big')}},{"../utils":104,"./256":100}],100:[function(require,module,exports){'use strict';var utils=require('../utils');var common=require('../common');var shaCommon=require('./common');var assert=require('minimalistic-assert');var sum32=utils.sum32;var sum32_4=utils.sum32_4;var sum32_5=utils.sum32_5;var ch32=shaCommon.ch32;var maj32=shaCommon.maj32;var s0_256=shaCommon.s0_256;var s1_256=shaCommon.s1_256;var g0_256=shaCommon.g0_256;var g1_256=shaCommon.g1_256;var BlockHash=common.BlockHash;var sha256_K=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0x0fc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x06ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2];function SHA256(){if(!(this instanceof SHA256))
return new SHA256();BlockHash.call(this);this.h=[0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19];this.k=sha256_K;this.W=new Array(64)}
utils.inherits(SHA256,BlockHash);module.exports=SHA256;SHA256.blockSize=512;SHA256.outSize=256;SHA256.hmacStrength=192;SHA256.padLength=64;SHA256.prototype._update=function _update(msg,start){var W=this.W;for(var i=0;i<16;i++)
W[i]=msg[start+i];for(;i<W.length;i++)
W[i]=sum32_4(g1_256(W[i-2]),W[i-7],g0_256(W[i-15]),W[i-16]);var a=this.h[0];var b=this.h[1];var c=this.h[2];var d=this.h[3];var e=this.h[4];var f=this.h[5];var g=this.h[6];var h=this.h[7];assert(this.k.length===W.length);for(i=0;i<W.length;i++){var T1=sum32_5(h,s1_256(e),ch32(e,f,g),this.k[i],W[i]);var T2=sum32(s0_256(a),maj32(a,b,c));h=g;g=f;f=e;e=sum32(d,T1);d=c;c=b;b=a;a=sum32(T1,T2)}
this.h[0]=sum32(this.h[0],a);this.h[1]=sum32(this.h[1],b);this.h[2]=sum32(this.h[2],c);this.h[3]=sum32(this.h[3],d);this.h[4]=sum32(this.h[4],e);this.h[5]=sum32(this.h[5],f);this.h[6]=sum32(this.h[6],g);this.h[7]=sum32(this.h[7],h)};SHA256.prototype._digest=function digest(enc){if(enc==='hex')
return utils.toHex32(this.h,'big');else return utils.split32(this.h,'big')}},{"../common":94,"../utils":104,"./common":103,"minimalistic-assert":113}],101:[function(require,module,exports){'use strict';var utils=require('../utils');var SHA512=require('./512');function SHA384(){if(!(this instanceof SHA384))
return new SHA384();SHA512.call(this);this.h=[0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]}
utils.inherits(SHA384,SHA512);module.exports=SHA384;SHA384.blockSize=1024;SHA384.outSize=384;SHA384.hmacStrength=192;SHA384.padLength=128;SHA384.prototype._digest=function digest(enc){if(enc==='hex')
return utils.toHex32(this.h.slice(0,12),'big');else return utils.split32(this.h.slice(0,12),'big')}},{"../utils":104,"./512":102}],102:[function(require,module,exports){'use strict';var utils=require('../utils');var common=require('../common');var assert=require('minimalistic-assert');var rotr64_hi=utils.rotr64_hi;var rotr64_lo=utils.rotr64_lo;var shr64_hi=utils.shr64_hi;var shr64_lo=utils.shr64_lo;var sum64=utils.sum64;var sum64_hi=utils.sum64_hi;var sum64_lo=utils.sum64_lo;var sum64_4_hi=utils.sum64_4_hi;var sum64_4_lo=utils.sum64_4_lo;var sum64_5_hi=utils.sum64_5_hi;var sum64_5_lo=utils.sum64_5_lo;var BlockHash=common.BlockHash;var sha512_K=[0x428a2f98,0xd728ae22,0x71374491,0x23ef65cd,0xb5c0fbcf,0xec4d3b2f,0xe9b5dba5,0x8189dbbc,0x3956c25b,0xf348b538,0x59f111f1,0xb605d019,0x923f82a4,0xaf194f9b,0xab1c5ed5,0xda6d8118,0xd807aa98,0xa3030242,0x12835b01,0x45706fbe,0x243185be,0x4ee4b28c,0x550c7dc3,0xd5ffb4e2,0x72be5d74,0xf27b896f,0x80deb1fe,0x3b1696b1,0x9bdc06a7,0x25c71235,0xc19bf174,0xcf692694,0xe49b69c1,0x9ef14ad2,0xefbe4786,0x384f25e3,0x0fc19dc6,0x8b8cd5b5,0x240ca1cc,0x77ac9c65,0x2de92c6f,0x592b0275,0x4a7484aa,0x6ea6e483,0x5cb0a9dc,0xbd41fbd4,0x76f988da,0x831153b5,0x983e5152,0xee66dfab,0xa831c66d,0x2db43210,0xb00327c8,0x98fb213f,0xbf597fc7,0xbeef0ee4,0xc6e00bf3,0x3da88fc2,0xd5a79147,0x930aa725,0x06ca6351,0xe003826f,0x14292967,0x0a0e6e70,0x27b70a85,0x46d22ffc,0x2e1b2138,0x5c26c926,0x4d2c6dfc,0x5ac42aed,0x53380d13,0x9d95b3df,0x650a7354,0x8baf63de,0x766a0abb,0x3c77b2a8,0x81c2c92e,0x47edaee6,0x92722c85,0x1482353b,0xa2bfe8a1,0x4cf10364,0xa81a664b,0xbc423001,0xc24b8b70,0xd0f89791,0xc76c51a3,0x0654be30,0xd192e819,0xd6ef5218,0xd6990624,0x5565a910,0xf40e3585,0x5771202a,0x106aa070,0x32bbd1b8,0x19a4c116,0xb8d2d0c8,0x1e376c08,0x5141ab53,0x2748774c,0xdf8eeb99,0x34b0bcb5,0xe19b48a8,0x391c0cb3,0xc5c95a63,0x4ed8aa4a,0xe3418acb,0x5b9cca4f,0x7763e373,0x682e6ff3,0xd6b2b8a3,0x748f82ee,0x5defb2fc,0x78a5636f,0x43172f60,0x84c87814,0xa1f0ab72,0x8cc70208,0x1a6439ec,0x90befffa,0x23631e28,0xa4506ceb,0xde82bde9,0xbef9a3f7,0xb2c67915,0xc67178f2,0xe372532b,0xca273ece,0xea26619c,0xd186b8c7,0x21c0c207,0xeada7dd6,0xcde0eb1e,0xf57d4f7f,0xee6ed178,0x06f067aa,0x72176fba,0x0a637dc5,0xa2c898a6,0x113f9804,0xbef90dae,0x1b710b35,0x131c471b,0x28db77f5,0x23047d84,0x32caab7b,0x40c72493,0x3c9ebe0a,0x15c9bebc,0x431d67c4,0x9c100d4c,0x4cc5d4be,0xcb3e42b6,0x597f299c,0xfc657e2a,0x5fcb6fab,0x3ad6faec,0x6c44198c,0x4a475817];function SHA512(){if(!(this instanceof SHA512))
return new SHA512();BlockHash.call(this);this.h=[0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179];this.k=sha512_K;this.W=new Array(160)}
utils.inherits(SHA512,BlockHash);module.exports=SHA512;SHA512.blockSize=1024;SHA512.outSize=512;SHA512.hmacStrength=192;SHA512.padLength=128;SHA512.prototype._prepareBlock=function _prepareBlock(msg,start){var W=this.W;for(var i=0;i<32;i++)
W[i]=msg[start+i];for(;i<W.length;i+=2){var c0_hi=g1_512_hi(W[i-4],W[i-3]);var c0_lo=g1_512_lo(W[i-4],W[i-3]);var c1_hi=W[i-14];var c1_lo=W[i-13];var c2_hi=g0_512_hi(W[i-30],W[i-29]);var c2_lo=g0_512_lo(W[i-30],W[i-29]);var c3_hi=W[i-32];var c3_lo=W[i-31];W[i]=sum64_4_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo);W[i+1]=sum64_4_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo)}};SHA512.prototype._update=function _update(msg,start){this._prepareBlock(msg,start);var W=this.W;var ah=this.h[0];var al=this.h[1];var bh=this.h[2];var bl=this.h[3];var ch=this.h[4];var cl=this.h[5];var dh=this.h[6];var dl=this.h[7];var eh=this.h[8];var el=this.h[9];var fh=this.h[10];var fl=this.h[11];var gh=this.h[12];var gl=this.h[13];var hh=this.h[14];var hl=this.h[15];assert(this.k.length===W.length);for(var i=0;i<W.length;i+=2){var c0_hi=hh;var c0_lo=hl;var c1_hi=s1_512_hi(eh,el);var c1_lo=s1_512_lo(eh,el);var c2_hi=ch64_hi(eh,el,fh,fl,gh,gl);var c2_lo=ch64_lo(eh,el,fh,fl,gh,gl);var c3_hi=this.k[i];var c3_lo=this.k[i+1];var c4_hi=W[i];var c4_lo=W[i+1];var T1_hi=sum64_5_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo);var T1_lo=sum64_5_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo);c0_hi=s0_512_hi(ah,al);c0_lo=s0_512_lo(ah,al);c1_hi=maj64_hi(ah,al,bh,bl,ch,cl);c1_lo=maj64_lo(ah,al,bh,bl,ch,cl);var T2_hi=sum64_hi(c0_hi,c0_lo,c1_hi,c1_lo);var T2_lo=sum64_lo(c0_hi,c0_lo,c1_hi,c1_lo);hh=gh;hl=gl;gh=fh;gl=fl;fh=eh;fl=el;eh=sum64_hi(dh,dl,T1_hi,T1_lo);el=sum64_lo(dl,dl,T1_hi,T1_lo);dh=ch;dl=cl;ch=bh;cl=bl;bh=ah;bl=al;ah=sum64_hi(T1_hi,T1_lo,T2_hi,T2_lo);al=sum64_lo(T1_hi,T1_lo,T2_hi,T2_lo)}
sum64(this.h,0,ah,al);sum64(this.h,2,bh,bl);sum64(this.h,4,ch,cl);sum64(this.h,6,dh,dl);sum64(this.h,8,eh,el);sum64(this.h,10,fh,fl);sum64(this.h,12,gh,gl);sum64(this.h,14,hh,hl)};SHA512.prototype._digest=function digest(enc){if(enc==='hex')
return utils.toHex32(this.h,'big');else return utils.split32(this.h,'big')};function ch64_hi(xh,xl,yh,yl,zh){var r=(xh&yh)^((~xh)&zh);if(r<0)
r+=0x100000000;return r}
function ch64_lo(xh,xl,yh,yl,zh,zl){var r=(xl&yl)^((~xl)&zl);if(r<0)
r+=0x100000000;return r}
function maj64_hi(xh,xl,yh,yl,zh){var r=(xh&yh)^(xh&zh)^(yh&zh);if(r<0)
r+=0x100000000;return r}
function maj64_lo(xh,xl,yh,yl,zh,zl){var r=(xl&yl)^(xl&zl)^(yl&zl);if(r<0)
r+=0x100000000;return r}
function s0_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,28);var c1_hi=rotr64_hi(xl,xh,2);var c2_hi=rotr64_hi(xl,xh,7);var r=c0_hi^c1_hi^c2_hi;if(r<0)
r+=0x100000000;return r}
function s0_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,28);var c1_lo=rotr64_lo(xl,xh,2);var c2_lo=rotr64_lo(xl,xh,7);var r=c0_lo^c1_lo^c2_lo;if(r<0)
r+=0x100000000;return r}
function s1_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,14);var c1_hi=rotr64_hi(xh,xl,18);var c2_hi=rotr64_hi(xl,xh,9);var r=c0_hi^c1_hi^c2_hi;if(r<0)
r+=0x100000000;return r}
function s1_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,14);var c1_lo=rotr64_lo(xh,xl,18);var c2_lo=rotr64_lo(xl,xh,9);var r=c0_lo^c1_lo^c2_lo;if(r<0)
r+=0x100000000;return r}
function g0_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,1);var c1_hi=rotr64_hi(xh,xl,8);var c2_hi=shr64_hi(xh,xl,7);var r=c0_hi^c1_hi^c2_hi;if(r<0)
r+=0x100000000;return r}
function g0_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,1);var c1_lo=rotr64_lo(xh,xl,8);var c2_lo=shr64_lo(xh,xl,7);var r=c0_lo^c1_lo^c2_lo;if(r<0)
r+=0x100000000;return r}
function g1_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,19);var c1_hi=rotr64_hi(xl,xh,29);var c2_hi=shr64_hi(xh,xl,6);var r=c0_hi^c1_hi^c2_hi;if(r<0)
r+=0x100000000;return r}
function g1_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,19);var c1_lo=rotr64_lo(xl,xh,29);var c2_lo=shr64_lo(xh,xl,6);var r=c0_lo^c1_lo^c2_lo;if(r<0)
r+=0x100000000;return r}},{"../common":94,"../utils":104,"minimalistic-assert":113}],103:[function(require,module,exports){'use strict';var utils=require('../utils');var rotr32=utils.rotr32;function ft_1(s,x,y,z){if(s===0)
return ch32(x,y,z);if(s===1||s===3)
return p32(x,y,z);if(s===2)
return maj32(x,y,z)}
exports.ft_1=ft_1;function ch32(x,y,z){return(x&y)^((~x)&z)}
exports.ch32=ch32;function maj32(x,y,z){return(x&y)^(x&z)^(y&z)}
exports.maj32=maj32;function p32(x,y,z){return x^y^z}
exports.p32=p32;function s0_256(x){return rotr32(x,2)^rotr32(x,13)^rotr32(x,22)}
exports.s0_256=s0_256;function s1_256(x){return rotr32(x,6)^rotr32(x,11)^rotr32(x,25)}
exports.s1_256=s1_256;function g0_256(x){return rotr32(x,7)^rotr32(x,18)^(x>>>3)}
exports.g0_256=g0_256;function g1_256(x){return rotr32(x,17)^rotr32(x,19)^(x>>>10)}
exports.g1_256=g1_256},{"../utils":104}],104:[function(require,module,exports){'use strict';var assert=require('minimalistic-assert');var inherits=require('inherits');exports.inherits=inherits;function isSurrogatePair(msg,i){if((msg.charCodeAt(i)&0xFC00)!==0xD800){return!1}
if(i<0||i+1>=msg.length){return!1}
return(msg.charCodeAt(i+1)&0xFC00)===0xDC00}
function toArray(msg,enc){if(Array.isArray(msg))
return msg.slice();if(!msg)
return[];var res=[];if(typeof msg==='string'){if(!enc){var p=0;for(var i=0;i<msg.length;i++){var c=msg.charCodeAt(i);if(c<128){res[p++]=c}else if(c<2048){res[p++]=(c>>6)|192;res[p++]=(c&63)|128}else if(isSurrogatePair(msg,i)){c=0x10000+((c&0x03FF)<<10)+(msg.charCodeAt(++i)&0x03FF);res[p++]=(c>>18)|240;res[p++]=((c>>12)&63)|128;res[p++]=((c>>6)&63)|128;res[p++]=(c&63)|128}else{res[p++]=(c>>12)|224;res[p++]=((c>>6)&63)|128;res[p++]=(c&63)|128}}}else if(enc==='hex'){msg=msg.replace(/[^a-z0-9]+/ig,'');if(msg.length%2!==0)
msg='0'+msg;for(i=0;i<msg.length;i+=2)
res.push(parseInt(msg[i]+msg[i+1],16));}}else{for(i=0;i<msg.length;i++)
res[i]=msg[i]|0}
return res}
exports.toArray=toArray;function toHex(msg){var res='';for(var i=0;i<msg.length;i++)
res+=zero2(msg[i].toString(16));return res}
exports.toHex=toHex;function htonl(w){var res=(w>>>24)|((w>>>8)&0xff00)|((w<<8)&0xff0000)|((w&0xff)<<24);return res>>>0}
exports.htonl=htonl;function toHex32(msg,endian){var res='';for(var i=0;i<msg.length;i++){var w=msg[i];if(endian==='little')
w=htonl(w);res+=zero8(w.toString(16))}
return res}
exports.toHex32=toHex32;function zero2(word){if(word.length===1)
return'0'+word;else return word}
exports.zero2=zero2;function zero8(word){if(word.length===7)
return'0'+word;else if(word.length===6)
return'00'+word;else if(word.length===5)
return'000'+word;else if(word.length===4)
return'0000'+word;else if(word.length===3)
return'00000'+word;else if(word.length===2)
return'000000'+word;else if(word.length===1)
return'0000000'+word;else return word}
exports.zero8=zero8;function join32(msg,start,end,endian){var len=end-start;assert(len%4===0);var res=new Array(len/4);for(var i=0,k=start;i<res.length;i++,k+=4){var w;if(endian==='big')
w=(msg[k]<<24)|(msg[k+1]<<16)|(msg[k+2]<<8)|msg[k+3];else w=(msg[k+3]<<24)|(msg[k+2]<<16)|(msg[k+1]<<8)|msg[k];res[i]=w>>>0}
return res}
exports.join32=join32;function split32(msg,endian){var res=new Array(msg.length*4);for(var i=0,k=0;i<msg.length;i++,k+=4){var m=msg[i];if(endian==='big'){res[k]=m>>>24;res[k+1]=(m>>>16)&0xff;res[k+2]=(m>>>8)&0xff;res[k+3]=m&0xff}else{res[k+3]=m>>>24;res[k+2]=(m>>>16)&0xff;res[k+1]=(m>>>8)&0xff;res[k]=m&0xff}}
return res}
exports.split32=split32;function rotr32(w,b){return(w>>>b)|(w<<(32-b))}
exports.rotr32=rotr32;function rotl32(w,b){return(w<<b)|(w>>>(32-b))}
exports.rotl32=rotl32;function sum32(a,b){return(a+b)>>>0}
exports.sum32=sum32;function sum32_3(a,b,c){return(a+b+c)>>>0}
exports.sum32_3=sum32_3;function sum32_4(a,b,c,d){return(a+b+c+d)>>>0}
exports.sum32_4=sum32_4;function sum32_5(a,b,c,d,e){return(a+b+c+d+e)>>>0}
exports.sum32_5=sum32_5;function sum64(buf,pos,ah,al){var bh=buf[pos];var bl=buf[pos+1];var lo=(al+bl)>>>0;var hi=(lo<al?1:0)+ah+bh;buf[pos]=hi>>>0;buf[pos+1]=lo}
exports.sum64=sum64;function sum64_hi(ah,al,bh,bl){var lo=(al+bl)>>>0;var hi=(lo<al?1:0)+ah+bh;return hi>>>0}
exports.sum64_hi=sum64_hi;function sum64_lo(ah,al,bh,bl){var lo=al+bl;return lo>>>0}
exports.sum64_lo=sum64_lo;function sum64_4_hi(ah,al,bh,bl,ch,cl,dh,dl){var carry=0;var lo=al;lo=(lo+bl)>>>0;carry+=lo<al?1:0;lo=(lo+cl)>>>0;carry+=lo<cl?1:0;lo=(lo+dl)>>>0;carry+=lo<dl?1:0;var hi=ah+bh+ch+dh+carry;return hi>>>0}
exports.sum64_4_hi=sum64_4_hi;function sum64_4_lo(ah,al,bh,bl,ch,cl,dh,dl){var lo=al+bl+cl+dl;return lo>>>0}
exports.sum64_4_lo=sum64_4_lo;function sum64_5_hi(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var carry=0;var lo=al;lo=(lo+bl)>>>0;carry+=lo<al?1:0;lo=(lo+cl)>>>0;carry+=lo<cl?1:0;lo=(lo+dl)>>>0;carry+=lo<dl?1:0;lo=(lo+el)>>>0;carry+=lo<el?1:0;var hi=ah+bh+ch+dh+eh+carry;return hi>>>0}
exports.sum64_5_hi=sum64_5_hi;function sum64_5_lo(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var lo=al+bl+cl+dl+el;return lo>>>0}
exports.sum64_5_lo=sum64_5_lo;function rotr64_hi(ah,al,num){var r=(al<<(32-num))|(ah>>>num);return r>>>0}
exports.rotr64_hi=rotr64_hi;function rotr64_lo(ah,al,num){var r=(ah<<(32-num))|(al>>>num);return r>>>0}
exports.rotr64_lo=rotr64_lo;function shr64_hi(ah,al,num){return ah>>>num}
exports.shr64_hi=shr64_hi;function shr64_lo(ah,al,num){var r=(ah<<(32-num))|(al>>>num);return r>>>0}
exports.shr64_lo=shr64_lo},{"inherits":108,"minimalistic-assert":113}],105:[function(require,module,exports){'use strict';var hash=require('hash.js');var utils=require('minimalistic-crypto-utils');var assert=require('minimalistic-assert');function HmacDRBG(options){if(!(this instanceof HmacDRBG))
return new HmacDRBG(options);this.hash=options.hash;this.predResist=!!options.predResist;this.outLen=this.hash.outSize;this.minEntropy=options.minEntropy||this.hash.hmacStrength;this._reseed=null;this.reseedInterval=null;this.K=null;this.V=null;var entropy=utils.toArray(options.entropy,options.entropyEnc||'hex');var nonce=utils.toArray(options.nonce,options.nonceEnc||'hex');var pers=utils.toArray(options.pers,options.persEnc||'hex');assert(entropy.length>=(this.minEntropy/8),'Not enough entropy. Minimum is: '+this.minEntropy+' bits');this._init(entropy,nonce,pers)}
module.exports=HmacDRBG;HmacDRBG.prototype._init=function init(entropy,nonce,pers){var seed=entropy.concat(nonce).concat(pers);this.K=new Array(this.outLen/8);this.V=new Array(this.outLen/8);for(var i=0;i<this.V.length;i++){this.K[i]=0x00;this.V[i]=0x01}
this._update(seed);this._reseed=1;this.reseedInterval=0x1000000000000};HmacDRBG.prototype._hmac=function hmac(){return new hash.hmac(this.hash,this.K)};HmacDRBG.prototype._update=function update(seed){var kmac=this._hmac().update(this.V).update([0x00]);if(seed)
kmac=kmac.update(seed);this.K=kmac.digest();this.V=this._hmac().update(this.V).digest();if(!seed)
return;this.K=this._hmac().update(this.V).update([0x01]).update(seed).digest();this.V=this._hmac().update(this.V).digest()};HmacDRBG.prototype.reseed=function reseed(entropy,entropyEnc,add,addEnc){if(typeof entropyEnc!=='string'){addEnc=add;add=entropyEnc;entropyEnc=null}
entropy=utils.toArray(entropy,entropyEnc);add=utils.toArray(add,addEnc);assert(entropy.length>=(this.minEntropy/8),'Not enough entropy. Minimum is: '+this.minEntropy+' bits');this._update(entropy.concat(add||[]));this._reseed=1};HmacDRBG.prototype.generate=function generate(len,enc,add,addEnc){if(this._reseed>this.reseedInterval)
throw new Error('Reseed is required');if(typeof enc!=='string'){addEnc=add;add=enc;enc=null}
if(add){add=utils.toArray(add,addEnc||'hex');this._update(add)}
var temp=[];while(temp.length<len){this.V=this._hmac().update(this.V).digest();temp=temp.concat(this.V)}
var res=temp.slice(0,len);this._update(add);this._reseed++;return utils.encode(res,enc)}},{"hash.js":93,"minimalistic-assert":113,"minimalistic-crypto-utils":114}],106:[function(require,module,exports){var http=require('http')
var url=require('url')
var https=module.exports
for(var key in http){if(http.hasOwnProperty(key))https[key]=http[key]}
https.request=function(params,cb){params=validateParams(params)
return http.request.call(this,params,cb)}
https.get=function(params,cb){params=validateParams(params)
return http.get.call(this,params,cb)}
function validateParams(params){if(typeof params==='string'){params=url.parse(params)}
if(!params.protocol){params.protocol='https:'}
if(params.protocol!=='https:'){throw new Error('Protocol "'+params.protocol+'" not supported. Expected "https:"')}
return params}},{"http":177,"url":184}],107:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m
var eLen=(nBytes*8)-mLen-1
var eMax=(1<<eLen)-1
var eBias=eMax>>1
var nBits=-7
var i=isLE?(nBytes-1):0
var d=isLE?-1:1
var s=buffer[offset+i]
i+=d
e=s&((1<<(-nBits))-1)
s>>=(-nBits)
nBits+=eLen
for(;nBits>0;e=(e*256)+buffer[offset+i],i+=d,nBits-=8){}
m=e&((1<<(-nBits))-1)
e>>=(-nBits)
nBits+=mLen
for(;nBits>0;m=(m*256)+buffer[offset+i],i+=d,nBits-=8){}
if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:((s?-1:1)*Infinity)}else{m=m+Math.pow(2,mLen)
e=e-eBias}
return(s?-1:1)*m*Math.pow(2,e-mLen)}
exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c
var eLen=(nBytes*8)-mLen-1
var eMax=(1<<eLen)-1
var eBias=eMax>>1
var rt=(mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0)
var i=isLE?0:(nBytes-1)
var d=isLE?1:-1
var s=value<0||(value===0&&1/value<0)?1:0
value=Math.abs(value)
if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0
e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2)
if(value*(c=Math.pow(2,-e))<1){e--
c*=2}
if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}
if(value*c>=2){e++
c/=2}
if(e+eBias>=eMax){m=0
e=eMax}else if(e+eBias>=1){m=((value*c)-1)*Math.pow(2,mLen)
e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen)
e=0}}
for(;mLen>=8;buffer[offset+i]=m&0xff,i+=d,m/=256,mLen-=8){}
e=(e<<mLen)|m
eLen+=mLen
for(;eLen>0;buffer[offset+i]=e&0xff,i+=d,e/=256,eLen-=8){}
buffer[offset+i-d]|=s*128}},{}],108:[function(require,module,exports){arguments[4][17][0].apply(exports,arguments)},{"dup":17}],109:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)}
function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==='function'&&obj.constructor.isBuffer(obj)}
function isSlowBuffer(obj){return typeof obj.readFloatLE==='function'&&typeof obj.slice==='function'&&isBuffer(obj.slice(0,0))}},{}],110:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=='[object Array]'}},{}],111:[function(require,module,exports){'use strict'
var inherits=require('inherits')
var HashBase=require('hash-base')
var Buffer=require('safe-buffer').Buffer
var ARRAY16=new Array(16)
function MD5(){HashBase.call(this,64)
this._a=0x67452301
this._b=0xefcdab89
this._c=0x98badcfe
this._d=0x10325476}
inherits(MD5,HashBase)
MD5.prototype._update=function(){var M=ARRAY16
for(var i=0;i<16;++i)M[i]=this._block.readInt32LE(i*4)
var a=this._a
var b=this._b
var c=this._c
var d=this._d
a=fnF(a,b,c,d,M[0],0xd76aa478,7)
d=fnF(d,a,b,c,M[1],0xe8c7b756,12)
c=fnF(c,d,a,b,M[2],0x242070db,17)
b=fnF(b,c,d,a,M[3],0xc1bdceee,22)
a=fnF(a,b,c,d,M[4],0xf57c0faf,7)
d=fnF(d,a,b,c,M[5],0x4787c62a,12)
c=fnF(c,d,a,b,M[6],0xa8304613,17)
b=fnF(b,c,d,a,M[7],0xfd469501,22)
a=fnF(a,b,c,d,M[8],0x698098d8,7)
d=fnF(d,a,b,c,M[9],0x8b44f7af,12)
c=fnF(c,d,a,b,M[10],0xffff5bb1,17)
b=fnF(b,c,d,a,M[11],0x895cd7be,22)
a=fnF(a,b,c,d,M[12],0x6b901122,7)
d=fnF(d,a,b,c,M[13],0xfd987193,12)
c=fnF(c,d,a,b,M[14],0xa679438e,17)
b=fnF(b,c,d,a,M[15],0x49b40821,22)
a=fnG(a,b,c,d,M[1],0xf61e2562,5)
d=fnG(d,a,b,c,M[6],0xc040b340,9)
c=fnG(c,d,a,b,M[11],0x265e5a51,14)
b=fnG(b,c,d,a,M[0],0xe9b6c7aa,20)
a=fnG(a,b,c,d,M[5],0xd62f105d,5)
d=fnG(d,a,b,c,M[10],0x02441453,9)
c=fnG(c,d,a,b,M[15],0xd8a1e681,14)
b=fnG(b,c,d,a,M[4],0xe7d3fbc8,20)
a=fnG(a,b,c,d,M[9],0x21e1cde6,5)
d=fnG(d,a,b,c,M[14],0xc33707d6,9)
c=fnG(c,d,a,b,M[3],0xf4d50d87,14)
b=fnG(b,c,d,a,M[8],0x455a14ed,20)
a=fnG(a,b,c,d,M[13],0xa9e3e905,5)
d=fnG(d,a,b,c,M[2],0xfcefa3f8,9)
c=fnG(c,d,a,b,M[7],0x676f02d9,14)
b=fnG(b,c,d,a,M[12],0x8d2a4c8a,20)
a=fnH(a,b,c,d,M[5],0xfffa3942,4)
d=fnH(d,a,b,c,M[8],0x8771f681,11)
c=fnH(c,d,a,b,M[11],0x6d9d6122,16)
b=fnH(b,c,d,a,M[14],0xfde5380c,23)
a=fnH(a,b,c,d,M[1],0xa4beea44,4)
d=fnH(d,a,b,c,M[4],0x4bdecfa9,11)
c=fnH(c,d,a,b,M[7],0xf6bb4b60,16)
b=fnH(b,c,d,a,M[10],0xbebfbc70,23)
a=fnH(a,b,c,d,M[13],0x289b7ec6,4)
d=fnH(d,a,b,c,M[0],0xeaa127fa,11)
c=fnH(c,d,a,b,M[3],0xd4ef3085,16)
b=fnH(b,c,d,a,M[6],0x04881d05,23)
a=fnH(a,b,c,d,M[9],0xd9d4d039,4)
d=fnH(d,a,b,c,M[12],0xe6db99e5,11)
c=fnH(c,d,a,b,M[15],0x1fa27cf8,16)
b=fnH(b,c,d,a,M[2],0xc4ac5665,23)
a=fnI(a,b,c,d,M[0],0xf4292244,6)
d=fnI(d,a,b,c,M[7],0x432aff97,10)
c=fnI(c,d,a,b,M[14],0xab9423a7,15)
b=fnI(b,c,d,a,M[5],0xfc93a039,21)
a=fnI(a,b,c,d,M[12],0x655b59c3,6)
d=fnI(d,a,b,c,M[3],0x8f0ccc92,10)
c=fnI(c,d,a,b,M[10],0xffeff47d,15)
b=fnI(b,c,d,a,M[1],0x85845dd1,21)
a=fnI(a,b,c,d,M[8],0x6fa87e4f,6)
d=fnI(d,a,b,c,M[15],0xfe2ce6e0,10)
c=fnI(c,d,a,b,M[6],0xa3014314,15)
b=fnI(b,c,d,a,M[13],0x4e0811a1,21)
a=fnI(a,b,c,d,M[4],0xf7537e82,6)
d=fnI(d,a,b,c,M[11],0xbd3af235,10)
c=fnI(c,d,a,b,M[2],0x2ad7d2bb,15)
b=fnI(b,c,d,a,M[9],0xeb86d391,21)
this._a=(this._a+a)|0
this._b=(this._b+b)|0
this._c=(this._c+c)|0
this._d=(this._d+d)|0}
MD5.prototype._digest=function(){this._block[this._blockOffset++]=0x80
if(this._blockOffset>56){this._block.fill(0,this._blockOffset,64)
this._update()
this._blockOffset=0}
this._block.fill(0,this._blockOffset,56)
this._block.writeUInt32LE(this._length[0],56)
this._block.writeUInt32LE(this._length[1],60)
this._update()
var buffer=Buffer.allocUnsafe(16)
buffer.writeInt32LE(this._a,0)
buffer.writeInt32LE(this._b,4)
buffer.writeInt32LE(this._c,8)
buffer.writeInt32LE(this._d,12)
return buffer}
function rotl(x,n){return(x<<n)|(x>>>(32-n))}
function fnF(a,b,c,d,m,k,s){return(rotl((a+((b&c)|((~b)&d))+m+k)|0,s)+b)|0}
function fnG(a,b,c,d,m,k,s){return(rotl((a+((b&d)|(c&(~d)))+m+k)|0,s)+b)|0}
function fnH(a,b,c,d,m,k,s){return(rotl((a+(b^c^d)+m+k)|0,s)+b)|0}
function fnI(a,b,c,d,m,k,s){return(rotl((a+((c^(b|(~d))))+m+k)|0,s)+b)|0}
module.exports=MD5},{"hash-base":92,"inherits":108,"safe-buffer":167}],112:[function(require,module,exports){var bn=require('bn.js');var brorand=require('brorand');function MillerRabin(rand){this.rand=rand||new brorand.Rand()}
module.exports=MillerRabin;MillerRabin.create=function create(rand){return new MillerRabin(rand)};MillerRabin.prototype._randbelow=function _randbelow(n){var len=n.bitLength();var min_bytes=Math.ceil(len/8);do var a=new bn(this.rand.generate(min_bytes));while(a.cmp(n)>=0);return a};MillerRabin.prototype._randrange=function _randrange(start,stop){var size=stop.sub(start);return start.add(this._randbelow(size))};MillerRabin.prototype.test=function test(n,k,cb){var len=n.bitLength();var red=bn.mont(n);var rone=new bn(1).toRed(red);if(!k)
k=Math.max(1,(len/48)|0);var n1=n.subn(1);for(var s=0;!n1.testn(s);s++){}
var d=n.shrn(s);var rn1=n1.toRed(red);var prime=!0;for(;k>0;k--){var a=this._randrange(new bn(2),n1);if(cb)
cb(a);var x=a.toRed(red).redPow(d);if(x.cmp(rone)===0||x.cmp(rn1)===0)
continue;for(var i=1;i<s;i++){x=x.redSqr();if(x.cmp(rone)===0)
return!1;if(x.cmp(rn1)===0)
break}
if(i===s)
return!1}
return prime};MillerRabin.prototype.getDivisor=function getDivisor(n,k){var len=n.bitLength();var red=bn.mont(n);var rone=new bn(1).toRed(red);if(!k)
k=Math.max(1,(len/48)|0);var n1=n.subn(1);for(var s=0;!n1.testn(s);s++){}
var d=n.shrn(s);var rn1=n1.toRed(red);for(;k>0;k--){var a=this._randrange(new bn(2),n1);var g=n.gcd(a);if(g.cmpn(1)!==0)
return g;var x=a.toRed(red).redPow(d);if(x.cmp(rone)===0||x.cmp(rn1)===0)
continue;for(var i=1;i<s;i++){x=x.redSqr();if(x.cmp(rone)===0)
return x.fromRed().subn(1).gcd(n);if(x.cmp(rn1)===0)
break}
if(i===s){x=x.redSqr();return x.fromRed().subn(1).gcd(n)}}
return!1}},{"bn.js":21,"brorand":22}],113:[function(require,module,exports){module.exports=assert;function assert(val,msg){if(!val)
throw new Error(msg||'Assertion failed')}
assert.equal=function assertEqual(l,r,msg){if(l!=r)
throw new Error(msg||('Assertion failed: '+l+' != '+r))}},{}],114:[function(require,module,exports){'use strict';var utils=exports;function toArray(msg,enc){if(Array.isArray(msg))
return msg.slice();if(!msg)
return[];var res=[];if(typeof msg!=='string'){for(var i=0;i<msg.length;i++)
res[i]=msg[i]|0;return res}
if(enc==='hex'){msg=msg.replace(/[^a-z0-9]+/ig,'');if(msg.length%2!==0)
msg='0'+msg;for(var i=0;i<msg.length;i+=2)
res.push(parseInt(msg[i]+msg[i+1],16));}else{for(var i=0;i<msg.length;i++){var c=msg.charCodeAt(i);var hi=c>>8;var lo=c&0xff;if(hi)
res.push(hi,lo);else res.push(lo)}}
return res}
utils.toArray=toArray;function zero2(word){if(word.length===1)
return'0'+word;else return word}
utils.zero2=zero2;function toHex(msg){var res='';for(var i=0;i<msg.length;i++)
res+=zero2(msg[i].toString(16));return res}
utils.toHex=toHex;utils.encode=function encode(arr,enc){if(enc==='hex')
return toHex(arr);else return arr}},{}],115:[function(require,module,exports){'use strict';var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError('Object.assign cannot be called with null or undefined')}
return Object(val)}
function shouldUseNative(){try{if(!Object.assign){return!1}
var test1=new String('abc');test1[5]='de';if(Object.getOwnPropertyNames(test1)[0]==='5'){return!1}
var test2={};for(var i=0;i<10;i++){test2['_'+String.fromCharCode(i)]=i}
var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join('')!=='0123456789'){return!1}
var test3={};'abcdefghijklmnopqrst'.split('').forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join('')!=='abcdefghijklmnopqrst'){return!1}
return!0}catch(err){return!1}}
module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}
if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}
return to}},{}],116:[function(require,module,exports){'use strict';var TYPED_OK=(typeof Uint8Array!=='undefined')&&(typeof Uint16Array!=='undefined')&&(typeof Int32Array!=='undefined');function _has(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}
exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}
if(typeof source!=='object'){throw new TypeError(source+'must be non-object')}
for(var p in source){if(_has(source,p)){obj[p]=source[p]}}}
return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size){return buf}
if(buf.subarray){return buf.subarray(0,size)}
buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}
for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}
result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}
return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],117:[function(require,module,exports){'use strict';function adler32(adler,buf,len,pos){var s1=(adler&0xffff)|0,s2=((adler>>>16)&0xffff)|0,n=0;while(len!==0){n=len>2000?2000:len;len-=n;do{s1=(s1+buf[pos++])|0;s2=(s2+s1)|0}while(--n);s1%=65521;s2%=65521}
return(s1|(s2<<16))|0}
module.exports=adler32},{}],118:[function(require,module,exports){'use strict';module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],119:[function(require,module,exports){'use strict';function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=((c&1)?(0xEDB88320^(c>>>1)):(c>>>1))}
table[n]=c}
return table}
var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++){crc=(crc>>>8)^t[(crc^buf[i])&0xFF]}
return(crc^(-1))}
module.exports=crc32},{}],120:[function(require,module,exports){'use strict';var utils=require('../utils/common');var trees=require('./trees');var adler32=require('./adler32');var crc32=require('./crc32');var msg=require('./messages');var Z_NO_FLUSH=0;var Z_PARTIAL_FLUSH=1;var Z_FULL_FLUSH=3;var Z_FINISH=4;var Z_BLOCK=5;var Z_OK=0;var Z_STREAM_END=1;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_BUF_ERROR=-5;var Z_DEFAULT_COMPRESSION=-1;var Z_FILTERED=1;var Z_HUFFMAN_ONLY=2;var Z_RLE=3;var Z_FIXED=4;var Z_DEFAULT_STRATEGY=0;var Z_UNKNOWN=2;var Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var MAX_WBITS=15;var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var MIN_MATCH=3;var MAX_MATCH=258;var MIN_LOOKAHEAD=(MAX_MATCH+MIN_MATCH+1);var PRESET_DICT=0x20;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=1;var BS_BLOCK_DONE=2;var BS_FINISH_STARTED=3;var BS_FINISH_DONE=4;var OS_CODE=0x03;function err(strm,errorCode){strm.msg=msg[errorCode];return errorCode}
function rank(f){return((f)<<1)-((f)>4?9:0)}
function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}
function flush_pending(strm){var s=strm.state;var len=s.pending;if(len>strm.avail_out){len=strm.avail_out}
if(len===0){return}
utils.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out);strm.next_out+=len;s.pending_out+=len;strm.total_out+=len;strm.avail_out-=len;s.pending-=len;if(s.pending===0){s.pending_out=0}}
function flush_block_only(s,last){trees._tr_flush_block(s,(s.block_start>=0?s.block_start:-1),s.strstart-s.block_start,last);s.block_start=s.strstart;flush_pending(s.strm)}
function put_byte(s,b){s.pending_buf[s.pending++]=b}
function putShortMSB(s,b){s.pending_buf[s.pending++]=(b>>>8)&0xff;s.pending_buf[s.pending++]=b&0xff}
function read_buf(strm,buf,start,size){var len=strm.avail_in;if(len>size){len=size}
if(len===0){return 0}
strm.avail_in-=len;utils.arraySet(buf,strm.input,strm.next_in,len,start);if(strm.state.wrap===1){strm.adler=adler32(strm.adler,buf,len,start)}
else if(strm.state.wrap===2){strm.adler=crc32(strm.adler,buf,len,start)}
strm.next_in+=len;strm.total_in+=len;return len}
function longest_match(s,cur_match){var chain_length=s.max_chain_length;var scan=s.strstart;var match;var len;var best_len=s.prev_length;var nice_match=s.nice_match;var limit=(s.strstart>(s.w_size-MIN_LOOKAHEAD))?s.strstart-(s.w_size-MIN_LOOKAHEAD):0;var _win=s.window;var wmask=s.w_mask;var prev=s.prev;var strend=s.strstart+MAX_MATCH;var scan_end1=_win[scan+best_len-1];var scan_end=_win[scan+best_len];if(s.prev_length>=s.good_match){chain_length>>=2}
if(nice_match>s.lookahead){nice_match=s.lookahead}
do{match=cur_match;if(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1]){continue}
scan+=2;match++;do{}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);len=MAX_MATCH-(strend-scan);scan=strend-MAX_MATCH;if(len>best_len){s.match_start=cur_match;best_len=len;if(len>=nice_match){break}
scan_end1=_win[scan+best_len-1];scan_end=_win[scan+best_len]}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!==0);if(best_len<=s.lookahead){return best_len}
return s.lookahead}
function fill_window(s){var _w_size=s.w_size;var p,n,m,more,str;do{more=s.window_size-s.lookahead-s.strstart;if(s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils.arraySet(s.window,s.window,_w_size,_w_size,0);s.match_start-=_w_size;s.strstart-=_w_size;s.block_start-=_w_size;n=s.hash_size;p=n;do{m=s.head[--p];s.head[p]=(m>=_w_size?m-_w_size:0)}while(--n);n=_w_size;p=n;do{m=s.prev[--p];s.prev[p]=(m>=_w_size?m-_w_size:0)}while(--n);more+=_w_size}
if(s.strm.avail_in===0){break}
n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more);s.lookahead+=n;if(s.lookahead+s.insert>=MIN_MATCH){str=s.strstart-s.insert;s.ins_h=s.window[str];s.ins_h=((s.ins_h<<s.hash_shift)^s.window[str+1])&s.hash_mask;while(s.insert){s.ins_h=((s.ins_h<<s.hash_shift)^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;s.insert--;if(s.lookahead+s.insert<MIN_MATCH){break}}}}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0);}
function deflate_stored(s,flush){var max_block_size=0xffff;if(max_block_size>s.pending_buf_size-5){max_block_size=s.pending_buf_size-5}
for(;;){if(s.lookahead<=1){fill_window(s);if(s.lookahead===0&&flush===Z_NO_FLUSH){return BS_NEED_MORE}
if(s.lookahead===0){break}}
s.strstart+=s.lookahead;s.lookahead=0;var max_start=s.block_start+max_block_size;if(s.strstart===0||s.strstart>=max_start){s.lookahead=s.strstart-max_start;s.strstart=max_start;flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}
if(s.strstart-s.block_start>=(s.w_size-MIN_LOOKAHEAD)){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}}
s.insert=0;if(flush===Z_FINISH){flush_block_only(s,!0);if(s.strm.avail_out===0){return BS_FINISH_STARTED}
return BS_FINISH_DONE}
if(s.strstart>s.block_start){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}
return BS_NEED_MORE}
function deflate_fast(s,flush){var hash_head;var bflush;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}
if(s.lookahead===0){break}}
hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}
if(hash_head!==0&&((s.strstart-hash_head)<=(s.w_size-MIN_LOOKAHEAD))){s.match_length=longest_match(s,hash_head)}
if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;if(s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do{s.strstart++;s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}while(--s.match_length!==0);s.strstart++}else{s.strstart+=s.match_length;s.match_length=0;s.ins_h=s.window[s.strstart];s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+1])&s.hash_mask}}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}
if(bflush){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}}
s.insert=((s.strstart<(MIN_MATCH-1))?s.strstart:MIN_MATCH-1);if(flush===Z_FINISH){flush_block_only(s,!0);if(s.strm.avail_out===0){return BS_FINISH_STARTED}
return BS_FINISH_DONE}
if(s.last_lit){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}
return BS_BLOCK_DONE}
function deflate_slow(s,flush){var hash_head;var bflush;var max_insert;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}
if(s.lookahead===0){break}}
hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}
s.prev_length=s.match_length;s.prev_match=s.match_start;s.match_length=MIN_MATCH-1;if(hash_head!==0&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=(s.w_size-MIN_LOOKAHEAD)){s.match_length=longest_match(s,hash_head);if(s.match_length<=5&&(s.strategy===Z_FILTERED||(s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096))){s.match_length=MIN_MATCH-1}}
if(s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH;bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH);s.lookahead-=s.prev_length-1;s.prev_length-=2;do{if(++s.strstart<=max_insert){s.ins_h=((s.ins_h<<s.hash_shift)^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}}while(--s.prev_length!==0);s.match_available=0;s.match_length=MIN_MATCH-1;s.strstart++;if(bflush){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}}else if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);if(bflush){flush_block_only(s,!1)}
s.strstart++;s.lookahead--;if(s.strm.avail_out===0){return BS_NEED_MORE}}else{s.match_available=1;s.strstart++;s.lookahead--}}
if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);s.match_available=0}
s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,!0);if(s.strm.avail_out===0){return BS_FINISH_STARTED}
return BS_FINISH_DONE}
if(s.last_lit){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}
return BS_BLOCK_DONE}
function deflate_rle(s,flush){var bflush;var prev;var scan,strend;var _win=s.window;for(;;){if(s.lookahead<=MAX_MATCH){fill_window(s);if(s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH){return BS_NEED_MORE}
if(s.lookahead===0){break}}
s.match_length=0;if(s.lookahead>=MIN_MATCH&&s.strstart>0){scan=s.strstart-1;prev=_win[scan];if(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do{}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan);if(s.match_length>s.lookahead){s.match_length=s.lookahead}}}
if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;s.strstart+=s.match_length;s.match_length=0}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}
if(bflush){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}}
s.insert=0;if(flush===Z_FINISH){flush_block_only(s,!0);if(s.strm.avail_out===0){return BS_FINISH_STARTED}
return BS_FINISH_DONE}
if(s.last_lit){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}
return BS_BLOCK_DONE}
function deflate_huff(s,flush){var bflush;for(;;){if(s.lookahead===0){fill_window(s);if(s.lookahead===0){if(flush===Z_NO_FLUSH){return BS_NEED_MORE}
break}}
s.match_length=0;bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;if(bflush){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}}
s.insert=0;if(flush===Z_FINISH){flush_block_only(s,!0);if(s.strm.avail_out===0){return BS_FINISH_STARTED}
return BS_FINISH_DONE}
if(s.last_lit){flush_block_only(s,!1);if(s.strm.avail_out===0){return BS_NEED_MORE}}
return BS_BLOCK_DONE}
function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length;this.max_lazy=max_lazy;this.nice_length=nice_length;this.max_chain=max_chain;this.func=func}
var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(s){s.window_size=2*s.w_size;zero(s.head);s.max_lazy_match=configuration_table[s.level].max_lazy;s.good_match=configuration_table[s.level].good_length;s.nice_match=configuration_table[s.level].nice_length;s.max_chain_length=configuration_table[s.level].max_chain;s.strstart=0;s.block_start=0;s.lookahead=0;s.insert=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;s.ins_h=0}
function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Z_DEFLATED;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new utils.Buf16(HEAP_SIZE*2);this.dyn_dtree=new utils.Buf16((2*D_CODES+1)*2);this.bl_tree=new utils.Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new utils.Buf16(MAX_BITS+1);this.heap=new utils.Buf16(2*L_CODES+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new utils.Buf16(2*L_CODES+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}
function deflateResetKeep(strm){var s;if(!strm||!strm.state){return err(strm,Z_STREAM_ERROR)}
strm.total_in=strm.total_out=0;strm.data_type=Z_UNKNOWN;s=strm.state;s.pending=0;s.pending_out=0;if(s.wrap<0){s.wrap=-s.wrap}
s.status=(s.wrap?INIT_STATE:BUSY_STATE);strm.adler=(s.wrap===2)?0:1;s.last_flush=Z_NO_FLUSH;trees._tr_init(s);return Z_OK}
function deflateReset(strm){var ret=deflateResetKeep(strm);if(ret===Z_OK){lm_init(strm.state)}
return ret}
function deflateSetHeader(strm,head){if(!strm||!strm.state){return Z_STREAM_ERROR}
if(strm.state.wrap!==2){return Z_STREAM_ERROR}
strm.state.gzhead=head;return Z_OK}
function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm){return Z_STREAM_ERROR}
var wrap=1;if(level===Z_DEFAULT_COMPRESSION){level=6}
if(windowBits<0){wrap=0;windowBits=-windowBits}
else if(windowBits>15){wrap=2;windowBits-=16}
if(memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED){return err(strm,Z_STREAM_ERROR)}
if(windowBits===8){windowBits=9}
var s=new DeflateState();strm.state=s;s.strm=strm;s.wrap=wrap;s.gzhead=null;s.w_bits=windowBits;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=memLevel+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH);s.window=new utils.Buf8(s.w_size*2);s.head=new utils.Buf16(s.hash_size);s.prev=new utils.Buf16(s.w_size);s.lit_bufsize=1<<(memLevel+6);s.pending_buf_size=s.lit_bufsize*4;s.pending_buf=new utils.Buf8(s.pending_buf_size);s.d_buf=1*s.lit_bufsize;s.l_buf=(1+2)*s.lit_bufsize;s.level=level;s.strategy=strategy;s.method=method;return deflateReset(strm)}
function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}
function deflate(strm,flush){var old_flush,s;var beg,val;if(!strm||!strm.state||flush>Z_BLOCK||flush<0){return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR}
s=strm.state;if(!strm.output||(!strm.input&&strm.avail_in!==0)||(s.status===FINISH_STATE&&flush!==Z_FINISH)){return err(strm,(strm.avail_out===0)?Z_BUF_ERROR:Z_STREAM_ERROR)}
s.strm=strm;old_flush=s.last_flush;s.last_flush=flush;if(s.status===INIT_STATE){if(s.wrap===2){strm.adler=0;put_byte(s,31);put_byte(s,139);put_byte(s,8);if(!s.gzhead){put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,s.level===9?2:(s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0));put_byte(s,OS_CODE);s.status=BUSY_STATE}
else{put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(!s.gzhead.extra?0:4)+(!s.gzhead.name?0:8)+(!s.gzhead.comment?0:16));put_byte(s,s.gzhead.time&0xff);put_byte(s,(s.gzhead.time>>8)&0xff);put_byte(s,(s.gzhead.time>>16)&0xff);put_byte(s,(s.gzhead.time>>24)&0xff);put_byte(s,s.level===9?2:(s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0));put_byte(s,s.gzhead.os&0xff);if(s.gzhead.extra&&s.gzhead.extra.length){put_byte(s,s.gzhead.extra.length&0xff);put_byte(s,(s.gzhead.extra.length>>8)&0xff)}
if(s.gzhead.hcrc){strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0)}
s.gzindex=0;s.status=EXTRA_STATE}}
else{var header=(Z_DEFLATED+((s.w_bits-8)<<4))<<8;var level_flags=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2){level_flags=0}else if(s.level<6){level_flags=1}else if(s.level===6){level_flags=2}else{level_flags=3}
header|=(level_flags<<6);if(s.strstart!==0){header|=PRESET_DICT}
header+=31-(header%31);s.status=BUSY_STATE;putShortMSB(s,header);if(s.strstart!==0){putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&0xffff)}
strm.adler=1}}
if(s.status===EXTRA_STATE){if(s.gzhead.extra){beg=s.pending;while(s.gzindex<(s.gzhead.extra.length&0xffff)){if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}
flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){break}}
put_byte(s,s.gzhead.extra[s.gzindex]&0xff);s.gzindex++}
if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}
if(s.gzindex===s.gzhead.extra.length){s.gzindex=0;s.status=NAME_STATE}}
else{s.status=NAME_STATE}}
if(s.status===NAME_STATE){if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}
flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}
if(s.gzindex<s.gzhead.name.length){val=s.gzhead.name.charCodeAt(s.gzindex++)&0xff}else{val=0}
put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}
if(val===0){s.gzindex=0;s.status=COMMENT_STATE}}
else{s.status=COMMENT_STATE}}
if(s.status===COMMENT_STATE){if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}
flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}
if(s.gzindex<s.gzhead.comment.length){val=s.gzhead.comment.charCodeAt(s.gzindex++)&0xff}else{val=0}
put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}
if(val===0){s.status=HCRC_STATE}}
else{s.status=HCRC_STATE}}
if(s.status===HCRC_STATE){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size){flush_pending(strm)}
if(s.pending+2<=s.pending_buf_size){put_byte(s,strm.adler&0xff);put_byte(s,(strm.adler>>8)&0xff);strm.adler=0;s.status=BUSY_STATE}}
else{s.status=BUSY_STATE}}
if(s.pending!==0){flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH){return err(strm,Z_BUF_ERROR)}
if(s.status===FINISH_STATE&&strm.avail_in!==0){return err(strm,Z_BUF_ERROR)}
if(strm.avail_in!==0||s.lookahead!==0||(flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE)){var bstate=(s.strategy===Z_HUFFMAN_ONLY)?deflate_huff(s,flush):(s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush));if(bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE){s.status=FINISH_STATE}
if(bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED){if(strm.avail_out===0){s.last_flush=-1}
return Z_OK}
if(bstate===BS_BLOCK_DONE){if(flush===Z_PARTIAL_FLUSH){trees._tr_align(s)}
else if(flush!==Z_BLOCK){trees._tr_stored_block(s,0,0,!1);if(flush===Z_FULL_FLUSH){zero(s.head);if(s.lookahead===0){s.strstart=0;s.block_start=0;s.insert=0}}}
flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}}
if(flush!==Z_FINISH){return Z_OK}
if(s.wrap<=0){return Z_STREAM_END}
if(s.wrap===2){put_byte(s,strm.adler&0xff);put_byte(s,(strm.adler>>8)&0xff);put_byte(s,(strm.adler>>16)&0xff);put_byte(s,(strm.adler>>24)&0xff);put_byte(s,strm.total_in&0xff);put_byte(s,(strm.total_in>>8)&0xff);put_byte(s,(strm.total_in>>16)&0xff);put_byte(s,(strm.total_in>>24)&0xff)}
else{putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&0xffff)}
flush_pending(strm);if(s.wrap>0){s.wrap=-s.wrap}
return s.pending!==0?Z_OK:Z_STREAM_END}
function deflateEnd(strm){var status;if(!strm||!strm.state){return Z_STREAM_ERROR}
status=strm.state.status;if(status!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE){return err(strm,Z_STREAM_ERROR)}
strm.state=null;return status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK}
function deflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var s;var str,n;var wrap;var avail;var next;var input;var tmpDict;if(!strm||!strm.state){return Z_STREAM_ERROR}
s=strm.state;wrap=s.wrap;if(wrap===2||(wrap===1&&s.status!==INIT_STATE)||s.lookahead){return Z_STREAM_ERROR}
if(wrap===1){strm.adler=adler32(strm.adler,dictionary,dictLength,0)}
s.wrap=0;if(dictLength>=s.w_size){if(wrap===0){zero(s.head);s.strstart=0;s.block_start=0;s.insert=0}
tmpDict=new utils.Buf8(s.w_size);utils.arraySet(tmpDict,dictionary,dictLength-s.w_size,s.w_size,0);dictionary=tmpDict;dictLength=s.w_size}
avail=strm.avail_in;next=strm.next_in;input=strm.input;strm.avail_in=dictLength;strm.next_in=0;strm.input=dictionary;fill_window(s);while(s.lookahead>=MIN_MATCH){str=s.strstart;n=s.lookahead-(MIN_MATCH-1);do{s.ins_h=((s.ins_h<<s.hash_shift)^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++}while(--n);s.strstart=str;s.lookahead=MIN_MATCH-1;fill_window(s)}
s.strstart+=s.lookahead;s.block_start=s.strstart;s.insert=s.lookahead;s.lookahead=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;strm.next_in=next;strm.input=input;strm.avail_in=avail;s.wrap=wrap;return Z_OK}
exports.deflateInit=deflateInit;exports.deflateInit2=deflateInit2;exports.deflateReset=deflateReset;exports.deflateResetKeep=deflateResetKeep;exports.deflateSetHeader=deflateSetHeader;exports.deflate=deflate;exports.deflateEnd=deflateEnd;exports.deflateSetDictionary=deflateSetDictionary;exports.deflateInfo='pako deflate (from Nodeca project)'},{"../utils/common":116,"./adler32":117,"./crc32":119,"./messages":124,"./trees":125}],121:[function(require,module,exports){'use strict';var BAD=30;var TYPE=12;module.exports=function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var s_window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;s_window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}
here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=(here>>>16)&0xff;if(op===0){output[_out++]=here&0xffff}
else if(op&16){len=here&0xffff;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}
len+=hold&((1<<op)-1);hold>>>=op;bits-=op}
if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}
here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=(here>>>16)&0xff;if(op&16){dist=here&0xffff;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}
dist+=hold&((1<<op)-1);if(dist>dmax){strm.msg='invalid distance too far back';state.mode=BAD;break top}
hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg='invalid distance too far back';state.mode=BAD;break top}}
from=0;from_source=s_window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}
else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}}
else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}
while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}
if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}
else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}
else if((op&64)===0){here=dcode[(here&0xffff)+(hold&((1<<op)-1))];continue dodist}
else{strm.msg='invalid distance code';state.mode=BAD;break top}
break}}
else if((op&64)===0){here=lcode[(here&0xffff)+(hold&((1<<op)-1))];continue dolen}
else if(op&32){state.mode=TYPE;break top}
else{strm.msg='invalid literal/length code';state.mode=BAD;break top}
break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=(_in<last?5+(last-_in):5-(_in-last));strm.avail_out=(_out<end?257+(end-_out):257-(_out-end));state.hold=hold;state.bits=bits;return}},{}],122:[function(require,module,exports){'use strict';var utils=require('../utils/common');var adler32=require('./adler32');var crc32=require('./crc32');var inflate_fast=require('./inffast');var inflate_table=require('./inftrees');var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function zswap32(q){return(((q>>>24)&0xff)+((q>>>8)&0xff00)+((q&0xff00)<<8)+((q&0xff)<<24))}
function InflateState(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}
function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}
state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg='';if(state.wrap){strm.adler=state.wrap&1}
state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK}
function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}
state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)}
function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state){return Z_STREAM_ERROR}
state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}
else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}
if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}
if(state.window!==null&&state.wbits!==windowBits){state.window=null}
state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)}
function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR}
state=new InflateState();strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}
return ret}
function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}
var virgin=!0;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8}
while(sym<256){state.lens[sym++]=9}
while(sym<280){state.lens[sym++]=7}
while(sym<288){state.lens[sym++]=8}
inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}
inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=!1}
state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5}
function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize)}
if(copy>=state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize}
else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy}
utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize}
else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0}
if(state.whave<state.wsize){state.whave+=dist}}}
return 0}
function inflate(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||(!strm.input&&strm.avail_in!==0)){return Z_STREAM_ERROR}
state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO}
put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}
while(bits<16){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
if((state.wrap&2)&&hold===0x8b1f){state.check=0;hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;state.check=crc32(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}
state.flags=0;if(state.head){state.head.done=!1}
if(!(state.wrap&1)||(((hold&0xff)<<8)+(hold>>8))%31){strm.msg='incorrect header check';state.mode=BAD;break}
if((hold&0x0f)!==Z_DEFLATED){strm.msg='unknown compression method';state.mode=BAD;break}
hold>>>=4;bits-=4;len=(hold&0x0f)+8;if(state.wbits===0){state.wbits=len}
else if(len>state.wbits){strm.msg='invalid window size';state.mode=BAD;break}
state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&0x200?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
state.flags=hold;if((state.flags&0xff)!==Z_DEFLATED){strm.msg='unknown compression method';state.mode=BAD;break}
if(state.flags&0xe000){strm.msg='unknown header flags set';state.mode=BAD;break}
if(state.head){state.head.text=((hold>>8)&1)}
if(state.flags&0x0200){hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;state.check=crc32(state.check,hbuf,2,0)}
hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
if(state.head){state.head.time=hold}
if(state.flags&0x0200){hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;hbuf[2]=(hold>>>16)&0xff;hbuf[3]=(hold>>>24)&0xff;state.check=crc32(state.check,hbuf,4,0)}
hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
if(state.head){state.head.xflags=(hold&0xff);state.head.os=(hold>>8)}
if(state.flags&0x0200){hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;state.check=crc32(state.check,hbuf,2,0)}
hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&0x0400){while(bits<16){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
state.length=hold;if(state.head){state.head.extra_len=hold}
if(state.flags&0x0200){hbuf[0]=hold&0xff;hbuf[1]=(hold>>>8)&0xff;state.check=crc32(state.check,hbuf,2,0)}
hold=0;bits=0}
else if(state.head){state.head.extra=null}
state.mode=EXTRA;case EXTRA:if(state.flags&0x0400){copy=state.length;if(copy>have){copy=have}
if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Array(state.head.extra_len)}
utils.arraySet(state.head.extra,input,next,copy,len)}
if(state.flags&0x0200){state.check=crc32(state.check,input,copy,next)}
have-=copy;next+=copy;state.length-=copy}
if(state.length){break inf_leave}}
state.length=0;state.mode=NAME;case NAME:if(state.flags&0x0800){if(have===0){break inf_leave}
copy=0;do{len=input[next+copy++];if(state.head&&len&&(state.length<65536)){state.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&0x0200){state.check=crc32(state.check,input,copy,next)}
have-=copy;next+=copy;if(len){break inf_leave}}
else if(state.head){state.head.name=null}
state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&0x1000){if(have===0){break inf_leave}
copy=0;do{len=input[next+copy++];if(state.head&&len&&(state.length<65536)){state.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&0x0200){state.check=crc32(state.check,input,copy,next)}
have-=copy;next+=copy;if(len){break inf_leave}}
else if(state.head){state.head.comment=null}
state.mode=HCRC;case HCRC:if(state.flags&0x0200){while(bits<16){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
if(hold!==(state.check&0xffff)){strm.msg='header crc mismatch';state.mode=BAD;break}
hold=0;bits=0}
if(state.head){state.head.hcrc=((state.flags>>9)&1);state.head.done=!0}
strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
strm.adler=state.check=zswap32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT}
strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave}
case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}
while(bits<3){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
state.last=(hold&0x01);hold>>>=1;bits-=1;switch((hold&0x03)){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}
break;case 2:state.mode=TABLE;break;case 3:strm.msg='invalid block type';state.mode=BAD}
hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
if((hold&0xffff)!==((hold>>>16)^0xffff)){strm.msg='invalid stored block lengths';state.mode=BAD;break}
state.length=hold&0xffff;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave}
case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have}
if(copy>left){copy=left}
if(copy===0){break inf_leave}
utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}
state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
state.nlen=(hold&0x1f)+257;hold>>>=5;bits-=5;state.ndist=(hold&0x1f)+1;hold>>>=5;bits-=5;state.ncode=(hold&0x0f)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg='too many length or distance symbols';state.mode=BAD;break}
state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
state.lens[order[state.have++]]=(hold&0x07);hold>>>=3;bits-=3}
while(state.have<19){state.lens[order[state.have++]]=0}
state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg='invalid code lengths set';state.mode=BAD;break}
state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&((1<<state.lenbits)-1)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if((here_bits)<=bits){break}
if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}
else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg='invalid bit length repeat';state.mode=BAD;break}
len=state.lens[state.have-1];copy=3+(hold&0x03);hold>>>=2;bits-=2}
else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&0x07);hold>>>=3;bits-=3}
else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&0x7f);hold>>>=7;bits-=7}
if(state.have+copy>state.nlen+state.ndist){strm.msg='invalid bit length repeat';state.mode=BAD;break}
while(copy--){state.lens[state.have++]=len}}}
if(state.mode===BAD){break}
if(state.lens[256]===0){strm.msg='invalid code -- missing end-of-block';state.mode=BAD;break}
state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg='invalid literal/lengths set';state.mode=BAD;break}
state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg='invalid distances set';state.mode=BAD;break}
state.mode=LEN_;if(flush===Z_TREES){break inf_leave}
case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1}
break}
state.back=0;for(;;){here=state.lencode[hold&((1<<state.lenbits)-1)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if(here_bits<=bits){break}
if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
if(here_op&&(here_op&0xf0)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&((1<<(last_bits+last_op))-1))>>last_bits)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if((last_bits+here_bits)<=bits){break}
if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}
hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}
if(here_op&32){state.back=-1;state.mode=TYPE;break}
if(here_op&64){strm.msg='invalid literal/length code';state.mode=BAD;break}
state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
state.length+=hold&((1<<state.extra)-1);hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}
state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&((1<<state.distbits)-1)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if((here_bits)<=bits){break}
if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
if((here_op&0xf0)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&((1<<(last_bits+last_op))-1))>>last_bits)];here_bits=here>>>24;here_op=(here>>>16)&0xff;here_val=here&0xffff;if((last_bits+here_bits)<=bits){break}
if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}
hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg='invalid distance code';state.mode=BAD;break}
state.offset=here_val;state.extra=(here_op)&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
state.offset+=hold&((1<<state.extra)-1);hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}
if(state.offset>state.dmax){strm.msg='invalid distance too far back';state.mode=BAD;break}
state.mode=MATCH;case MATCH:if(left===0){break inf_leave}
copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg='invalid distance too far back';state.mode=BAD;break}}
if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}
else{from=state.wnext-copy}
if(copy>state.length){copy=state.length}
from_source=state.window}
else{from_source=output;from=put-state.offset;copy=state.length}
if(copy>left){copy=left}
left-=copy;state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state.length===0){state.mode=LEN}
break;case LIT:if(left===0){break inf_leave}
output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave}
have--;hold|=input[next++]<<bits;bits+=8}
_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=(state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out))}
_out=left;if((state.flags?hold:zswap32(hold))!==state.check){strm.msg='incorrect data check';state.mode=BAD;break}
hold=0;bits=0}
state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave}
have--;hold+=input[next++]<<bits;bits+=8}
if(hold!==(state.total&0xffffffff)){strm.msg='incorrect length check';state.mode=BAD;break}
hold=0;bits=0}
state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}}
strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||(_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH))){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state.mode=MEM;return Z_MEM_ERROR}}
_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=(state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out))}
strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if(((_in===0&&_out===0)||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR}
return ret}
function inflateEnd(strm){if(!strm||!strm.state){return Z_STREAM_ERROR}
var state=strm.state;if(state.window){state.window=null}
strm.state=null;return Z_OK}
function inflateGetHeader(strm,head){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}
state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR}
state.head=head;head.done=!1;return Z_OK}
function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var state;var dictid;var ret;if(!strm||!strm.state){return Z_STREAM_ERROR}
state=strm.state;if(state.wrap!==0&&state.mode!==DICT){return Z_STREAM_ERROR}
if(state.mode===DICT){dictid=1;dictid=adler32(dictid,dictionary,dictLength,0);if(dictid!==state.check){return Z_DATA_ERROR}}
ret=updatewindow(strm,dictionary,dictLength,dictLength);if(ret){state.mode=MEM;return Z_MEM_ERROR}
state.havedict=1;return Z_OK}
exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateSetDictionary=inflateSetDictionary;exports.inflateInfo='pako inflate (from Nodeca project)'},{"../utils/common":116,"./adler32":117,"./crc32":119,"./inffast":121,"./inftrees":123}],123:[function(require,module,exports){'use strict';var utils=require('../utils/common');var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts)
{var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}
for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}
root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}
if(root>max){root=max}
if(max===0){table[table_index++]=(1<<24)|(64<<16)|0;table[table_index++]=(1<<24)|(64<<16)|0;opts.bits=1;return 0}
for(min=1;min<max;min++){if(count[min]!==0){break}}
if(root<min){root=min}
left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}
if(left>0&&(type===CODES||max!==1)){return-1}
offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}
for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}
if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}
huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if((type===LENS&&used>ENOUGH_LENS)||(type===DISTS&&used>ENOUGH_DISTS)){return 1}
for(;;){here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}
else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}
else{here_op=32+64;here_val=0}
incr=1<<(len-drop);fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=(here_bits<<24)|(here_op<<16)|here_val|0}while(fill!==0);incr=1<<(len-1);while(huff&incr){incr>>=1}
if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}
sym++;if(--count[len]===0){if(len===max){break}
len=lens[lens_index+work[sym]]}
if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}
next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}
curr++;left<<=1}
used+=1<<curr;if((type===LENS&&used>ENOUGH_LENS)||(type===DISTS&&used>ENOUGH_DISTS)){return 1}
low=huff&mask;table[low]=(root<<24)|(curr<<16)|(next-table_index)|0}}
if(huff!==0){table[next+huff]=((len-drop)<<24)|(64<<16)|0}
opts.bits=root;return 0}},{"../utils/common":116}],124:[function(require,module,exports){'use strict';module.exports={2:'need dictionary',1:'stream end',0:'','-1':'file error','-2':'stream error','-3':'data error','-4':'insufficient memory','-5':'buffer error','-6':'incompatible version'}},{}],125:[function(require,module,exports){'use strict';var utils=require('../utils/common');var Z_FIXED=4;var Z_BINARY=0;var Z_TEXT=1;var Z_UNKNOWN=2;function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}
var STORED_BLOCK=0;var STATIC_TREES=1;var DYN_TREES=2;var MIN_MATCH=3;var MAX_MATCH=258;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var Buf_size=16;var MAX_BL_BITS=7;var END_BLOCK=256;var REP_3_6=16;var REPZ_3_10=17;var REPZ_11_138=18;var extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var DIST_CODE_LEN=512;var static_ltree=new Array((L_CODES+2)*2);zero(static_ltree);var static_dtree=new Array(D_CODES*2);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES);zero(base_dist);function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree;this.extra_bits=extra_bits;this.extra_base=extra_base;this.elems=elems;this.max_length=max_length;this.has_stree=static_tree&&static_tree.length}
var static_l_desc;var static_d_desc;var static_bl_desc;function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree;this.max_code=0;this.stat_desc=stat_desc}
function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}
function put_short(s,w){s.pending_buf[s.pending++]=(w)&0xff;s.pending_buf[s.pending++]=(w>>>8)&0xff}
function send_bits(s,value,length){if(s.bi_valid>(Buf_size-length)){s.bi_buf|=(value<<s.bi_valid)&0xffff;put_short(s,s.bi_buf);s.bi_buf=value>>(Buf_size-s.bi_valid);s.bi_valid+=length-Buf_size}else{s.bi_buf|=(value<<s.bi_valid)&0xffff;s.bi_valid+=length}}
function send_code(s,c,tree){send_bits(s,tree[c*2],tree[c*2+1])}
function bi_reverse(code,len){var res=0;do{res|=code&1;code>>>=1;res<<=1}while(--len>0);return res>>>1}
function bi_flush(s){if(s.bi_valid===16){put_short(s,s.bi_buf);s.bi_buf=0;s.bi_valid=0}else if(s.bi_valid>=8){s.pending_buf[s.pending++]=s.bi_buf&0xff;s.bi_buf>>=8;s.bi_valid-=8}}
function gen_bitlen(s,desc)
{var tree=desc.dyn_tree;var max_code=desc.max_code;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var extra=desc.stat_desc.extra_bits;var base=desc.stat_desc.extra_base;var max_length=desc.stat_desc.max_length;var h;var n,m;var bits;var xbits;var f;var overflow=0;for(bits=0;bits<=MAX_BITS;bits++){s.bl_count[bits]=0}
tree[s.heap[s.heap_max]*2+1]=0;for(h=s.heap_max+1;h<HEAP_SIZE;h++){n=s.heap[h];bits=tree[tree[n*2+1]*2+1]+1;if(bits>max_length){bits=max_length;overflow++}
tree[n*2+1]=bits;if(n>max_code){continue}
s.bl_count[bits]++;xbits=0;if(n>=base){xbits=extra[n-base]}
f=tree[n*2];s.opt_len+=f*(bits+xbits);if(has_stree){s.static_len+=f*(stree[n*2+1]+xbits)}}
if(overflow===0){return}
do{bits=max_length-1;while(s.bl_count[bits]===0){bits--}
s.bl_count[bits]--;s.bl_count[bits+1]+=2;s.bl_count[max_length]--;overflow-=2}while(overflow>0);for(bits=max_length;bits!==0;bits--){n=s.bl_count[bits];while(n!==0){m=s.heap[--h];if(m>max_code){continue}
if(tree[m*2+1]!==bits){s.opt_len+=(bits-tree[m*2+1])*tree[m*2];tree[m*2+1]=bits}
n--}}}
function gen_codes(tree,max_code,bl_count)
{var next_code=new Array(MAX_BITS+1);var code=0;var bits;var n;for(bits=1;bits<=MAX_BITS;bits++){next_code[bits]=code=(code+bl_count[bits-1])<<1}
for(n=0;n<=max_code;n++){var len=tree[n*2+1];if(len===0){continue}
tree[n*2]=bi_reverse(next_code[len]++,len)}}
function tr_static_init(){var n;var bits;var length;var code;var dist;var bl_count=new Array(MAX_BITS+1);length=0;for(code=0;code<LENGTH_CODES-1;code++){base_length[code]=length;for(n=0;n<(1<<extra_lbits[code]);n++){_length_code[length++]=code}}
_length_code[length-1]=code;dist=0;for(code=0;code<16;code++){base_dist[code]=dist;for(n=0;n<(1<<extra_dbits[code]);n++){_dist_code[dist++]=code}}
dist>>=7;for(;code<D_CODES;code++){base_dist[code]=dist<<7;for(n=0;n<(1<<(extra_dbits[code]-7));n++){_dist_code[256+dist++]=code}}
for(bits=0;bits<=MAX_BITS;bits++){bl_count[bits]=0}
n=0;while(n<=143){static_ltree[n*2+1]=8;n++;bl_count[8]++}
while(n<=255){static_ltree[n*2+1]=9;n++;bl_count[9]++}
while(n<=279){static_ltree[n*2+1]=7;n++;bl_count[7]++}
while(n<=287){static_ltree[n*2+1]=8;n++;bl_count[8]++}
gen_codes(static_ltree,L_CODES+1,bl_count);for(n=0;n<D_CODES;n++){static_dtree[n*2+1]=5;static_dtree[n*2]=bi_reverse(n,5)}
static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS);static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS);static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}
function init_block(s){var n;for(n=0;n<L_CODES;n++){s.dyn_ltree[n*2]=0}
for(n=0;n<D_CODES;n++){s.dyn_dtree[n*2]=0}
for(n=0;n<BL_CODES;n++){s.bl_tree[n*2]=0}
s.dyn_ltree[END_BLOCK*2]=1;s.opt_len=s.static_len=0;s.last_lit=s.matches=0}
function bi_windup(s)
{if(s.bi_valid>8){put_short(s,s.bi_buf)}else if(s.bi_valid>0){s.pending_buf[s.pending++]=s.bi_buf}
s.bi_buf=0;s.bi_valid=0}
function copy_block(s,buf,len,header)
{bi_windup(s);if(header){put_short(s,len);put_short(s,~len)}
utils.arraySet(s.pending_buf,s.window,buf,len,s.pending);s.pending+=len}
function smaller(tree,n,m,depth){var _n2=n*2;var _m2=m*2;return(tree[_n2]<tree[_m2]||(tree[_n2]===tree[_m2]&&depth[n]<=depth[m]))}
function pqdownheap(s,tree,k)
{var v=s.heap[k];var j=k<<1;while(j<=s.heap_len){if(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)){j++}
if(smaller(tree,v,s.heap[j],s.depth)){break}
s.heap[k]=s.heap[j];k=j;j<<=1}
s.heap[k]=v}
function compress_block(s,ltree,dtree)
{var dist;var lc;var lx=0;var code;var extra;if(s.last_lit!==0){do{dist=(s.pending_buf[s.d_buf+lx*2]<<8)|(s.pending_buf[s.d_buf+lx*2+1]);lc=s.pending_buf[s.l_buf+lx];lx++;if(dist===0){send_code(s,lc,ltree)}else{code=_length_code[lc];send_code(s,code+LITERALS+1,ltree);extra=extra_lbits[code];if(extra!==0){lc-=base_length[code];send_bits(s,lc,extra)}
dist--;code=d_code(dist);send_code(s,code,dtree);extra=extra_dbits[code];if(extra!==0){dist-=base_dist[code];send_bits(s,dist,extra)}}}while(lx<s.last_lit);}
send_code(s,END_BLOCK,ltree)}
function build_tree(s,desc)
{var tree=desc.dyn_tree;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var elems=desc.stat_desc.elems;var n,m;var max_code=-1;var node;s.heap_len=0;s.heap_max=HEAP_SIZE;for(n=0;n<elems;n++){if(tree[n*2]!==0){s.heap[++s.heap_len]=max_code=n;s.depth[n]=0}else{tree[n*2+1]=0}}
while(s.heap_len<2){node=s.heap[++s.heap_len]=(max_code<2?++max_code:0);tree[node*2]=1;s.depth[node]=0;s.opt_len--;if(has_stree){s.static_len-=stree[node*2+1]}}
desc.max_code=max_code;for(n=(s.heap_len>>1);n>=1;n--){pqdownheap(s,tree,n)}
node=elems;do{n=s.heap[1];s.heap[1]=s.heap[s.heap_len--];pqdownheap(s,tree,1);m=s.heap[1];s.heap[--s.heap_max]=n;s.heap[--s.heap_max]=m;tree[node*2]=tree[n*2]+tree[m*2];s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1;tree[n*2+1]=tree[m*2+1]=node;s.heap[1]=node++;pqdownheap(s,tree,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1];gen_bitlen(s,desc);gen_codes(tree,max_code,s.bl_count)}
function scan_tree(s,tree,max_code)
{var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}
tree[(max_code+1)*2+1]=0xffff;for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){s.bl_tree[curlen*2]+=count}else if(curlen!==0){if(curlen!==prevlen){s.bl_tree[curlen*2]++}
s.bl_tree[REP_3_6*2]++}else if(count<=10){s.bl_tree[REPZ_3_10*2]++}else{s.bl_tree[REPZ_11_138*2]++}
count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}
function send_tree(s,tree,max_code)
{var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}
for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){do{send_code(s,curlen,s.bl_tree)}while(--count!==0);}else if(curlen!==0){if(curlen!==prevlen){send_code(s,curlen,s.bl_tree);count--}
send_code(s,REP_3_6,s.bl_tree);send_bits(s,count-3,2)}else if(count<=10){send_code(s,REPZ_3_10,s.bl_tree);send_bits(s,count-3,3)}else{send_code(s,REPZ_11_138,s.bl_tree);send_bits(s,count-11,7)}
count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}
function build_bl_tree(s){var max_blindex;scan_tree(s,s.dyn_ltree,s.l_desc.max_code);scan_tree(s,s.dyn_dtree,s.d_desc.max_code);build_tree(s,s.bl_desc);for(max_blindex=BL_CODES-1;max_blindex>=3;max_blindex--){if(s.bl_tree[bl_order[max_blindex]*2+1]!==0){break}}
s.opt_len+=3*(max_blindex+1)+5+5+4;return max_blindex}
function send_all_trees(s,lcodes,dcodes,blcodes)
{var rank;send_bits(s,lcodes-257,5);send_bits(s,dcodes-1,5);send_bits(s,blcodes-4,4);for(rank=0;rank<blcodes;rank++){send_bits(s,s.bl_tree[bl_order[rank]*2+1],3)}
send_tree(s,s.dyn_ltree,lcodes-1);send_tree(s,s.dyn_dtree,dcodes-1)}
function detect_data_type(s){var black_mask=0xf3ffc07f;var n;for(n=0;n<=31;n++,black_mask>>>=1){if((black_mask&1)&&(s.dyn_ltree[n*2]!==0)){return Z_BINARY}}
if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0){return Z_TEXT}
for(n=32;n<LITERALS;n++){if(s.dyn_ltree[n*2]!==0){return Z_TEXT}}
return Z_BINARY}
var static_init_done=!1;function _tr_init(s)
{if(!static_init_done){tr_static_init();static_init_done=!0}
s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc);s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc);s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc);s.bi_buf=0;s.bi_valid=0;init_block(s)}
function _tr_stored_block(s,buf,stored_len,last)
{send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3);copy_block(s,buf,stored_len,!0)}
function _tr_align(s){send_bits(s,STATIC_TREES<<1,3);send_code(s,END_BLOCK,static_ltree);bi_flush(s)}
function _tr_flush_block(s,buf,stored_len,last)
{var opt_lenb,static_lenb;var max_blindex=0;if(s.level>0){if(s.strm.data_type===Z_UNKNOWN){s.strm.data_type=detect_data_type(s)}
build_tree(s,s.l_desc);build_tree(s,s.d_desc);max_blindex=build_bl_tree(s);opt_lenb=(s.opt_len+3+7)>>>3;static_lenb=(s.static_len+3+7)>>>3;if(static_lenb<=opt_lenb){opt_lenb=static_lenb}}else{opt_lenb=static_lenb=stored_len+5}
if((stored_len+4<=opt_lenb)&&(buf!==-1)){_tr_stored_block(s,buf,stored_len,last)}else if(s.strategy===Z_FIXED||static_lenb===opt_lenb){send_bits(s,(STATIC_TREES<<1)+(last?1:0),3);compress_block(s,static_ltree,static_dtree)}else{send_bits(s,(DYN_TREES<<1)+(last?1:0),3);send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1);compress_block(s,s.dyn_ltree,s.dyn_dtree)}
init_block(s);if(last){bi_windup(s)}}
function _tr_tally(s,dist,lc)
{s.pending_buf[s.d_buf+s.last_lit*2]=(dist>>>8)&0xff;s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&0xff;s.pending_buf[s.l_buf+s.last_lit]=lc&0xff;s.last_lit++;if(dist===0){s.dyn_ltree[lc*2]++}else{s.matches++;dist--;s.dyn_ltree[(_length_code[lc]+LITERALS+1)*2]++;s.dyn_dtree[d_code(dist)*2]++}
return(s.last_lit===s.lit_bufsize-1)}
exports._tr_init=_tr_init;exports._tr_stored_block=_tr_stored_block;exports._tr_flush_block=_tr_flush_block;exports._tr_tally=_tr_tally;exports._tr_align=_tr_align},{"../utils/common":116}],126:[function(require,module,exports){'use strict';function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg='';this.state=null;this.data_type=2;this.adler=0}
module.exports=ZStream},{}],127:[function(require,module,exports){module.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},{}],128:[function(require,module,exports){'use strict'
var asn1=require('asn1.js')
exports.certificate=require('./certificate')
var RSAPrivateKey=asn1.define('RSAPrivateKey',function(){this.seq().obj(this.key('version').int(),this.key('modulus').int(),this.key('publicExponent').int(),this.key('privateExponent').int(),this.key('prime1').int(),this.key('prime2').int(),this.key('exponent1').int(),this.key('exponent2').int(),this.key('coefficient').int())})
exports.RSAPrivateKey=RSAPrivateKey
var RSAPublicKey=asn1.define('RSAPublicKey',function(){this.seq().obj(this.key('modulus').int(),this.key('publicExponent').int())})
exports.RSAPublicKey=RSAPublicKey
var PublicKey=asn1.define('SubjectPublicKeyInfo',function(){this.seq().obj(this.key('algorithm').use(AlgorithmIdentifier),this.key('subjectPublicKey').bitstr())})
exports.PublicKey=PublicKey
var AlgorithmIdentifier=asn1.define('AlgorithmIdentifier',function(){this.seq().obj(this.key('algorithm').objid(),this.key('none').null_().optional(),this.key('curve').objid().optional(),this.key('params').seq().obj(this.key('p').int(),this.key('q').int(),this.key('g').int()).optional())})
var PrivateKeyInfo=asn1.define('PrivateKeyInfo',function(){this.seq().obj(this.key('version').int(),this.key('algorithm').use(AlgorithmIdentifier),this.key('subjectPrivateKey').octstr())})
exports.PrivateKey=PrivateKeyInfo
var EncryptedPrivateKeyInfo=asn1.define('EncryptedPrivateKeyInfo',function(){this.seq().obj(this.key('algorithm').seq().obj(this.key('id').objid(),this.key('decrypt').seq().obj(this.key('kde').seq().obj(this.key('id').objid(),this.key('kdeparams').seq().obj(this.key('salt').octstr(),this.key('iters').int())),this.key('cipher').seq().obj(this.key('algo').objid(),this.key('iv').octstr()))),this.key('subjectPrivateKey').octstr())})
exports.EncryptedPrivateKey=EncryptedPrivateKeyInfo
var DSAPrivateKey=asn1.define('DSAPrivateKey',function(){this.seq().obj(this.key('version').int(),this.key('p').int(),this.key('q').int(),this.key('g').int(),this.key('pub_key').int(),this.key('priv_key').int())})
exports.DSAPrivateKey=DSAPrivateKey
exports.DSAparam=asn1.define('DSAparam',function(){this.int()})
var ECPrivateKey=asn1.define('ECPrivateKey',function(){this.seq().obj(this.key('version').int(),this.key('privateKey').octstr(),this.key('parameters').optional().explicit(0).use(ECParameters),this.key('publicKey').optional().explicit(1).bitstr())})
exports.ECPrivateKey=ECPrivateKey
var ECParameters=asn1.define('ECParameters',function(){this.choice({namedCurve:this.objid()})})
exports.signature=asn1.define('signature',function(){this.seq().obj(this.key('r').int(),this.key('s').int())})},{"./certificate":129,"asn1.js":2}],129:[function(require,module,exports){'use strict'
var asn=require('asn1.js')
var Time=asn.define('Time',function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})})
var AttributeTypeValue=asn.define('AttributeTypeValue',function(){this.seq().obj(this.key('type').objid(),this.key('value').any())})
var AlgorithmIdentifier=asn.define('AlgorithmIdentifier',function(){this.seq().obj(this.key('algorithm').objid(),this.key('parameters').optional(),this.key('curve').objid().optional())})
var SubjectPublicKeyInfo=asn.define('SubjectPublicKeyInfo',function(){this.seq().obj(this.key('algorithm').use(AlgorithmIdentifier),this.key('subjectPublicKey').bitstr())})
var RelativeDistinguishedName=asn.define('RelativeDistinguishedName',function(){this.setof(AttributeTypeValue)})
var RDNSequence=asn.define('RDNSequence',function(){this.seqof(RelativeDistinguishedName)})
var Name=asn.define('Name',function(){this.choice({rdnSequence:this.use(RDNSequence)})})
var Validity=asn.define('Validity',function(){this.seq().obj(this.key('notBefore').use(Time),this.key('notAfter').use(Time))})
var Extension=asn.define('Extension',function(){this.seq().obj(this.key('extnID').objid(),this.key('critical').bool().def(!1),this.key('extnValue').octstr())})
var TBSCertificate=asn.define('TBSCertificate',function(){this.seq().obj(this.key('version').explicit(0).int().optional(),this.key('serialNumber').int(),this.key('signature').use(AlgorithmIdentifier),this.key('issuer').use(Name),this.key('validity').use(Validity),this.key('subject').use(Name),this.key('subjectPublicKeyInfo').use(SubjectPublicKeyInfo),this.key('issuerUniqueID').implicit(1).bitstr().optional(),this.key('subjectUniqueID').implicit(2).bitstr().optional(),this.key('extensions').explicit(3).seqof(Extension).optional())})
var X509Certificate=asn.define('X509Certificate',function(){this.seq().obj(this.key('tbsCertificate').use(TBSCertificate),this.key('signatureAlgorithm').use(AlgorithmIdentifier),this.key('signatureValue').bitstr())})
module.exports=X509Certificate},{"asn1.js":2}],130:[function(require,module,exports){var findProc=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r\+\/\=]+)[\n\r]+/m
var startRegex=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m
var fullRegex=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r\+\/\=]+)-----END \1-----$/m
var evp=require('evp_bytestokey')
var ciphers=require('browserify-aes')
var Buffer=require('safe-buffer').Buffer
module.exports=function(okey,password){var key=okey.toString()
var match=key.match(findProc)
var decrypted
if(!match){var match2=key.match(fullRegex)
decrypted=new Buffer(match2[2].replace(/[\r\n]/g,''),'base64')}else{var suite='aes'+match[1]
var iv=Buffer.from(match[2],'hex')
var cipherText=Buffer.from(match[3].replace(/[\r\n]/g,''),'base64')
var cipherKey=evp(password,iv.slice(0,8),parseInt(match[1],10)).key
var out=[]
var cipher=ciphers.createDecipheriv(suite,cipherKey,iv)
out.push(cipher.update(cipherText))
out.push(cipher.final())
decrypted=Buffer.concat(out)}
var tag=key.match(startRegex)[1]
return{tag:tag,data:decrypted}}},{"browserify-aes":26,"evp_bytestokey":91,"safe-buffer":167}],131:[function(require,module,exports){var asn1=require('./asn1')
var aesid=require('./aesid.json')
var fixProc=require('./fixProc')
var ciphers=require('browserify-aes')
var compat=require('pbkdf2')
var Buffer=require('safe-buffer').Buffer
module.exports=parseKeys
function parseKeys(buffer){var password
if(typeof buffer==='object'&&!Buffer.isBuffer(buffer)){password=buffer.passphrase
buffer=buffer.key}
if(typeof buffer==='string'){buffer=Buffer.from(buffer)}
var stripped=fixProc(buffer,password)
var type=stripped.tag
var data=stripped.data
var subtype,ndata
switch(type){case 'CERTIFICATE':ndata=asn1.certificate.decode(data,'der').tbsCertificate.subjectPublicKeyInfo
case 'PUBLIC KEY':if(!ndata){ndata=asn1.PublicKey.decode(data,'der')}
subtype=ndata.algorithm.algorithm.join('.')
switch(subtype){case '1.2.840.113549.1.1.1':return asn1.RSAPublicKey.decode(ndata.subjectPublicKey.data,'der')
case '1.2.840.10045.2.1':ndata.subjectPrivateKey=ndata.subjectPublicKey
return{type:'ec',data:ndata}
case '1.2.840.10040.4.1':ndata.algorithm.params.pub_key=asn1.DSAparam.decode(ndata.subjectPublicKey.data,'der')
return{type:'dsa',data:ndata.algorithm.params}
default:throw new Error('unknown key id '+subtype)}
throw new Error('unknown key type '+type)
case 'ENCRYPTED PRIVATE KEY':data=asn1.EncryptedPrivateKey.decode(data,'der')
data=decrypt(data,password)
case 'PRIVATE KEY':ndata=asn1.PrivateKey.decode(data,'der')
subtype=ndata.algorithm.algorithm.join('.')
switch(subtype){case '1.2.840.113549.1.1.1':return asn1.RSAPrivateKey.decode(ndata.subjectPrivateKey,'der')
case '1.2.840.10045.2.1':return{curve:ndata.algorithm.curve,privateKey:asn1.ECPrivateKey.decode(ndata.subjectPrivateKey,'der').privateKey}
case '1.2.840.10040.4.1':ndata.algorithm.params.priv_key=asn1.DSAparam.decode(ndata.subjectPrivateKey,'der')
return{type:'dsa',params:ndata.algorithm.params}
default:throw new Error('unknown key id '+subtype)}
throw new Error('unknown key type '+type)
case 'RSA PUBLIC KEY':return asn1.RSAPublicKey.decode(data,'der')
case 'RSA PRIVATE KEY':return asn1.RSAPrivateKey.decode(data,'der')
case 'DSA PRIVATE KEY':return{type:'dsa',params:asn1.DSAPrivateKey.decode(data,'der')}
case 'EC PRIVATE KEY':data=asn1.ECPrivateKey.decode(data,'der')
return{curve:data.parameters.value,privateKey:data.privateKey}
default:throw new Error('unknown key type '+type)}}
parseKeys.signature=asn1.signature
function decrypt(data,password){var salt=data.algorithm.decrypt.kde.kdeparams.salt
var iters=parseInt(data.algorithm.decrypt.kde.kdeparams.iters.toString(),10)
var algo=aesid[data.algorithm.decrypt.cipher.algo.join('.')]
var iv=data.algorithm.decrypt.cipher.iv
var cipherText=data.subjectPrivateKey
var keylen=parseInt(algo.split('-')[1],10)/8
var key=compat.pbkdf2Sync(password,salt,iters,keylen,'sha1')
var cipher=ciphers.createDecipheriv(algo,key,iv)
var out=[]
out.push(cipher.update(cipherText))
out.push(cipher.final())
return Buffer.concat(out)}},{"./aesid.json":127,"./asn1":128,"./fixProc":130,"browserify-aes":26,"pbkdf2":133,"safe-buffer":167}],132:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==='.'){parts.splice(i,1)}else if(last==='..'){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}
if(allowAboveRoot){for(;up--;up){parts.unshift('..')}}
return parts}
exports.resolve=function(){var resolvedPath='',resolvedAbsolute=!1;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=(i>=0)?arguments[i]:process.cwd();if(typeof path!=='string'){throw new TypeError('Arguments to path.resolve must be strings')}else if(!path){continue}
resolvedPath=path+'/'+resolvedPath;resolvedAbsolute=path.charAt(0)==='/'}
resolvedPath=normalizeArray(filter(resolvedPath.split('/'),function(p){return!!p}),!resolvedAbsolute).join('/');return((resolvedAbsolute?'/':'')+resolvedPath)||'.'};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==='/';path=normalizeArray(filter(path.split('/'),function(p){return!!p}),!isAbsolute).join('/');if(!path&&!isAbsolute){path='.'}
if(path&&trailingSlash){path+='/'}
return(isAbsolute?'/':'')+path};exports.isAbsolute=function(path){return path.charAt(0)==='/'};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=='string'){throw new TypeError('Arguments to path.join must be strings')}
return p}).join('/'))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=='')break}
var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=='')break}
if(start>end)return[];return arr.slice(start,end-start+1)}
var fromParts=trim(from.split('/'));var toParts=trim(to.split('/'));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}
var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push('..')}
outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join('/')};exports.sep='/';exports.delimiter=':';exports.dirname=function(path){if(typeof path!=='string')path=path+'';if(path.length===0)return'.';var code=path.charCodeAt(0);var hasRoot=code===47;var end=-1;var matchedSlash=!0;for(var i=path.length-1;i>=1;--i){code=path.charCodeAt(i);if(code===47){if(!matchedSlash){end=i;break}}else{matchedSlash=!1}}
if(end===-1)return hasRoot?'/':'.';if(hasRoot&&end===1){return'/'}
return path.slice(0,end)};function basename(path){if(typeof path!=='string')path=path+'';var start=0;var end=-1;var matchedSlash=!0;var i;for(i=path.length-1;i>=0;--i){if(path.charCodeAt(i)===47){if(!matchedSlash){start=i+1;break}}else if(end===-1){matchedSlash=!1;end=i+1}}
if(end===-1)return'';return path.slice(start,end)}
exports.basename=function(path,ext){var f=basename(path);if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}
return f};exports.extname=function(path){if(typeof path!=='string')path=path+'';var startDot=-1;var startPart=0;var end=-1;var matchedSlash=!0;var preDotState=0;for(var i=path.length-1;i>=0;--i){var code=path.charCodeAt(i);if(code===47){if(!matchedSlash){startPart=i+1;break}
continue}
if(end===-1){matchedSlash=!1;end=i+1}
if(code===46){if(startDot===-1)
startDot=i;else if(preDotState!==1)
preDotState=1}else if(startDot!==-1){preDotState=-1}}
if(startDot===-1||end===-1||preDotState===0||preDotState===1&&startDot===end-1&&startDot===startPart+1){return''}
return path.slice(startDot,end)};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}
return res}
var substr='ab'.substr(-1)==='b'?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require('_process'))},{"_process":139}],133:[function(require,module,exports){exports.pbkdf2=require('./lib/async')
exports.pbkdf2Sync=require('./lib/sync')},{"./lib/async":134,"./lib/sync":137}],134:[function(require,module,exports){(function(process,global){var checkParameters=require('./precondition')
var defaultEncoding=require('./default-encoding')
var sync=require('./sync')
var Buffer=require('safe-buffer').Buffer
var ZERO_BUF
var subtle=global.crypto&&global.crypto.subtle
var toBrowser={'sha':'SHA-1','sha-1':'SHA-1','sha1':'SHA-1','sha256':'SHA-256','sha-256':'SHA-256','sha384':'SHA-384','sha-384':'SHA-384','sha-512':'SHA-512','sha512':'SHA-512'}
var checks=[]
function checkNative(algo){if(global.process&&!global.process.browser){return Promise.resolve(!1)}
if(!subtle||!subtle.importKey||!subtle.deriveBits){return Promise.resolve(!1)}
if(checks[algo]!==undefined){return checks[algo]}
ZERO_BUF=ZERO_BUF||Buffer.alloc(8)
var prom=browserPbkdf2(ZERO_BUF,ZERO_BUF,10,128,algo).then(function(){return!0}).catch(function(){return!1})
checks[algo]=prom
return prom}
function browserPbkdf2(password,salt,iterations,length,algo){return subtle.importKey('raw',password,{name:'PBKDF2'},!1,['deriveBits']).then(function(key){return subtle.deriveBits({name:'PBKDF2',salt:salt,iterations:iterations,hash:{name:algo}},key,length<<3)}).then(function(res){return Buffer.from(res)})}
function resolvePromise(promise,callback){promise.then(function(out){process.nextTick(function(){callback(null,out)})},function(e){process.nextTick(function(){callback(e)})})}
module.exports=function(password,salt,iterations,keylen,digest,callback){if(typeof digest==='function'){callback=digest
digest=undefined}
digest=digest||'sha1'
var algo=toBrowser[digest.toLowerCase()]
if(!algo||typeof global.Promise!=='function'){return process.nextTick(function(){var out
try{out=sync(password,salt,iterations,keylen,digest)}catch(e){return callback(e)}
callback(null,out)})}
checkParameters(password,salt,iterations,keylen)
if(typeof callback!=='function')throw new Error('No callback provided to pbkdf2')
if(!Buffer.isBuffer(password))password=Buffer.from(password,defaultEncoding)
if(!Buffer.isBuffer(salt))salt=Buffer.from(salt,defaultEncoding)
resolvePromise(checkNative(algo).then(function(resp){if(resp)return browserPbkdf2(password,salt,iterations,keylen,algo)
return sync(password,salt,iterations,keylen,digest)}),callback)}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./default-encoding":135,"./precondition":136,"./sync":137,"_process":139,"safe-buffer":167}],135:[function(require,module,exports){(function(process){var defaultEncoding
if(process.browser){defaultEncoding='utf-8'}else{var pVersionMajor=parseInt(process.version.split('.')[0].slice(1),10)
defaultEncoding=pVersionMajor>=6?'utf-8':'binary'}
module.exports=defaultEncoding}).call(this,require('_process'))},{"_process":139}],136:[function(require,module,exports){(function(Buffer){var MAX_ALLOC=Math.pow(2,30)-1
function checkBuffer(buf,name){if(typeof buf!=='string'&&!Buffer.isBuffer(buf)){throw new TypeError(name+' must be a buffer or string')}}
module.exports=function(password,salt,iterations,keylen){checkBuffer(password,'Password')
checkBuffer(salt,'Salt')
if(typeof iterations!=='number'){throw new TypeError('Iterations not a number')}
if(iterations<0){throw new TypeError('Bad iterations')}
if(typeof keylen!=='number'){throw new TypeError('Key length not a number')}
if(keylen<0||keylen>MAX_ALLOC||keylen!==keylen){throw new TypeError('Bad key length')}}}).call(this,{"isBuffer":require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":109}],137:[function(require,module,exports){var md5=require('create-hash/md5')
var RIPEMD160=require('ripemd160')
var sha=require('sha.js')
var checkParameters=require('./precondition')
var defaultEncoding=require('./default-encoding')
var Buffer=require('safe-buffer').Buffer
var ZEROS=Buffer.alloc(128)
var sizes={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20}
function Hmac(alg,key,saltLen){var hash=getDigest(alg)
var blocksize=(alg==='sha512'||alg==='sha384')?128:64
if(key.length>blocksize){key=hash(key)}else if(key.length<blocksize){key=Buffer.concat([key,ZEROS],blocksize)}
var ipad=Buffer.allocUnsafe(blocksize+sizes[alg])
var opad=Buffer.allocUnsafe(blocksize+sizes[alg])
for(var i=0;i<blocksize;i++){ipad[i]=key[i]^0x36
opad[i]=key[i]^0x5C}
var ipad1=Buffer.allocUnsafe(blocksize+saltLen+4)
ipad.copy(ipad1,0,0,blocksize)
this.ipad1=ipad1
this.ipad2=ipad
this.opad=opad
this.alg=alg
this.blocksize=blocksize
this.hash=hash
this.size=sizes[alg]}
Hmac.prototype.run=function(data,ipad){data.copy(ipad,this.blocksize)
var h=this.hash(ipad)
h.copy(this.opad,this.blocksize)
return this.hash(this.opad)}
function getDigest(alg){function shaFunc(data){return sha(alg).update(data).digest()}
function rmd160Func(data){return new RIPEMD160().update(data).digest()}
if(alg==='rmd160'||alg==='ripemd160')return rmd160Func
if(alg==='md5')return md5
return shaFunc}
function pbkdf2(password,salt,iterations,keylen,digest){checkParameters(password,salt,iterations,keylen)
if(!Buffer.isBuffer(password))password=Buffer.from(password,defaultEncoding)
if(!Buffer.isBuffer(salt))salt=Buffer.from(salt,defaultEncoding)
digest=digest||'sha1'
var hmac=new Hmac(digest,password,salt.length)
var DK=Buffer.allocUnsafe(keylen)
var block1=Buffer.allocUnsafe(salt.length+4)
salt.copy(block1,0,0,salt.length)
var destPos=0
var hLen=sizes[digest]
var l=Math.ceil(keylen/hLen)
for(var i=1;i<=l;i++){block1.writeUInt32BE(i,salt.length)
var T=hmac.run(block1,hmac.ipad1)
var U=T
for(var j=1;j<iterations;j++){U=hmac.run(U,hmac.ipad2)
for(var k=0;k<hLen;k++)T[k]^=U[k]}
T.copy(DK,destPos)
destPos+=hLen}
return DK}
module.exports=pbkdf2},{"./default-encoding":135,"./precondition":136,"create-hash/md5":60,"ripemd160":166,"safe-buffer":167,"sha.js":169}],138:[function(require,module,exports){(function(process){'use strict';if(!process.version||process.version.indexOf('v0.')===0||process.version.indexOf('v1.')===0&&process.version.indexOf('v1.8.')!==0){module.exports={nextTick:nextTick}}else{module.exports=process}
function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=='function'){throw new TypeError('"callback" argument must be a function')}
var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}
return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require('_process'))},{"_process":139}],139:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error('setTimeout has not been defined')}
function defaultClearTimeout(){throw new Error('clearTimeout has not been defined')}(function(){try{if(typeof setTimeout==='function'){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}
try{if(typeof clearTimeout==='function'){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}}())
function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}
if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}
try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}
function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}
if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}
try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}
var queue=[];var draining=!1;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}
draining=!1;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}
if(queue.length){drainQueue()}}
function drainQueue(){if(draining){return}
var timeout=runTimeout(cleanUpNextTick);draining=!0;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}
queueIndex=-1;len=queue.length}
currentQueue=null;draining=!1;runClearTimeout(timeout)}
process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}
queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}
Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title='browser';process.browser=!0;process.env={};process.argv=[];process.version='';process.versions={};function noop(){}
process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]}
process.binding=function(name){throw new Error('process.binding is not supported')};process.cwd=function(){return'/'};process.chdir=function(dir){throw new Error('process.chdir is not supported')};process.umask=function(){return 0}},{}],140:[function(require,module,exports){exports.publicEncrypt=require('./publicEncrypt')
exports.privateDecrypt=require('./privateDecrypt')
exports.privateEncrypt=function privateEncrypt(key,buf){return exports.publicEncrypt(key,buf,!0)}
exports.publicDecrypt=function publicDecrypt(key,buf){return exports.privateDecrypt(key,buf,!0)}},{"./privateDecrypt":142,"./publicEncrypt":143}],141:[function(require,module,exports){var createHash=require('create-hash')
var Buffer=require('safe-buffer').Buffer
module.exports=function(seed,len){var t=Buffer.alloc(0)
var i=0
var c
while(t.length<len){c=i2ops(i++)
t=Buffer.concat([t,createHash('sha1').update(seed).update(c).digest()])}
return t.slice(0,len)}
function i2ops(c){var out=Buffer.allocUnsafe(4)
out.writeUInt32BE(c,0)
return out}},{"create-hash":59,"safe-buffer":167}],142:[function(require,module,exports){var parseKeys=require('parse-asn1')
var mgf=require('./mgf')
var xor=require('./xor')
var BN=require('bn.js')
var crt=require('browserify-rsa')
var createHash=require('create-hash')
var withPublic=require('./withPublic')
var Buffer=require('safe-buffer').Buffer
module.exports=function privateDecrypt(privateKey,enc,reverse){var padding
if(privateKey.padding){padding=privateKey.padding}else if(reverse){padding=1}else{padding=4}
var key=parseKeys(privateKey)
var k=key.modulus.byteLength()
if(enc.length>k||new BN(enc).cmp(key.modulus)>=0){throw new Error('decryption error')}
var msg
if(reverse){msg=withPublic(new BN(enc),key)}else{msg=crt(enc,key)}
var zBuffer=Buffer.alloc(k-msg.length)
msg=Buffer.concat([zBuffer,msg],k)
if(padding===4){return oaep(key,msg)}else if(padding===1){return pkcs1(key,msg,reverse)}else if(padding===3){return msg}else{throw new Error('unknown padding')}}
function oaep(key,msg){var k=key.modulus.byteLength()
var iHash=createHash('sha1').update(Buffer.alloc(0)).digest()
var hLen=iHash.length
if(msg[0]!==0){throw new Error('decryption error')}
var maskedSeed=msg.slice(1,hLen+1)
var maskedDb=msg.slice(hLen+1)
var seed=xor(maskedSeed,mgf(maskedDb,hLen))
var db=xor(maskedDb,mgf(seed,k-hLen-1))
if(compare(iHash,db.slice(0,hLen))){throw new Error('decryption error')}
var i=hLen
while(db[i]===0){i++}
if(db[i++]!==1){throw new Error('decryption error')}
return db.slice(i)}
function pkcs1(key,msg,reverse){var p1=msg.slice(0,2)
var i=2
var status=0
while(msg[i++]!==0){if(i>=msg.length){status++
break}}
var ps=msg.slice(2,i-1)
if((p1.toString('hex')!=='0002'&&!reverse)||(p1.toString('hex')!=='0001'&&reverse)){status++}
if(ps.length<8){status++}
if(status){throw new Error('decryption error')}
return msg.slice(i)}
function compare(a,b){a=Buffer.from(a)
b=Buffer.from(b)
var dif=0
var len=a.length
if(a.length!==b.length){dif++
len=Math.min(a.length,b.length)}
var i=-1
while(++i<len){dif+=(a[i]^b[i])}
return dif}},{"./mgf":141,"./withPublic":144,"./xor":145,"bn.js":21,"browserify-rsa":44,"create-hash":59,"parse-asn1":131,"safe-buffer":167}],143:[function(require,module,exports){var parseKeys=require('parse-asn1')
var randomBytes=require('randombytes')
var createHash=require('create-hash')
var mgf=require('./mgf')
var xor=require('./xor')
var BN=require('bn.js')
var withPublic=require('./withPublic')
var crt=require('browserify-rsa')
var Buffer=require('safe-buffer').Buffer
module.exports=function publicEncrypt(publicKey,msg,reverse){var padding
if(publicKey.padding){padding=publicKey.padding}else if(reverse){padding=1}else{padding=4}
var key=parseKeys(publicKey)
var paddedMsg
if(padding===4){paddedMsg=oaep(key,msg)}else if(padding===1){paddedMsg=pkcs1(key,msg,reverse)}else if(padding===3){paddedMsg=new BN(msg)
if(paddedMsg.cmp(key.modulus)>=0){throw new Error('data too long for modulus')}}else{throw new Error('unknown padding')}
if(reverse){return crt(paddedMsg,key)}else{return withPublic(paddedMsg,key)}}
function oaep(key,msg){var k=key.modulus.byteLength()
var mLen=msg.length
var iHash=createHash('sha1').update(Buffer.alloc(0)).digest()
var hLen=iHash.length
var hLen2=2*hLen
if(mLen>k-hLen2-2){throw new Error('message too long')}
var ps=Buffer.alloc(k-mLen-hLen2-2)
var dblen=k-hLen-1
var seed=randomBytes(hLen)
var maskedDb=xor(Buffer.concat([iHash,ps,Buffer.alloc(1,1),msg],dblen),mgf(seed,dblen))
var maskedSeed=xor(seed,mgf(maskedDb,hLen))
return new BN(Buffer.concat([Buffer.alloc(1),maskedSeed,maskedDb],k))}
function pkcs1(key,msg,reverse){var mLen=msg.length
var k=key.modulus.byteLength()
if(mLen>k-11){throw new Error('message too long')}
var ps
if(reverse){ps=Buffer.alloc(k-mLen-3,0xff)}else{ps=nonZero(k-mLen-3)}
return new BN(Buffer.concat([Buffer.from([0,reverse?1:2]),ps,Buffer.alloc(1),msg],k))}
function nonZero(len){var out=Buffer.allocUnsafe(len)
var i=0
var cache=randomBytes(len*2)
var cur=0
var num
while(i<len){if(cur===cache.length){cache=randomBytes(len*2)
cur=0}
num=cache[cur++]
if(num){out[i++]=num}}
return out}},{"./mgf":141,"./withPublic":144,"./xor":145,"bn.js":21,"browserify-rsa":44,"create-hash":59,"parse-asn1":131,"randombytes":150,"safe-buffer":167}],144:[function(require,module,exports){var BN=require('bn.js')
var Buffer=require('safe-buffer').Buffer
function withPublic(paddedMsg,key){return Buffer.from(paddedMsg.toRed(BN.mont(key.modulus)).redPow(new BN(key.publicExponent)).fromRed().toArray())}
module.exports=withPublic},{"bn.js":21,"safe-buffer":167}],145:[function(require,module,exports){module.exports=function xor(a,b){var len=a.length
var i=-1
while(++i<len){a[i]^=b[i]}
return a}},{}],146:[function(require,module,exports){(function(global){;(function(root){var freeExports=typeof exports=='object'&&exports&&!exports.nodeType&&exports;var freeModule=typeof module=='object'&&module&&!module.nodeType&&module;var freeGlobal=typeof global=='object'&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}
var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter='-',regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={'overflow':'Overflow: input needs wider integers to process','not-basic':'Illegal input >= 0x80 (not a basic code point)','invalid-input':'Invalid input'},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}
function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}
return result}
function mapDomain(string,fn){var parts=string.split('@');var result='';if(parts.length>1){result=parts[0]+'@';string=parts[1]}
string=string.replace(regexSeparators,'\x2E');var labels=string.split('.');var encoded=map(labels,fn).join('.');return result+encoded}
function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=0xD800&&value<=0xDBFF&&counter<length){extra=string.charCodeAt(counter++);if((extra&0xFC00)==0xDC00){output.push(((value&0x3FF)<<10)+(extra&0x3FF)+0x10000)}else{output.push(value);counter--}}else{output.push(value)}}
return output}
function ucs2encode(array){return map(array,function(value){var output='';if(value>0xFFFF){value-=0x10000;output+=stringFromCharCode(value>>>10&0x3FF|0xD800);value=0xDC00|value&0x3FF}
output+=stringFromCharCode(value);return output}).join('')}
function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}
if(codePoint-65<26){return codePoint-65}
if(codePoint-97<26){return codePoint-97}
return base}
function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}
function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}
return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}
function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}
for(j=0;j<basic;++j){if(input.charCodeAt(j)>=0x80){error('not-basic')}
output.push(input.charCodeAt(j))}
for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error('invalid-input')}
digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error('overflow')}
i+=digit*w;t=k<=bias?tMin:(k>=bias+tMax?tMax:k-bias);if(digit<t){break}
baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error('overflow')}
w*=baseMinusT}
out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error('overflow')}
n+=floor(i/out);i%=out;output.splice(i++,0,n)}
return ucs2encode(output)}
function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<0x80){output.push(stringFromCharCode(currentValue))}}
handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}
while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}
handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error('overflow')}
delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error('overflow')}
if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:(k>=bias+tMax?tMax:k-bias);if(q<t){break}
qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}
output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}
++delta;++n}
return output.join('')}
function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}
function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?'xn--'+encode(string):string})}
punycode={'version':'1.4.1','ucs2':{'decode':ucs2decode,'encode':ucs2encode},'decode':decode,'encode':encode,'toASCII':toASCII,'toUnicode':toUnicode};if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){define('punycode',function(){return punycode})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}}(this))}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],147:[function(require,module,exports){'use strict';function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}
module.exports=function(qs,sep,eq,options){sep=sep||'&';eq=eq||'=';var obj={};if(typeof qs!=='string'||qs.length===0){return obj}
var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1000;if(options&&typeof options.maxKeys==='number'){maxKeys=options.maxKeys}
var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}
for(var i=0;i<len;++i){var x=qs[i].replace(regexp,'%20'),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=''}
k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}
return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==='[object Array]'}},{}],148:[function(require,module,exports){'use strict';var stringifyPrimitive=function(v){switch(typeof v){case 'string':return v;case 'boolean':return v?'true':'false';case 'number':return isFinite(v)?v:'';default:return''}};module.exports=function(obj,sep,eq,name){sep=sep||'&';eq=eq||'=';if(obj===null){obj=undefined}
if(typeof obj==='object'){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}
if(!name)return'';return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==='[object Array]'};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}
return res}
var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}
return res}},{}],149:[function(require,module,exports){'use strict';exports.decode=exports.parse=require('./decode');exports.encode=exports.stringify=require('./encode')},{"./decode":147,"./encode":148}],150:[function(require,module,exports){(function(process,global){'use strict'
var MAX_BYTES=65536
var MAX_UINT32=4294967295
function oldBrowser(){throw new Error('Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11')}
var Buffer=require('safe-buffer').Buffer
var crypto=global.crypto||global.msCrypto
if(crypto&&crypto.getRandomValues){module.exports=randomBytes}else{module.exports=oldBrowser}
function randomBytes(size,cb){if(size>MAX_UINT32)throw new RangeError('requested too many random bytes')
var bytes=Buffer.allocUnsafe(size)
if(size>0){if(size>MAX_BYTES){for(var generated=0;generated<size;generated+=MAX_BYTES){crypto.getRandomValues(bytes.slice(generated,generated+MAX_BYTES))}}else{crypto.getRandomValues(bytes)}}
if(typeof cb==='function'){return process.nextTick(function(){cb(null,bytes)})}
return bytes}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"_process":139,"safe-buffer":167}],151:[function(require,module,exports){(function(process,global){'use strict'
function oldBrowser(){throw new Error('secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11')}
var safeBuffer=require('safe-buffer')
var randombytes=require('randombytes')
var Buffer=safeBuffer.Buffer
var kBufferMaxLength=safeBuffer.kMaxLength
var crypto=global.crypto||global.msCrypto
var kMaxUint32=Math.pow(2,32)-1
function assertOffset(offset,length){if(typeof offset!=='number'||offset!==offset){throw new TypeError('offset must be a number')}
if(offset>kMaxUint32||offset<0){throw new TypeError('offset must be a uint32')}
if(offset>kBufferMaxLength||offset>length){throw new RangeError('offset out of range')}}
function assertSize(size,offset,length){if(typeof size!=='number'||size!==size){throw new TypeError('size must be a number')}
if(size>kMaxUint32||size<0){throw new TypeError('size must be a uint32')}
if(size+offset>length||size>kBufferMaxLength){throw new RangeError('buffer too small')}}
if((crypto&&crypto.getRandomValues)||!process.browser){exports.randomFill=randomFill
exports.randomFillSync=randomFillSync}else{exports.randomFill=oldBrowser
exports.randomFillSync=oldBrowser}
function randomFill(buf,offset,size,cb){if(!Buffer.isBuffer(buf)&&!(buf instanceof global.Uint8Array)){throw new TypeError('"buf" argument must be a Buffer or Uint8Array')}
if(typeof offset==='function'){cb=offset
offset=0
size=buf.length}else if(typeof size==='function'){cb=size
size=buf.length-offset}else if(typeof cb!=='function'){throw new TypeError('"cb" argument must be a function')}
assertOffset(offset,buf.length)
assertSize(size,offset,buf.length)
return actualFill(buf,offset,size,cb)}
function actualFill(buf,offset,size,cb){if(process.browser){var ourBuf=buf.buffer
var uint=new Uint8Array(ourBuf,offset,size)
crypto.getRandomValues(uint)
if(cb){process.nextTick(function(){cb(null,buf)})
return}
return buf}
if(cb){randombytes(size,function(err,bytes){if(err){return cb(err)}
bytes.copy(buf,offset)
cb(null,buf)})
return}
var bytes=randombytes(size)
bytes.copy(buf,offset)
return buf}
function randomFillSync(buf,offset,size){if(typeof offset==='undefined'){offset=0}
if(!Buffer.isBuffer(buf)&&!(buf instanceof global.Uint8Array)){throw new TypeError('"buf" argument must be a Buffer or Uint8Array')}
assertOffset(offset,buf.length)
if(size===undefined)size=buf.length-offset
assertSize(size,offset,buf.length)
return actualFill(buf,offset,size)}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"_process":139,"randombytes":150,"safe-buffer":167}],152:[function(require,module,exports){module.exports=require('./lib/_stream_duplex.js')},{"./lib/_stream_duplex.js":153}],153:[function(require,module,exports){'use strict';var pna=require('process-nextick-args');var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var util=require('core-util-is');util.inherits=require('inherits');var Readable=require('./_stream_readable');var Writable=require('./_stream_writable');util.inherits(Duplex,Readable);{var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}}
function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===!1)this.readable=!1;if(options&&options.writable===!1)this.writable=!1;this.allowHalfOpen=!0;if(options&&options.allowHalfOpen===!1)this.allowHalfOpen=!1;this.once('end',onend)}
Object.defineProperty(Duplex.prototype,'writableHighWaterMark',{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function onend(){if(this.allowHalfOpen||this._writableState.ended)return;pna.nextTick(onEndNT,this)}
function onEndNT(self){self.end()}
Object.defineProperty(Duplex.prototype,'destroyed',{get:function(){if(this._readableState===undefined||this._writableState===undefined){return!1}
return this._readableState.destroyed&&this._writableState.destroyed},set:function(value){if(this._readableState===undefined||this._writableState===undefined){return}
this._readableState.destroyed=value;this._writableState.destroyed=value}});Duplex.prototype._destroy=function(err,cb){this.push(null);this.end();pna.nextTick(cb,err)}},{"./_stream_readable":155,"./_stream_writable":157,"core-util-is":57,"inherits":108,"process-nextick-args":138}],154:[function(require,module,exports){'use strict';module.exports=PassThrough;var Transform=require('./_stream_transform');var util=require('core-util-is');util.inherits=require('inherits');util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}
PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":156,"core-util-is":57,"inherits":108}],155:[function(require,module,exports){(function(process,global){'use strict';var pna=require('process-nextick-args');module.exports=Readable;var isArray=require('isarray');var Duplex;Readable.ReadableState=ReadableState;var EE=require('events').EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require('./internal/streams/stream');var Buffer=require('safe-buffer').Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}
function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}
var util=require('core-util-is');util.inherits=require('inherits');var debugUtil=require('util');var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog('stream')}else{debug=function(){}}
var BufferList=require('./internal/streams/BufferList');var destroyImpl=require('./internal/streams/destroy');var StringDecoder;util.inherits(Readable,Stream);var kProxyEvents=['error','close','destroy','pause','resume'];function prependListener(emitter,event,fn){if(typeof emitter.prependListener==='function')return emitter.prependListener(event,fn);if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}
function ReadableState(options,stream){Duplex=Duplex||require('./_stream_duplex');options=options||{};var isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var readableHwm=options.readableHighWaterMark;var defaultHwm=this.objectMode?16:16*1024;if(hwm||hwm===0)this.highWaterMark=hwm;else if(isDuplex&&(readableHwm||readableHwm===0))this.highWaterMark=readableHwm;else this.highWaterMark=defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.buffer=new BufferList();this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=!1;this.endEmitted=!1;this.reading=!1;this.sync=!0;this.needReadable=!1;this.emittedReadable=!1;this.readableListening=!1;this.resumeScheduled=!1;this.destroyed=!1;this.defaultEncoding=options.defaultEncoding||'utf8';this.awaitDrain=0;this.readingMore=!1;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require('string_decoder/').StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}
function Readable(options){Duplex=Duplex||require('./_stream_duplex');if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=!0;if(options){if(typeof options.read==='function')this._read=options.read;if(typeof options.destroy==='function')this._destroy=options.destroy}
Stream.call(this)}
Object.defineProperty(Readable.prototype,'destroyed',{get:function(){if(this._readableState===undefined){return!1}
return this._readableState.destroyed},set:function(value){if(!this._readableState){return}
this._readableState.destroyed=value}});Readable.prototype.destroy=destroyImpl.destroy;Readable.prototype._undestroy=destroyImpl.undestroy;Readable.prototype._destroy=function(err,cb){this.push(null);cb(err)};Readable.prototype.push=function(chunk,encoding){var state=this._readableState;var skipChunkCheck;if(!state.objectMode){if(typeof chunk==='string'){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=Buffer.from(chunk,encoding);encoding=''}
skipChunkCheck=!0}}else{skipChunkCheck=!0}
return readableAddChunk(this,chunk,encoding,!1,skipChunkCheck)};Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,!0,!1)};function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var state=stream._readableState;if(chunk===null){state.reading=!1;onEofChunk(stream,state)}else{var er;if(!skipChunkCheck)er=chunkInvalid(state,chunk);if(er){stream.emit('error',er)}else if(state.objectMode||chunk&&chunk.length>0){if(typeof chunk!=='string'&&!state.objectMode&&Object.getPrototypeOf(chunk)!==Buffer.prototype){chunk=_uint8ArrayToBuffer(chunk)}
if(addToFront){if(state.endEmitted)stream.emit('error',new Error('stream.unshift() after end event'));else addChunk(stream,state,chunk,!0)}else if(state.ended){stream.emit('error',new Error('stream.push() after EOF'))}else{state.reading=!1;if(state.decoder&&!encoding){chunk=state.decoder.write(chunk);if(state.objectMode||chunk.length!==0)addChunk(stream,state,chunk,!1);else maybeReadMore(stream,state)}else{addChunk(stream,state,chunk,!1)}}}else if(!addToFront){state.reading=!1}}
return needMoreData(state)}
function addChunk(stream,state,chunk,addToFront){if(state.flowing&&state.length===0&&!state.sync){stream.emit('data',chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}
maybeReadMore(stream,state)}
function chunkInvalid(state,chunk){var er;if(!_isUint8Array(chunk)&&typeof chunk!=='string'&&chunk!==undefined&&!state.objectMode){er=new TypeError('Invalid non-string/buffer chunk')}
return er}
function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}
Readable.prototype.isPaused=function(){return this._readableState.flowing===!1};Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require('string_decoder/').StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=0x800000;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}
return n}
function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}
if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=!0;return 0}
return state.length}
Readable.prototype.read=function(n){debug('read',n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=!1;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug('read: emitReadable',state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}
n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}
var doRead=state.needReadable;debug('need readable',doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=!0;debug('length less than watermark',doRead)}
if(state.ended||state.reading){doRead=!1;debug('reading or ended',doRead)}else if(doRead){debug('do read');state.reading=!0;state.sync=!0;if(state.length===0)state.needReadable=!0;this._read(state.highWaterMark);state.sync=!1;if(!state.reading)n=howMuchToRead(nOrig,state)}
var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=!0;n=0}else{state.length-=n}
if(state.length===0){if(!state.ended)state.needReadable=!0;if(nOrig!==n&&state.ended)endReadable(this)}
if(ret!==null)this.emit('data',ret);return ret};function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}
state.ended=!0;emitReadable(stream)}
function emitReadable(stream){var state=stream._readableState;state.needReadable=!1;if(!state.emittedReadable){debug('emitReadable',state.flowing);state.emittedReadable=!0;if(state.sync)pna.nextTick(emitReadable_,stream);else emitReadable_(stream)}}
function emitReadable_(stream){debug('emit readable');stream.emit('readable');flow(stream)}
function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=!0;pna.nextTick(maybeReadMore_,stream,state)}}
function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug('maybeReadMore read 0');stream.read(0);if(len===state.length)
break;else len=state.length}
state.readingMore=!1}
Readable.prototype._read=function(n){this.emit('error',new Error('_read() is not implemented'))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}
state.pipesCount+=1;debug('pipe count=%d opts=%j',state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:unpipe;if(state.endEmitted)pna.nextTick(endFn);else src.once('end',endFn);dest.on('unpipe',onunpipe);function onunpipe(readable,unpipeInfo){debug('onunpipe');if(readable===src){if(unpipeInfo&&unpipeInfo.hasUnpiped===!1){unpipeInfo.hasUnpiped=!0;cleanup()}}}
function onend(){debug('onend');dest.end()}
var ondrain=pipeOnDrain(src);dest.on('drain',ondrain);var cleanedUp=!1;function cleanup(){debug('cleanup');dest.removeListener('close',onclose);dest.removeListener('finish',onfinish);dest.removeListener('drain',ondrain);dest.removeListener('error',onerror);dest.removeListener('unpipe',onunpipe);src.removeListener('end',onend);src.removeListener('end',unpipe);src.removeListener('data',ondata);cleanedUp=!0;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}
var increasedAwaitDrain=!1;src.on('data',ondata);function ondata(chunk){debug('ondata');increasedAwaitDrain=!1;var ret=dest.write(chunk);if(!1===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug('false write response, pause',src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=!0}
src.pause()}}
function onerror(er){debug('onerror',er);unpipe();dest.removeListener('error',onerror);if(EElistenerCount(dest,'error')===0)dest.emit('error',er)}
prependListener(dest,'error',onerror);function onclose(){dest.removeListener('finish',onfinish);unpipe()}
dest.once('close',onclose);function onfinish(){debug('onfinish');dest.removeListener('close',onclose);unpipe()}
dest.once('finish',onfinish);function unpipe(){debug('unpipe');src.unpipe(dest)}
dest.emit('pipe',src);if(!state.flowing){debug('pipe resume');src.resume()}
return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug('pipeOnDrain',state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,'data')){state.flowing=!0;flow(src)}}}
Readable.prototype.unpipe=function(dest){var state=this._readableState;var unpipeInfo={hasUnpiped:!1};if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=!1;if(dest)dest.emit('unpipe',this,unpipeInfo);return this}
if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=!1;for(var i=0;i<len;i++){dests[i].emit('unpipe',this,unpipeInfo)}return this}
var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit('unpipe',this,unpipeInfo);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==='data'){if(this._readableState.flowing!==!1)this.resume()}else if(ev==='readable'){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=!0;state.emittedReadable=!1;if(!state.reading){pna.nextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this)}}}
return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug('readable nexttick read 0');self.read(0)}
Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug('resume');state.flowing=!0;resume(this,state)}
return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=!0;pna.nextTick(resume_,stream,state)}}
function resume_(stream,state){if(!state.reading){debug('resume read 0');stream.read(0)}
state.resumeScheduled=!1;state.awaitDrain=0;stream.emit('resume');flow(stream);if(state.flowing&&!state.reading)stream.read(0)}
Readable.prototype.pause=function(){debug('call pause flowing=%j',this._readableState.flowing);if(!1!==this._readableState.flowing){debug('pause');this._readableState.flowing=!1;this.emit('pause')}
return this};function flow(stream){var state=stream._readableState;debug('flow',state.flowing);while(state.flowing&&stream.read()!==null){}}
Readable.prototype.wrap=function(stream){var _this=this;var state=this._readableState;var paused=!1;stream.on('end',function(){debug('wrapped end');if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)_this.push(chunk)}
_this.push(null)});stream.on('data',function(chunk){debug('wrapped data');if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=_this.push(chunk);if(!ret){paused=!0;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==='function'){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}
for(var n=0;n<kProxyEvents.length;n++){stream.on(kProxyEvents[n],this.emit.bind(this,kProxyEvents[n]))}
this._read=function(n){debug('wrapped _read',n);if(paused){paused=!1;stream.resume()}};return this};Object.defineProperty(Readable.prototype,'readableHighWaterMark',{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join('');else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}
return ret}
function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}
return ret}
function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}
break}
++c}
list.length-=c;return ret}
function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}
break}
++c}
list.length-=c;return ret}
function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=!0;pna.nextTick(endReadableNT,state,stream)}}
function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=!0;stream.readable=!1;stream.emit('end')}}
function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}
return-1}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./_stream_duplex":153,"./internal/streams/BufferList":158,"./internal/streams/destroy":159,"./internal/streams/stream":160,"_process":139,"core-util-is":57,"events":90,"inherits":108,"isarray":110,"process-nextick-args":138,"safe-buffer":167,"string_decoder/":161,"util":23}],156:[function(require,module,exports){'use strict';module.exports=Transform;var Duplex=require('./_stream_duplex');var util=require('core-util-is');util.inherits=require('inherits');util.inherits(Transform,Duplex);function afterTransform(er,data){var ts=this._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb){return this.emit('error',new Error('write callback called multiple times'))}
ts.writechunk=null;ts.writecb=null;if(data!=null)
this.push(data);cb(er);var rs=this._readableState;rs.reading=!1;if(rs.needReadable||rs.length<rs.highWaterMark){this._read(rs.highWaterMark)}}
function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null};this._readableState.needReadable=!0;this._readableState.sync=!1;if(options){if(typeof options.transform==='function')this._transform=options.transform;if(typeof options.flush==='function')this._flush=options.flush}
this.on('prefinish',prefinish)}
function prefinish(){var _this=this;if(typeof this._flush==='function'){this._flush(function(er,data){done(_this,er,data)})}else{done(this,null,null)}}
Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=!1;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error('_transform() is not implemented')};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=!0;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=!0}};Transform.prototype._destroy=function(err,cb){var _this2=this;Duplex.prototype._destroy.call(this,err,function(err2){cb(err2);_this2.emit('close')})};function done(stream,er,data){if(er)return stream.emit('error',er);if(data!=null)
stream.push(data);if(stream._writableState.length)throw new Error('Calling transform done when ws.length != 0');if(stream._transformState.transforming)throw new Error('Calling transform done when still transforming');return stream.push(null)}},{"./_stream_duplex":153,"core-util-is":57,"inherits":108}],157:[function(require,module,exports){(function(process,global,setImmediate){'use strict';var pna=require('process-nextick-args');module.exports=Writable;function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}
function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(){onCorkedFinish(_this,state)}}
var asyncWrite=!process.browser&&['v0.10','v0.9.'].indexOf(process.version.slice(0,5))>-1?setImmediate:pna.nextTick;var Duplex;Writable.WritableState=WritableState;var util=require('core-util-is');util.inherits=require('inherits');var internalUtil={deprecate:require('util-deprecate')};var Stream=require('./internal/streams/stream');var Buffer=require('safe-buffer').Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}
function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}
var destroyImpl=require('./internal/streams/destroy');util.inherits(Writable,Stream);function nop(){}
function WritableState(options,stream){Duplex=Duplex||require('./_stream_duplex');options=options||{};var isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var writableHwm=options.writableHighWaterMark;var defaultHwm=this.objectMode?16:16*1024;if(hwm||hwm===0)this.highWaterMark=hwm;else if(isDuplex&&(writableHwm||writableHwm===0))this.highWaterMark=writableHwm;else this.highWaterMark=defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.finalCalled=!1;this.needDrain=!1;this.ending=!1;this.ended=!1;this.finished=!1;this.destroyed=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||'utf8';this.length=0;this.writing=!1;this.corked=0;this.sync=!0;this.bufferProcessing=!1;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=!1;this.errorEmitted=!1;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}
WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}
return out};(function(){try{Object.defineProperty(WritableState.prototype,'buffer',{get:internalUtil.deprecate(function(){return this.getBuffer()},'_writableState.buffer is deprecated. Use _writableState.getBuffer '+'instead.','DEP0003')})}catch(_){}})();var realHasInstance;if(typeof Symbol==='function'&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==='function'){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return!0;if(this!==Writable)return!1;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}
function Writable(options){Duplex=Duplex||require('./_stream_duplex');if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}
this._writableState=new WritableState(options,this);this.writable=!0;if(options){if(typeof options.write==='function')this._write=options.write;if(typeof options.writev==='function')this._writev=options.writev;if(typeof options.destroy==='function')this._destroy=options.destroy;if(typeof options.final==='function')this._final=options.final}
Stream.call(this)}
Writable.prototype.pipe=function(){this.emit('error',new Error('Cannot pipe, not readable'))};function writeAfterEnd(stream,cb){var er=new Error('write after end');stream.emit('error',er);pna.nextTick(cb,er)}
function validChunk(stream,state,chunk,cb){var valid=!0;var er=!1;if(chunk===null){er=new TypeError('May not write null values to stream')}else if(typeof chunk!=='string'&&chunk!==undefined&&!state.objectMode){er=new TypeError('Invalid non-string/buffer chunk')}
if(er){stream.emit('error',er);pna.nextTick(cb,er);valid=!1}
return valid}
Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=!1;var isBuf=!state.objectMode&&_isUint8Array(chunk);if(isBuf&&!Buffer.isBuffer(chunk)){chunk=_uint8ArrayToBuffer(chunk)}
if(typeof encoding==='function'){cb=encoding;encoding=null}
if(isBuf)encoding='buffer';else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=='function')cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)}
return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==='string')encoding=encoding.toLowerCase();if(!(['hex','utf8','utf-8','ascii','binary','base64','ucs2','ucs-2','utf16le','utf-16le','raw'].indexOf((encoding+'').toLowerCase())>-1))throw new TypeError('Unknown encoding: '+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==!1&&typeof chunk==='string'){chunk=Buffer.from(chunk,encoding)}
return chunk}
Object.defineProperty(Writable.prototype,'writableHighWaterMark',{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=decodeChunk(state,chunk,encoding);if(chunk!==newChunk){isBuf=!0;encoding='buffer';chunk=newChunk}}
var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=!0;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null};if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}
state.bufferedRequestCount+=1}else{doWrite(stream,state,!1,len,chunk,encoding,cb)}
return ret}
function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=!0;state.sync=!0;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=!1}
function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync){pna.nextTick(cb,er);pna.nextTick(finishMaybe,stream,state);stream._writableState.errorEmitted=!0;stream.emit('error',er)}else{cb(er);stream._writableState.errorEmitted=!0;stream.emit('error',er);finishMaybe(stream,state)}}
function onwriteStateUpdate(state){state.writing=!1;state.writecb=null;state.length-=state.writelen;state.writelen=0}
function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}
if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}
function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}
function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=!1;stream.emit('drain')}}
function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;var allBuffers=!0;while(entry){buffer[count]=entry;if(!entry.isBuf)allBuffers=!1;entry=entry.next;count+=1}
buffer.allBuffers=allBuffers;doWrite(stream,state,!0,state.length,buffer,'',holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}
state.bufferedRequestCount=0}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,!1,len,chunk,encoding,cb);entry=entry.next;state.bufferedRequestCount--;if(state.writing){break}}
if(entry===null)state.lastBufferedRequest=null}
state.bufferedRequest=entry;state.bufferProcessing=!1}
Writable.prototype._write=function(chunk,encoding,cb){cb(new Error('_write() is not implemented'))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==='function'){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==='function'){cb=encoding;encoding=null}
if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}
if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}
function callFinal(stream,state){stream._final(function(err){state.pendingcb--;if(err){stream.emit('error',err)}
state.prefinished=!0;stream.emit('prefinish');finishMaybe(stream,state)})}
function prefinish(stream,state){if(!state.prefinished&&!state.finalCalled){if(typeof stream._final==='function'){state.pendingcb++;state.finalCalled=!0;pna.nextTick(callFinal,stream,state)}else{state.prefinished=!0;stream.emit('prefinish')}}}
function finishMaybe(stream,state){var need=needFinish(state);if(need){prefinish(stream,state);if(state.pendingcb===0){state.finished=!0;stream.emit('finish')}}
return need}
function endWritable(stream,state,cb){state.ending=!0;finishMaybe(stream,state);if(cb){if(state.finished)pna.nextTick(cb);else stream.once('finish',cb)}
state.ended=!0;stream.writable=!1}
function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}
if(state.corkedRequestsFree){state.corkedRequestsFree.next=corkReq}else{state.corkedRequestsFree=corkReq}}
Object.defineProperty(Writable.prototype,'destroyed',{get:function(){if(this._writableState===undefined){return!1}
return this._writableState.destroyed},set:function(value){if(!this._writableState){return}
this._writableState.destroyed=value}});Writable.prototype.destroy=destroyImpl.destroy;Writable.prototype._undestroy=destroyImpl.undestroy;Writable.prototype._destroy=function(err,cb){this.end();cb(err)}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("timers").setImmediate)},{"./_stream_duplex":153,"./internal/streams/destroy":159,"./internal/streams/stream":160,"_process":139,"core-util-is":57,"inherits":108,"process-nextick-args":138,"safe-buffer":167,"timers":182,"util-deprecate":186}],158:[function(require,module,exports){'use strict';function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}
var Buffer=require('safe-buffer').Buffer;var util=require('util');function copyBuffer(src,target,offset){src.copy(target,offset)}
module.exports=function(){function BufferList(){_classCallCheck(this,BufferList);this.head=null;this.tail=null;this.length=0}
BufferList.prototype.push=function push(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function unshift(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function shift(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function clear(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function join(s){if(this.length===0)return'';var p=this.head;var ret=''+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function concat(n){if(this.length===0)return Buffer.alloc(0);if(this.length===1)return this.head.data;var ret=Buffer.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){copyBuffer(p.data,ret,i);i+=p.data.length;p=p.next}
return ret};return BufferList}();if(util&&util.inspect&&util.inspect.custom){module.exports.prototype[util.inspect.custom]=function(){var obj=util.inspect({length:this.length});return this.constructor.name+' '+obj}}},{"safe-buffer":167,"util":23}],159:[function(require,module,exports){'use strict';var pna=require('process-nextick-args');function destroy(err,cb){var _this=this;var readableDestroyed=this._readableState&&this._readableState.destroyed;var writableDestroyed=this._writableState&&this._writableState.destroyed;if(readableDestroyed||writableDestroyed){if(cb){cb(err)}else if(err&&(!this._writableState||!this._writableState.errorEmitted)){pna.nextTick(emitErrorNT,this,err)}
return this}
if(this._readableState){this._readableState.destroyed=!0}
if(this._writableState){this._writableState.destroyed=!0}
this._destroy(err||null,function(err){if(!cb&&err){pna.nextTick(emitErrorNT,_this,err);if(_this._writableState){_this._writableState.errorEmitted=!0}}else if(cb){cb(err)}});return this}
function undestroy(){if(this._readableState){this._readableState.destroyed=!1;this._readableState.reading=!1;this._readableState.ended=!1;this._readableState.endEmitted=!1}
if(this._writableState){this._writableState.destroyed=!1;this._writableState.ended=!1;this._writableState.ending=!1;this._writableState.finished=!1;this._writableState.errorEmitted=!1}}
function emitErrorNT(self,err){self.emit('error',err)}
module.exports={destroy:destroy,undestroy:undestroy}},{"process-nextick-args":138}],160:[function(require,module,exports){module.exports=require('events').EventEmitter},{"events":90}],161:[function(require,module,exports){'use strict';var Buffer=require('safe-buffer').Buffer;var isEncoding=Buffer.isEncoding||function(encoding){encoding=''+encoding;switch(encoding&&encoding.toLowerCase()){case 'hex':case 'utf8':case 'utf-8':case 'ascii':case 'binary':case 'base64':case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':case 'raw':return!0;default:return!1}};function _normalizeEncoding(enc){if(!enc)return'utf8';var retried;while(!0){switch(enc){case 'utf8':case 'utf-8':return'utf8';case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':return'utf16le';case 'latin1':case 'binary':return'latin1';case 'base64':case 'ascii':case 'hex':return enc;default:if(retried)return;enc=(''+enc).toLowerCase();retried=!0}}};function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if(typeof nenc!=='string'&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error('Unknown encoding: '+enc);return nenc||enc}
exports.StringDecoder=StringDecoder;function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case 'utf16le':this.text=utf16Text;this.end=utf16End;nb=4;break;case 'utf8':this.fillLast=utf8FillLast;nb=4;break;case 'base64':this.text=base64Text;this.end=base64End;nb=3;break;default:this.write=simpleWrite;this.end=simpleEnd;return}
this.lastNeed=0;this.lastTotal=0;this.lastChar=Buffer.allocUnsafe(nb)}
StringDecoder.prototype.write=function(buf){if(buf.length===0)return'';var r;var i;if(this.lastNeed){r=this.fillLast(buf);if(r===undefined)return'';i=this.lastNeed;this.lastNeed=0}else{i=0}
if(i<buf.length)return r?r+this.text(buf,i):this.text(buf,i);return r||''};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length){buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}
buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length);this.lastNeed-=buf.length};function utf8CheckByte(byte){if(byte<=0x7F)return 0;else if(byte>>5===0x06)return 2;else if(byte>>4===0x0E)return 3;else if(byte>>3===0x1E)return 4;return byte>>6===0x02?-1:-2}
function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-1;return nb}
if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-2;return nb}
if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0){if(nb===2)nb=0;else self.lastNeed=nb-3}
return nb}
return 0}
function utf8CheckExtraBytes(self,buf,p){if((buf[0]&0xC0)!==0x80){self.lastNeed=0;return'\ufffd'}
if(self.lastNeed>1&&buf.length>1){if((buf[1]&0xC0)!==0x80){self.lastNeed=1;return'\ufffd'}
if(self.lastNeed>2&&buf.length>2){if((buf[2]&0xC0)!==0x80){self.lastNeed=2;return'\ufffd'}}}}
function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed;var r=utf8CheckExtraBytes(this,buf,p);if(r!==undefined)return r;if(this.lastNeed<=buf.length){buf.copy(this.lastChar,p,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}
buf.copy(this.lastChar,p,0,buf.length);this.lastNeed-=buf.length}
function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString('utf8',i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);buf.copy(this.lastChar,0,end);return buf.toString('utf8',i,end)}
function utf8End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed)return r+'\ufffd';return r}
function utf16Text(buf,i){if((buf.length-i)%2===0){var r=buf.toString('utf16le',i);if(r){var c=r.charCodeAt(r.length-1);if(c>=0xD800&&c<=0xDBFF){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1];return r.slice(0,-1)}}
return r}
this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=buf[buf.length-1];return buf.toString('utf16le',i,buf.length-1)}
function utf16End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString('utf16le',0,end)}
return r}
function base64Text(buf,i){var n=(buf.length-i)%3;if(n===0)return buf.toString('base64',i);this.lastNeed=3-n;this.lastTotal=3;if(n===1){this.lastChar[0]=buf[buf.length-1]}else{this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1]}
return buf.toString('base64',i,buf.length-n)}
function base64End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed)return r+this.lastChar.toString('base64',0,3-this.lastNeed);return r}
function simpleWrite(buf){return buf.toString(this.encoding)}
function simpleEnd(buf){return buf&&buf.length?this.write(buf):''}},{"safe-buffer":167}],162:[function(require,module,exports){module.exports=require('./readable').PassThrough},{"./readable":163}],163:[function(require,module,exports){exports=module.exports=require('./lib/_stream_readable.js');exports.Stream=exports;exports.Readable=exports;exports.Writable=require('./lib/_stream_writable.js');exports.Duplex=require('./lib/_stream_duplex.js');exports.Transform=require('./lib/_stream_transform.js');exports.PassThrough=require('./lib/_stream_passthrough.js')},{"./lib/_stream_duplex.js":153,"./lib/_stream_passthrough.js":154,"./lib/_stream_readable.js":155,"./lib/_stream_transform.js":156,"./lib/_stream_writable.js":157}],164:[function(require,module,exports){module.exports=require('./readable').Transform},{"./readable":163}],165:[function(require,module,exports){module.exports=require('./lib/_stream_writable.js')},{"./lib/_stream_writable.js":157}],166:[function(require,module,exports){'use strict'
var Buffer=require('buffer').Buffer
var inherits=require('inherits')
var HashBase=require('hash-base')
var ARRAY16=new Array(16)
var zl=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]
var zr=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]
var sl=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]
var sr=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]
var hl=[0x00000000,0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xa953fd4e]
var hr=[0x50a28be6,0x5c4dd124,0x6d703ef3,0x7a6d76e9,0x00000000]
function RIPEMD160(){HashBase.call(this,64)
this._a=0x67452301
this._b=0xefcdab89
this._c=0x98badcfe
this._d=0x10325476
this._e=0xc3d2e1f0}
inherits(RIPEMD160,HashBase)
RIPEMD160.prototype._update=function(){var words=ARRAY16
for(var j=0;j<16;++j)words[j]=this._block.readInt32LE(j*4)
var al=this._a|0
var bl=this._b|0
var cl=this._c|0
var dl=this._d|0
var el=this._e|0
var ar=this._a|0
var br=this._b|0
var cr=this._c|0
var dr=this._d|0
var er=this._e|0
for(var i=0;i<80;i+=1){var tl
var tr
if(i<16){tl=fn1(al,bl,cl,dl,el,words[zl[i]],hl[0],sl[i])
tr=fn5(ar,br,cr,dr,er,words[zr[i]],hr[0],sr[i])}else if(i<32){tl=fn2(al,bl,cl,dl,el,words[zl[i]],hl[1],sl[i])
tr=fn4(ar,br,cr,dr,er,words[zr[i]],hr[1],sr[i])}else if(i<48){tl=fn3(al,bl,cl,dl,el,words[zl[i]],hl[2],sl[i])
tr=fn3(ar,br,cr,dr,er,words[zr[i]],hr[2],sr[i])}else if(i<64){tl=fn4(al,bl,cl,dl,el,words[zl[i]],hl[3],sl[i])
tr=fn2(ar,br,cr,dr,er,words[zr[i]],hr[3],sr[i])}else{tl=fn5(al,bl,cl,dl,el,words[zl[i]],hl[4],sl[i])
tr=fn1(ar,br,cr,dr,er,words[zr[i]],hr[4],sr[i])}
al=el
el=dl
dl=rotl(cl,10)
cl=bl
bl=tl
ar=er
er=dr
dr=rotl(cr,10)
cr=br
br=tr}
var t=(this._b+cl+dr)|0
this._b=(this._c+dl+er)|0
this._c=(this._d+el+ar)|0
this._d=(this._e+al+br)|0
this._e=(this._a+bl+cr)|0
this._a=t}
RIPEMD160.prototype._digest=function(){this._block[this._blockOffset++]=0x80
if(this._blockOffset>56){this._block.fill(0,this._blockOffset,64)
this._update()
this._blockOffset=0}
this._block.fill(0,this._blockOffset,56)
this._block.writeUInt32LE(this._length[0],56)
this._block.writeUInt32LE(this._length[1],60)
this._update()
var buffer=Buffer.alloc?Buffer.alloc(20):new Buffer(20)
buffer.writeInt32LE(this._a,0)
buffer.writeInt32LE(this._b,4)
buffer.writeInt32LE(this._c,8)
buffer.writeInt32LE(this._d,12)
buffer.writeInt32LE(this._e,16)
return buffer}
function rotl(x,n){return(x<<n)|(x>>>(32-n))}
function fn1(a,b,c,d,e,m,k,s){return(rotl((a+(b^c^d)+m+k)|0,s)+e)|0}
function fn2(a,b,c,d,e,m,k,s){return(rotl((a+((b&c)|((~b)&d))+m+k)|0,s)+e)|0}
function fn3(a,b,c,d,e,m,k,s){return(rotl((a+((b|(~c))^d)+m+k)|0,s)+e)|0}
function fn4(a,b,c,d,e,m,k,s){return(rotl((a+((b&d)|(c&(~d)))+m+k)|0,s)+e)|0}
function fn5(a,b,c,d,e,m,k,s){return(rotl((a+(b^(c|(~d)))+m+k)|0,s)+e)|0}
module.exports=RIPEMD160},{"buffer":54,"hash-base":92,"inherits":108}],167:[function(require,module,exports){var buffer=require('buffer')
var Buffer=buffer.Buffer
function copyProps(src,dst){for(var key in src){dst[key]=src[key]}}
if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=buffer}else{copyProps(buffer,exports)
exports.Buffer=SafeBuffer}
function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}
copyProps(Buffer,SafeBuffer)
SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==='number'){throw new TypeError('Argument must not be a number')}
return Buffer(arg,encodingOrOffset,length)}
SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=='number'){throw new TypeError('Argument must be a number')}
var buf=Buffer(size)
if(fill!==undefined){if(typeof encoding==='string'){buf.fill(fill,encoding)}else{buf.fill(fill)}}else{buf.fill(0)}
return buf}
SafeBuffer.allocUnsafe=function(size){if(typeof size!=='number'){throw new TypeError('Argument must be a number')}
return Buffer(size)}
SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=='number'){throw new TypeError('Argument must be a number')}
return buffer.SlowBuffer(size)}},{"buffer":54}],168:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
function Hash(blockSize,finalSize){this._block=Buffer.alloc(blockSize)
this._finalSize=finalSize
this._blockSize=blockSize
this._len=0}
Hash.prototype.update=function(data,enc){if(typeof data==='string'){enc=enc||'utf8'
data=Buffer.from(data,enc)}
var block=this._block
var blockSize=this._blockSize
var length=data.length
var accum=this._len
for(var offset=0;offset<length;){var assigned=accum%blockSize
var remainder=Math.min(length-offset,blockSize-assigned)
for(var i=0;i<remainder;i++){block[assigned+i]=data[offset+i]}
accum+=remainder
offset+=remainder
if((accum%blockSize)===0){this._update(block)}}
this._len+=length
return this}
Hash.prototype.digest=function(enc){var rem=this._len%this._blockSize
this._block[rem]=0x80
this._block.fill(0,rem+1)
if(rem>=this._finalSize){this._update(this._block)
this._block.fill(0)}
var bits=this._len*8
if(bits<=0xffffffff){this._block.writeUInt32BE(bits,this._blockSize-4)}else{var lowBits=(bits&0xffffffff)>>>0
var highBits=(bits-lowBits)/0x100000000
this._block.writeUInt32BE(highBits,this._blockSize-8)
this._block.writeUInt32BE(lowBits,this._blockSize-4)}
this._update(this._block)
var hash=this._hash()
return enc?hash.toString(enc):hash}
Hash.prototype._update=function(){throw new Error('_update must be implemented by subclass')}
module.exports=Hash},{"safe-buffer":167}],169:[function(require,module,exports){var exports=module.exports=function SHA(algorithm){algorithm=algorithm.toLowerCase()
var Algorithm=exports[algorithm]
if(!Algorithm)throw new Error(algorithm+' is not supported (we accept pull requests)')
return new Algorithm()}
exports.sha=require('./sha')
exports.sha1=require('./sha1')
exports.sha224=require('./sha224')
exports.sha256=require('./sha256')
exports.sha384=require('./sha384')
exports.sha512=require('./sha512')},{"./sha":170,"./sha1":171,"./sha224":172,"./sha256":173,"./sha384":174,"./sha512":175}],170:[function(require,module,exports){var inherits=require('inherits')
var Hash=require('./hash')
var Buffer=require('safe-buffer').Buffer
var K=[0x5a827999,0x6ed9eba1,0x8f1bbcdc|0,0xca62c1d6|0]
var W=new Array(80)
function Sha(){this.init()
this._w=W
Hash.call(this,64,56)}
inherits(Sha,Hash)
Sha.prototype.init=function(){this._a=0x67452301
this._b=0xefcdab89
this._c=0x98badcfe
this._d=0x10325476
this._e=0xc3d2e1f0
return this}
function rotl5(num){return(num<<5)|(num>>>27)}
function rotl30(num){return(num<<30)|(num>>>2)}
function ft(s,b,c,d){if(s===0)return(b&c)|((~b)&d)
if(s===2)return(b&c)|(b&d)|(c&d)
return b^c^d}
Sha.prototype._update=function(M){var W=this._w
var a=this._a|0
var b=this._b|0
var c=this._c|0
var d=this._d|0
var e=this._e|0
for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4)
for(;i<80;++i)W[i]=W[i-3]^W[i-8]^W[i-14]^W[i-16]
for(var j=0;j<80;++j){var s=~~(j/20)
var t=(rotl5(a)+ft(s,b,c,d)+e+W[j]+K[s])|0
e=d
d=c
c=rotl30(b)
b=a
a=t}
this._a=(a+this._a)|0
this._b=(b+this._b)|0
this._c=(c+this._c)|0
this._d=(d+this._d)|0
this._e=(e+this._e)|0}
Sha.prototype._hash=function(){var H=Buffer.allocUnsafe(20)
H.writeInt32BE(this._a|0,0)
H.writeInt32BE(this._b|0,4)
H.writeInt32BE(this._c|0,8)
H.writeInt32BE(this._d|0,12)
H.writeInt32BE(this._e|0,16)
return H}
module.exports=Sha},{"./hash":168,"inherits":108,"safe-buffer":167}],171:[function(require,module,exports){var inherits=require('inherits')
var Hash=require('./hash')
var Buffer=require('safe-buffer').Buffer
var K=[0x5a827999,0x6ed9eba1,0x8f1bbcdc|0,0xca62c1d6|0]
var W=new Array(80)
function Sha1(){this.init()
this._w=W
Hash.call(this,64,56)}
inherits(Sha1,Hash)
Sha1.prototype.init=function(){this._a=0x67452301
this._b=0xefcdab89
this._c=0x98badcfe
this._d=0x10325476
this._e=0xc3d2e1f0
return this}
function rotl1(num){return(num<<1)|(num>>>31)}
function rotl5(num){return(num<<5)|(num>>>27)}
function rotl30(num){return(num<<30)|(num>>>2)}
function ft(s,b,c,d){if(s===0)return(b&c)|((~b)&d)
if(s===2)return(b&c)|(b&d)|(c&d)
return b^c^d}
Sha1.prototype._update=function(M){var W=this._w
var a=this._a|0
var b=this._b|0
var c=this._c|0
var d=this._d|0
var e=this._e|0
for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4)
for(;i<80;++i)W[i]=rotl1(W[i-3]^W[i-8]^W[i-14]^W[i-16])
for(var j=0;j<80;++j){var s=~~(j/20)
var t=(rotl5(a)+ft(s,b,c,d)+e+W[j]+K[s])|0
e=d
d=c
c=rotl30(b)
b=a
a=t}
this._a=(a+this._a)|0
this._b=(b+this._b)|0
this._c=(c+this._c)|0
this._d=(d+this._d)|0
this._e=(e+this._e)|0}
Sha1.prototype._hash=function(){var H=Buffer.allocUnsafe(20)
H.writeInt32BE(this._a|0,0)
H.writeInt32BE(this._b|0,4)
H.writeInt32BE(this._c|0,8)
H.writeInt32BE(this._d|0,12)
H.writeInt32BE(this._e|0,16)
return H}
module.exports=Sha1},{"./hash":168,"inherits":108,"safe-buffer":167}],172:[function(require,module,exports){var inherits=require('inherits')
var Sha256=require('./sha256')
var Hash=require('./hash')
var Buffer=require('safe-buffer').Buffer
var W=new Array(64)
function Sha224(){this.init()
this._w=W
Hash.call(this,64,56)}
inherits(Sha224,Sha256)
Sha224.prototype.init=function(){this._a=0xc1059ed8
this._b=0x367cd507
this._c=0x3070dd17
this._d=0xf70e5939
this._e=0xffc00b31
this._f=0x68581511
this._g=0x64f98fa7
this._h=0xbefa4fa4
return this}
Sha224.prototype._hash=function(){var H=Buffer.allocUnsafe(28)
H.writeInt32BE(this._a,0)
H.writeInt32BE(this._b,4)
H.writeInt32BE(this._c,8)
H.writeInt32BE(this._d,12)
H.writeInt32BE(this._e,16)
H.writeInt32BE(this._f,20)
H.writeInt32BE(this._g,24)
return H}
module.exports=Sha224},{"./hash":168,"./sha256":173,"inherits":108,"safe-buffer":167}],173:[function(require,module,exports){var inherits=require('inherits')
var Hash=require('./hash')
var Buffer=require('safe-buffer').Buffer
var K=[0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0x0FC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x06CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2]
var W=new Array(64)
function Sha256(){this.init()
this._w=W
Hash.call(this,64,56)}
inherits(Sha256,Hash)
Sha256.prototype.init=function(){this._a=0x6a09e667
this._b=0xbb67ae85
this._c=0x3c6ef372
this._d=0xa54ff53a
this._e=0x510e527f
this._f=0x9b05688c
this._g=0x1f83d9ab
this._h=0x5be0cd19
return this}
function ch(x,y,z){return z^(x&(y^z))}
function maj(x,y,z){return(x&y)|(z&(x|y))}
function sigma0(x){return(x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10)}
function sigma1(x){return(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7)}
function gamma0(x){return(x>>>7|x<<25)^(x>>>18|x<<14)^(x>>>3)}
function gamma1(x){return(x>>>17|x<<15)^(x>>>19|x<<13)^(x>>>10)}
Sha256.prototype._update=function(M){var W=this._w
var a=this._a|0
var b=this._b|0
var c=this._c|0
var d=this._d|0
var e=this._e|0
var f=this._f|0
var g=this._g|0
var h=this._h|0
for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4)
for(;i<64;++i)W[i]=(gamma1(W[i-2])+W[i-7]+gamma0(W[i-15])+W[i-16])|0
for(var j=0;j<64;++j){var T1=(h+sigma1(e)+ch(e,f,g)+K[j]+W[j])|0
var T2=(sigma0(a)+maj(a,b,c))|0
h=g
g=f
f=e
e=(d+T1)|0
d=c
c=b
b=a
a=(T1+T2)|0}
this._a=(a+this._a)|0
this._b=(b+this._b)|0
this._c=(c+this._c)|0
this._d=(d+this._d)|0
this._e=(e+this._e)|0
this._f=(f+this._f)|0
this._g=(g+this._g)|0
this._h=(h+this._h)|0}
Sha256.prototype._hash=function(){var H=Buffer.allocUnsafe(32)
H.writeInt32BE(this._a,0)
H.writeInt32BE(this._b,4)
H.writeInt32BE(this._c,8)
H.writeInt32BE(this._d,12)
H.writeInt32BE(this._e,16)
H.writeInt32BE(this._f,20)
H.writeInt32BE(this._g,24)
H.writeInt32BE(this._h,28)
return H}
module.exports=Sha256},{"./hash":168,"inherits":108,"safe-buffer":167}],174:[function(require,module,exports){var inherits=require('inherits')
var SHA512=require('./sha512')
var Hash=require('./hash')
var Buffer=require('safe-buffer').Buffer
var W=new Array(160)
function Sha384(){this.init()
this._w=W
Hash.call(this,128,112)}
inherits(Sha384,SHA512)
Sha384.prototype.init=function(){this._ah=0xcbbb9d5d
this._bh=0x629a292a
this._ch=0x9159015a
this._dh=0x152fecd8
this._eh=0x67332667
this._fh=0x8eb44a87
this._gh=0xdb0c2e0d
this._hh=0x47b5481d
this._al=0xc1059ed8
this._bl=0x367cd507
this._cl=0x3070dd17
this._dl=0xf70e5939
this._el=0xffc00b31
this._fl=0x68581511
this._gl=0x64f98fa7
this._hl=0xbefa4fa4
return this}
Sha384.prototype._hash=function(){var H=Buffer.allocUnsafe(48)
function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset)
H.writeInt32BE(l,offset+4)}
writeInt64BE(this._ah,this._al,0)
writeInt64BE(this._bh,this._bl,8)
writeInt64BE(this._ch,this._cl,16)
writeInt64BE(this._dh,this._dl,24)
writeInt64BE(this._eh,this._el,32)
writeInt64BE(this._fh,this._fl,40)
return H}
module.exports=Sha384},{"./hash":168,"./sha512":175,"inherits":108,"safe-buffer":167}],175:[function(require,module,exports){var inherits=require('inherits')
var Hash=require('./hash')
var Buffer=require('safe-buffer').Buffer
var K=[0x428a2f98,0xd728ae22,0x71374491,0x23ef65cd,0xb5c0fbcf,0xec4d3b2f,0xe9b5dba5,0x8189dbbc,0x3956c25b,0xf348b538,0x59f111f1,0xb605d019,0x923f82a4,0xaf194f9b,0xab1c5ed5,0xda6d8118,0xd807aa98,0xa3030242,0x12835b01,0x45706fbe,0x243185be,0x4ee4b28c,0x550c7dc3,0xd5ffb4e2,0x72be5d74,0xf27b896f,0x80deb1fe,0x3b1696b1,0x9bdc06a7,0x25c71235,0xc19bf174,0xcf692694,0xe49b69c1,0x9ef14ad2,0xefbe4786,0x384f25e3,0x0fc19dc6,0x8b8cd5b5,0x240ca1cc,0x77ac9c65,0x2de92c6f,0x592b0275,0x4a7484aa,0x6ea6e483,0x5cb0a9dc,0xbd41fbd4,0x76f988da,0x831153b5,0x983e5152,0xee66dfab,0xa831c66d,0x2db43210,0xb00327c8,0x98fb213f,0xbf597fc7,0xbeef0ee4,0xc6e00bf3,0x3da88fc2,0xd5a79147,0x930aa725,0x06ca6351,0xe003826f,0x14292967,0x0a0e6e70,0x27b70a85,0x46d22ffc,0x2e1b2138,0x5c26c926,0x4d2c6dfc,0x5ac42aed,0x53380d13,0x9d95b3df,0x650a7354,0x8baf63de,0x766a0abb,0x3c77b2a8,0x81c2c92e,0x47edaee6,0x92722c85,0x1482353b,0xa2bfe8a1,0x4cf10364,0xa81a664b,0xbc423001,0xc24b8b70,0xd0f89791,0xc76c51a3,0x0654be30,0xd192e819,0xd6ef5218,0xd6990624,0x5565a910,0xf40e3585,0x5771202a,0x106aa070,0x32bbd1b8,0x19a4c116,0xb8d2d0c8,0x1e376c08,0x5141ab53,0x2748774c,0xdf8eeb99,0x34b0bcb5,0xe19b48a8,0x391c0cb3,0xc5c95a63,0x4ed8aa4a,0xe3418acb,0x5b9cca4f,0x7763e373,0x682e6ff3,0xd6b2b8a3,0x748f82ee,0x5defb2fc,0x78a5636f,0x43172f60,0x84c87814,0xa1f0ab72,0x8cc70208,0x1a6439ec,0x90befffa,0x23631e28,0xa4506ceb,0xde82bde9,0xbef9a3f7,0xb2c67915,0xc67178f2,0xe372532b,0xca273ece,0xea26619c,0xd186b8c7,0x21c0c207,0xeada7dd6,0xcde0eb1e,0xf57d4f7f,0xee6ed178,0x06f067aa,0x72176fba,0x0a637dc5,0xa2c898a6,0x113f9804,0xbef90dae,0x1b710b35,0x131c471b,0x28db77f5,0x23047d84,0x32caab7b,0x40c72493,0x3c9ebe0a,0x15c9bebc,0x431d67c4,0x9c100d4c,0x4cc5d4be,0xcb3e42b6,0x597f299c,0xfc657e2a,0x5fcb6fab,0x3ad6faec,0x6c44198c,0x4a475817]
var W=new Array(160)
function Sha512(){this.init()
this._w=W
Hash.call(this,128,112)}
inherits(Sha512,Hash)
Sha512.prototype.init=function(){this._ah=0x6a09e667
this._bh=0xbb67ae85
this._ch=0x3c6ef372
this._dh=0xa54ff53a
this._eh=0x510e527f
this._fh=0x9b05688c
this._gh=0x1f83d9ab
this._hh=0x5be0cd19
this._al=0xf3bcc908
this._bl=0x84caa73b
this._cl=0xfe94f82b
this._dl=0x5f1d36f1
this._el=0xade682d1
this._fl=0x2b3e6c1f
this._gl=0xfb41bd6b
this._hl=0x137e2179
return this}
function Ch(x,y,z){return z^(x&(y^z))}
function maj(x,y,z){return(x&y)|(z&(x|y))}
function sigma0(x,xl){return(x>>>28|xl<<4)^(xl>>>2|x<<30)^(xl>>>7|x<<25)}
function sigma1(x,xl){return(x>>>14|xl<<18)^(x>>>18|xl<<14)^(xl>>>9|x<<23)}
function Gamma0(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^(x>>>7)}
function Gamma0l(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^(x>>>7|xl<<25)}
function Gamma1(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^(x>>>6)}
function Gamma1l(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^(x>>>6|xl<<26)}
function getCarry(a,b){return(a>>>0)<(b>>>0)?1:0}
Sha512.prototype._update=function(M){var W=this._w
var ah=this._ah|0
var bh=this._bh|0
var ch=this._ch|0
var dh=this._dh|0
var eh=this._eh|0
var fh=this._fh|0
var gh=this._gh|0
var hh=this._hh|0
var al=this._al|0
var bl=this._bl|0
var cl=this._cl|0
var dl=this._dl|0
var el=this._el|0
var fl=this._fl|0
var gl=this._gl|0
var hl=this._hl|0
for(var i=0;i<32;i+=2){W[i]=M.readInt32BE(i*4)
W[i+1]=M.readInt32BE(i*4+4)}
for(;i<160;i+=2){var xh=W[i-15*2]
var xl=W[i-15*2+1]
var gamma0=Gamma0(xh,xl)
var gamma0l=Gamma0l(xl,xh)
xh=W[i-2*2]
xl=W[i-2*2+1]
var gamma1=Gamma1(xh,xl)
var gamma1l=Gamma1l(xl,xh)
var Wi7h=W[i-7*2]
var Wi7l=W[i-7*2+1]
var Wi16h=W[i-16*2]
var Wi16l=W[i-16*2+1]
var Wil=(gamma0l+Wi7l)|0
var Wih=(gamma0+Wi7h+getCarry(Wil,gamma0l))|0
Wil=(Wil+gamma1l)|0
Wih=(Wih+gamma1+getCarry(Wil,gamma1l))|0
Wil=(Wil+Wi16l)|0
Wih=(Wih+Wi16h+getCarry(Wil,Wi16l))|0
W[i]=Wih
W[i+1]=Wil}
for(var j=0;j<160;j+=2){Wih=W[j]
Wil=W[j+1]
var majh=maj(ah,bh,ch)
var majl=maj(al,bl,cl)
var sigma0h=sigma0(ah,al)
var sigma0l=sigma0(al,ah)
var sigma1h=sigma1(eh,el)
var sigma1l=sigma1(el,eh)
var Kih=K[j]
var Kil=K[j+1]
var chh=Ch(eh,fh,gh)
var chl=Ch(el,fl,gl)
var t1l=(hl+sigma1l)|0
var t1h=(hh+sigma1h+getCarry(t1l,hl))|0
t1l=(t1l+chl)|0
t1h=(t1h+chh+getCarry(t1l,chl))|0
t1l=(t1l+Kil)|0
t1h=(t1h+Kih+getCarry(t1l,Kil))|0
t1l=(t1l+Wil)|0
t1h=(t1h+Wih+getCarry(t1l,Wil))|0
var t2l=(sigma0l+majl)|0
var t2h=(sigma0h+majh+getCarry(t2l,sigma0l))|0
hh=gh
hl=gl
gh=fh
gl=fl
fh=eh
fl=el
el=(dl+t1l)|0
eh=(dh+t1h+getCarry(el,dl))|0
dh=ch
dl=cl
ch=bh
cl=bl
bh=ah
bl=al
al=(t1l+t2l)|0
ah=(t1h+t2h+getCarry(al,t1l))|0}
this._al=(this._al+al)|0
this._bl=(this._bl+bl)|0
this._cl=(this._cl+cl)|0
this._dl=(this._dl+dl)|0
this._el=(this._el+el)|0
this._fl=(this._fl+fl)|0
this._gl=(this._gl+gl)|0
this._hl=(this._hl+hl)|0
this._ah=(this._ah+ah+getCarry(this._al,al))|0
this._bh=(this._bh+bh+getCarry(this._bl,bl))|0
this._ch=(this._ch+ch+getCarry(this._cl,cl))|0
this._dh=(this._dh+dh+getCarry(this._dl,dl))|0
this._eh=(this._eh+eh+getCarry(this._el,el))|0
this._fh=(this._fh+fh+getCarry(this._fl,fl))|0
this._gh=(this._gh+gh+getCarry(this._gl,gl))|0
this._hh=(this._hh+hh+getCarry(this._hl,hl))|0}
Sha512.prototype._hash=function(){var H=Buffer.allocUnsafe(64)
function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset)
H.writeInt32BE(l,offset+4)}
writeInt64BE(this._ah,this._al,0)
writeInt64BE(this._bh,this._bl,8)
writeInt64BE(this._ch,this._cl,16)
writeInt64BE(this._dh,this._dl,24)
writeInt64BE(this._eh,this._el,32)
writeInt64BE(this._fh,this._fl,40)
writeInt64BE(this._gh,this._gl,48)
writeInt64BE(this._hh,this._hl,56)
return H}
module.exports=Sha512},{"./hash":168,"inherits":108,"safe-buffer":167}],176:[function(require,module,exports){module.exports=Stream;var EE=require('events').EventEmitter;var inherits=require('inherits');inherits(Stream,EE);Stream.Readable=require('readable-stream/readable.js');Stream.Writable=require('readable-stream/writable.js');Stream.Duplex=require('readable-stream/duplex.js');Stream.Transform=require('readable-stream/transform.js');Stream.PassThrough=require('readable-stream/passthrough.js');Stream.Stream=Stream;function Stream(){EE.call(this)}
Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(!1===dest.write(chunk)&&source.pause){source.pause()}}}
source.on('data',ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}
dest.on('drain',ondrain);if(!dest._isStdio&&(!options||options.end!==!1)){source.on('end',onend);source.on('close',onclose)}
var didOnEnd=!1;function onend(){if(didOnEnd)return;didOnEnd=!0;dest.end()}
function onclose(){if(didOnEnd)return;didOnEnd=!0;if(typeof dest.destroy==='function')dest.destroy()}
function onerror(er){cleanup();if(EE.listenerCount(this,'error')===0){throw er}}
source.on('error',onerror);dest.on('error',onerror);function cleanup(){source.removeListener('data',ondata);dest.removeListener('drain',ondrain);source.removeListener('end',onend);source.removeListener('close',onclose);source.removeListener('error',onerror);dest.removeListener('error',onerror);source.removeListener('end',cleanup);source.removeListener('close',cleanup);dest.removeListener('close',cleanup)}
source.on('end',cleanup);source.on('close',cleanup);dest.on('close',cleanup);dest.emit('pipe',source);return dest}},{"events":90,"inherits":108,"readable-stream/duplex.js":152,"readable-stream/passthrough.js":162,"readable-stream/readable.js":163,"readable-stream/transform.js":164,"readable-stream/writable.js":165}],177:[function(require,module,exports){(function(global){var ClientRequest=require('./lib/request')
var response=require('./lib/response')
var extend=require('xtend')
var statusCodes=require('builtin-status-codes')
var url=require('url')
var http=exports
http.request=function(opts,cb){if(typeof opts==='string')
opts=url.parse(opts)
else opts=extend(opts)
var defaultProtocol=global.location.protocol.search(/^https?:$/)===-1?'http:':''
var protocol=opts.protocol||defaultProtocol
var host=opts.hostname||opts.host
var port=opts.port
var path=opts.path||'/'
if(host&&host.indexOf(':')!==-1)
host='['+host+']'
opts.url=(host?(protocol+'//'+host):'')+(port?':'+port:'')+path
opts.method=(opts.method||'GET').toUpperCase()
opts.headers=opts.headers||{}
var req=new ClientRequest(opts)
if(cb)
req.on('response',cb)
return req}
http.get=function get(opts,cb){var req=http.request(opts,cb)
req.end()
return req}
http.ClientRequest=ClientRequest
http.IncomingMessage=response.IncomingMessage
http.Agent=function(){}
http.Agent.defaultMaxSockets=4
http.globalAgent=new http.Agent()
http.STATUS_CODES=statusCodes
http.METHODS=['CHECKOUT','CONNECT','COPY','DELETE','GET','HEAD','LOCK','M-SEARCH','MERGE','MKACTIVITY','MKCOL','MOVE','NOTIFY','OPTIONS','PATCH','POST','PROPFIND','PROPPATCH','PURGE','PUT','REPORT','SEARCH','SUBSCRIBE','TRACE','UNLOCK','UNSUBSCRIBE']}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./lib/request":179,"./lib/response":180,"builtin-status-codes":55,"url":184,"xtend":190}],178:[function(require,module,exports){(function(global){exports.fetch=isFunction(global.fetch)&&isFunction(global.ReadableStream)
exports.writableStream=isFunction(global.WritableStream)
exports.abortController=isFunction(global.AbortController)
exports.blobConstructor=!1
try{new Blob([new ArrayBuffer(1)])
exports.blobConstructor=!0}catch(e){}
var xhr
function getXHR(){if(xhr!==undefined)return xhr
if(global.XMLHttpRequest){xhr=new global.XMLHttpRequest()
try{xhr.open('GET',global.XDomainRequest?'/':'https://example.com')}catch(e){xhr=null}}else{xhr=null}
return xhr}
function checkTypeSupport(type){var xhr=getXHR()
if(!xhr)return!1
try{xhr.responseType=type
return xhr.responseType===type}catch(e){}
return!1}
var haveArrayBuffer=typeof global.ArrayBuffer!=='undefined'
var haveSlice=haveArrayBuffer&&isFunction(global.ArrayBuffer.prototype.slice)
exports.arraybuffer=exports.fetch||(haveArrayBuffer&&checkTypeSupport('arraybuffer'))
exports.msstream=!exports.fetch&&haveSlice&&checkTypeSupport('ms-stream')
exports.mozchunkedarraybuffer=!exports.fetch&&haveArrayBuffer&&checkTypeSupport('moz-chunked-arraybuffer')
exports.overrideMimeType=exports.fetch||(getXHR()?isFunction(getXHR().overrideMimeType):!1)
exports.vbArray=isFunction(global.VBArray)
function isFunction(value){return typeof value==='function'}
xhr=null}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],179:[function(require,module,exports){(function(process,global,Buffer){var capability=require('./capability')
var inherits=require('inherits')
var response=require('./response')
var stream=require('readable-stream')
var toArrayBuffer=require('to-arraybuffer')
var IncomingMessage=response.IncomingMessage
var rStates=response.readyStates
function decideMode(preferBinary,useFetch){if(capability.fetch&&useFetch){return'fetch'}else if(capability.mozchunkedarraybuffer){return'moz-chunked-arraybuffer'}else if(capability.msstream){return'ms-stream'}else if(capability.arraybuffer&&preferBinary){return'arraybuffer'}else if(capability.vbArray&&preferBinary){return'text:vbarray'}else{return'text'}}
var ClientRequest=module.exports=function(opts){var self=this
stream.Writable.call(self)
self._opts=opts
self._body=[]
self._headers={}
if(opts.auth)
self.setHeader('Authorization','Basic '+new Buffer(opts.auth).toString('base64'))
Object.keys(opts.headers).forEach(function(name){self.setHeader(name,opts.headers[name])})
var preferBinary
var useFetch=!0
if(opts.mode==='disable-fetch'||('requestTimeout' in opts&&!capability.abortController)){useFetch=!1
preferBinary=!0}else if(opts.mode==='prefer-streaming'){preferBinary=!1}else if(opts.mode==='allow-wrong-content-type'){preferBinary=!capability.overrideMimeType}else if(!opts.mode||opts.mode==='default'||opts.mode==='prefer-fast'){preferBinary=!0}else{throw new Error('Invalid value for opts.mode')}
self._mode=decideMode(preferBinary,useFetch)
self._fetchTimer=null
self.on('finish',function(){self._onFinish()})}
inherits(ClientRequest,stream.Writable)
ClientRequest.prototype.setHeader=function(name,value){var self=this
var lowerName=name.toLowerCase()
if(unsafeHeaders.indexOf(lowerName)!==-1)
return
self._headers[lowerName]={name:name,value:value}}
ClientRequest.prototype.getHeader=function(name){var header=this._headers[name.toLowerCase()]
if(header)
return header.value
return null}
ClientRequest.prototype.removeHeader=function(name){var self=this
delete self._headers[name.toLowerCase()]}
ClientRequest.prototype._onFinish=function(){var self=this
if(self._destroyed)
return
var opts=self._opts
var headersObj=self._headers
var body=null
if(opts.method!=='GET'&&opts.method!=='HEAD'){if(capability.arraybuffer){body=toArrayBuffer(Buffer.concat(self._body))}else if(capability.blobConstructor){body=new global.Blob(self._body.map(function(buffer){return toArrayBuffer(buffer)}),{type:(headersObj['content-type']||{}).value||''})}else{body=Buffer.concat(self._body).toString()}}
var headersList=[]
Object.keys(headersObj).forEach(function(keyName){var name=headersObj[keyName].name
var value=headersObj[keyName].value
if(Array.isArray(value)){value.forEach(function(v){headersList.push([name,v])})}else{headersList.push([name,value])}})
if(self._mode==='fetch'){var signal=null
var fetchTimer=null
if(capability.abortController){var controller=new AbortController()
signal=controller.signal
self._fetchAbortController=controller
if('requestTimeout' in opts&&opts.requestTimeout!==0){self._fetchTimer=global.setTimeout(function(){self.emit('requestTimeout')
if(self._fetchAbortController)
self._fetchAbortController.abort()},opts.requestTimeout)}}
global.fetch(self._opts.url,{method:self._opts.method,headers:headersList,body:body||undefined,mode:'cors',credentials:opts.withCredentials?'include':'same-origin',signal:signal}).then(function(response){self._fetchResponse=response
self._connect()},function(reason){global.clearTimeout(self._fetchTimer)
if(!self._destroyed)
self.emit('error',reason)})}else{var xhr=self._xhr=new global.XMLHttpRequest()
try{xhr.open(self._opts.method,self._opts.url,!0)}catch(err){process.nextTick(function(){self.emit('error',err)})
return}
if('responseType' in xhr)
xhr.responseType=self._mode.split(':')[0]
if('withCredentials' in xhr)
xhr.withCredentials=!!opts.withCredentials
if(self._mode==='text'&&'overrideMimeType' in xhr)
xhr.overrideMimeType('text/plain; charset=x-user-defined')
if('requestTimeout' in opts){xhr.timeout=opts.requestTimeout
xhr.ontimeout=function(){self.emit('requestTimeout')}}
headersList.forEach(function(header){xhr.setRequestHeader(header[0],header[1])})
self._response=null
xhr.onreadystatechange=function(){switch(xhr.readyState){case rStates.LOADING:case rStates.DONE:self._onXHRProgress()
break}}
if(self._mode==='moz-chunked-arraybuffer'){xhr.onprogress=function(){self._onXHRProgress()}}
xhr.onerror=function(){if(self._destroyed)
return
self.emit('error',new Error('XHR error'))}
try{xhr.send(body)}catch(err){process.nextTick(function(){self.emit('error',err)})
return}}}
function statusValid(xhr){try{var status=xhr.status
return(status!==null&&status!==0)}catch(e){return!1}}
ClientRequest.prototype._onXHRProgress=function(){var self=this
if(!statusValid(self._xhr)||self._destroyed)
return
if(!self._response)
self._connect()
self._response._onXHRProgress()}
ClientRequest.prototype._connect=function(){var self=this
if(self._destroyed)
return
self._response=new IncomingMessage(self._xhr,self._fetchResponse,self._mode,self._fetchTimer)
self._response.on('error',function(err){self.emit('error',err)})
self.emit('response',self._response)}
ClientRequest.prototype._write=function(chunk,encoding,cb){var self=this
self._body.push(chunk)
cb()}
ClientRequest.prototype.abort=ClientRequest.prototype.destroy=function(){var self=this
self._destroyed=!0
global.clearTimeout(self._fetchTimer)
if(self._response)
self._response._destroyed=!0
if(self._xhr)
self._xhr.abort()
else if(self._fetchAbortController)
self._fetchAbortController.abort()}
ClientRequest.prototype.end=function(data,encoding,cb){var self=this
if(typeof data==='function'){cb=data
data=undefined}
stream.Writable.prototype.end.call(self,data,encoding,cb)}
ClientRequest.prototype.flushHeaders=function(){}
ClientRequest.prototype.setTimeout=function(){}
ClientRequest.prototype.setNoDelay=function(){}
ClientRequest.prototype.setSocketKeepAlive=function(){}
var unsafeHeaders=['accept-charset','accept-encoding','access-control-request-headers','access-control-request-method','connection','content-length','cookie','cookie2','date','dnt','expect','host','keep-alive','origin','referer','te','trailer','transfer-encoding','upgrade','via']}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer)},{"./capability":178,"./response":180,"_process":139,"buffer":54,"inherits":108,"readable-stream":163,"to-arraybuffer":183}],180:[function(require,module,exports){(function(process,global,Buffer){var capability=require('./capability')
var inherits=require('inherits')
var stream=require('readable-stream')
var rStates=exports.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}
var IncomingMessage=exports.IncomingMessage=function(xhr,response,mode,fetchTimer){var self=this
stream.Readable.call(self)
self._mode=mode
self.headers={}
self.rawHeaders=[]
self.trailers={}
self.rawTrailers=[]
self.on('end',function(){process.nextTick(function(){self.emit('close')})})
if(mode==='fetch'){self._fetchResponse=response
self.url=response.url
self.statusCode=response.status
self.statusMessage=response.statusText
response.headers.forEach(function(header,key){self.headers[key.toLowerCase()]=header
self.rawHeaders.push(key,header)})
if(capability.writableStream){var writable=new WritableStream({write:function(chunk){return new Promise(function(resolve,reject){if(self._destroyed){reject()}else if(self.push(new Buffer(chunk))){resolve()}else{self._resumeFetch=resolve}})},close:function(){global.clearTimeout(fetchTimer)
if(!self._destroyed)
self.push(null)},abort:function(err){if(!self._destroyed)
self.emit('error',err)}})
try{response.body.pipeTo(writable).catch(function(err){global.clearTimeout(fetchTimer)
if(!self._destroyed)
self.emit('error',err)})
return}catch(e){}}
var reader=response.body.getReader()
function read(){reader.read().then(function(result){if(self._destroyed)
return
if(result.done){global.clearTimeout(fetchTimer)
self.push(null)
return}
self.push(new Buffer(result.value))
read()}).catch(function(err){global.clearTimeout(fetchTimer)
if(!self._destroyed)
self.emit('error',err)})}
read()}else{self._xhr=xhr
self._pos=0
self.url=xhr.responseURL
self.statusCode=xhr.status
self.statusMessage=xhr.statusText
var headers=xhr.getAllResponseHeaders().split(/\r?\n/)
headers.forEach(function(header){var matches=header.match(/^([^:]+):\s*(.*)/)
if(matches){var key=matches[1].toLowerCase()
if(key==='set-cookie'){if(self.headers[key]===undefined){self.headers[key]=[]}
self.headers[key].push(matches[2])}else if(self.headers[key]!==undefined){self.headers[key]+=', '+matches[2]}else{self.headers[key]=matches[2]}
self.rawHeaders.push(matches[1],matches[2])}})
self._charset='x-user-defined'
if(!capability.overrideMimeType){var mimeType=self.rawHeaders['mime-type']
if(mimeType){var charsetMatch=mimeType.match(/;\s*charset=([^;])(;|$)/)
if(charsetMatch){self._charset=charsetMatch[1].toLowerCase()}}
if(!self._charset)
self._charset='utf-8'}}}
inherits(IncomingMessage,stream.Readable)
IncomingMessage.prototype._read=function(){var self=this
var resolve=self._resumeFetch
if(resolve){self._resumeFetch=null
resolve()}}
IncomingMessage.prototype._onXHRProgress=function(){var self=this
var xhr=self._xhr
var response=null
switch(self._mode){case 'text:vbarray':if(xhr.readyState!==rStates.DONE)
break
try{response=new global.VBArray(xhr.responseBody).toArray()}catch(e){}
if(response!==null){self.push(new Buffer(response))
break}
case 'text':try{response=xhr.responseText}catch(e){self._mode='text:vbarray'
break}
if(response.length>self._pos){var newData=response.substr(self._pos)
if(self._charset==='x-user-defined'){var buffer=new Buffer(newData.length)
for(var i=0;i<newData.length;i++)
buffer[i]=newData.charCodeAt(i)&0xff
self.push(buffer)}else{self.push(newData,self._charset)}
self._pos=response.length}
break
case 'arraybuffer':if(xhr.readyState!==rStates.DONE||!xhr.response)
break
response=xhr.response
self.push(new Buffer(new Uint8Array(response)))
break
case 'moz-chunked-arraybuffer':response=xhr.response
if(xhr.readyState!==rStates.LOADING||!response)
break
self.push(new Buffer(new Uint8Array(response)))
break
case 'ms-stream':response=xhr.response
if(xhr.readyState!==rStates.LOADING)
break
var reader=new global.MSStreamReader()
reader.onprogress=function(){if(reader.result.byteLength>self._pos){self.push(new Buffer(new Uint8Array(reader.result.slice(self._pos))))
self._pos=reader.result.byteLength}}
reader.onload=function(){self.push(null)}
reader.readAsArrayBuffer(response)
break}
if(self._xhr.readyState===rStates.DONE&&self._mode!=='ms-stream'){self.push(null)}}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer)},{"./capability":178,"_process":139,"buffer":54,"inherits":108,"readable-stream":163}],181:[function(require,module,exports){arguments[4][161][0].apply(exports,arguments)},{"dup":161,"safe-buffer":167}],182:[function(require,module,exports){(function(setImmediate,clearImmediate){var nextTick=require('process/browser.js').nextTick;var apply=Function.prototype.apply;var slice=Array.prototype.slice;var immediateIds={};var nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}
Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)
item._onTimeout()},msecs)}};exports.setImmediate=typeof setImmediate==="function"?setImmediate:function(fn){var id=nextImmediateId++;var args=arguments.length<2?!1:slice.call(arguments,1);immediateIds[id]=!0;nextTick(function onNextTick(){if(immediateIds[id]){if(args){fn.apply(null,args)}else{fn.call(null)}
exports.clearImmediate(id)}});return id};exports.clearImmediate=typeof clearImmediate==="function"?clearImmediate:function(id){delete immediateIds[id]}}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":139,"timers":182}],183:[function(require,module,exports){var Buffer=require('buffer').Buffer
module.exports=function(buf){if(buf instanceof Uint8Array){if(buf.byteOffset===0&&buf.byteLength===buf.buffer.byteLength){return buf.buffer}else if(typeof buf.buffer.slice==='function'){return buf.buffer.slice(buf.byteOffset,buf.byteOffset+buf.byteLength)}}
if(Buffer.isBuffer(buf)){var arrayCopy=new Uint8Array(buf.length)
var len=buf.length
for(var i=0;i<len;i++){arrayCopy[i]=buf[i]}
return arrayCopy.buffer}else{throw new Error('Argument must be a Buffer')}}},{"buffer":54}],184:[function(require,module,exports){'use strict';var punycode=require('punycode');var util=require('./util');exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}
var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=['<','>','"','`',' ','\r','\n','\t'],unwise=['{','}','|','\\','^','`'].concat(delims),autoEscape=['\''].concat(unwise),nonHostChars=['%','/','?',';','#'].concat(autoEscape),hostEndingChars=['/','?','#'],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={'javascript':!0,'javascript:':!0},hostlessProtocol={'javascript':!0,'javascript:':!0},slashedProtocol={'http':!0,'https':!0,'ftp':!0,'gopher':!0,'file':!0,'http:':!0,'https:':!0,'ftp:':!0,'gopher:':!0,'file:':!0},querystring=require('querystring');function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}
Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}
var queryIndex=url.indexOf('?'),splitter=(queryIndex!==-1&&queryIndex<url.indexOf('#'))?'?':'#',uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,'/');url=uSplit.join(splitter);var rest=url;rest=rest.trim();if(!slashesDenoteHost&&url.split('#').length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath){this.path=rest;this.href=rest;this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2];if(parseQueryString){this.query=querystring.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(parseQueryString){this.search='';this.query={}}
return this}}
var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}
if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==='//';if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=!0}}
if(!hostlessProtocol[proto]&&(slashes||(proto&&!slashedProtocol[proto]))){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))
hostEnd=hec}
var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf('@')}else{atSign=rest.lastIndexOf('@',hostEnd)}
if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}
hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))
hostEnd=hec}
if(hostEnd===-1)
hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||'';var ipv6Hostname=this.hostname[0]==='['&&this.hostname[this.hostname.length-1]===']';if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart='';for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+='x'}else{newpart+=part[j]}}
if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}
if(notHost.length){rest='/'+notHost.join('.')+rest}
this.hostname=validParts.join('.');break}}}}
if(this.hostname.length>hostnameMaxLen){this.hostname=''}else{this.hostname=this.hostname.toLowerCase()}
if(!ipv6Hostname){this.hostname=punycode.toASCII(this.hostname)}
var p=this.port?':'+this.port:'';var h=this.hostname||'';this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=='/'){rest='/'+rest}}}
if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)===-1)
continue;var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}
rest=rest.split(ae).join(esc)}}
var hash=rest.indexOf('#');if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}
var qm=rest.indexOf('?');if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}
rest=rest.slice(0,qm)}else if(parseQueryString){this.search='';this.query={}}
if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname='/'}
if(this.pathname||this.search){var p=this.pathname||'';var s=this.search||'';this.path=p+s}
this.href=this.format();return this};function urlFormat(obj){if(util.isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}
Url.prototype.format=function(){var auth=this.auth||'';if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,':');auth+='@'}
var protocol=this.protocol||'',pathname=this.pathname||'',hash=this.hash||'',host=!1,query='';if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(':')===-1?this.hostname:'['+this.hostname+']');if(this.port){host+=':'+this.port}}
if(this.query&&util.isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}
var search=this.search||(query&&('?'+query))||'';if(protocol&&protocol.substr(-1)!==':')protocol+=':';if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1){host='//'+(host||'');if(pathname&&pathname.charAt(0)!=='/')pathname='/'+pathname}else if(!host){host=''}
if(hash&&hash.charAt(0)!=='#')hash='#'+hash;if(search&&search.charAt(0)!=='?')search='?'+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace('#','%23');return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}
Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,!1,!0).resolveObject(relative)}
Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url();rel.parse(relative,!1,!0);relative=rel}
var result=new Url();var tkeys=Object.keys(this);for(var tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}
result.hash=relative.hash;if(relative.href===''){result.href=result.format();return result}
if(relative.slashes&&!relative.protocol){var rkeys=Object.keys(relative);for(var rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];if(rkey!=='protocol')
result[rkey]=relative[rkey]}
if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname='/'}
result.href=result.format();return result}
if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){var keys=Object.keys(relative);for(var v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}
result.href=result.format();return result}
result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||'').split('/');while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host='';if(!relative.hostname)relative.hostname='';if(relPath[0]!=='')relPath.unshift('');if(relPath.length<2)relPath.unshift('');result.pathname=relPath.join('/')}else{result.pathname=relative.pathname}
result.search=relative.search;result.query=relative.query;result.host=relative.host||'';result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||'';var s=result.search||'';result.path=p+s}
result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}
var isSourceAbs=(result.pathname&&result.pathname.charAt(0)==='/'),isRelAbs=(relative.host||relative.pathname&&relative.pathname.charAt(0)==='/'),mustEndAbs=(isRelAbs||isSourceAbs||(result.host&&relative.pathname)),removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split('/')||[],relPath=relative.pathname&&relative.pathname.split('/')||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname='';result.port=null;if(result.host){if(srcPath[0]==='')srcPath[0]=result.host;else srcPath.unshift(result.host)}
result.host='';if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==='')relPath[0]=relative.host;else relPath.unshift(relative.host)}
relative.host=null}
mustEndAbs=mustEndAbs&&(relPath[0]===''||srcPath[0]==='')}
if(isRelAbs){result.host=(relative.host||relative.host==='')?relative.host:result.host;result.hostname=(relative.hostname||relative.hostname==='')?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf('@')>0?result.host.split('@'):!1;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}
result.search=relative.search;result.query=relative.query;if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:'')+(result.search?result.search:'')}
result.href=result.format();return result}
if(!srcPath.length){result.pathname=null;if(result.search){result.path='/'+result.search}else{result.path=null}
result.href=result.format();return result}
var last=srcPath.slice(-1)[0];var hasTrailingSlash=((result.host||relative.host||srcPath.length>1)&&(last==='.'||last==='..')||last==='');var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last==='.'){srcPath.splice(i,1)}else if(last==='..'){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}
if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift('..')}}
if(mustEndAbs&&srcPath[0]!==''&&(!srcPath[0]||srcPath[0].charAt(0)!=='/')){srcPath.unshift('')}
if(hasTrailingSlash&&(srcPath.join('/').substr(-1)!=='/')){srcPath.push('')}
var isAbsolute=srcPath[0]===''||(srcPath[0]&&srcPath[0].charAt(0)==='/');if(psychotic){result.hostname=result.host=isAbsolute?'':srcPath.length?srcPath.shift():'';var authInHost=result.host&&result.host.indexOf('@')>0?result.host.split('@'):!1;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}
mustEndAbs=mustEndAbs||(result.host&&srcPath.length);if(mustEndAbs&&!isAbsolute){srcPath.unshift('')}
if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join('/')}
if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:'')+(result.search?result.search:'')}
result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==':'){this.port=port.substr(1)}
host=host.substr(0,host.length-port.length)}
if(host)this.hostname=host}},{"./util":185,"punycode":146,"querystring":149}],185:[function(require,module,exports){'use strict';module.exports={isString:function(arg){return typeof(arg)==='string'},isObject:function(arg){return typeof(arg)==='object'&&arg!==null},isNull:function(arg){return arg===null},isNullOrUndefined:function(arg){return arg==null}}},{}],186:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config('noDeprecation')){return fn}
var warned=!1;function deprecated(){if(!warned){if(config('throwDeprecation')){throw new Error(msg)}else if(config('traceDeprecation')){console.trace(msg)}else{console.warn(msg)}
warned=!0}
return fn.apply(this,arguments)}
return deprecated}
function config(name){try{if(!global.localStorage)return!1}catch(_){return!1}
var val=global.localStorage[name];if(null==val)return!1;return String(val).toLowerCase()==='true'}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],187:[function(require,module,exports){arguments[4][18][0].apply(exports,arguments)},{"dup":18}],188:[function(require,module,exports){arguments[4][19][0].apply(exports,arguments)},{"./support/isBuffer":187,"_process":139,"dup":19,"inherits":108}],189:[function(require,module,exports){var indexOf=function(xs,item){if(xs.indexOf)return xs.indexOf(item);else for(var i=0;i<xs.length;i++){if(xs[i]===item)return i}
return-1};var Object_keys=function(obj){if(Object.keys)return Object.keys(obj)
else{var res=[];for(var key in obj)res.push(key)
return res}};var forEach=function(xs,fn){if(xs.forEach)return xs.forEach(fn)
else for(var i=0;i<xs.length;i++){fn(xs[i],i,xs)}};var defineProp=(function(){try{Object.defineProperty({},'_',{});return function(obj,name,value){Object.defineProperty(obj,name,{writable:!0,enumerable:!1,configurable:!0,value:value})}}catch(e){return function(obj,name,value){obj[name]=value}}}());var globals=['Array','Boolean','Date','Error','EvalError','Function','Infinity','JSON','Math','NaN','Number','Object','RangeError','ReferenceError','RegExp','String','SyntaxError','TypeError','URIError','decodeURI','decodeURIComponent','encodeURI','encodeURIComponent','escape','eval','isFinite','isNaN','parseFloat','parseInt','undefined','unescape'];function Context(){}
Context.prototype={};var Script=exports.Script=function NodeScript(code){if(!(this instanceof Script))return new Script(code);this.code=code};Script.prototype.runInContext=function(context){if(!(context instanceof Context)){throw new TypeError("needs a 'context' argument.")}
var iframe=document.createElement('iframe');if(!iframe.style)iframe.style={};iframe.style.display='none';document.body.appendChild(iframe);var win=iframe.contentWindow;var wEval=win.eval,wExecScript=win.execScript;if(!wEval&&wExecScript){wExecScript.call(win,'null');wEval=win.eval}
forEach(Object_keys(context),function(key){win[key]=context[key]});forEach(globals,function(key){if(context[key]){win[key]=context[key]}});var winKeys=Object_keys(win);var res=wEval.call(win,this.code);forEach(Object_keys(win),function(key){if(key in context||indexOf(winKeys,key)===-1){context[key]=win[key]}});forEach(globals,function(key){if(!(key in context)){defineProp(context,key,win[key])}});document.body.removeChild(iframe);return res};Script.prototype.runInThisContext=function(){return eval(this.code)};Script.prototype.runInNewContext=function(context){var ctx=Script.createContext(context);var res=this.runInContext(ctx);if(context){forEach(Object_keys(ctx),function(key){context[key]=ctx[key]})}
return res};forEach(Object_keys(Script.prototype),function(name){exports[name]=Script[name]=function(code){var s=Script(code);return s[name].apply(s,[].slice.call(arguments,1))}});exports.isContext=function(context){return context instanceof Context};exports.createScript=function(code){return exports.Script(code)};exports.createContext=Script.createContext=function(context){var copy=new Context();if(typeof context==='object'){forEach(Object_keys(context),function(key){copy[key]=context[key]})}
return copy}},{}],190:[function(require,module,exports){module.exports=extend
var hasOwnProperty=Object.prototype.hasOwnProperty;function extend(){var target={}
for(var i=0;i<arguments.length;i++){var source=arguments[i]
for(var key in source){if(hasOwnProperty.call(source,key)){target[key]=source[key]}}}
return target}},{}],191:[function(require,module,exports){(function(process){const{app,BrowserWindow}=require('electron')
let mainWindow
function createWindow(){mainWindow=new BrowserWindow({width:1920,height:1080,frame:!1,webPreferences:{nodeIntegration:!0}})
mainWindow.show()
mainWindow.loadFile('index.html')
mainWindow.setMenuBarVisibility(!1)
mainWindow.on('closed',function(){mainWindow=null})}
app.on('ready',createWindow)
app.on('window-all-closed',function(){if(process.platform!=='darwin')app.quit()})
app.on('activate',function(){if(mainWindow===null)createWindow()})
require('./renderer.js');var OS=require('./node_modules/opensubtitles-api');var OpenSubtitles=new OS('TemporaryUserAgent');var srt2vtt=require('./node_modules/srt-to-vtt')
var fs=require('fs')
var WebTorrent=require('./node_modules/webtorrent-hybrid-electron');var client=new WebTorrent()
function openNewWindow(hash,imdb){$('#player-container').css('display','block');var torrentId=hash
var movieId=imdb
client.add(torrentId,function(torrent){var file=torrent.files.find(function(file){return file.name.endsWith('.mp4')})
OpenSubtitles.search({sublanguageid:'es',extensions:['srt','vtt'],imdbid:movieId,}).then(function(subtitles){console.log("subtitles: ",subtitles);$("#player-container").html('<video scr="" poster="" id="player" preload="auto" autoplay playsinline controls><track id="player-subtitle" kind="captions" label="English captions" src="'+subtitles.es.vtt+'" srclang="en" default /></video>')
file.renderTo('video#player')
const player=new Plyr('#player')})})}}).call(this,require('_process'))},{"./node_modules/opensubtitles-api":364,"./node_modules/srt-to-vtt":440,"./node_modules/webtorrent-hybrid-electron":470,"./renderer.js":529,"_process":139,"electron":287,"fs":1}],192:[function(require,module,exports){const ADDR_RE=/^\[?([^\]]+)\]?:(\d+)$/let cache={}
let size=0
module.exports=function addrToIPPort(addr){if(size===100000)module.exports.reset()
if(!cache[addr]){const m=ADDR_RE.exec(addr)
if(!m)throw new Error(`invalid addr: ${addr}`)
cache[addr]=[m[1],Number(m[2])]
size+=1}
return cache[addr]}
module.exports.reset=function reset(){cache={}
size=0}},{}],193:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
const INTEGER_START=0x69
const STRING_DELIM=0x3A
const DICTIONARY_START=0x64
const LIST_START=0x6C
const END_OF_TYPE=0x65
function getIntFromBuffer(buffer,start,end){var sum=0
var sign=1
for(var i=start;i<end;i++){var num=buffer[i]
if(num<58&&num>=48){sum=sum*10+(num-48)
continue}
if(i===start&&num===43){continue}
if(i===start&&num===45){sign=-1
continue}
if(num===46){break}
throw new Error('not a number: buffer['+i+'] = '+num)}
return sum*sign}
function decode(data,start,end,encoding){if(data==null||data.length===0){return null}
if(typeof start!=='number'&&encoding==null){encoding=start
start=undefined}
if(typeof end!=='number'&&encoding==null){encoding=end
end=undefined}
decode.position=0
decode.encoding=encoding||null
decode.data=!(Buffer.isBuffer(data))?Buffer.from(data):data.slice(start,end)
decode.bytes=decode.data.length
return decode.next()}
decode.bytes=0
decode.position=0
decode.data=null
decode.encoding=null
decode.next=function(){switch(decode.data[decode.position]){case DICTIONARY_START:return decode.dictionary()
case LIST_START:return decode.list()
case INTEGER_START:return decode.integer()
default:return decode.buffer()}}
decode.find=function(chr){var i=decode.position
var c=decode.data.length
var d=decode.data
while(i<c){if(d[i]===chr)return i
i++}
throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode(chr)+'" [0x'+chr.toString(16)+']')}
decode.dictionary=function(){decode.position++
var dict={}
while(decode.data[decode.position]!==END_OF_TYPE){dict[decode.buffer()]=decode.next()}
decode.position++
return dict}
decode.list=function(){decode.position++
var lst=[]
while(decode.data[decode.position]!==END_OF_TYPE){lst.push(decode.next())}
decode.position++
return lst}
decode.integer=function(){var end=decode.find(END_OF_TYPE)
var number=getIntFromBuffer(decode.data,decode.position+1,end)
decode.position+=end+1-decode.position
return number}
decode.buffer=function(){var sep=decode.find(STRING_DELIM)
var length=getIntFromBuffer(decode.data,decode.position,sep)
var end=++sep+length
decode.position=end
return decode.encoding?decode.data.toString(decode.encoding,sep,end):decode.data.slice(sep,end)}
module.exports=decode},{"safe-buffer":401}],194:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
function encode(data,buffer,offset){var buffers=[]
var result=null
encode._encode(buffers,data)
result=Buffer.concat(buffers)
encode.bytes=result.length
if(Buffer.isBuffer(buffer)){result.copy(buffer,offset)
return buffer}
return result}
encode.bytes=-1
encode._floatConversionDetected=!1
encode.getType=function(value){if(Buffer.isBuffer(value))return'buffer'
if(Array.isArray(value))return'array'
if(ArrayBuffer.isView(value))return'arraybufferview'
if(value instanceof Number)return'number'
if(value instanceof Boolean)return'boolean'
if(value instanceof ArrayBuffer)return'arraybuffer'
return typeof value}
encode._encode=function(buffers,data){if(data==null){return}
switch(encode.getType(data)){case 'buffer':encode.buffer(buffers,data);break
case 'object':encode.dict(buffers,data);break
case 'array':encode.list(buffers,data);break
case 'string':encode.string(buffers,data);break
case 'number':encode.number(buffers,data);break
case 'boolean':encode.number(buffers,data);break
case 'arraybufferview':encode.buffer(buffers,Buffer.from(data.buffer,data.byteOffset,data.byteLength));break
case 'arraybuffer':encode.buffer(buffers,Buffer.from(data));break}}
var buffE=Buffer.from('e')
var buffD=Buffer.from('d')
var buffL=Buffer.from('l')
encode.buffer=function(buffers,data){buffers.push(Buffer.from(data.length+':'),data)}
encode.string=function(buffers,data){buffers.push(Buffer.from(Buffer.byteLength(data)+':'+data))}
encode.number=function(buffers,data){var maxLo=0x80000000
var hi=(data/maxLo)<<0
var lo=(data%maxLo)<<0
var val=hi*maxLo+lo
buffers.push(Buffer.from('i'+val+'e'))
if(val!==data&&!encode._floatConversionDetected){encode._floatConversionDetected=!0
console.warn('WARNING: Possible data corruption detected with value "'+data+'":','Bencoding only defines support for integers, value was converted to "'+val+'"')
console.trace()}}
encode.dict=function(buffers,data){buffers.push(buffD)
var j=0
var k
var keys=Object.keys(data).sort()
var kl=keys.length
for(;j<kl;j++){k=keys[j]
if(data[k]==null)continue
encode.string(buffers,k)
encode._encode(buffers,data[k])}
buffers.push(buffE)}
encode.list=function(buffers,data){var i=0
var c=data.length
buffers.push(buffL)
for(;i<c;i++){if(data[i]==null)continue
encode._encode(buffers,data[i])}
buffers.push(buffE)}
module.exports=encode},{"safe-buffer":401}],195:[function(require,module,exports){var bencode=module.exports
bencode.encode=require('./encode')
bencode.decode=require('./decode')
bencode.byteLength=bencode.encodingLength=function(value){return bencode.encode(value).length}},{"./decode":193,"./encode":194}],196:[function(require,module,exports){module.exports=function(haystack,needle,comparator,low,high){var mid,cmp;if(low===undefined)
low=0;else{low=low|0;if(low<0||low>=haystack.length)
throw new RangeError("invalid lower bound")}
if(high===undefined)
high=haystack.length-1;else{high=high|0;if(high<low||high>=haystack.length)
throw new RangeError("invalid upper bound")}
while(low<=high){mid=low+(high-low>>1);cmp=+comparator(haystack[mid],needle,mid,haystack);if(cmp<0.0)
low=mid+1;else if(cmp>0.0)
high=mid-1;else return mid}
return~low}},{}],197:[function(require,module,exports){(function(Buffer){var Container=typeof Buffer!=='undefined'?Buffer:Uint8Array
function BitField(data,opts){if(!(this instanceof BitField)){return new BitField(data,opts)}
if(arguments.length===0){data=0}
this.grow=(opts&&((isFinite(opts.grow)&&getByteSize(opts.grow))||opts.grow))||0
if(typeof data==='number'||data===undefined){data=new Container(getByteSize(data))
if(data.fill&&!data._isBuffer)data.fill(0)}
this.buffer=data}
function getByteSize(num){var out=num>>3
if(num%8!==0)out++
return out}
BitField.prototype.get=function(i){var j=i>>3
return(j<this.buffer.length)&&!!(this.buffer[j]&(128>>(i%8)))}
BitField.prototype.set=function(i,b){var j=i>>3
if(b||arguments.length===1){if(this.buffer.length<j+1){this._grow(Math.max(j+1,Math.min(2*this.buffer.length,this.grow)))}
this.buffer[j]|=128>>(i%8)}else if(j<this.buffer.length){this.buffer[j]&=~(128>>(i%8))}}
BitField.prototype._grow=function(length){if(this.buffer.length<length&&length<=this.grow){var newBuffer=new Container(length)
if(newBuffer.fill)newBuffer.fill(0)
if(this.buffer.copy){this.buffer.copy(newBuffer,0)}else{for(var i=0;i<this.buffer.length;i++){newBuffer[i]=this.buffer[i]}}
this.buffer=newBuffer}}
if(typeof module!=='undefined')module.exports=BitField}).call(this,require("buffer").Buffer)},{"buffer":54}],198:[function(require,module,exports){(function(Buffer){const arrayRemove=require('unordered-array-remove')
const bencode=require('bencode')
const BitField=require('bitfield')
const debug=require('debug')('bittorrent-protocol')
const extend=require('xtend')
const randombytes=require('randombytes')
const speedometer=require('speedometer')
const stream=require('readable-stream')
const BITFIELD_GROW=400000
const KEEP_ALIVE_TIMEOUT=55000
const MESSAGE_PROTOCOL=Buffer.from('\u0013BitTorrent protocol')
const MESSAGE_KEEP_ALIVE=Buffer.from([0x00,0x00,0x00,0x00])
const MESSAGE_CHOKE=Buffer.from([0x00,0x00,0x00,0x01,0x00])
const MESSAGE_UNCHOKE=Buffer.from([0x00,0x00,0x00,0x01,0x01])
const MESSAGE_INTERESTED=Buffer.from([0x00,0x00,0x00,0x01,0x02])
const MESSAGE_UNINTERESTED=Buffer.from([0x00,0x00,0x00,0x01,0x03])
const MESSAGE_RESERVED=[0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00]
const MESSAGE_PORT=[0x00,0x00,0x00,0x03,0x09,0x00,0x00]
class Request{constructor(piece,offset,length,callback){this.piece=piece
this.offset=offset
this.length=length
this.callback=callback}}
class Wire extends stream.Duplex{constructor(){super()
this._debugId=randombytes(4).toString('hex')
this._debug('new wire')
this.peerId=null
this.peerIdBuffer=null
this.type=null
this.amChoking=!0
this.amInterested=!1
this.peerChoking=!0
this.peerInterested=!1
this.peerPieces=new BitField(0,{grow:BITFIELD_GROW})
this.peerExtensions={}
this.requests=[]
this.peerRequests=[]
this.extendedMapping={}
this.peerExtendedMapping={}
this.extendedHandshake={}
this.peerExtendedHandshake={}
this._ext={}
this._nextExt=1
this.uploaded=0
this.downloaded=0
this.uploadSpeed=speedometer()
this.downloadSpeed=speedometer()
this._keepAliveInterval=null
this._timeout=null
this._timeoutMs=0
this.destroyed=!1
this._finished=!1
this._parserSize=0
this._parser=null
this._buffer=[]
this._bufferSize=0
this.on('finish',this._onFinish)
this._parseHandshake()}
setKeepAlive(enable){this._debug('setKeepAlive %s',enable)
clearInterval(this._keepAliveInterval)
if(enable===!1)return
this._keepAliveInterval=setInterval(()=>{this.keepAlive()},KEEP_ALIVE_TIMEOUT)}
setTimeout(ms,unref){this._debug('setTimeout ms=%d unref=%s',ms,unref)
this._clearTimeout()
this._timeoutMs=ms
this._timeoutUnref=!!unref
this._updateTimeout()}
destroy(){if(this.destroyed)return
this.destroyed=!0
this._debug('destroy')
this.emit('close')
this.end()}
end(...args){this._debug('end')
this._onUninterested()
this._onChoke()
super.end(...args)}
use(Extension){const name=Extension.prototype.name
if(!name){throw new Error('Extension class requires a "name" property on the prototype')}
this._debug('use extension.name=%s',name)
const ext=this._nextExt
const handler=new Extension(this)
function noop(){}
if(typeof handler.onHandshake!=='function'){handler.onHandshake=noop}
if(typeof handler.onExtendedHandshake!=='function'){handler.onExtendedHandshake=noop}
if(typeof handler.onMessage!=='function'){handler.onMessage=noop}
this.extendedMapping[ext]=name
this._ext[name]=handler
this[name]=handler
this._nextExt+=1}
keepAlive(){this._debug('keep-alive')
this._push(MESSAGE_KEEP_ALIVE)}
handshake(infoHash,peerId,extensions){let infoHashBuffer
let peerIdBuffer
if(typeof infoHash==='string'){infoHash=infoHash.toLowerCase()
infoHashBuffer=Buffer.from(infoHash,'hex')}else{infoHashBuffer=infoHash
infoHash=infoHashBuffer.toString('hex')}
if(typeof peerId==='string'){peerIdBuffer=Buffer.from(peerId,'hex')}else{peerIdBuffer=peerId
peerId=peerIdBuffer.toString('hex')}
if(infoHashBuffer.length!==20||peerIdBuffer.length!==20){throw new Error('infoHash and peerId MUST have length 20')}
this._debug('handshake i=%s p=%s exts=%o',infoHash,peerId,extensions)
const reserved=Buffer.from(MESSAGE_RESERVED)
reserved[5]|=0x10
if(extensions&&extensions.dht)reserved[7]|=1
this._push(Buffer.concat([MESSAGE_PROTOCOL,reserved,infoHashBuffer,peerIdBuffer]))
this._handshakeSent=!0
if(this.peerExtensions.extended&&!this._extendedHandshakeSent){this._sendExtendedHandshake()}}
_sendExtendedHandshake(){const msg=extend(this.extendedHandshake)
msg.m={}
for(const ext in this.extendedMapping){const name=this.extendedMapping[ext]
msg.m[name]=Number(ext)}
this.extended(0,bencode.encode(msg))
this._extendedHandshakeSent=!0}
choke(){if(this.amChoking)return
this.amChoking=!0
this._debug('choke')
while(this.peerRequests.length){this.peerRequests.pop()}
this._push(MESSAGE_CHOKE)}
unchoke(){if(!this.amChoking)return
this.amChoking=!1
this._debug('unchoke')
this._push(MESSAGE_UNCHOKE)}
interested(){if(this.amInterested)return
this.amInterested=!0
this._debug('interested')
this._push(MESSAGE_INTERESTED)}
uninterested(){if(!this.amInterested)return
this.amInterested=!1
this._debug('uninterested')
this._push(MESSAGE_UNINTERESTED)}
have(index){this._debug('have %d',index)
this._message(4,[index],null)}
bitfield(bitfield){this._debug('bitfield')
if(!Buffer.isBuffer(bitfield))bitfield=bitfield.buffer
this._message(5,[],bitfield)}
request(index,offset,length,cb){if(!cb)cb=()=>{}
if(this._finished)return cb(new Error('wire is closed'))
if(this.peerChoking)return cb(new Error('peer is choking'))
this._debug('request index=%d offset=%d length=%d',index,offset,length)
this.requests.push(new Request(index,offset,length,cb))
this._updateTimeout()
this._message(6,[index,offset,length],null)}
piece(index,offset,buffer){this._debug('piece index=%d offset=%d',index,offset)
this.uploaded+=buffer.length
this.uploadSpeed(buffer.length)
this.emit('upload',buffer.length)
this._message(7,[index,offset],buffer)}
cancel(index,offset,length){this._debug('cancel index=%d offset=%d length=%d',index,offset,length)
this._callback(this._pull(this.requests,index,offset,length),new Error('request was cancelled'),null)
this._message(8,[index,offset,length],null)}
port(port){this._debug('port %d',port)
const message=Buffer.from(MESSAGE_PORT)
message.writeUInt16BE(port,5)
this._push(message)}
extended(ext,obj){this._debug('extended ext=%s',ext)
if(typeof ext==='string'&&this.peerExtendedMapping[ext]){ext=this.peerExtendedMapping[ext]}
if(typeof ext==='number'){const extId=Buffer.from([ext])
const buf=Buffer.isBuffer(obj)?obj:bencode.encode(obj)
this._message(20,[],Buffer.concat([extId,buf]))}else{throw new Error(`Unrecognized extension: ${ext}`)}}
_read(){}
_message(id,numbers,data){const dataLength=data?data.length:0
const buffer=Buffer.allocUnsafe(5+(4*numbers.length))
buffer.writeUInt32BE(buffer.length+dataLength-4,0)
buffer[4]=id
for(let i=0;i<numbers.length;i++){buffer.writeUInt32BE(numbers[i],5+(4*i))}
this._push(buffer)
if(data)this._push(data)}
_push(data){if(this._finished)return
return this.push(data)}
_onKeepAlive(){this._debug('got keep-alive')
this.emit('keep-alive')}
_onHandshake(infoHashBuffer,peerIdBuffer,extensions){const infoHash=infoHashBuffer.toString('hex')
const peerId=peerIdBuffer.toString('hex')
this._debug('got handshake i=%s p=%s exts=%o',infoHash,peerId,extensions)
this.peerId=peerId
this.peerIdBuffer=peerIdBuffer
this.peerExtensions=extensions
this.emit('handshake',infoHash,peerId,extensions)
let name
for(name in this._ext){this._ext[name].onHandshake(infoHash,peerId,extensions)}
if(extensions.extended&&this._handshakeSent&&!this._extendedHandshakeSent){this._sendExtendedHandshake()}}
_onChoke(){this.peerChoking=!0
this._debug('got choke')
this.emit('choke')
while(this.requests.length){this._callback(this.requests.pop(),new Error('peer is choking'),null)}}
_onUnchoke(){this.peerChoking=!1
this._debug('got unchoke')
this.emit('unchoke')}
_onInterested(){this.peerInterested=!0
this._debug('got interested')
this.emit('interested')}
_onUninterested(){this.peerInterested=!1
this._debug('got uninterested')
this.emit('uninterested')}
_onHave(index){if(this.peerPieces.get(index))return
this._debug('got have %d',index)
this.peerPieces.set(index,!0)
this.emit('have',index)}
_onBitField(buffer){this.peerPieces=new BitField(buffer)
this._debug('got bitfield')
this.emit('bitfield',this.peerPieces)}
_onRequest(index,offset,length){if(this.amChoking)return
this._debug('got request index=%d offset=%d length=%d',index,offset,length)
const respond=(err,buffer)=>{if(request!==this._pull(this.peerRequests,index,offset,length))return
if(err)return this._debug('error satisfying request index=%d offset=%d length=%d (%s)',index,offset,length,err.message)
this.piece(index,offset,buffer)}
var request=new Request(index,offset,length,respond)
this.peerRequests.push(request)
this.emit('request',index,offset,length,respond)}
_onPiece(index,offset,buffer){this._debug('got piece index=%d offset=%d',index,offset)
this._callback(this._pull(this.requests,index,offset,buffer.length),null,buffer)
this.downloaded+=buffer.length
this.downloadSpeed(buffer.length)
this.emit('download',buffer.length)
this.emit('piece',index,offset,buffer)}
_onCancel(index,offset,length){this._debug('got cancel index=%d offset=%d length=%d',index,offset,length)
this._pull(this.peerRequests,index,offset,length)
this.emit('cancel',index,offset,length)}
_onPort(port){this._debug('got port %d',port)
this.emit('port',port)}
_onExtended(ext,buf){if(ext===0){let info
try{info=bencode.decode(buf)}catch(err){this._debug('ignoring invalid extended handshake: %s',err.message||err)}
if(!info)return
this.peerExtendedHandshake=info
let name
if(typeof info.m==='object'){for(name in info.m){this.peerExtendedMapping[name]=Number(info.m[name].toString())}}
for(name in this._ext){if(this.peerExtendedMapping[name]){this._ext[name].onExtendedHandshake(this.peerExtendedHandshake)}}
this._debug('got extended handshake')
this.emit('extended','handshake',this.peerExtendedHandshake)}else{if(this.extendedMapping[ext]){ext=this.extendedMapping[ext]
if(this._ext[ext]){this._ext[ext].onMessage(buf)}}
this._debug('got extended message ext=%s',ext)
this.emit('extended',ext,buf)}}
_onTimeout(){this._debug('request timed out')
this._callback(this.requests.shift(),new Error('request has timed out'),null)
this.emit('timeout')}
_write(data,encoding,cb){this._bufferSize+=data.length
this._buffer.push(data)
while(this._bufferSize>=this._parserSize){const buffer=(this._buffer.length===1)?this._buffer[0]:Buffer.concat(this._buffer)
this._bufferSize-=this._parserSize
this._buffer=this._bufferSize?[buffer.slice(this._parserSize)]:[]
this._parser(buffer.slice(0,this._parserSize))}
cb(null)}
_callback(request,err,buffer){if(!request)return
this._clearTimeout()
if(!this.peerChoking&&!this._finished)this._updateTimeout()
request.callback(err,buffer)}
_clearTimeout(){if(!this._timeout)return
clearTimeout(this._timeout)
this._timeout=null}
_updateTimeout(){if(!this._timeoutMs||!this.requests.length||this._timeout)return
this._timeout=setTimeout(()=>this._onTimeout(),this._timeoutMs)
if(this._timeoutUnref&&this._timeout.unref)this._timeout.unref()}
_parse(size,parser){this._parserSize=size
this._parser=parser}
_onMessageLength(buffer){const length=buffer.readUInt32BE(0)
if(length>0){this._parse(length,this._onMessage)}else{this._onKeepAlive()
this._parse(4,this._onMessageLength)}}
_onMessage(buffer){this._parse(4,this._onMessageLength)
switch(buffer[0]){case 0:return this._onChoke()
case 1:return this._onUnchoke()
case 2:return this._onInterested()
case 3:return this._onUninterested()
case 4:return this._onHave(buffer.readUInt32BE(1))
case 5:return this._onBitField(buffer.slice(1))
case 6:return this._onRequest(buffer.readUInt32BE(1),buffer.readUInt32BE(5),buffer.readUInt32BE(9))
case 7:return this._onPiece(buffer.readUInt32BE(1),buffer.readUInt32BE(5),buffer.slice(9))
case 8:return this._onCancel(buffer.readUInt32BE(1),buffer.readUInt32BE(5),buffer.readUInt32BE(9))
case 9:return this._onPort(buffer.readUInt16BE(1))
case 20:return this._onExtended(buffer.readUInt8(1),buffer.slice(2))
default:this._debug('got unknown message')
return this.emit('unknownmessage',buffer)}}
_parseHandshake(){this._parse(1,buffer=>{const pstrlen=buffer.readUInt8(0)
this._parse(pstrlen+48,handshake=>{const protocol=handshake.slice(0,pstrlen)
if(protocol.toString()!=='BitTorrent protocol'){this._debug('Error: wire not speaking BitTorrent protocol (%s)',protocol.toString())
this.end()
return}
handshake=handshake.slice(pstrlen)
this._onHandshake(handshake.slice(8,28),handshake.slice(28,48),{dht:!!(handshake[7]&0x01),extended:!!(handshake[5]&0x10)})
this._parse(4,this._onMessageLength)})})}
_onFinish(){this._finished=!0
this.push(null)
while(this.read()){}
clearInterval(this._keepAliveInterval)
this._parse(Number.MAX_VALUE,()=>{})
while(this.peerRequests.length){this.peerRequests.pop()}
while(this.requests.length){this._callback(this.requests.pop(),new Error('wire was closed'),null)}}
_debug(...args){args[0]=`[${this._debugId}] ${args[0]}`
debug(...args)}
_pull(requests,piece,offset,length){for(let i=0;i<requests.length;i++){const req=requests[i]
if(req.piece===piece&&req.offset===offset&&req.length===length){arrayRemove(requests,i)
return req}}
return null}}
module.exports=Wire}).call(this,require("buffer").Buffer)},{"bencode":195,"bitfield":197,"buffer":54,"debug":265,"randombytes":379,"readable-stream":208,"speedometer":209,"unordered-array-remove":461,"xtend":211}],199:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=='[object Array]'}},{}],200:[function(require,module,exports){'use strict';var pna=require('process-nextick-args');var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var util=require('core-util-is');util.inherits=require('inherits');var Readable=require('./_stream_readable');var Writable=require('./_stream_writable');util.inherits(Duplex,Readable);{var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}}
function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===!1)this.readable=!1;if(options&&options.writable===!1)this.writable=!1;this.allowHalfOpen=!0;if(options&&options.allowHalfOpen===!1)this.allowHalfOpen=!1;this.once('end',onend)}
Object.defineProperty(Duplex.prototype,'writableHighWaterMark',{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function onend(){if(this.allowHalfOpen||this._writableState.ended)return;pna.nextTick(onEndNT,this)}
function onEndNT(self){self.end()}
Object.defineProperty(Duplex.prototype,'destroyed',{get:function(){if(this._readableState===undefined||this._writableState===undefined){return!1}
return this._readableState.destroyed&&this._writableState.destroyed},set:function(value){if(this._readableState===undefined||this._writableState===undefined){return}
this._readableState.destroyed=value;this._writableState.destroyed=value}});Duplex.prototype._destroy=function(err,cb){this.push(null);this.end();pna.nextTick(cb,err)}},{"./_stream_readable":202,"./_stream_writable":204,"core-util-is":248,"inherits":305,"process-nextick-args":374}],201:[function(require,module,exports){'use strict';module.exports=PassThrough;var Transform=require('./_stream_transform');var util=require('core-util-is');util.inherits=require('inherits');util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}
PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":203,"core-util-is":248,"inherits":305}],202:[function(require,module,exports){(function(process,global){'use strict';var pna=require('process-nextick-args');module.exports=Readable;var isArray=require('isarray');var Duplex;Readable.ReadableState=ReadableState;var EE=require('events').EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require('./internal/streams/stream');var Buffer=require('safe-buffer').Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}
function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}
var util=require('core-util-is');util.inherits=require('inherits');var debugUtil=require('util');var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog('stream')}else{debug=function(){}}
var BufferList=require('./internal/streams/BufferList');var destroyImpl=require('./internal/streams/destroy');var StringDecoder;util.inherits(Readable,Stream);var kProxyEvents=['error','close','destroy','pause','resume'];function prependListener(emitter,event,fn){if(typeof emitter.prependListener==='function')return emitter.prependListener(event,fn);if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}
function ReadableState(options,stream){Duplex=Duplex||require('./_stream_duplex');options=options||{};var isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var readableHwm=options.readableHighWaterMark;var defaultHwm=this.objectMode?16:16*1024;if(hwm||hwm===0)this.highWaterMark=hwm;else if(isDuplex&&(readableHwm||readableHwm===0))this.highWaterMark=readableHwm;else this.highWaterMark=defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.buffer=new BufferList();this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=!1;this.endEmitted=!1;this.reading=!1;this.sync=!0;this.needReadable=!1;this.emittedReadable=!1;this.readableListening=!1;this.resumeScheduled=!1;this.destroyed=!1;this.defaultEncoding=options.defaultEncoding||'utf8';this.awaitDrain=0;this.readingMore=!1;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require('string_decoder/').StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}
function Readable(options){Duplex=Duplex||require('./_stream_duplex');if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=!0;if(options){if(typeof options.read==='function')this._read=options.read;if(typeof options.destroy==='function')this._destroy=options.destroy}
Stream.call(this)}
Object.defineProperty(Readable.prototype,'destroyed',{get:function(){if(this._readableState===undefined){return!1}
return this._readableState.destroyed},set:function(value){if(!this._readableState){return}
this._readableState.destroyed=value}});Readable.prototype.destroy=destroyImpl.destroy;Readable.prototype._undestroy=destroyImpl.undestroy;Readable.prototype._destroy=function(err,cb){this.push(null);cb(err)};Readable.prototype.push=function(chunk,encoding){var state=this._readableState;var skipChunkCheck;if(!state.objectMode){if(typeof chunk==='string'){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=Buffer.from(chunk,encoding);encoding=''}
skipChunkCheck=!0}}else{skipChunkCheck=!0}
return readableAddChunk(this,chunk,encoding,!1,skipChunkCheck)};Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,!0,!1)};function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var state=stream._readableState;if(chunk===null){state.reading=!1;onEofChunk(stream,state)}else{var er;if(!skipChunkCheck)er=chunkInvalid(state,chunk);if(er){stream.emit('error',er)}else if(state.objectMode||chunk&&chunk.length>0){if(typeof chunk!=='string'&&!state.objectMode&&Object.getPrototypeOf(chunk)!==Buffer.prototype){chunk=_uint8ArrayToBuffer(chunk)}
if(addToFront){if(state.endEmitted)stream.emit('error',new Error('stream.unshift() after end event'));else addChunk(stream,state,chunk,!0)}else if(state.ended){stream.emit('error',new Error('stream.push() after EOF'))}else{state.reading=!1;if(state.decoder&&!encoding){chunk=state.decoder.write(chunk);if(state.objectMode||chunk.length!==0)addChunk(stream,state,chunk,!1);else maybeReadMore(stream,state)}else{addChunk(stream,state,chunk,!1)}}}else if(!addToFront){state.reading=!1}}
return needMoreData(state)}
function addChunk(stream,state,chunk,addToFront){if(state.flowing&&state.length===0&&!state.sync){stream.emit('data',chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}
maybeReadMore(stream,state)}
function chunkInvalid(state,chunk){var er;if(!_isUint8Array(chunk)&&typeof chunk!=='string'&&chunk!==undefined&&!state.objectMode){er=new TypeError('Invalid non-string/buffer chunk')}
return er}
function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}
Readable.prototype.isPaused=function(){return this._readableState.flowing===!1};Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require('string_decoder/').StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=0x800000;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}
return n}
function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}
if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=!0;return 0}
return state.length}
Readable.prototype.read=function(n){debug('read',n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=!1;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug('read: emitReadable',state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}
n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}
var doRead=state.needReadable;debug('need readable',doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=!0;debug('length less than watermark',doRead)}
if(state.ended||state.reading){doRead=!1;debug('reading or ended',doRead)}else if(doRead){debug('do read');state.reading=!0;state.sync=!0;if(state.length===0)state.needReadable=!0;this._read(state.highWaterMark);state.sync=!1;if(!state.reading)n=howMuchToRead(nOrig,state)}
var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=!0;n=0}else{state.length-=n}
if(state.length===0){if(!state.ended)state.needReadable=!0;if(nOrig!==n&&state.ended)endReadable(this)}
if(ret!==null)this.emit('data',ret);return ret};function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}
state.ended=!0;emitReadable(stream)}
function emitReadable(stream){var state=stream._readableState;state.needReadable=!1;if(!state.emittedReadable){debug('emitReadable',state.flowing);state.emittedReadable=!0;if(state.sync)pna.nextTick(emitReadable_,stream);else emitReadable_(stream)}}
function emitReadable_(stream){debug('emit readable');stream.emit('readable');flow(stream)}
function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=!0;pna.nextTick(maybeReadMore_,stream,state)}}
function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug('maybeReadMore read 0');stream.read(0);if(len===state.length)
break;else len=state.length}
state.readingMore=!1}
Readable.prototype._read=function(n){this.emit('error',new Error('_read() is not implemented'))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}
state.pipesCount+=1;debug('pipe count=%d opts=%j',state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:unpipe;if(state.endEmitted)pna.nextTick(endFn);else src.once('end',endFn);dest.on('unpipe',onunpipe);function onunpipe(readable,unpipeInfo){debug('onunpipe');if(readable===src){if(unpipeInfo&&unpipeInfo.hasUnpiped===!1){unpipeInfo.hasUnpiped=!0;cleanup()}}}
function onend(){debug('onend');dest.end()}
var ondrain=pipeOnDrain(src);dest.on('drain',ondrain);var cleanedUp=!1;function cleanup(){debug('cleanup');dest.removeListener('close',onclose);dest.removeListener('finish',onfinish);dest.removeListener('drain',ondrain);dest.removeListener('error',onerror);dest.removeListener('unpipe',onunpipe);src.removeListener('end',onend);src.removeListener('end',unpipe);src.removeListener('data',ondata);cleanedUp=!0;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}
var increasedAwaitDrain=!1;src.on('data',ondata);function ondata(chunk){debug('ondata');increasedAwaitDrain=!1;var ret=dest.write(chunk);if(!1===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug('false write response, pause',src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=!0}
src.pause()}}
function onerror(er){debug('onerror',er);unpipe();dest.removeListener('error',onerror);if(EElistenerCount(dest,'error')===0)dest.emit('error',er)}
prependListener(dest,'error',onerror);function onclose(){dest.removeListener('finish',onfinish);unpipe()}
dest.once('close',onclose);function onfinish(){debug('onfinish');dest.removeListener('close',onclose);unpipe()}
dest.once('finish',onfinish);function unpipe(){debug('unpipe');src.unpipe(dest)}
dest.emit('pipe',src);if(!state.flowing){debug('pipe resume');src.resume()}
return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug('pipeOnDrain',state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,'data')){state.flowing=!0;flow(src)}}}
Readable.prototype.unpipe=function(dest){var state=this._readableState;var unpipeInfo={hasUnpiped:!1};if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=!1;if(dest)dest.emit('unpipe',this,unpipeInfo);return this}
if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=!1;for(var i=0;i<len;i++){dests[i].emit('unpipe',this,unpipeInfo)}return this}
var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit('unpipe',this,unpipeInfo);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==='data'){if(this._readableState.flowing!==!1)this.resume()}else if(ev==='readable'){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=!0;state.emittedReadable=!1;if(!state.reading){pna.nextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this)}}}
return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug('readable nexttick read 0');self.read(0)}
Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug('resume');state.flowing=!0;resume(this,state)}
return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=!0;pna.nextTick(resume_,stream,state)}}
function resume_(stream,state){if(!state.reading){debug('resume read 0');stream.read(0)}
state.resumeScheduled=!1;state.awaitDrain=0;stream.emit('resume');flow(stream);if(state.flowing&&!state.reading)stream.read(0)}
Readable.prototype.pause=function(){debug('call pause flowing=%j',this._readableState.flowing);if(!1!==this._readableState.flowing){debug('pause');this._readableState.flowing=!1;this.emit('pause')}
return this};function flow(stream){var state=stream._readableState;debug('flow',state.flowing);while(state.flowing&&stream.read()!==null){}}
Readable.prototype.wrap=function(stream){var _this=this;var state=this._readableState;var paused=!1;stream.on('end',function(){debug('wrapped end');if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)_this.push(chunk)}
_this.push(null)});stream.on('data',function(chunk){debug('wrapped data');if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=_this.push(chunk);if(!ret){paused=!0;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==='function'){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}
for(var n=0;n<kProxyEvents.length;n++){stream.on(kProxyEvents[n],this.emit.bind(this,kProxyEvents[n]))}
this._read=function(n){debug('wrapped _read',n);if(paused){paused=!1;stream.resume()}};return this};Object.defineProperty(Readable.prototype,'readableHighWaterMark',{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join('');else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}
return ret}
function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}
return ret}
function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}
break}
++c}
list.length-=c;return ret}
function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}
break}
++c}
list.length-=c;return ret}
function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=!0;pna.nextTick(endReadableNT,state,stream)}}
function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=!0;stream.readable=!1;stream.emit('end')}}
function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}
return-1}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./_stream_duplex":200,"./internal/streams/BufferList":205,"./internal/streams/destroy":206,"./internal/streams/stream":207,"_process":139,"core-util-is":248,"events":90,"inherits":305,"isarray":199,"process-nextick-args":374,"safe-buffer":401,"string_decoder/":210,"util":23}],203:[function(require,module,exports){'use strict';module.exports=Transform;var Duplex=require('./_stream_duplex');var util=require('core-util-is');util.inherits=require('inherits');util.inherits(Transform,Duplex);function afterTransform(er,data){var ts=this._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb){return this.emit('error',new Error('write callback called multiple times'))}
ts.writechunk=null;ts.writecb=null;if(data!=null)
this.push(data);cb(er);var rs=this._readableState;rs.reading=!1;if(rs.needReadable||rs.length<rs.highWaterMark){this._read(rs.highWaterMark)}}
function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null};this._readableState.needReadable=!0;this._readableState.sync=!1;if(options){if(typeof options.transform==='function')this._transform=options.transform;if(typeof options.flush==='function')this._flush=options.flush}
this.on('prefinish',prefinish)}
function prefinish(){var _this=this;if(typeof this._flush==='function'){this._flush(function(er,data){done(_this,er,data)})}else{done(this,null,null)}}
Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=!1;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error('_transform() is not implemented')};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=!0;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=!0}};Transform.prototype._destroy=function(err,cb){var _this2=this;Duplex.prototype._destroy.call(this,err,function(err2){cb(err2);_this2.emit('close')})};function done(stream,er,data){if(er)return stream.emit('error',er);if(data!=null)
stream.push(data);if(stream._writableState.length)throw new Error('Calling transform done when ws.length != 0');if(stream._transformState.transforming)throw new Error('Calling transform done when still transforming');return stream.push(null)}},{"./_stream_duplex":200,"core-util-is":248,"inherits":305}],204:[function(require,module,exports){(function(process,global,setImmediate){'use strict';var pna=require('process-nextick-args');module.exports=Writable;function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}
function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(){onCorkedFinish(_this,state)}}
var asyncWrite=!process.browser&&['v0.10','v0.9.'].indexOf(process.version.slice(0,5))>-1?setImmediate:pna.nextTick;var Duplex;Writable.WritableState=WritableState;var util=require('core-util-is');util.inherits=require('inherits');var internalUtil={deprecate:require('util-deprecate')};var Stream=require('./internal/streams/stream');var Buffer=require('safe-buffer').Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}
function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}
var destroyImpl=require('./internal/streams/destroy');util.inherits(Writable,Stream);function nop(){}
function WritableState(options,stream){Duplex=Duplex||require('./_stream_duplex');options=options||{};var isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var writableHwm=options.writableHighWaterMark;var defaultHwm=this.objectMode?16:16*1024;if(hwm||hwm===0)this.highWaterMark=hwm;else if(isDuplex&&(writableHwm||writableHwm===0))this.highWaterMark=writableHwm;else this.highWaterMark=defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.finalCalled=!1;this.needDrain=!1;this.ending=!1;this.ended=!1;this.finished=!1;this.destroyed=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||'utf8';this.length=0;this.writing=!1;this.corked=0;this.sync=!0;this.bufferProcessing=!1;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=!1;this.errorEmitted=!1;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}
WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}
return out};(function(){try{Object.defineProperty(WritableState.prototype,'buffer',{get:internalUtil.deprecate(function(){return this.getBuffer()},'_writableState.buffer is deprecated. Use _writableState.getBuffer '+'instead.','DEP0003')})}catch(_){}})();var realHasInstance;if(typeof Symbol==='function'&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==='function'){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return!0;if(this!==Writable)return!1;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}
function Writable(options){Duplex=Duplex||require('./_stream_duplex');if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}
this._writableState=new WritableState(options,this);this.writable=!0;if(options){if(typeof options.write==='function')this._write=options.write;if(typeof options.writev==='function')this._writev=options.writev;if(typeof options.destroy==='function')this._destroy=options.destroy;if(typeof options.final==='function')this._final=options.final}
Stream.call(this)}
Writable.prototype.pipe=function(){this.emit('error',new Error('Cannot pipe, not readable'))};function writeAfterEnd(stream,cb){var er=new Error('write after end');stream.emit('error',er);pna.nextTick(cb,er)}
function validChunk(stream,state,chunk,cb){var valid=!0;var er=!1;if(chunk===null){er=new TypeError('May not write null values to stream')}else if(typeof chunk!=='string'&&chunk!==undefined&&!state.objectMode){er=new TypeError('Invalid non-string/buffer chunk')}
if(er){stream.emit('error',er);pna.nextTick(cb,er);valid=!1}
return valid}
Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=!1;var isBuf=!state.objectMode&&_isUint8Array(chunk);if(isBuf&&!Buffer.isBuffer(chunk)){chunk=_uint8ArrayToBuffer(chunk)}
if(typeof encoding==='function'){cb=encoding;encoding=null}
if(isBuf)encoding='buffer';else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=='function')cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)}
return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==='string')encoding=encoding.toLowerCase();if(!(['hex','utf8','utf-8','ascii','binary','base64','ucs2','ucs-2','utf16le','utf-16le','raw'].indexOf((encoding+'').toLowerCase())>-1))throw new TypeError('Unknown encoding: '+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==!1&&typeof chunk==='string'){chunk=Buffer.from(chunk,encoding)}
return chunk}
Object.defineProperty(Writable.prototype,'writableHighWaterMark',{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=decodeChunk(state,chunk,encoding);if(chunk!==newChunk){isBuf=!0;encoding='buffer';chunk=newChunk}}
var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=!0;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null};if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}
state.bufferedRequestCount+=1}else{doWrite(stream,state,!1,len,chunk,encoding,cb)}
return ret}
function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=!0;state.sync=!0;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=!1}
function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync){pna.nextTick(cb,er);pna.nextTick(finishMaybe,stream,state);stream._writableState.errorEmitted=!0;stream.emit('error',er)}else{cb(er);stream._writableState.errorEmitted=!0;stream.emit('error',er);finishMaybe(stream,state)}}
function onwriteStateUpdate(state){state.writing=!1;state.writecb=null;state.length-=state.writelen;state.writelen=0}
function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}
if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}
function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}
function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=!1;stream.emit('drain')}}
function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;var allBuffers=!0;while(entry){buffer[count]=entry;if(!entry.isBuf)allBuffers=!1;entry=entry.next;count+=1}
buffer.allBuffers=allBuffers;doWrite(stream,state,!0,state.length,buffer,'',holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}
state.bufferedRequestCount=0}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,!1,len,chunk,encoding,cb);entry=entry.next;state.bufferedRequestCount--;if(state.writing){break}}
if(entry===null)state.lastBufferedRequest=null}
state.bufferedRequest=entry;state.bufferProcessing=!1}
Writable.prototype._write=function(chunk,encoding,cb){cb(new Error('_write() is not implemented'))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==='function'){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==='function'){cb=encoding;encoding=null}
if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}
if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}
function callFinal(stream,state){stream._final(function(err){state.pendingcb--;if(err){stream.emit('error',err)}
state.prefinished=!0;stream.emit('prefinish');finishMaybe(stream,state)})}
function prefinish(stream,state){if(!state.prefinished&&!state.finalCalled){if(typeof stream._final==='function'){state.pendingcb++;state.finalCalled=!0;pna.nextTick(callFinal,stream,state)}else{state.prefinished=!0;stream.emit('prefinish')}}}
function finishMaybe(stream,state){var need=needFinish(state);if(need){prefinish(stream,state);if(state.pendingcb===0){state.finished=!0;stream.emit('finish')}}
return need}
function endWritable(stream,state,cb){state.ending=!0;finishMaybe(stream,state);if(cb){if(state.finished)pna.nextTick(cb);else stream.once('finish',cb)}
state.ended=!0;stream.writable=!1}
function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}
if(state.corkedRequestsFree){state.corkedRequestsFree.next=corkReq}else{state.corkedRequestsFree=corkReq}}
Object.defineProperty(Writable.prototype,'destroyed',{get:function(){if(this._writableState===undefined){return!1}
return this._writableState.destroyed},set:function(value){if(!this._writableState){return}
this._writableState.destroyed=value}});Writable.prototype.destroy=destroyImpl.destroy;Writable.prototype._undestroy=destroyImpl.undestroy;Writable.prototype._destroy=function(err,cb){this.end();cb(err)}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("timers").setImmediate)},{"./_stream_duplex":200,"./internal/streams/destroy":206,"./internal/streams/stream":207,"_process":139,"core-util-is":248,"inherits":305,"process-nextick-args":374,"safe-buffer":401,"timers":182,"util-deprecate":467}],205:[function(require,module,exports){'use strict';function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}
var Buffer=require('safe-buffer').Buffer;var util=require('util');function copyBuffer(src,target,offset){src.copy(target,offset)}
module.exports=function(){function BufferList(){_classCallCheck(this,BufferList);this.head=null;this.tail=null;this.length=0}
BufferList.prototype.push=function push(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function unshift(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function shift(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function clear(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function join(s){if(this.length===0)return'';var p=this.head;var ret=''+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function concat(n){if(this.length===0)return Buffer.alloc(0);if(this.length===1)return this.head.data;var ret=Buffer.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){copyBuffer(p.data,ret,i);i+=p.data.length;p=p.next}
return ret};return BufferList}();if(util&&util.inspect&&util.inspect.custom){module.exports.prototype[util.inspect.custom]=function(){var obj=util.inspect({length:this.length});return this.constructor.name+' '+obj}}},{"safe-buffer":401,"util":23}],206:[function(require,module,exports){'use strict';var pna=require('process-nextick-args');function destroy(err,cb){var _this=this;var readableDestroyed=this._readableState&&this._readableState.destroyed;var writableDestroyed=this._writableState&&this._writableState.destroyed;if(readableDestroyed||writableDestroyed){if(cb){cb(err)}else if(err&&(!this._writableState||!this._writableState.errorEmitted)){pna.nextTick(emitErrorNT,this,err)}
return this}
if(this._readableState){this._readableState.destroyed=!0}
if(this._writableState){this._writableState.destroyed=!0}
this._destroy(err||null,function(err){if(!cb&&err){pna.nextTick(emitErrorNT,_this,err);if(_this._writableState){_this._writableState.errorEmitted=!0}}else if(cb){cb(err)}});return this}
function undestroy(){if(this._readableState){this._readableState.destroyed=!1;this._readableState.reading=!1;this._readableState.ended=!1;this._readableState.endEmitted=!1}
if(this._writableState){this._writableState.destroyed=!1;this._writableState.ended=!1;this._writableState.ending=!1;this._writableState.finished=!1;this._writableState.errorEmitted=!1}}
function emitErrorNT(self,err){self.emit('error',err)}
module.exports={destroy:destroy,undestroy:undestroy}},{"process-nextick-args":374}],207:[function(require,module,exports){module.exports=require('events').EventEmitter},{"events":90}],208:[function(require,module,exports){exports=module.exports=require('./lib/_stream_readable.js');exports.Stream=exports;exports.Readable=exports;exports.Writable=require('./lib/_stream_writable.js');exports.Duplex=require('./lib/_stream_duplex.js');exports.Transform=require('./lib/_stream_transform.js');exports.PassThrough=require('./lib/_stream_passthrough.js')},{"./lib/_stream_duplex.js":200,"./lib/_stream_passthrough.js":201,"./lib/_stream_readable.js":202,"./lib/_stream_transform.js":203,"./lib/_stream_writable.js":204}],209:[function(require,module,exports){var tick=1
var maxTick=65535
var resolution=4
var timer
var inc=function(){tick=(tick+1)&maxTick}
module.exports=function(seconds){if(!timer){timer=setInterval(inc,(1000/resolution)|0)
if(timer.unref)timer.unref()}
var size=resolution*(seconds||5)
var buffer=[0]
var pointer=1
var last=(tick-1)&maxTick
return function(delta){var dist=(tick-last)&maxTick
if(dist>size)dist=size
last=tick
while(dist--){if(pointer===size)pointer=0
buffer[pointer]=buffer[pointer===0?size-1:pointer-1]
pointer++}
if(delta)buffer[pointer-1]+=delta
var top=buffer[pointer-1]
var btm=buffer.length<size?0:buffer[pointer===size?0:pointer]
return buffer.length<resolution?top:(top-btm)*resolution/buffer.length}}},{}],210:[function(require,module,exports){'use strict';var Buffer=require('safe-buffer').Buffer;var isEncoding=Buffer.isEncoding||function(encoding){encoding=''+encoding;switch(encoding&&encoding.toLowerCase()){case 'hex':case 'utf8':case 'utf-8':case 'ascii':case 'binary':case 'base64':case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':case 'raw':return!0;default:return!1}};function _normalizeEncoding(enc){if(!enc)return'utf8';var retried;while(!0){switch(enc){case 'utf8':case 'utf-8':return'utf8';case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':return'utf16le';case 'latin1':case 'binary':return'latin1';case 'base64':case 'ascii':case 'hex':return enc;default:if(retried)return;enc=(''+enc).toLowerCase();retried=!0}}};function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if(typeof nenc!=='string'&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error('Unknown encoding: '+enc);return nenc||enc}
exports.StringDecoder=StringDecoder;function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case 'utf16le':this.text=utf16Text;this.end=utf16End;nb=4;break;case 'utf8':this.fillLast=utf8FillLast;nb=4;break;case 'base64':this.text=base64Text;this.end=base64End;nb=3;break;default:this.write=simpleWrite;this.end=simpleEnd;return}
this.lastNeed=0;this.lastTotal=0;this.lastChar=Buffer.allocUnsafe(nb)}
StringDecoder.prototype.write=function(buf){if(buf.length===0)return'';var r;var i;if(this.lastNeed){r=this.fillLast(buf);if(r===undefined)return'';i=this.lastNeed;this.lastNeed=0}else{i=0}
if(i<buf.length)return r?r+this.text(buf,i):this.text(buf,i);return r||''};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length){buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}
buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length);this.lastNeed-=buf.length};function utf8CheckByte(byte){if(byte<=0x7F)return 0;else if(byte>>5===0x06)return 2;else if(byte>>4===0x0E)return 3;else if(byte>>3===0x1E)return 4;return byte>>6===0x02?-1:-2}
function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-1;return nb}
if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-2;return nb}
if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0){if(nb===2)nb=0;else self.lastNeed=nb-3}
return nb}
return 0}
function utf8CheckExtraBytes(self,buf,p){if((buf[0]&0xC0)!==0x80){self.lastNeed=0;return'\ufffd'}
if(self.lastNeed>1&&buf.length>1){if((buf[1]&0xC0)!==0x80){self.lastNeed=1;return'\ufffd'}
if(self.lastNeed>2&&buf.length>2){if((buf[2]&0xC0)!==0x80){self.lastNeed=2;return'\ufffd'}}}}
function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed;var r=utf8CheckExtraBytes(this,buf,p);if(r!==undefined)return r;if(this.lastNeed<=buf.length){buf.copy(this.lastChar,p,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}
buf.copy(this.lastChar,p,0,buf.length);this.lastNeed-=buf.length}
function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString('utf8',i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);buf.copy(this.lastChar,0,end);return buf.toString('utf8',i,end)}
function utf8End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed)return r+'\ufffd';return r}
function utf16Text(buf,i){if((buf.length-i)%2===0){var r=buf.toString('utf16le',i);if(r){var c=r.charCodeAt(r.length-1);if(c>=0xD800&&c<=0xDBFF){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1];return r.slice(0,-1)}}
return r}
this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=buf[buf.length-1];return buf.toString('utf16le',i,buf.length-1)}
function utf16End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString('utf16le',0,end)}
return r}
function base64Text(buf,i){var n=(buf.length-i)%3;if(n===0)return buf.toString('base64',i);this.lastNeed=3-n;this.lastTotal=3;if(n===1){this.lastChar[0]=buf[buf.length-1]}else{this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1]}
return buf.toString('base64',i,buf.length-n)}
function base64End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed)return r+this.lastChar.toString('base64',0,3-this.lastNeed);return r}
function simpleWrite(buf){return buf.toString(this.encoding)}
function simpleEnd(buf){return buf&&buf.length?this.write(buf):''}},{"safe-buffer":401}],211:[function(require,module,exports){module.exports=extend
var hasOwnProperty=Object.prototype.hasOwnProperty;function extend(){var target={}
for(var i=0;i<arguments.length;i++){var source=arguments[i]
for(var key in source){if(hasOwnProperty.call(source,key)){target[key]=source[key]}}}
return target}},{}],212:[function(require,module,exports){(function(process){const{Buffer}=require('safe-buffer')
const debug=require('debug')('bittorrent-tracker:client')
const EventEmitter=require('events')
const once=require('once')
const parallel=require('run-parallel')
const Peer=require('simple-peer')
const uniq=require('uniq')
const url=require('url')
const common=require('./lib/common')
const HTTPTracker=require('./lib/client/http-tracker')
const UDPTracker=require('./lib/client/udp-tracker')
const WebSocketTracker=require('./lib/client/websocket-tracker')
class Client extends EventEmitter{constructor(opts={}){super()
if(!opts.peerId)throw new Error('Option `peerId` is required')
if(!opts.infoHash)throw new Error('Option `infoHash` is required')
if(!opts.announce)throw new Error('Option `announce` is required')
if(!process.browser&&!opts.port)throw new Error('Option `port` is required')
this.peerId=typeof opts.peerId==='string'?opts.peerId:opts.peerId.toString('hex')
this._peerIdBuffer=Buffer.from(this.peerId,'hex')
this._peerIdBinary=this._peerIdBuffer.toString('binary')
this.infoHash=typeof opts.infoHash==='string'?opts.infoHash.toLowerCase():opts.infoHash.toString('hex')
this._infoHashBuffer=Buffer.from(this.infoHash,'hex')
this._infoHashBinary=this._infoHashBuffer.toString('binary')
debug('new client %s',this.infoHash)
this.destroyed=!1
this._port=opts.port
this._getAnnounceOpts=opts.getAnnounceOpts
this._rtcConfig=opts.rtcConfig
this._userAgent=opts.userAgent
this._wrtc=typeof opts.wrtc==='function'?opts.wrtc():opts.wrtc
let announce=typeof opts.announce==='string'?[opts.announce]:opts.announce==null?[]:opts.announce
announce=announce.map(announceUrl=>{announceUrl=announceUrl.toString()
if(announceUrl[announceUrl.length-1]==='/'){announceUrl=announceUrl.substring(0,announceUrl.length-1)}
return announceUrl})
announce=uniq(announce)
const webrtcSupport=this._wrtc!==!1&&(!!this._wrtc||Peer.WEBRTC_SUPPORT)
const nextTickWarn=err=>{process.nextTick(()=>{this.emit('warning',err)})}
this._trackers=announce.map(announceUrl=>{const parsedUrl=url.parse(announceUrl)
const port=parsedUrl.port
if(port<0||port>65535){nextTickWarn(new Error(`Invalid tracker port: ${announceUrl}`))
return null}
const protocol=parsedUrl.protocol
if((protocol==='http:'||protocol==='https:')&&typeof HTTPTracker==='function'){return new HTTPTracker(this,announceUrl)}else if(protocol==='udp:'&&typeof UDPTracker==='function'){return new UDPTracker(this,announceUrl)}else if((protocol==='ws:'||protocol==='wss:')&&webrtcSupport){if(protocol==='ws:'&&typeof window!=='undefined'&&window.location.protocol==='https:'){nextTickWarn(new Error(`Unsupported tracker protocol: ${announceUrl}`))
return null}
return new WebSocketTracker(this,announceUrl)}else{nextTickWarn(new Error(`Unsupported tracker protocol: ${announceUrl}`))
return null}}).filter(Boolean)}
start(opts){debug('send `start`')
opts=this._defaultAnnounceOpts(opts)
opts.event='started'
this._announce(opts)
this._trackers.forEach(tracker=>{tracker.setInterval()})}
stop(opts){debug('send `stop`')
opts=this._defaultAnnounceOpts(opts)
opts.event='stopped'
this._announce(opts)}
complete(opts){debug('send `complete`')
if(!opts)opts={}
opts=this._defaultAnnounceOpts(opts)
opts.event='completed'
this._announce(opts)}
update(opts){debug('send `update`')
opts=this._defaultAnnounceOpts(opts)
if(opts.event)delete opts.event
this._announce(opts)}
_announce(opts){this._trackers.forEach(tracker=>{tracker.announce(opts)})}
scrape(opts){debug('send `scrape`')
if(!opts)opts={}
this._trackers.forEach(tracker=>{tracker.scrape(opts)})}
setInterval(intervalMs){debug('setInterval %d',intervalMs)
this._trackers.forEach(tracker=>{tracker.setInterval(intervalMs)})}
destroy(cb){if(this.destroyed)return
this.destroyed=!0
debug('destroy')
const tasks=this._trackers.map(tracker=>cb=>{tracker.destroy(cb)})
parallel(tasks,cb)
this._trackers=[]
this._getAnnounceOpts=null}
_defaultAnnounceOpts(opts={}){if(opts.numwant==null)opts.numwant=common.DEFAULT_ANNOUNCE_PEERS
if(opts.uploaded==null)opts.uploaded=0
if(opts.downloaded==null)opts.downloaded=0
if(this._getAnnounceOpts)opts=Object.assign({},opts,this._getAnnounceOpts())
return opts}}
Client.scrape=(opts,cb)=>{cb=once(cb)
if(!opts.infoHash)throw new Error('Option `infoHash` is required')
if(!opts.announce)throw new Error('Option `announce` is required')
const clientOpts=Object.assign({},opts,{infoHash:Array.isArray(opts.infoHash)?opts.infoHash[0]:opts.infoHash,peerId:Buffer.from('01234567890123456789'),port:6881})
const client=new Client(clientOpts)
client.once('error',cb)
client.once('warning',cb)
let len=Array.isArray(opts.infoHash)?opts.infoHash.length:1
const results={}
client.on('scrape',data=>{len-=1
results[data.infoHash]=data
if(len===0){client.destroy()
const keys=Object.keys(results)
if(keys.length===1){cb(null,results[keys[0]])}else{cb(null,results)}}})
opts.infoHash=Array.isArray(opts.infoHash)?opts.infoHash.map(infoHash=>{return Buffer.from(infoHash,'hex')}):Buffer.from(opts.infoHash,'hex')
client.scrape({infoHash:opts.infoHash})
return client}
module.exports=Client}).call(this,require('_process'))},{"./lib/client/http-tracker":23,"./lib/client/udp-tracker":23,"./lib/client/websocket-tracker":214,"./lib/common":215,"_process":139,"debug":216,"events":90,"once":363,"run-parallel":399,"safe-buffer":401,"simple-peer":405,"uniq":460,"url":184}],213:[function(require,module,exports){const EventEmitter=require('events')
class Tracker extends EventEmitter{constructor(client,announceUrl){super()
this.client=client
this.announceUrl=announceUrl
this.interval=null
this.destroyed=!1}
setInterval(intervalMs){if(intervalMs==null)intervalMs=this.DEFAULT_ANNOUNCE_INTERVAL
clearInterval(this.interval)
if(intervalMs){this.interval=setInterval(()=>{this.announce(this.client._defaultAnnounceOpts())},intervalMs)
if(this.interval.unref)this.interval.unref()}}}
module.exports=Tracker},{"events":90}],214:[function(require,module,exports){const debug=require('debug')('bittorrent-tracker:websocket-tracker')
const Peer=require('simple-peer')
const randombytes=require('randombytes')
const Socket=require('simple-websocket')
const common=require('../common')
const Tracker=require('./tracker')
const socketPool={}
const RECONNECT_MINIMUM=10*1000
const RECONNECT_MAXIMUM=30*60*1000
const RECONNECT_VARIANCE=2*60*1000
const OFFER_TIMEOUT=50*1000
class WebSocketTracker extends Tracker{constructor(client,announceUrl,opts){super(client,announceUrl)
debug('new websocket tracker %s',announceUrl)
this.peers={}
this.socket=null
this.reconnecting=!1
this.retries=0
this.reconnectTimer=null
this.expectingResponse=!1
this._openSocket()}
announce(opts){if(this.destroyed||this.reconnecting)return
if(!this.socket.connected){this.socket.once('connect',()=>{this.announce(opts)})
return}
const params=Object.assign({},opts,{action:'announce',info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary})
if(this._trackerId)params.trackerid=this._trackerId
if(opts.event==='stopped'||opts.event==='completed'){this._send(params)}else{const numwant=Math.min(opts.numwant,10)
this._generateOffers(numwant,offers=>{params.numwant=numwant
params.offers=offers
this._send(params)})}}
scrape(opts){if(this.destroyed||this.reconnecting)return
if(!this.socket.connected){this.socket.once('connect',()=>{this.scrape(opts)})
return}
const infoHashes=(Array.isArray(opts.infoHash)&&opts.infoHash.length>0)?opts.infoHash.map(infoHash=>{return infoHash.toString('binary')}):(opts.infoHash&&opts.infoHash.toString('binary'))||this.client._infoHashBinary
const params={action:'scrape',info_hash:infoHashes}
this._send(params)}
destroy(cb=noop){if(this.destroyed)return cb(null)
this.destroyed=!0
clearInterval(this.interval)
clearTimeout(this.reconnectTimer)
for(const peerId in this.peers){const peer=this.peers[peerId]
clearTimeout(peer.trackerTimeout)
peer.destroy()}
this.peers=null
if(this.socket){this.socket.removeListener('connect',this._onSocketConnectBound)
this.socket.removeListener('data',this._onSocketDataBound)
this.socket.removeListener('close',this._onSocketCloseBound)
this.socket.removeListener('error',this._onSocketErrorBound)
this.socket=null}
this._onSocketConnectBound=null
this._onSocketErrorBound=null
this._onSocketDataBound=null
this._onSocketCloseBound=null
if(socketPool[this.announceUrl]){socketPool[this.announceUrl].consumers-=1}
if(socketPool[this.announceUrl].consumers>0)return cb()
let socket=socketPool[this.announceUrl]
delete socketPool[this.announceUrl]
socket.on('error',noop)
socket.once('close',cb)
if(!this.expectingResponse)return destroyCleanup()
var timeout=setTimeout(destroyCleanup,common.DESTROY_TIMEOUT)
socket.once('data',destroyCleanup)
function destroyCleanup(){if(timeout){clearTimeout(timeout)
timeout=null}
socket.removeListener('data',destroyCleanup)
socket.destroy()
socket=null}}
_openSocket(){this.destroyed=!1
if(!this.peers)this.peers={}
this._onSocketConnectBound=()=>{this._onSocketConnect()}
this._onSocketErrorBound=err=>{this._onSocketError(err)}
this._onSocketDataBound=data=>{this._onSocketData(data)}
this._onSocketCloseBound=()=>{this._onSocketClose()}
this.socket=socketPool[this.announceUrl]
if(this.socket){socketPool[this.announceUrl].consumers+=1}else{this.socket=socketPool[this.announceUrl]=new Socket(this.announceUrl)
this.socket.consumers=1
this.socket.once('connect',this._onSocketConnectBound)}
this.socket.on('data',this._onSocketDataBound)
this.socket.once('close',this._onSocketCloseBound)
this.socket.once('error',this._onSocketErrorBound)}
_onSocketConnect(){if(this.destroyed)return
if(this.reconnecting){this.reconnecting=!1
this.retries=0
this.announce(this.client._defaultAnnounceOpts())}}
_onSocketData(data){if(this.destroyed)return
this.expectingResponse=!1
try{data=JSON.parse(data)}catch(err){this.client.emit('warning',new Error('Invalid tracker response'))
return}
if(data.action==='announce'){this._onAnnounceResponse(data)}else if(data.action==='scrape'){this._onScrapeResponse(data)}else{this._onSocketError(new Error(`invalid action in WS response: ${data.action}`))}}
_onAnnounceResponse(data){if(data.info_hash!==this.client._infoHashBinary){debug('ignoring websocket data from %s for %s (looking for %s: reused socket)',this.announceUrl,common.binaryToHex(data.info_hash),this.client.infoHash)
return}
if(data.peer_id&&data.peer_id===this.client._peerIdBinary){return}
debug('received %s from %s for %s',JSON.stringify(data),this.announceUrl,this.client.infoHash)
const failure=data['failure reason']
if(failure)return this.client.emit('warning',new Error(failure))
const warning=data['warning message']
if(warning)this.client.emit('warning',new Error(warning))
const interval=data.interval||data['min interval']
if(interval)this.setInterval(interval*1000)
const trackerId=data['tracker id']
if(trackerId){this._trackerId=trackerId}
if(data.complete!=null){const response=Object.assign({},data,{announce:this.announceUrl,infoHash:common.binaryToHex(data.info_hash)})
this.client.emit('update',response)}
let peer
if(data.offer&&data.peer_id){debug('creating peer (from remote offer)')
peer=this._createPeer()
peer.id=common.binaryToHex(data.peer_id)
peer.once('signal',answer=>{const params={action:'announce',info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary,to_peer_id:data.peer_id,answer,offer_id:data.offer_id}
if(this._trackerId)params.trackerid=this._trackerId
this._send(params)})
peer.signal(data.offer)
this.client.emit('peer',peer)}
if(data.answer&&data.peer_id){const offerId=common.binaryToHex(data.offer_id)
peer=this.peers[offerId]
if(peer){peer.id=common.binaryToHex(data.peer_id)
peer.signal(data.answer)
this.client.emit('peer',peer)
clearTimeout(peer.trackerTimeout)
peer.trackerTimeout=null
delete this.peers[offerId]}else{debug(`got unexpected answer: ${JSON.stringify(data.answer)}`)}}}
_onScrapeResponse(data){data=data.files||{}
const keys=Object.keys(data)
if(keys.length===0){this.client.emit('warning',new Error('invalid scrape response'))
return}
keys.forEach(infoHash=>{const response=Object.assign(data[infoHash],{announce:this.announceUrl,infoHash:common.binaryToHex(infoHash)})
this.client.emit('scrape',response)})}
_onSocketClose(){if(this.destroyed)return
this.destroy()
this._startReconnectTimer()}
_onSocketError(err){if(this.destroyed)return
this.destroy()
this.client.emit('warning',err)
this._startReconnectTimer()}
_startReconnectTimer(){const ms=Math.floor(Math.random()*RECONNECT_VARIANCE)+Math.min(Math.pow(2,this.retries)*RECONNECT_MINIMUM,RECONNECT_MAXIMUM)
this.reconnecting=!0
clearTimeout(this.reconnectTimer)
this.reconnectTimer=setTimeout(()=>{this.retries++
this._openSocket()},ms)
if(this.reconnectTimer.unref)this.reconnectTimer.unref()
debug('reconnecting socket in %s ms',ms)}
_send(params){if(this.destroyed)return
this.expectingResponse=!0
const message=JSON.stringify(params)
debug('send %s',message)
this.socket.send(message)}
_generateOffers(numwant,cb){const self=this
const offers=[]
debug('generating %s offers',numwant)
for(let i=0;i<numwant;++i){generateOffer()}
checkDone()
function generateOffer(){const offerId=randombytes(20).toString('hex')
debug('creating peer (from _generateOffers)')
const peer=self.peers[offerId]=self._createPeer({initiator:!0})
peer.once('signal',offer=>{offers.push({offer,offer_id:common.hexToBinary(offerId)})
checkDone()})
peer.trackerTimeout=setTimeout(()=>{debug('tracker timeout: destroying peer')
peer.trackerTimeout=null
delete self.peers[offerId]
peer.destroy()},OFFER_TIMEOUT)
if(peer.trackerTimeout.unref)peer.trackerTimeout.unref()}
function checkDone(){if(offers.length===numwant){debug('generated %s offers',numwant)
cb(offers)}}}
_createPeer(opts){const self=this
opts=Object.assign({trickle:!1,config:self.client._rtcConfig,wrtc:self.client._wrtc},opts)
const peer=new Peer(opts)
peer.once('error',onError)
peer.once('connect',onConnect)
return peer
function onError(err){self.client.emit('warning',new Error(`Connection error: ${err.message}`))
peer.destroy()}
function onConnect(){peer.removeListener('error',onError)
peer.removeListener('connect',onConnect)}}}
WebSocketTracker.prototype.DEFAULT_ANNOUNCE_INTERVAL=30*1000
WebSocketTracker._socketPool=socketPool
function noop(){}
module.exports=WebSocketTracker},{"../common":215,"./tracker":213,"debug":216,"randombytes":379,"simple-peer":405,"simple-websocket":420}],215:[function(require,module,exports){var Buffer=require('safe-buffer').Buffer
exports.DEFAULT_ANNOUNCE_PEERS=50
exports.MAX_ANNOUNCE_PEERS=82
exports.binaryToHex=function(str){if(typeof str!=='string'){str=String(str)}
return Buffer.from(str,'binary').toString('hex')}
exports.hexToBinary=function(str){if(typeof str!=='string'){str=String(str)}
return Buffer.from(str,'hex').toString('binary')}
var config=require('./common-node')
Object.assign(exports,config)},{"./common-node":23,"safe-buffer":401}],216:[function(require,module,exports){(function(process){exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=localstorage();exports.colors=['#0000CC','#0000FF','#0033CC','#0033FF','#0066CC','#0066FF','#0099CC','#0099FF','#00CC00','#00CC33','#00CC66','#00CC99','#00CCCC','#00CCFF','#3300CC','#3300FF','#3333CC','#3333FF','#3366CC','#3366FF','#3399CC','#3399FF','#33CC00','#33CC33','#33CC66','#33CC99','#33CCCC','#33CCFF','#6600CC','#6600FF','#6633CC','#6633FF','#66CC00','#66CC33','#9900CC','#9900FF','#9933CC','#9933FF','#99CC00','#99CC33','#CC0000','#CC0033','#CC0066','#CC0099','#CC00CC','#CC00FF','#CC3300','#CC3333','#CC3366','#CC3399','#CC33CC','#CC33FF','#CC6600','#CC6633','#CC9900','#CC9933','#CCCC00','#CCCC33','#FF0000','#FF0033','#FF0066','#FF0099','#FF00CC','#FF00FF','#FF3300','#FF3333','#FF3366','#FF3399','#FF33CC','#FF33FF','#FF6600','#FF6633','#FF9900','#FF9933','#FFCC00','#FFCC33'];function useColors(){if(typeof window!=='undefined'&&window.process&&(window.process.type==='renderer'||window.process.__nwjs)){return!0}
if(typeof navigator!=='undefined'&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return!1}
return(typeof document!=='undefined'&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance)||(typeof window!=='undefined'&&window.console&&(window.console.firebug||(window.console.exception&&window.console.table)))||(typeof navigator!=='undefined'&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31)||(typeof navigator!=='undefined'&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}
function formatArgs(args){args[0]=(this.useColors?'%c':'')+this.namespace+(this.useColors?' %c':' ')+args[0]+(this.useColors?'%c ':' ')+'+'+module.exports.humanize(this.diff);if(!this.useColors){return}
const c='color: '+this.color;args.splice(1,0,c,'color: inherit');let index=0;let lastC=0;args[0].replace(/%[a-zA-Z%]/g,match=>{if(match==='%%'){return}
index++;if(match==='%c'){lastC=index}});args.splice(lastC,0,c)}
function log(...args){return typeof console==='object'&&console.log&&console.log(...args)}
function save(namespaces){try{if(namespaces){exports.storage.setItem('debug',namespaces)}else{exports.storage.removeItem('debug')}}catch(error){}}
function load(){let r;try{r=exports.storage.getItem('debug')}catch(error){}
if(!r&&typeof process!=='undefined'&&'env' in process){r=process.env.DEBUG}
return r}
function localstorage(){try{return localStorage}catch(error){}}
module.exports=require('./common')(exports);const{formatters}=module.exports;formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return'[UnexpectedJSONParseError]: '+error.message}}}).call(this,require('_process'))},{"./common":217,"_process":139}],217:[function(require,module,exports){function setup(env){createDebug.debug=createDebug;createDebug.default=createDebug;createDebug.coerce=coerce;createDebug.disable=disable;createDebug.enable=enable;createDebug.enabled=enabled;createDebug.humanize=require('ms');Object.keys(env).forEach(key=>{createDebug[key]=env[key]});createDebug.instances=[];createDebug.names=[];createDebug.skips=[];createDebug.formatters={};function selectColor(namespace){let hash=0;for(let i=0;i<namespace.length;i++){hash=((hash<<5)-hash)+namespace.charCodeAt(i);hash|=0}
return createDebug.colors[Math.abs(hash)%createDebug.colors.length]}
createDebug.selectColor=selectColor;function createDebug(namespace){let prevTime;function debug(...args){if(!debug.enabled){return}
const self=debug;const curr=Number(new Date());const ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;args[0]=createDebug.coerce(args[0]);if(typeof args[0]!=='string'){args.unshift('%O')}
let index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,(match,format)=>{if(match==='%%'){return match}
index++;const formatter=createDebug.formatters[format];if(typeof formatter==='function'){const val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}
return match});createDebug.formatArgs.call(self,args);const logFn=self.log||createDebug.log;logFn.apply(self,args)}
debug.namespace=namespace;debug.enabled=createDebug.enabled(namespace);debug.useColors=createDebug.useColors();debug.color=selectColor(namespace);debug.destroy=destroy;debug.extend=extend;if(typeof createDebug.init==='function'){createDebug.init(debug)}
createDebug.instances.push(debug);return debug}
function destroy(){const index=createDebug.instances.indexOf(this);if(index!==-1){createDebug.instances.splice(index,1);return!0}
return!1}
function extend(namespace,delimiter){const newDebug=createDebug(this.namespace+(typeof delimiter==='undefined'?':':delimiter)+namespace);newDebug.log=this.log;return newDebug}
function enable(namespaces){createDebug.save(namespaces);createDebug.names=[];createDebug.skips=[];let i;const split=(typeof namespaces==='string'?namespaces:'').split(/[\s,]+/);const len=split.length;for(i=0;i<len;i++){if(!split[i]){continue}
namespaces=split[i].replace(/\*/g,'.*?');if(namespaces[0]==='-'){createDebug.skips.push(new RegExp('^'+namespaces.substr(1)+'$'))}else{createDebug.names.push(new RegExp('^'+namespaces+'$'))}}
for(i=0;i<createDebug.instances.length;i++){const instance=createDebug.instances[i];instance.enabled=createDebug.enabled(instance.namespace)}}
function disable(){const namespaces=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(namespace=>'-'+namespace)].join(',');createDebug.enable('');return namespaces}
function enabled(name){if(name[name.length-1]==='*'){return!0}
let i;let len;for(i=0,len=createDebug.skips.length;i<len;i++){if(createDebug.skips[i].test(name)){return!1}}
for(i=0,len=createDebug.names.length;i<len;i++){if(createDebug.names[i].test(name)){return!0}}
return!1}
function toNamespace(regexp){return regexp.toString().substring(2,regexp.toString().length-2).replace(/\.\*\?$/,'*')}
function coerce(val){if(val instanceof Error){return val.stack||val.message}
return val}
createDebug.enable(createDebug.load());return createDebug}
module.exports=setup},{"ms":346}],218:[function(require,module,exports){(function(Buffer){module.exports=function blobToBuffer(blob,cb){if(typeof Blob==='undefined'||!(blob instanceof Blob)){throw new Error('first argument must be a Blob')}
if(typeof cb!=='function'){throw new Error('second argument must be a function')}
var reader=new FileReader()
function onLoadEnd(e){reader.removeEventListener('loadend',onLoadEnd,!1)
if(e.error)cb(e.error)
else cb(null,Buffer.from(reader.result))}
reader.addEventListener('loadend',onLoadEnd,!1)
reader.readAsArrayBuffer(blob)}}).call(this,require("buffer").Buffer)},{"buffer":54}],219:[function(require,module,exports){(function(Buffer){var inherits=require('inherits');var Transform=require('readable-stream').Transform;var defined=require('defined');module.exports=Block;inherits(Block,Transform);function Block(size,opts){if(!(this instanceof Block))return new Block(size,opts);Transform.call(this);if(!opts)opts={};if(typeof size==='object'){opts=size;size=opts.size}
this.size=size||512;if(opts.nopad)this._zeroPadding=!1;else this._zeroPadding=defined(opts.zeroPadding,!0);this._buffered=[];this._bufferedBytes=0}
Block.prototype._transform=function(buf,enc,next){this._bufferedBytes+=buf.length;this._buffered.push(buf);while(this._bufferedBytes>=this.size){var b=Buffer.concat(this._buffered);this._bufferedBytes-=this.size;this.push(b.slice(0,this.size));this._buffered=[b.slice(this.size,b.length)]}
next()};Block.prototype._flush=function(){if(this._bufferedBytes&&this._zeroPadding){var zeroes=new Buffer(this.size-this._bufferedBytes);zeroes.fill(0);this._buffered.push(zeroes);this.push(Buffer.concat(this._buffered));this._buffered=null}
else if(this._bufferedBytes){this.push(Buffer.concat(this._buffered));this._buffered=null}
this.push(null)}}).call(this,require("buffer").Buffer)},{"buffer":54,"defined":267,"inherits":305,"readable-stream":229}],220:[function(require,module,exports){arguments[4][199][0].apply(exports,arguments)},{"dup":199}],221:[function(require,module,exports){arguments[4][200][0].apply(exports,arguments)},{"./_stream_readable":223,"./_stream_writable":225,"core-util-is":248,"dup":200,"inherits":305,"process-nextick-args":374}],222:[function(require,module,exports){arguments[4][201][0].apply(exports,arguments)},{"./_stream_transform":224,"core-util-is":248,"dup":201,"inherits":305}],223:[function(require,module,exports){arguments[4][202][0].apply(exports,arguments)},{"./_stream_duplex":221,"./internal/streams/BufferList":226,"./internal/streams/destroy":227,"./internal/streams/stream":228,"_process":139,"core-util-is":248,"dup":202,"events":90,"inherits":305,"isarray":220,"process-nextick-args":374,"safe-buffer":401,"string_decoder/":230,"util":23}],224:[function(require,module,exports){arguments[4][203][0].apply(exports,arguments)},{"./_stream_duplex":221,"core-util-is":248,"dup":203,"inherits":305}],225:[function(require,module,exports){arguments[4][204][0].apply(exports,arguments)},{"./_stream_duplex":221,"./internal/streams/destroy":227,"./internal/streams/stream":228,"_process":139,"core-util-is":248,"dup":204,"inherits":305,"process-nextick-args":374,"safe-buffer":401,"timers":182,"util-deprecate":467}],226:[function(require,module,exports){arguments[4][205][0].apply(exports,arguments)},{"dup":205,"safe-buffer":401,"util":23}],227:[function(require,module,exports){arguments[4][206][0].apply(exports,arguments)},{"dup":206,"process-nextick-args":374}],228:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],229:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":221,"./lib/_stream_passthrough.js":222,"./lib/_stream_readable.js":223,"./lib/_stream_transform.js":224,"./lib/_stream_writable.js":225,"dup":208}],230:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],231:[function(require,module,exports){(function(Buffer){function allocUnsafe(size){if(typeof size!=='number'){throw new TypeError('"size" argument must be a number')}
if(size<0){throw new RangeError('"size" argument must not be negative')}
if(Buffer.allocUnsafe){return Buffer.allocUnsafe(size)}else{return new Buffer(size)}}
module.exports=allocUnsafe}).call(this,require("buffer").Buffer)},{"buffer":54}],232:[function(require,module,exports){(function(Buffer){var bufferFill=require('buffer-fill')
var allocUnsafe=require('buffer-alloc-unsafe')
module.exports=function alloc(size,fill,encoding){if(typeof size!=='number'){throw new TypeError('"size" argument must be a number')}
if(size<0){throw new RangeError('"size" argument must not be negative')}
if(Buffer.alloc){return Buffer.alloc(size,fill,encoding)}
var buffer=allocUnsafe(size)
if(size===0){return buffer}
if(fill===undefined){return bufferFill(buffer,0)}
if(typeof encoding!=='string'){encoding=undefined}
return bufferFill(buffer,fill,encoding)}}).call(this,require("buffer").Buffer)},{"buffer":54,"buffer-alloc-unsafe":231,"buffer-fill":233}],233:[function(require,module,exports){(function(Buffer){var hasFullSupport=(function(){try{if(!Buffer.isEncoding('latin1')){return!1}
var buf=Buffer.alloc?Buffer.alloc(4):new Buffer(4)
buf.fill('ab','ucs2')
return(buf.toString('hex')==='61006200')}catch(_){return!1}}())
function isSingleByte(val){return(val.length===1&&val.charCodeAt(0)<256)}
function fillWithNumber(buffer,val,start,end){if(start<0||end>buffer.length){throw new RangeError('Out of range index')}
start=start>>>0
end=end===undefined?buffer.length:end>>>0
if(end>start){buffer.fill(val,start,end)}
return buffer}
function fillWithBuffer(buffer,val,start,end){if(start<0||end>buffer.length){throw new RangeError('Out of range index')}
if(end<=start){return buffer}
start=start>>>0
end=end===undefined?buffer.length:end>>>0
var pos=start
var len=val.length
while(pos<=(end-len)){val.copy(buffer,pos)
pos+=len}
if(pos!==end){val.copy(buffer,pos,0,end-pos)}
return buffer}
function fill(buffer,val,start,end,encoding){if(hasFullSupport){return buffer.fill(val,start,end,encoding)}
if(typeof val==='number'){return fillWithNumber(buffer,val,start,end)}
if(typeof val==='string'){if(typeof start==='string'){encoding=start
start=0
end=buffer.length}else if(typeof end==='string'){encoding=end
end=buffer.length}
if(encoding!==undefined&&typeof encoding!=='string'){throw new TypeError('encoding must be a string')}
if(encoding==='latin1'){encoding='binary'}
if(typeof encoding==='string'&&!Buffer.isEncoding(encoding)){throw new TypeError('Unknown encoding: '+encoding)}
if(val===''){return fillWithNumber(buffer,0,start,end)}
if(isSingleByte(val)){return fillWithNumber(buffer,val.charCodeAt(0),start,end)}
val=new Buffer(val,encoding)}
if(Buffer.isBuffer(val)){return fillWithBuffer(buffer,val,start,end)}
return fillWithNumber(buffer,0,start,end)}
module.exports=fill}).call(this,require("buffer").Buffer)},{"buffer":54}],234:[function(require,module,exports){(function(Buffer){var toString=Object.prototype.toString
var isModern=(typeof Buffer.alloc==='function'&&typeof Buffer.allocUnsafe==='function'&&typeof Buffer.from==='function')
function isArrayBuffer(input){return toString.call(input).slice(8,-1)==='ArrayBuffer'}
function fromArrayBuffer(obj,byteOffset,length){byteOffset>>>=0
var maxLength=obj.byteLength-byteOffset
if(maxLength<0){throw new RangeError("'offset' is out of bounds")}
if(length===undefined){length=maxLength}else{length>>>=0
if(length>maxLength){throw new RangeError("'length' is out of bounds")}}
return isModern?Buffer.from(obj.slice(byteOffset,byteOffset+length)):new Buffer(new Uint8Array(obj.slice(byteOffset,byteOffset+length)))}
function fromString(string,encoding){if(typeof encoding!=='string'||encoding===''){encoding='utf8'}
if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}
return isModern?Buffer.from(string,encoding):new Buffer(string,encoding)}
function bufferFrom(value,encodingOrOffset,length){if(typeof value==='number'){throw new TypeError('"value" argument must not be a number')}
if(isArrayBuffer(value)){return fromArrayBuffer(value,encodingOrOffset,length)}
if(typeof value==='string'){return fromString(value,encodingOrOffset)}
return isModern?Buffer.from(value):new Buffer(value)}
module.exports=bufferFrom}).call(this,require("buffer").Buffer)},{"buffer":54}],235:[function(require,module,exports){arguments[4][199][0].apply(exports,arguments)},{"dup":199}],236:[function(require,module,exports){arguments[4][200][0].apply(exports,arguments)},{"./_stream_readable":238,"./_stream_writable":240,"core-util-is":248,"dup":200,"inherits":305,"process-nextick-args":374}],237:[function(require,module,exports){arguments[4][201][0].apply(exports,arguments)},{"./_stream_transform":239,"core-util-is":248,"dup":201,"inherits":305}],238:[function(require,module,exports){arguments[4][202][0].apply(exports,arguments)},{"./_stream_duplex":236,"./internal/streams/BufferList":241,"./internal/streams/destroy":242,"./internal/streams/stream":243,"_process":139,"core-util-is":248,"dup":202,"events":90,"inherits":305,"isarray":235,"process-nextick-args":374,"safe-buffer":401,"string_decoder/":245,"util":23}],239:[function(require,module,exports){arguments[4][203][0].apply(exports,arguments)},{"./_stream_duplex":236,"core-util-is":248,"dup":203,"inherits":305}],240:[function(require,module,exports){arguments[4][204][0].apply(exports,arguments)},{"./_stream_duplex":236,"./internal/streams/destroy":242,"./internal/streams/stream":243,"_process":139,"core-util-is":248,"dup":204,"inherits":305,"process-nextick-args":374,"safe-buffer":401,"timers":182,"util-deprecate":467}],241:[function(require,module,exports){arguments[4][205][0].apply(exports,arguments)},{"dup":205,"safe-buffer":401,"util":23}],242:[function(require,module,exports){arguments[4][206][0].apply(exports,arguments)},{"dup":206,"process-nextick-args":374}],243:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],244:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":236,"./lib/_stream_passthrough.js":237,"./lib/_stream_readable.js":238,"./lib/_stream_transform.js":239,"./lib/_stream_writable.js":240,"dup":208}],245:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],246:[function(require,module,exports){const BlockStream=require('block-stream2')
const stream=require('readable-stream')
class ChunkStoreWriteStream extends stream.Writable{constructor(store,chunkLength,opts={}){super(opts)
if(!store||!store.put||!store.get){throw new Error('First argument must be an abstract-chunk-store compliant store')}
chunkLength=Number(chunkLength)
if(!chunkLength)throw new Error('Second argument must be a chunk length')
this._blockstream=new BlockStream(chunkLength,{zeroPadding:!1})
let index=0
const onData=chunk=>{if(this.destroyed)return
store.put(index,chunk)
index+=1}
this._blockstream.on('data',onData).on('error',err=>{this.destroy(err)})
this.on('finish',()=>this._blockstream.end())}
_write(chunk,encoding,callback){this._blockstream.write(chunk,encoding,callback)}
destroy(err){if(this.destroyed)return
this.destroyed=!0
if(err)this.emit('error',err)
this.emit('close')}}
module.exports=ChunkStoreWriteStream},{"block-stream2":219,"readable-stream":244}],247:[function(require,module,exports){var abs=Math.abs
module.exports=closest
function closest(n,arr,rndx){var i,ndx,diff,best=Infinity
var low=0,high=arr.length-1
while(low<=high){i=low+(high-low>>1)
diff=arr[i]-n
diff<0?low=i+1:diff>0?high=i-1:void 0
diff=abs(diff)
if(diff<best)best=diff,ndx=i
if(arr[i]===n)break}
return rndx?ndx:arr[ndx]}},{}],248:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}
return objectToString(arg)==='[object Array]'}
exports.isArray=isArray;function isBoolean(arg){return typeof arg==='boolean'}
exports.isBoolean=isBoolean;function isNull(arg){return arg===null}
exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}
exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==='number'}
exports.isNumber=isNumber;function isString(arg){return typeof arg==='string'}
exports.isString=isString;function isSymbol(arg){return typeof arg==='symbol'}
exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}
exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==='[object RegExp]'}
exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==='object'&&arg!==null}
exports.isObject=isObject;function isDate(d){return objectToString(d)==='[object Date]'}
exports.isDate=isDate;function isError(e){return(objectToString(e)==='[object Error]'||e instanceof Error)}
exports.isError=isError;function isFunction(arg){return typeof arg==='function'}
exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==='boolean'||typeof arg==='number'||typeof arg==='string'||typeof arg==='symbol'||typeof arg==='undefined'}
exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{"isBuffer":require("../../../../../Users/barbanarca/nvm/v12.0.0/node_modules/browserify/node_modules/is-buffer/index.js")})},{"../../../../../Users/barbanarca/nvm/v12.0.0/node_modules/browserify/node_modules/is-buffer/index.js":109}],249:[function(require,module,exports){(function(process,global,Buffer){const bencode=require('bencode')
const BlockStream=require('block-stream2')
const calcPieceLength=require('piece-length')
const corePath=require('path')
const FileReadStream=require('filestream/read')
const flatten=require('flatten')
const fs=require('fs')
const isFile=require('is-file')
const junk=require('junk')
const MultiStream=require('multistream')
const once=require('once')
const parallel=require('run-parallel')
const sha1=require('simple-sha1')
const stream=require('readable-stream')
const announceList=[['udp://tracker.leechers-paradise.org:6969'],['udp://tracker.coppersurfer.tk:6969'],['udp://tracker.opentrackr.org:1337'],['udp://explodie.org:6969'],['udp://tracker.empire-js.us:1337'],['wss://tracker.btorrent.xyz'],['wss://tracker.openwebtorrent.com'],['wss://tracker.fastcast.nz']]
function createTorrent(input,opts,cb){if(typeof opts==='function')[opts,cb]=[cb,opts]
opts=opts?Object.assign({},opts):{}
_parseInput(input,opts,(err,files,singleFileTorrent)=>{if(err)return cb(err)
opts.singleFileTorrent=singleFileTorrent
onFiles(files,opts,cb)})}
function parseInput(input,opts,cb){if(typeof opts==='function')[opts,cb]=[cb,opts]
opts=opts?Object.assign({},opts):{}
_parseInput(input,opts,cb)}
function _parseInput(input,opts,cb){if(isFileList(input))input=Array.from(input)
if(!Array.isArray(input))input=[input]
if(input.length===0)throw new Error('invalid input type')
input.forEach(item=>{if(item==null)throw new Error(`invalid input type: ${item}`)})
input=input.map(item=>{if(isBlob(item)&&typeof item.path==='string'&&typeof fs.stat==='function')return item.path
return item})
if(input.length===1&&typeof input[0]!=='string'&&!input[0].name)input[0].name=opts.name
let commonPrefix=null
input.forEach((item,i)=>{if(typeof item==='string'){return}
let path=item.fullPath||item.name
if(!path){path=`Unknown File ${i + 1}`
item.unknownName=!0}
item.path=path.split('/')
if(!item.path[0]){item.path.shift()}
if(item.path.length<2){commonPrefix=null}else if(i===0&&input.length>1){commonPrefix=item.path[0]}else if(item.path[0]!==commonPrefix){commonPrefix=null}})
input=input.filter(item=>{if(typeof item==='string'){return!0}
const filename=item.path[item.path.length-1]
return notHidden(filename)&&junk.not(filename)})
if(commonPrefix){input.forEach(item=>{const pathless=(Buffer.isBuffer(item)||isReadable(item))&&!item.path
if(typeof item==='string'||pathless)return
item.path.shift()})}
if(!opts.name&&commonPrefix){opts.name=commonPrefix}
if(!opts.name){input.some(item=>{if(typeof item==='string'){opts.name=corePath.basename(item)
return!0}else if(!item.unknownName){opts.name=item.path[item.path.length-1]
return!0}})}
if(!opts.name){opts.name=`Unnamed Torrent ${Date.now()}`}
const numPaths=input.reduce((sum,item)=>sum+Number(typeof item==='string'),0)
let isSingleFileTorrent=(input.length===1)
if(input.length===1&&typeof input[0]==='string'){if(typeof fs.stat!=='function'){throw new Error('filesystem paths do not work in the browser')}
isFile(input[0],(err,pathIsFile)=>{if(err)return cb(err)
isSingleFileTorrent=pathIsFile
processInput()})}else{process.nextTick(()=>{processInput()})}
function processInput(){parallel(input.map(item=>cb=>{const file={}
if(isBlob(item)){file.getStream=getBlobStream(item)
file.length=item.size}else if(Buffer.isBuffer(item)){file.getStream=getBufferStream(item)
file.length=item.length}else if(isReadable(item)){file.getStream=getStreamStream(item,file)
file.length=0}else if(typeof item==='string'){if(typeof fs.stat!=='function'){throw new Error('filesystem paths do not work in the browser')}
const keepRoot=numPaths>1||isSingleFileTorrent
getFiles(item,keepRoot,cb)
return}else{throw new Error('invalid input type')}
file.path=item.path
cb(null,file)}),(err,files)=>{if(err)return cb(err)
files=flatten(files)
cb(null,files,isSingleFileTorrent)})}}
function getFiles(path,keepRoot,cb){traversePath(path,getFileInfo,(err,files)=>{if(err)return cb(err)
if(Array.isArray(files))files=flatten(files)
else files=[files]
path=corePath.normalize(path)
if(keepRoot){path=path.slice(0,path.lastIndexOf(corePath.sep)+1)}
if(path[path.length-1]!==corePath.sep)path+=corePath.sep
files.forEach(file=>{file.getStream=getFilePathStream(file.path)
file.path=file.path.replace(path,'').split(corePath.sep)})
cb(null,files)})}
function getFileInfo(path,cb){cb=once(cb)
fs.stat(path,(err,stat)=>{if(err)return cb(err)
const info={length:stat.size,path}
cb(null,info)})}
function traversePath(path,fn,cb){fs.stat(path,(err,stats)=>{if(err)return cb(err)
if(stats.isDirectory()){fs.readdir(path,(err,entries)=>{if(err)return cb(err)
parallel(entries.filter(notHidden).filter(junk.not).map(entry=>cb=>{traversePath(corePath.join(path,entry),fn,cb)}),cb)})}else if(stats.isFile()){fn(path,cb)}})}
function notHidden(file){return file[0]!=='.'}
function getPieceList(files,pieceLength,cb){cb=once(cb)
const pieces=[]
let length=0
const streams=files.map(file=>file.getStream)
let remainingHashes=0
let pieceNum=0
let ended=!1
const multistream=new MultiStream(streams)
const blockstream=new BlockStream(pieceLength,{zeroPadding:!1})
multistream.on('error',onError)
multistream.pipe(blockstream).on('data',onData).on('end',onEnd).on('error',onError)
function onData(chunk){length+=chunk.length
const i=pieceNum
sha1(chunk,hash=>{pieces[i]=hash
remainingHashes-=1
maybeDone()})
remainingHashes+=1
pieceNum+=1}
function onEnd(){ended=!0
maybeDone()}
function onError(err){cleanup()
cb(err)}
function cleanup(){multistream.removeListener('error',onError)
blockstream.removeListener('data',onData)
blockstream.removeListener('end',onEnd)
blockstream.removeListener('error',onError)}
function maybeDone(){if(ended&&remainingHashes===0){cleanup()
cb(null,Buffer.from(pieces.join(''),'hex'),length)}}}
function onFiles(files,opts,cb){let announceList=opts.announceList
if(!announceList){if(typeof opts.announce==='string')announceList=[[opts.announce]]
else if(Array.isArray(opts.announce)){announceList=opts.announce.map(u=>[u])}}
if(!announceList)announceList=[]
if(global.WEBTORRENT_ANNOUNCE){if(typeof global.WEBTORRENT_ANNOUNCE==='string'){announceList.push([[global.WEBTORRENT_ANNOUNCE]])}else if(Array.isArray(global.WEBTORRENT_ANNOUNCE)){announceList=announceList.concat(global.WEBTORRENT_ANNOUNCE.map(u=>[u]))}}
if(opts.announce===undefined&&opts.announceList===undefined){announceList=announceList.concat(module.exports.announceList)}
if(typeof opts.urlList==='string')opts.urlList=[opts.urlList]
const torrent={info:{name:opts.name},'creation date':Math.ceil((Number(opts.creationDate)||Date.now())/1000),encoding:'UTF-8'}
if(announceList.length!==0){torrent.announce=announceList[0][0]
torrent['announce-list']=announceList}
if(opts.comment!==undefined)torrent.comment=opts.comment
if(opts.createdBy!==undefined)torrent['created by']=opts.createdBy
if(opts.private!==undefined)torrent.info.private=Number(opts.private)
if(opts.sslCert!==undefined)torrent.info['ssl-cert']=opts.sslCert
if(opts.urlList!==undefined)torrent['url-list']=opts.urlList
const pieceLength=opts.pieceLength||calcPieceLength(files.reduce(sumLength,0))
torrent.info['piece length']=pieceLength
getPieceList(files,pieceLength,(err,pieces,torrentLength)=>{if(err)return cb(err)
torrent.info.pieces=pieces
files.forEach(file=>{delete file.getStream})
if(opts.singleFileTorrent){torrent.info.length=torrentLength}else{torrent.info.files=files}
cb(null,bencode.encode(torrent))})}
function sumLength(sum,file){return sum+file.length}
function isBlob(obj){return typeof Blob!=='undefined'&&obj instanceof Blob}
function isFileList(obj){return typeof FileList!=='undefined'&&obj instanceof FileList}
function isReadable(obj){return typeof obj==='object'&&obj!=null&&typeof obj.pipe==='function'}
function getBlobStream(file){return()=>new FileReadStream(file)}
function getBufferStream(buffer){return()=>{const s=new stream.PassThrough()
s.end(buffer)
return s}}
function getFilePathStream(path){return()=>fs.createReadStream(path)}
function getStreamStream(readable,file){return()=>{const counter=new stream.Transform()
counter._transform=function(buf,enc,done){file.length+=buf.length
this.push(buf)
done()}
readable.pipe(counter)
return counter}}
module.exports=createTorrent
module.exports.parseInput=parseInput
module.exports.announceList=announceList}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer)},{"_process":139,"bencode":195,"block-stream2":219,"buffer":54,"filestream/read":300,"flatten":301,"fs":1,"is-file":307,"junk":310,"multistream":347,"once":363,"path":132,"piece-length":373,"readable-stream":263,"run-parallel":399,"simple-sha1":419}],250:[function(require,module,exports){'use strict';function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass}
var codes={};function createErrorType(code,message,Base){if(!Base){Base=Error}
function getMessage(arg1,arg2,arg3){if(typeof message==='string'){return message}else{return message(arg1,arg2,arg3)}}
var NodeError=function(_Base){_inheritsLoose(NodeError,_Base);function NodeError(arg1,arg2,arg3){return _Base.call(this,getMessage(arg1,arg2,arg3))||this}
return NodeError}(Base);NodeError.prototype.name=Base.name;NodeError.prototype.code=code;codes[code]=NodeError}
function oneOf(expected,thing){if(Array.isArray(expected)){var len=expected.length;expected=expected.map(function(i){return String(i)});if(len>2){return"one of ".concat(thing," ").concat(expected.slice(0,len-1).join(', '),", or ")+expected[len-1]}else if(len===2){return"one of ".concat(thing," ").concat(expected[0]," or ").concat(expected[1])}else{return"of ".concat(thing," ").concat(expected[0])}}else{return"of ".concat(thing," ").concat(String(expected))}}
function startsWith(str,search,pos){return str.substr(!pos||pos<0?0:+pos,search.length)===search}
function endsWith(str,search,this_len){if(this_len===undefined||this_len>str.length){this_len=str.length}
return str.substring(this_len-search.length,this_len)===search}
function includes(str,search,start){if(typeof start!=='number'){start=0}
if(start+search.length>str.length){return!1}else{return str.indexOf(search,start)!==-1}}
createErrorType('ERR_INVALID_OPT_VALUE',function(name,value){return'The value "'+value+'" is invalid for option "'+name+'"'},TypeError);createErrorType('ERR_INVALID_ARG_TYPE',function(name,expected,actual){var determiner;if(typeof expected==='string'&&startsWith(expected,'not ')){determiner='must not be';expected=expected.replace(/^not /,'')}else{determiner='must be'}
var msg;if(endsWith(name,' argument')){msg="The ".concat(name," ").concat(determiner," ").concat(oneOf(expected,'type'))}else{var type=includes(name,'.')?'property':'argument';msg="The \"".concat(name,"\" ").concat(type," ").concat(determiner," ").concat(oneOf(expected,'type'))}
msg+=". Received type ".concat(typeof actual);return msg},TypeError);createErrorType('ERR_STREAM_PUSH_AFTER_EOF','stream.push() after EOF');createErrorType('ERR_METHOD_NOT_IMPLEMENTED',function(name){return'The '+name+' method is not implemented'});createErrorType('ERR_STREAM_PREMATURE_CLOSE','Premature close');createErrorType('ERR_STREAM_DESTROYED',function(name){return'Cannot call '+name+' after a stream was destroyed'});createErrorType('ERR_MULTIPLE_CALLBACK','Callback called multiple times');createErrorType('ERR_STREAM_CANNOT_PIPE','Cannot pipe, not readable');createErrorType('ERR_STREAM_WRITE_AFTER_END','write after end');createErrorType('ERR_STREAM_NULL_VALUES','May not write null values to stream',TypeError);createErrorType('ERR_UNKNOWN_ENCODING',function(arg){return'Unknown encoding: '+arg},TypeError);createErrorType('ERR_STREAM_UNSHIFT_AFTER_END_EVENT','stream.unshift() after end event');module.exports.codes=codes},{}],251:[function(require,module,exports){(function(process){'use strict'
var experimentalWarnings=new Set();function emitExperimentalWarning(feature){if(experimentalWarnings.has(feature))return;var msg=feature+' is an experimental feature. This feature could '+'change at any time';experimentalWarnings.add(feature);process.emitWarning(msg,'ExperimentalWarning')}
function noop(){}
module.exports.emitExperimentalWarning=process.emitWarning?emitExperimentalWarning:noop}).call(this,require('_process'))},{"_process":139}],252:[function(require,module,exports){(function(process){'use strict';var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}
return keys};module.exports=Duplex;var Readable=require('./_stream_readable');var Writable=require('./_stream_writable');require('inherits')(Duplex,Readable);{var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}}
function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);this.allowHalfOpen=!0;if(options){if(options.readable===!1)this.readable=!1;if(options.writable===!1)this.writable=!1;if(options.allowHalfOpen===!1){this.allowHalfOpen=!1;this.once('end',onend)}}}
Object.defineProperty(Duplex.prototype,'writableHighWaterMark',{enumerable:!1,get:function get(){return this._writableState.highWaterMark}});Object.defineProperty(Duplex.prototype,'writableBuffer',{enumerable:!1,get:function get(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(Duplex.prototype,'writableLength',{enumerable:!1,get:function get(){return this._writableState.length}});function onend(){if(this._writableState.ended)return;process.nextTick(onEndNT,this)}
function onEndNT(self){self.end()}
Object.defineProperty(Duplex.prototype,'destroyed',{enumerable:!1,get:function get(){if(this._readableState===undefined||this._writableState===undefined){return!1}
return this._readableState.destroyed&&this._writableState.destroyed},set:function set(value){if(this._readableState===undefined||this._writableState===undefined){return}
this._readableState.destroyed=value;this._writableState.destroyed=value}})}).call(this,require('_process'))},{"./_stream_readable":254,"./_stream_writable":256,"_process":139,"inherits":305}],253:[function(require,module,exports){'use strict';module.exports=PassThrough;var Transform=require('./_stream_transform');require('inherits')(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}
PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":255,"inherits":305}],254:[function(require,module,exports){(function(process,global){'use strict';module.exports=Readable;var Duplex;Readable.ReadableState=ReadableState;var EE=require('events').EventEmitter;var EElistenerCount=function EElistenerCount(emitter,type){return emitter.listeners(type).length};var Stream=require('./internal/streams/stream');var Buffer=require('buffer').Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}
function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}
var debugUtil=require('util');var debug;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog('stream')}else{debug=function debug(){}}
var BufferList=require('./internal/streams/buffer_list');var destroyImpl=require('./internal/streams/destroy');var _require=require('./internal/streams/state'),getHighWaterMark=_require.getHighWaterMark;var _require$codes=require('../errors').codes,ERR_INVALID_ARG_TYPE=_require$codes.ERR_INVALID_ARG_TYPE,ERR_STREAM_PUSH_AFTER_EOF=_require$codes.ERR_STREAM_PUSH_AFTER_EOF,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_STREAM_UNSHIFT_AFTER_END_EVENT=_require$codes.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;var _require2=require('../experimentalWarning'),emitExperimentalWarning=_require2.emitExperimentalWarning;var StringDecoder;var createReadableStreamAsyncIterator;require('inherits')(Readable,Stream);var kProxyEvents=['error','close','destroy','pause','resume'];function prependListener(emitter,event,fn){if(typeof emitter.prependListener==='function')return emitter.prependListener(event,fn);if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(Array.isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}
function ReadableState(options,stream,isDuplex){Duplex=Duplex||require('./_stream_duplex');options=options||{};if(typeof isDuplex!=='boolean')isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.readableObjectMode;this.highWaterMark=getHighWaterMark(this,options,'readableHighWaterMark',isDuplex);this.buffer=new BufferList();this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=!1;this.endEmitted=!1;this.reading=!1;this.sync=!0;this.needReadable=!1;this.emittedReadable=!1;this.readableListening=!1;this.resumeScheduled=!1;this.paused=!0;this.emitClose=options.emitClose!==!1;this.destroyed=!1;this.defaultEncoding=options.defaultEncoding||'utf8';this.awaitDrain=0;this.readingMore=!1;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require('string_decoder/').StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}
function Readable(options){Duplex=Duplex||require('./_stream_duplex');if(!(this instanceof Readable))return new Readable(options);var isDuplex=this instanceof Duplex;this._readableState=new ReadableState(options,this,isDuplex);this.readable=!0;if(options){if(typeof options.read==='function')this._read=options.read;if(typeof options.destroy==='function')this._destroy=options.destroy}
Stream.call(this)}
Object.defineProperty(Readable.prototype,'destroyed',{enumerable:!1,get:function get(){if(this._readableState===undefined){return!1}
return this._readableState.destroyed},set:function set(value){if(!this._readableState){return}
this._readableState.destroyed=value}});Readable.prototype.destroy=destroyImpl.destroy;Readable.prototype._undestroy=destroyImpl.undestroy;Readable.prototype._destroy=function(err,cb){cb(err)};Readable.prototype.push=function(chunk,encoding){var state=this._readableState;var skipChunkCheck;if(!state.objectMode){if(typeof chunk==='string'){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=Buffer.from(chunk,encoding);encoding=''}
skipChunkCheck=!0}}else{skipChunkCheck=!0}
return readableAddChunk(this,chunk,encoding,!1,skipChunkCheck)};Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,!0,!1)};function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){debug('readableAddChunk',chunk);var state=stream._readableState;if(chunk===null){state.reading=!1;onEofChunk(stream,state)}else{var er;if(!skipChunkCheck)er=chunkInvalid(state,chunk);if(er){stream.emit('error',er)}else if(state.objectMode||chunk&&chunk.length>0){if(typeof chunk!=='string'&&!state.objectMode&&Object.getPrototypeOf(chunk)!==Buffer.prototype){chunk=_uint8ArrayToBuffer(chunk)}
if(addToFront){if(state.endEmitted)stream.emit('error',new ERR_STREAM_UNSHIFT_AFTER_END_EVENT());else addChunk(stream,state,chunk,!0)}else if(state.ended){stream.emit('error',new ERR_STREAM_PUSH_AFTER_EOF())}else if(state.destroyed){return!1}else{state.reading=!1;if(state.decoder&&!encoding){chunk=state.decoder.write(chunk);if(state.objectMode||chunk.length!==0)addChunk(stream,state,chunk,!1);else maybeReadMore(stream,state)}else{addChunk(stream,state,chunk,!1)}}}else if(!addToFront){state.reading=!1;maybeReadMore(stream,state)}}
return!state.ended&&(state.length<state.highWaterMark||state.length===0)}
function addChunk(stream,state,chunk,addToFront){if(state.flowing&&state.length===0&&!state.sync){state.awaitDrain=0;stream.emit('data',chunk)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}
maybeReadMore(stream,state)}
function chunkInvalid(state,chunk){var er;if(!_isUint8Array(chunk)&&typeof chunk!=='string'&&chunk!==undefined&&!state.objectMode){er=new ERR_INVALID_ARG_TYPE('chunk',['string','Buffer','Uint8Array'],chunk)}
return er}
Readable.prototype.isPaused=function(){return this._readableState.flowing===!1};Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require('string_decoder/').StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=this._readableState.decoder.encoding;return this};var MAX_HWM=0x800000;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}
return n}
function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}
if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=!0;return 0}
return state.length}
Readable.prototype.read=function(n){debug('read',n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=!1;if(n===0&&state.needReadable&&((state.highWaterMark!==0?state.length>=state.highWaterMark:state.length>0)||state.ended)){debug('read: emitReadable',state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}
n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}
var doRead=state.needReadable;debug('need readable',doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=!0;debug('length less than watermark',doRead)}
if(state.ended||state.reading){doRead=!1;debug('reading or ended',doRead)}else if(doRead){debug('do read');state.reading=!0;state.sync=!0;if(state.length===0)state.needReadable=!0;this._read(state.highWaterMark);state.sync=!1;if(!state.reading)n=howMuchToRead(nOrig,state)}
var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=!0;n=0}else{state.length-=n;state.awaitDrain=0}
if(state.length===0){if(!state.ended)state.needReadable=!0;if(nOrig!==n&&state.ended)endReadable(this)}
if(ret!==null)this.emit('data',ret);return ret};function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}
state.ended=!0;if(state.sync){emitReadable(stream)}else{state.needReadable=!1;if(!state.emittedReadable){state.emittedReadable=!0;emitReadable_(stream)}}}
function emitReadable(stream){var state=stream._readableState;state.needReadable=!1;if(!state.emittedReadable){debug('emitReadable',state.flowing);state.emittedReadable=!0;process.nextTick(emitReadable_,stream)}}
function emitReadable_(stream){var state=stream._readableState;debug('emitReadable_',state.destroyed,state.length,state.ended);if(!state.destroyed&&(state.length||state.ended)){stream.emit('readable')}
state.needReadable=!state.flowing&&!state.ended&&state.length<=state.highWaterMark;flow(stream)}
function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=!0;process.nextTick(maybeReadMore_,stream,state)}}
function maybeReadMore_(stream,state){while(!state.reading&&!state.ended&&(state.length<state.highWaterMark||state.flowing&&state.length===0)){var len=state.length;debug('maybeReadMore read 0');stream.read(0);if(len===state.length)
break}
state.readingMore=!1}
Readable.prototype._read=function(n){this.emit('error',new ERR_METHOD_NOT_IMPLEMENTED('_read()'))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}
state.pipesCount+=1;debug('pipe count=%d opts=%j',state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:unpipe;if(state.endEmitted)process.nextTick(endFn);else src.once('end',endFn);dest.on('unpipe',onunpipe);function onunpipe(readable,unpipeInfo){debug('onunpipe');if(readable===src){if(unpipeInfo&&unpipeInfo.hasUnpiped===!1){unpipeInfo.hasUnpiped=!0;cleanup()}}}
function onend(){debug('onend');dest.end()}
var ondrain=pipeOnDrain(src);dest.on('drain',ondrain);var cleanedUp=!1;function cleanup(){debug('cleanup');dest.removeListener('close',onclose);dest.removeListener('finish',onfinish);dest.removeListener('drain',ondrain);dest.removeListener('error',onerror);dest.removeListener('unpipe',onunpipe);src.removeListener('end',onend);src.removeListener('end',unpipe);src.removeListener('data',ondata);cleanedUp=!0;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}
src.on('data',ondata);function ondata(chunk){debug('ondata');var ret=dest.write(chunk);debug('dest.write',ret);if(ret===!1){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug('false write response, pause',state.awaitDrain);state.awaitDrain++}
src.pause()}}
function onerror(er){debug('onerror',er);unpipe();dest.removeListener('error',onerror);if(EElistenerCount(dest,'error')===0)dest.emit('error',er)}
prependListener(dest,'error',onerror);function onclose(){dest.removeListener('finish',onfinish);unpipe()}
dest.once('close',onclose);function onfinish(){debug('onfinish');dest.removeListener('close',onclose);unpipe()}
dest.once('finish',onfinish);function unpipe(){debug('unpipe');src.unpipe(dest)}
dest.emit('pipe',src);if(!state.flowing){debug('pipe resume');src.resume()}
return dest};function pipeOnDrain(src){return function pipeOnDrainFunctionResult(){var state=src._readableState;debug('pipeOnDrain',state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,'data')){state.flowing=!0;flow(src)}}}
Readable.prototype.unpipe=function(dest){var state=this._readableState;var unpipeInfo={hasUnpiped:!1};if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=!1;if(dest)dest.emit('unpipe',this,unpipeInfo);return this}
if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=!1;for(var i=0;i<len;i++){dests[i].emit('unpipe',this,{hasUnpiped:!1})}
return this}
var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit('unpipe',this,unpipeInfo);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);var state=this._readableState;if(ev==='data'){state.readableListening=this.listenerCount('readable')>0;if(state.flowing!==!1)this.resume()}else if(ev==='readable'){if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=!0;state.flowing=!1;state.emittedReadable=!1;debug('on readable',state.length,state.reading);if(state.length){emitReadable(this)}else if(!state.reading){process.nextTick(nReadingNextTick,this)}}}
return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.removeListener=function(ev,fn){var res=Stream.prototype.removeListener.call(this,ev,fn);if(ev==='readable'){process.nextTick(updateReadableListening,this)}
return res};Readable.prototype.removeAllListeners=function(ev){var res=Stream.prototype.removeAllListeners.apply(this,arguments);if(ev==='readable'||ev===undefined){process.nextTick(updateReadableListening,this)}
return res};function updateReadableListening(self){var state=self._readableState;state.readableListening=self.listenerCount('readable')>0;if(state.resumeScheduled&&!state.paused){state.flowing=!0}else if(self.listenerCount('data')>0){self.resume()}}
function nReadingNextTick(self){debug('readable nexttick read 0');self.read(0)}
Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug('resume');state.flowing=!state.readableListening;resume(this,state)}
state.paused=!1;return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=!0;process.nextTick(resume_,stream,state)}}
function resume_(stream,state){debug('resume',state.reading);if(!state.reading){stream.read(0)}
state.resumeScheduled=!1;stream.emit('resume');flow(stream);if(state.flowing&&!state.reading)stream.read(0)}
Readable.prototype.pause=function(){debug('call pause flowing=%j',this._readableState.flowing);if(this._readableState.flowing!==!1){debug('pause');this._readableState.flowing=!1;this.emit('pause')}
this._readableState.paused=!0;return this};function flow(stream){var state=stream._readableState;debug('flow',state.flowing);while(state.flowing&&stream.read()!==null){}}
Readable.prototype.wrap=function(stream){var _this=this;var state=this._readableState;var paused=!1;stream.on('end',function(){debug('wrapped end');if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)_this.push(chunk)}
_this.push(null)});stream.on('data',function(chunk){debug('wrapped data');if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=_this.push(chunk);if(!ret){paused=!0;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==='function'){this[i]=function methodWrap(method){return function methodWrapReturnFunction(){return stream[method].apply(stream,arguments)}}(i)}}
for(var n=0;n<kProxyEvents.length;n++){stream.on(kProxyEvents[n],this.emit.bind(this,kProxyEvents[n]))}
this._read=function(n){debug('wrapped _read',n);if(paused){paused=!1;stream.resume()}};return this};if(typeof Symbol==='function'){Readable.prototype[Symbol.asyncIterator]=function(){emitExperimentalWarning('Readable[Symbol.asyncIterator]');if(createReadableStreamAsyncIterator===undefined){createReadableStreamAsyncIterator=require('./internal/streams/async_iterator')}
return createReadableStreamAsyncIterator(this)}}
Object.defineProperty(Readable.prototype,'readableHighWaterMark',{enumerable:!1,get:function get(){return this._readableState.highWaterMark}});Object.defineProperty(Readable.prototype,'readableBuffer',{enumerable:!1,get:function get(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(Readable.prototype,'readableFlowing',{enumerable:!1,get:function get(){return this._readableState.flowing},set:function set(state){if(this._readableState){this._readableState.flowing=state}}});Readable._fromList=fromList;Object.defineProperty(Readable.prototype,'readableLength',{enumerable:!1,get:function get(){return this._readableState.length}});function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join('');else if(state.buffer.length===1)ret=state.buffer.first();else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=state.buffer.consume(n,state.decoder)}
return ret}
function endReadable(stream){var state=stream._readableState;debug('endReadable',state.endEmitted);if(!state.endEmitted){state.ended=!0;process.nextTick(endReadableNT,state,stream)}}
function endReadableNT(state,stream){debug('endReadableNT',state.endEmitted,state.length);if(!state.endEmitted&&state.length===0){state.endEmitted=!0;stream.readable=!1;stream.emit('end')}}
function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}
return-1}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../errors":250,"../experimentalWarning":251,"./_stream_duplex":252,"./internal/streams/async_iterator":257,"./internal/streams/buffer_list":258,"./internal/streams/destroy":259,"./internal/streams/state":261,"./internal/streams/stream":262,"_process":139,"buffer":54,"events":90,"inherits":305,"string_decoder/":264,"util":23}],255:[function(require,module,exports){'use strict';module.exports=Transform;var _require$codes=require('../errors').codes,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes.ERR_MULTIPLE_CALLBACK,ERR_TRANSFORM_ALREADY_TRANSFORMING=_require$codes.ERR_TRANSFORM_ALREADY_TRANSFORMING,ERR_TRANSFORM_WITH_LENGTH_0=_require$codes.ERR_TRANSFORM_WITH_LENGTH_0;var Duplex=require('./_stream_duplex');require('inherits')(Transform,Duplex);function afterTransform(er,data){var ts=this._transformState;ts.transforming=!1;var cb=ts.writecb;if(cb===null){return this.emit('error',new ERR_MULTIPLE_CALLBACK())}
ts.writechunk=null;ts.writecb=null;if(data!=null)
this.push(data);cb(er);var rs=this._readableState;rs.reading=!1;if(rs.needReadable||rs.length<rs.highWaterMark){this._read(rs.highWaterMark)}}
function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null};this._readableState.needReadable=!0;this._readableState.sync=!1;if(options){if(typeof options.transform==='function')this._transform=options.transform;if(typeof options.flush==='function')this._flush=options.flush}
this.on('prefinish',prefinish)}
function prefinish(){var _this=this;if(typeof this._flush==='function'&&!this._readableState.destroyed){this._flush(function(er,data){done(_this,er,data)})}else{done(this,null,null)}}
Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=!1;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){cb(new ERR_METHOD_NOT_IMPLEMENTED('_transform()'))};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&!ts.transforming){ts.transforming=!0;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=!0}};Transform.prototype._destroy=function(err,cb){Duplex.prototype._destroy.call(this,err,function(err2){cb(err2)})};function done(stream,er,data){if(er)return stream.emit('error',er);if(data!=null)
stream.push(data);if(stream._writableState.length)throw new ERR_TRANSFORM_WITH_LENGTH_0();if(stream._transformState.transforming)throw new ERR_TRANSFORM_ALREADY_TRANSFORMING();return stream.push(null)}},{"../errors":250,"./_stream_duplex":252,"inherits":305}],256:[function(require,module,exports){(function(process,global){'use strict';module.exports=Writable;function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}
function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(){onCorkedFinish(_this,state)}}
var Duplex;Writable.WritableState=WritableState;var internalUtil={deprecate:require('util-deprecate')};var Stream=require('./internal/streams/stream');var Buffer=require('buffer').Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}
function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}
var destroyImpl=require('./internal/streams/destroy');var _require=require('./internal/streams/state'),getHighWaterMark=_require.getHighWaterMark;var _require$codes=require('../errors').codes,ERR_INVALID_ARG_TYPE=_require$codes.ERR_INVALID_ARG_TYPE,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes.ERR_MULTIPLE_CALLBACK,ERR_STREAM_CANNOT_PIPE=_require$codes.ERR_STREAM_CANNOT_PIPE,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED,ERR_STREAM_NULL_VALUES=_require$codes.ERR_STREAM_NULL_VALUES,ERR_STREAM_WRITE_AFTER_END=_require$codes.ERR_STREAM_WRITE_AFTER_END,ERR_UNKNOWN_ENCODING=_require$codes.ERR_UNKNOWN_ENCODING;require('inherits')(Writable,Stream);function nop(){}
function WritableState(options,stream,isDuplex){Duplex=Duplex||require('./_stream_duplex');options=options||{};if(typeof isDuplex!=='boolean')isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.writableObjectMode;this.highWaterMark=getHighWaterMark(this,options,'writableHighWaterMark',isDuplex);this.finalCalled=!1;this.needDrain=!1;this.ending=!1;this.ended=!1;this.finished=!1;this.destroyed=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||'utf8';this.length=0;this.writing=!1;this.corked=0;this.sync=!0;this.bufferProcessing=!1;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=!1;this.errorEmitted=!1;this.emitClose=options.emitClose!==!1;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}
WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}
return out};(function(){try{Object.defineProperty(WritableState.prototype,'buffer',{get:internalUtil.deprecate(function writableStateBufferGetter(){return this.getBuffer()},'_writableState.buffer is deprecated. Use _writableState.getBuffer '+'instead.','DEP0003')})}catch(_){}})();var realHasInstance;if(typeof Symbol==='function'&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==='function'){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function value(object){if(realHasInstance.call(this,object))return!0;if(this!==Writable)return!1;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function realHasInstance(object){return object instanceof this}}
function Writable(options){Duplex=Duplex||require('./_stream_duplex');var isDuplex=this instanceof Duplex;if(!isDuplex&&!realHasInstance.call(Writable,this))return new Writable(options);this._writableState=new WritableState(options,this,isDuplex);this.writable=!0;if(options){if(typeof options.write==='function')this._write=options.write;if(typeof options.writev==='function')this._writev=options.writev;if(typeof options.destroy==='function')this._destroy=options.destroy;if(typeof options.final==='function')this._final=options.final}
Stream.call(this)}
Writable.prototype.pipe=function(){this.emit('error',new ERR_STREAM_CANNOT_PIPE())};function writeAfterEnd(stream,cb){var er=new ERR_STREAM_WRITE_AFTER_END();stream.emit('error',er);process.nextTick(cb,er)}
function validChunk(stream,state,chunk,cb){var er;if(chunk===null){er=new ERR_STREAM_NULL_VALUES()}else if(typeof chunk!=='string'&&!state.objectMode){er=new ERR_INVALID_ARG_TYPE('chunk',['string','Buffer'],chunk)}
if(er){stream.emit('error',er);process.nextTick(cb,er);return!1}
return!0}
Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=!1;var isBuf=!state.objectMode&&_isUint8Array(chunk);if(isBuf&&!Buffer.isBuffer(chunk)){chunk=_uint8ArrayToBuffer(chunk)}
if(typeof encoding==='function'){cb=encoding;encoding=null}
if(isBuf)encoding='buffer';else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=='function')cb=nop;if(state.ending)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)}
return ret};Writable.prototype.cork=function(){this._writableState.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==='string')encoding=encoding.toLowerCase();if(!(['hex','utf8','utf-8','ascii','binary','base64','ucs2','ucs-2','utf16le','utf-16le','raw'].indexOf((encoding+'').toLowerCase())>-1))throw new ERR_UNKNOWN_ENCODING(encoding);this._writableState.defaultEncoding=encoding;return this};Object.defineProperty(Writable.prototype,'writableBuffer',{enumerable:!1,get:function get(){return this._writableState&&this._writableState.getBuffer()}});function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==!1&&typeof chunk==='string'){chunk=Buffer.from(chunk,encoding)}
return chunk}
Object.defineProperty(Writable.prototype,'writableHighWaterMark',{enumerable:!1,get:function get(){return this._writableState.highWaterMark}});function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=decodeChunk(state,chunk,encoding);if(chunk!==newChunk){isBuf=!0;encoding='buffer';chunk=newChunk}}
var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=!0;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null};if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}
state.bufferedRequestCount+=1}else{doWrite(stream,state,!1,len,chunk,encoding,cb)}
return ret}
function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=!0;state.sync=!0;if(state.destroyed)state.onwrite(new ERR_STREAM_DESTROYED('write'));else if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=!1}
function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync){process.nextTick(cb,er);process.nextTick(finishMaybe,stream,state);stream._writableState.errorEmitted=!0;stream.emit('error',er)}else{cb(er);stream._writableState.errorEmitted=!0;stream.emit('error',er);finishMaybe(stream,state)}}
function onwriteStateUpdate(state){state.writing=!1;state.writecb=null;state.length-=state.writelen;state.writelen=0}
function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;if(typeof cb!=='function')throw new ERR_MULTIPLE_CALLBACK();onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state)||stream.destroyed;if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}
if(sync){process.nextTick(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}
function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}
function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=!1;stream.emit('drain')}}
function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;var allBuffers=!0;while(entry){buffer[count]=entry;if(!entry.isBuf)allBuffers=!1;entry=entry.next;count+=1}
buffer.allBuffers=allBuffers;doWrite(stream,state,!0,state.length,buffer,'',holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}
state.bufferedRequestCount=0}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,!1,len,chunk,encoding,cb);entry=entry.next;state.bufferedRequestCount--;if(state.writing){break}}
if(entry===null)state.lastBufferedRequest=null}
state.bufferedRequest=entry;state.bufferProcessing=!1}
Writable.prototype._write=function(chunk,encoding,cb){cb(new ERR_METHOD_NOT_IMPLEMENTED('_write()'))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==='function'){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==='function'){cb=encoding;encoding=null}
if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}
if(!state.ending)endWritable(this,state,cb);return this};Object.defineProperty(Writable.prototype,'writableLength',{enumerable:!1,get:function get(){return this._writableState.length}});function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}
function callFinal(stream,state){stream._final(function(err){state.pendingcb--;if(err){stream.emit('error',err)}
state.prefinished=!0;stream.emit('prefinish');finishMaybe(stream,state)})}
function prefinish(stream,state){if(!state.prefinished&&!state.finalCalled){if(typeof stream._final==='function'&&!state.destroyed){state.pendingcb++;state.finalCalled=!0;process.nextTick(callFinal,stream,state)}else{state.prefinished=!0;stream.emit('prefinish')}}}
function finishMaybe(stream,state){var need=needFinish(state);if(need){prefinish(stream,state);if(state.pendingcb===0){state.finished=!0;stream.emit('finish')}}
return need}
function endWritable(stream,state,cb){state.ending=!0;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once('finish',cb)}
state.ended=!0;stream.writable=!1}
function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}
state.corkedRequestsFree.next=corkReq}
Object.defineProperty(Writable.prototype,'destroyed',{enumerable:!1,get:function get(){if(this._writableState===undefined){return!1}
return this._writableState.destroyed},set:function set(value){if(!this._writableState){return}
this._writableState.destroyed=value}});Writable.prototype.destroy=destroyImpl.destroy;Writable.prototype._undestroy=destroyImpl.undestroy;Writable.prototype._destroy=function(err,cb){cb(err)}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../errors":250,"./_stream_duplex":252,"./internal/streams/destroy":259,"./internal/streams/state":261,"./internal/streams/stream":262,"_process":139,"buffer":54,"inherits":305,"util-deprecate":467}],257:[function(require,module,exports){(function(process){'use strict';var _Object$setPrototypeO;function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0})}else{obj[key]=value}return obj}
var finished=require('./end-of-stream');var kLastResolve=Symbol('lastResolve');var kLastReject=Symbol('lastReject');var kError=Symbol('error');var kEnded=Symbol('ended');var kLastPromise=Symbol('lastPromise');var kHandlePromise=Symbol('handlePromise');var kStream=Symbol('stream');function createIterResult(value,done){return{value:value,done:done}}
function readAndResolve(iter){var resolve=iter[kLastResolve];if(resolve!==null){var data=iter[kStream].read();if(data!==null){iter[kLastPromise]=null;iter[kLastResolve]=null;iter[kLastReject]=null;resolve(createIterResult(data,!1))}}}
function onReadable(iter){process.nextTick(readAndResolve,iter)}
function wrapForNext(lastPromise,iter){return function(resolve,reject){lastPromise.then(function(){if(iter[kEnded]){resolve(createIterResult(undefined,!0));return}
iter[kHandlePromise](resolve,reject)},reject)}}
var AsyncIteratorPrototype=Object.getPrototypeOf(function(){});var ReadableStreamAsyncIteratorPrototype=Object.setPrototypeOf((_Object$setPrototypeO={get stream(){return this[kStream]},next:function next(){var _this=this;var error=this[kError];if(error!==null){return Promise.reject(error)}
if(this[kEnded]){return Promise.resolve(createIterResult(undefined,!0))}
if(this[kStream].destroyed){return new Promise(function(resolve,reject){process.nextTick(function(){if(_this[kError]){reject(_this[kError])}else{resolve(createIterResult(undefined,!0))}})})}
var lastPromise=this[kLastPromise];var promise;if(lastPromise){promise=new Promise(wrapForNext(lastPromise,this))}else{var data=this[kStream].read();if(data!==null){return Promise.resolve(createIterResult(data,!1))}
promise=new Promise(this[kHandlePromise])}
this[kLastPromise]=promise;return promise}},_defineProperty(_Object$setPrototypeO,Symbol.asyncIterator,function(){return this}),_defineProperty(_Object$setPrototypeO,"return",function _return(){var _this2=this;return new Promise(function(resolve,reject){_this2[kStream].destroy(null,function(err){if(err){reject(err);return}
resolve(createIterResult(undefined,!0))})})}),_Object$setPrototypeO),AsyncIteratorPrototype);var createReadableStreamAsyncIterator=function createReadableStreamAsyncIterator(stream){var _Object$create;var iterator=Object.create(ReadableStreamAsyncIteratorPrototype,(_Object$create={},_defineProperty(_Object$create,kStream,{value:stream,writable:!0}),_defineProperty(_Object$create,kLastResolve,{value:null,writable:!0}),_defineProperty(_Object$create,kLastReject,{value:null,writable:!0}),_defineProperty(_Object$create,kError,{value:null,writable:!0}),_defineProperty(_Object$create,kEnded,{value:stream._readableState.endEmitted,writable:!0}),_defineProperty(_Object$create,kHandlePromise,{value:function value(resolve,reject){var data=iterator[kStream].read();if(data){iterator[kLastPromise]=null;iterator[kLastResolve]=null;iterator[kLastReject]=null;resolve(createIterResult(data,!1))}else{iterator[kLastResolve]=resolve;iterator[kLastReject]=reject}},writable:!0}),_Object$create));iterator[kLastPromise]=null;finished(stream,function(err){if(err&&err.code!=='ERR_STREAM_PREMATURE_CLOSE'){var reject=iterator[kLastReject];if(reject!==null){iterator[kLastPromise]=null;iterator[kLastResolve]=null;iterator[kLastReject]=null;reject(err)}
iterator[kError]=err;return}
var resolve=iterator[kLastResolve];if(resolve!==null){iterator[kLastPromise]=null;iterator[kLastResolve]=null;iterator[kLastReject]=null;resolve(createIterResult(undefined,!0))}
iterator[kEnded]=!0});stream.on('readable',onReadable.bind(null,iterator));return iterator};module.exports=createReadableStreamAsyncIterator}).call(this,require('_process'))},{"./end-of-stream":260,"_process":139}],258:[function(require,module,exports){'use strict';function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==='function'){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}
function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0})}else{obj[key]=value}return obj}
var _require=require('buffer'),Buffer=_require.Buffer;var _require2=require('util'),inspect=_require2.inspect;var custom=inspect&&inspect.custom||'inspect';function copyBuffer(src,target,offset){Buffer.prototype.copy.call(src,target,offset)}
module.exports=function(){function BufferList(){this.head=null;this.tail=null;this.length=0}
var _proto=BufferList.prototype;_proto.push=function push(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};_proto.unshift=function unshift(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};_proto.shift=function shift(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};_proto.clear=function clear(){this.head=this.tail=null;this.length=0};_proto.join=function join(s){if(this.length===0)return'';var p=this.head;var ret=''+p.data;while(p=p.next){ret+=s+p.data}
return ret};_proto.concat=function concat(n){if(this.length===0)return Buffer.alloc(0);var ret=Buffer.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){copyBuffer(p.data,ret,i);i+=p.data.length;p=p.next}
return ret};_proto.consume=function consume(n,hasStrings){var ret;if(n<this.head.data.length){ret=this.head.data.slice(0,n);this.head.data=this.head.data.slice(n)}else if(n===this.head.data.length){ret=this.shift()}else{ret=hasStrings?this._getString(n):this._getBuffer(n)}
return ret};_proto.first=function first(){return this.head.data};_proto._getString=function _getString(n){var p=this.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)this.head=p.next;else this.head=this.tail=null}else{this.head=p;p.data=str.slice(nb)}
break}
++c}
this.length-=c;return ret};_proto._getBuffer=function _getBuffer(n){var ret=Buffer.allocUnsafe(n);var p=this.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)this.head=p.next;else this.head=this.tail=null}else{this.head=p;p.data=buf.slice(nb)}
break}
++c}
this.length-=c;return ret};_proto[custom]=function(_,options){return inspect(this,_objectSpread({},options,{depth:0,customInspect:!1}))};return BufferList}()},{"buffer":54,"util":23}],259:[function(require,module,exports){(function(process){'use strict';function destroy(err,cb){var _this=this;var readableDestroyed=this._readableState&&this._readableState.destroyed;var writableDestroyed=this._writableState&&this._writableState.destroyed;if(readableDestroyed||writableDestroyed){if(cb){cb(err)}else if(err&&(!this._writableState||!this._writableState.errorEmitted)){process.nextTick(emitErrorNT,this,err)}
return this}
if(this._readableState){this._readableState.destroyed=!0}
if(this._writableState){this._writableState.destroyed=!0}
this._destroy(err||null,function(err){if(!cb&&err){process.nextTick(emitErrorAndCloseNT,_this,err);if(_this._writableState){_this._writableState.errorEmitted=!0}}else if(cb){process.nextTick(emitCloseNT,_this);cb(err)}else{process.nextTick(emitCloseNT,_this)}});return this}
function emitErrorAndCloseNT(self,err){emitErrorNT(self,err);emitCloseNT(self)}
function emitCloseNT(self){if(self._writableState&&!self._writableState.emitClose)return;if(self._readableState&&!self._readableState.emitClose)return;self.emit('close')}
function undestroy(){if(this._readableState){this._readableState.destroyed=!1;this._readableState.reading=!1;this._readableState.ended=!1;this._readableState.endEmitted=!1}
if(this._writableState){this._writableState.destroyed=!1;this._writableState.ended=!1;this._writableState.ending=!1;this._writableState.finalCalled=!1;this._writableState.prefinished=!1;this._writableState.finished=!1;this._writableState.errorEmitted=!1}}
function emitErrorNT(self,err){self.emit('error',err)}
module.exports={destroy:destroy,undestroy:undestroy}}).call(this,require('_process'))},{"_process":139}],260:[function(require,module,exports){'use strict';var ERR_STREAM_PREMATURE_CLOSE=require('../../../errors').codes.ERR_STREAM_PREMATURE_CLOSE;function once(callback){var called=!1;return function(){if(called)return;called=!0;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}
callback.apply(this,args)}}
function noop(){}
function isRequest(stream){return stream.setHeader&&typeof stream.abort==='function'}
function eos(stream,opts,callback){if(typeof opts==='function')return eos(stream,null,opts);if(!opts)opts={};callback=once(callback||noop);var readable=opts.readable||opts.readable!==!1&&stream.readable;var writable=opts.writable||opts.writable!==!1&&stream.writable;var onlegacyfinish=function onlegacyfinish(){if(!stream.writable)onfinish()};var writableEnded=stream._writableState&&stream._writableState.finished;var onfinish=function onfinish(){writable=!1;writableEnded=!0;if(!readable)callback.call(stream)};var readableEnded=stream._readableState&&stream._readableState.endEmitted;var onend=function onend(){readable=!1;readableEnded=!0;if(!writable)callback.call(stream)};var onerror=function onerror(err){callback.call(stream,err)};var onclose=function onclose(){var err;if(readable&&!readableEnded){if(!stream._readableState||!stream._readableState.ended)err=new ERR_STREAM_PREMATURE_CLOSE();return callback.call(stream,err)}
if(writable&&!writableEnded){if(!stream._writableState||!stream._writableState.ended)err=new ERR_STREAM_PREMATURE_CLOSE();return callback.call(stream,err)}};var onrequest=function onrequest(){stream.req.on('finish',onfinish)};if(isRequest(stream)){stream.on('complete',onfinish);stream.on('abort',onclose);if(stream.req)onrequest();else stream.on('request',onrequest)}else if(writable&&!stream._writableState){stream.on('end',onlegacyfinish);stream.on('close',onlegacyfinish)}
stream.on('end',onend);stream.on('finish',onfinish);if(opts.error!==!1)stream.on('error',onerror);stream.on('close',onclose);return function(){stream.removeListener('complete',onfinish);stream.removeListener('abort',onclose);stream.removeListener('request',onrequest);if(stream.req)stream.req.removeListener('finish',onfinish);stream.removeListener('end',onlegacyfinish);stream.removeListener('close',onlegacyfinish);stream.removeListener('finish',onfinish);stream.removeListener('end',onend);stream.removeListener('error',onerror);stream.removeListener('close',onclose)}}
module.exports=eos},{"../../../errors":250}],261:[function(require,module,exports){'use strict';var ERR_INVALID_OPT_VALUE=require('../../../errors').codes.ERR_INVALID_OPT_VALUE;function highWaterMarkFrom(options,isDuplex,duplexKey){return options.highWaterMark!=null?options.highWaterMark:isDuplex?options[duplexKey]:null}
function getHighWaterMark(state,options,duplexKey,isDuplex){var hwm=highWaterMarkFrom(options,isDuplex,duplexKey);if(hwm!=null){if(!(isFinite(hwm)&&Math.floor(hwm)===hwm)||hwm<0){var name=isDuplex?duplexKey:'highWaterMark';throw new ERR_INVALID_OPT_VALUE(name,hwm)}
return Math.floor(hwm)}
return state.objectMode?16:16*1024}
module.exports={getHighWaterMark:getHighWaterMark}},{"../../../errors":250}],262:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],263:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":252,"./lib/_stream_passthrough.js":253,"./lib/_stream_readable.js":254,"./lib/_stream_transform.js":255,"./lib/_stream_writable.js":256,"dup":208}],264:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],265:[function(require,module,exports){(function(process){"use strict";function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}
exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=localstorage();exports.colors=['#0000CC','#0000FF','#0033CC','#0033FF','#0066CC','#0066FF','#0099CC','#0099FF','#00CC00','#00CC33','#00CC66','#00CC99','#00CCCC','#00CCFF','#3300CC','#3300FF','#3333CC','#3333FF','#3366CC','#3366FF','#3399CC','#3399FF','#33CC00','#33CC33','#33CC66','#33CC99','#33CCCC','#33CCFF','#6600CC','#6600FF','#6633CC','#6633FF','#66CC00','#66CC33','#9900CC','#9900FF','#9933CC','#9933FF','#99CC00','#99CC33','#CC0000','#CC0033','#CC0066','#CC0099','#CC00CC','#CC00FF','#CC3300','#CC3333','#CC3366','#CC3399','#CC33CC','#CC33FF','#CC6600','#CC6633','#CC9900','#CC9933','#CCCC00','#CCCC33','#FF0000','#FF0033','#FF0066','#FF0099','#FF00CC','#FF00FF','#FF3300','#FF3333','#FF3366','#FF3399','#FF33CC','#FF33FF','#FF6600','#FF6633','#FF9900','#FF9933','#FFCC00','#FFCC33'];function useColors(){if(typeof window!=='undefined'&&window.process&&(window.process.type==='renderer'||window.process.__nwjs)){return!0}
if(typeof navigator!=='undefined'&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return!1}
return typeof document!=='undefined'&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=='undefined'&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=='undefined'&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=='undefined'&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}
function formatArgs(args){args[0]=(this.useColors?'%c':'')+this.namespace+(this.useColors?' %c':' ')+args[0]+(this.useColors?'%c ':' ')+'+'+module.exports.humanize(this.diff);if(!this.useColors){return}
var c='color: '+this.color;args.splice(1,0,c,'color: inherit');var index=0;var lastC=0;args[0].replace(/%[a-zA-Z%]/g,function(match){if(match==='%%'){return}
index++;if(match==='%c'){lastC=index}});args.splice(lastC,0,c)}
function log(){var _console;return(typeof console==="undefined"?"undefined":_typeof(console))==='object'&&console.log&&(_console=console).log.apply(_console,arguments)}
function save(namespaces){try{if(namespaces){exports.storage.setItem('debug',namespaces)}else{exports.storage.removeItem('debug')}}catch(error){}}
function load(){var r;try{r=exports.storage.getItem('debug')}catch(error){}
if(!r&&typeof process!=='undefined'&&'env' in process){r=process.env.DEBUG}
return r}
function localstorage(){try{return localStorage}catch(error){}}
module.exports=require('./common')(exports);var formatters=module.exports.formatters;formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return'[UnexpectedJSONParseError]: '+error.message}}}).call(this,require('_process'))},{"./common":266,"_process":139}],266:[function(require,module,exports){"use strict";function setup(env){createDebug.debug=createDebug;createDebug.default=createDebug;createDebug.coerce=coerce;createDebug.disable=disable;createDebug.enable=enable;createDebug.enabled=enabled;createDebug.humanize=require('ms');Object.keys(env).forEach(function(key){createDebug[key]=env[key]});createDebug.instances=[];createDebug.names=[];createDebug.skips=[];createDebug.formatters={};function selectColor(namespace){var hash=0;for(var i=0;i<namespace.length;i++){hash=(hash<<5)-hash+namespace.charCodeAt(i);hash|=0}
return createDebug.colors[Math.abs(hash)%createDebug.colors.length]}
createDebug.selectColor=selectColor;function createDebug(namespace){var prevTime;function debug(){if(!debug.enabled){return}
for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}
var self=debug;var curr=Number(new Date());var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;args[0]=createDebug.coerce(args[0]);if(typeof args[0]!=='string'){args.unshift('%O')}
var index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,function(match,format){if(match==='%%'){return match}
index++;var formatter=createDebug.formatters[format];if(typeof formatter==='function'){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}
return match});createDebug.formatArgs.call(self,args);var logFn=self.log||createDebug.log;logFn.apply(self,args)}
debug.namespace=namespace;debug.enabled=createDebug.enabled(namespace);debug.useColors=createDebug.useColors();debug.color=selectColor(namespace);debug.destroy=destroy;debug.extend=extend;if(typeof createDebug.init==='function'){createDebug.init(debug)}
createDebug.instances.push(debug);return debug}
function destroy(){var index=createDebug.instances.indexOf(this);if(index!==-1){createDebug.instances.splice(index,1);return!0}
return!1}
function extend(namespace,delimiter){return createDebug(this.namespace+(typeof delimiter==='undefined'?':':delimiter)+namespace)}
function enable(namespaces){createDebug.save(namespaces);createDebug.names=[];createDebug.skips=[];var i;var split=(typeof namespaces==='string'?namespaces:'').split(/[\s,]+/);var len=split.length;for(i=0;i<len;i++){if(!split[i]){continue}
namespaces=split[i].replace(/\*/g,'.*?');if(namespaces[0]==='-'){createDebug.skips.push(new RegExp('^'+namespaces.substr(1)+'$'))}else{createDebug.names.push(new RegExp('^'+namespaces+'$'))}}
for(i=0;i<createDebug.instances.length;i++){var instance=createDebug.instances[i];instance.enabled=createDebug.enabled(instance.namespace)}}
function disable(){createDebug.enable('')}
function enabled(name){if(name[name.length-1]==='*'){return!0}
var i;var len;for(i=0,len=createDebug.skips.length;i<len;i++){if(createDebug.skips[i].test(name)){return!1}}
for(i=0,len=createDebug.names.length;i<len;i++){if(createDebug.names[i].test(name)){return!0}}
return!1}
function coerce(val){if(val instanceof Error){return val.stack||val.message}
return val}
createDebug.enable(createDebug.load());return createDebug}
module.exports=setup},{"ms":346}],267:[function(require,module,exports){module.exports=function(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined)return arguments[i]}}},{}],268:[function(require,module,exports){(function(process,Buffer){var stream=require('readable-stream')
var eos=require('end-of-stream')
var inherits=require('inherits')
var shift=require('stream-shift')
var SIGNAL_FLUSH=(Buffer.from&&Buffer.from!==Uint8Array.from)?Buffer.from([0]):new Buffer([0])
var onuncork=function(self,fn){if(self._corked)self.once('uncork',fn)
else fn()}
var autoDestroy=function(self,err){if(self._autoDestroy)self.destroy(err)}
var destroyer=function(self,end){return function(err){if(err)autoDestroy(self,err.message==='premature close'?null:err)
else if(end&&!self._ended)self.end()}}
var end=function(ws,fn){if(!ws)return fn()
if(ws._writableState&&ws._writableState.finished)return fn()
if(ws._writableState)return ws.end(fn)
ws.end()
fn()}
var toStreams2=function(rs){return new(stream.Readable)({objectMode:!0,highWaterMark:16}).wrap(rs)}
var Duplexify=function(writable,readable,opts){if(!(this instanceof Duplexify))return new Duplexify(writable,readable,opts)
stream.Duplex.call(this,opts)
this._writable=null
this._readable=null
this._readable2=null
this._autoDestroy=!opts||opts.autoDestroy!==!1
this._forwardDestroy=!opts||opts.destroy!==!1
this._forwardEnd=!opts||opts.end!==!1
this._corked=1
this._ondrain=null
this._drained=!1
this._forwarding=!1
this._unwrite=null
this._unread=null
this._ended=!1
this.destroyed=!1
if(writable)this.setWritable(writable)
if(readable)this.setReadable(readable)}
inherits(Duplexify,stream.Duplex)
Duplexify.obj=function(writable,readable,opts){if(!opts)opts={}
opts.objectMode=!0
opts.highWaterMark=16
return new Duplexify(writable,readable,opts)}
Duplexify.prototype.cork=function(){if(++this._corked===1)this.emit('cork')}
Duplexify.prototype.uncork=function(){if(this._corked&&--this._corked===0)this.emit('uncork')}
Duplexify.prototype.setWritable=function(writable){if(this._unwrite)this._unwrite()
if(this.destroyed){if(writable&&writable.destroy)writable.destroy()
return}
if(writable===null||writable===!1){this.end()
return}
var self=this
var unend=eos(writable,{writable:!0,readable:!1},destroyer(this,this._forwardEnd))
var ondrain=function(){var ondrain=self._ondrain
self._ondrain=null
if(ondrain)ondrain()}
var clear=function(){self._writable.removeListener('drain',ondrain)
unend()}
if(this._unwrite)process.nextTick(ondrain)
this._writable=writable
this._writable.on('drain',ondrain)
this._unwrite=clear
this.uncork()}
Duplexify.prototype.setReadable=function(readable){if(this._unread)this._unread()
if(this.destroyed){if(readable&&readable.destroy)readable.destroy()
return}
if(readable===null||readable===!1){this.push(null)
this.resume()
return}
var self=this
var unend=eos(readable,{writable:!1,readable:!0},destroyer(this))
var onreadable=function(){self._forward()}
var onend=function(){self.push(null)}
var clear=function(){self._readable2.removeListener('readable',onreadable)
self._readable2.removeListener('end',onend)
unend()}
this._drained=!0
this._readable=readable
this._readable2=readable._readableState?readable:toStreams2(readable)
this._readable2.on('readable',onreadable)
this._readable2.on('end',onend)
this._unread=clear
this._forward()}
Duplexify.prototype._read=function(){this._drained=!0
this._forward()}
Duplexify.prototype._forward=function(){if(this._forwarding||!this._readable2||!this._drained)return
this._forwarding=!0
var data
while(this._drained&&(data=shift(this._readable2))!==null){if(this.destroyed)continue
this._drained=this.push(data)}
this._forwarding=!1}
Duplexify.prototype.destroy=function(err){if(this.destroyed)return
this.destroyed=!0
var self=this
process.nextTick(function(){self._destroy(err)})}
Duplexify.prototype._destroy=function(err){if(err){var ondrain=this._ondrain
this._ondrain=null
if(ondrain)ondrain(err)
else this.emit('error',err)}
if(this._forwardDestroy){if(this._readable&&this._readable.destroy)this._readable.destroy()
if(this._writable&&this._writable.destroy)this._writable.destroy()}
this.emit('close')}
Duplexify.prototype._write=function(data,enc,cb){if(this.destroyed)return cb()
if(this._corked)return onuncork(this,this._write.bind(this,data,enc,cb))
if(data===SIGNAL_FLUSH)return this._finish(cb)
if(!this._writable)return cb()
if(this._writable.write(data)===!1)this._ondrain=cb
else cb()}
Duplexify.prototype._finish=function(cb){var self=this
this.emit('preend')
onuncork(this,function(){end(self._forwardEnd&&self._writable,function(){if(self._writableState.prefinished===!1)self._writableState.prefinished=!0
self.emit('prefinish')
onuncork(self,cb)})})}
Duplexify.prototype.end=function(data,enc,cb){if(typeof data==='function')return this.end(null,null,data)
if(typeof enc==='function')return this.end(data,null,enc)
this._ended=!0
if(data)this.write(data)
if(!this._writableState.ending)this.write(SIGNAL_FLUSH)
return stream.Writable.prototype.end.call(this,cb)}
module.exports=Duplexify}).call(this,require('_process'),require("buffer").Buffer)},{"_process":139,"buffer":54,"end-of-stream":288,"inherits":305,"readable-stream":278,"stream-shift":448}],269:[function(require,module,exports){arguments[4][199][0].apply(exports,arguments)},{"dup":199}],270:[function(require,module,exports){arguments[4][200][0].apply(exports,arguments)},{"./_stream_readable":272,"./_stream_writable":274,"core-util-is":248,"dup":200,"inherits":305,"process-nextick-args":374}],271:[function(require,module,exports){arguments[4][201][0].apply(exports,arguments)},{"./_stream_transform":273,"core-util-is":248,"dup":201,"inherits":305}],272:[function(require,module,exports){arguments[4][202][0].apply(exports,arguments)},{"./_stream_duplex":270,"./internal/streams/BufferList":275,"./internal/streams/destroy":276,"./internal/streams/stream":277,"_process":139,"core-util-is":248,"dup":202,"events":90,"inherits":305,"isarray":269,"process-nextick-args":374,"safe-buffer":401,"string_decoder/":279,"util":23}],273:[function(require,module,exports){arguments[4][203][0].apply(exports,arguments)},{"./_stream_duplex":270,"core-util-is":248,"dup":203,"inherits":305}],274:[function(require,module,exports){arguments[4][204][0].apply(exports,arguments)},{"./_stream_duplex":270,"./internal/streams/destroy":276,"./internal/streams/stream":277,"_process":139,"core-util-is":248,"dup":204,"inherits":305,"process-nextick-args":374,"safe-buffer":401,"timers":182,"util-deprecate":467}],275:[function(require,module,exports){arguments[4][205][0].apply(exports,arguments)},{"dup":205,"safe-buffer":401,"util":23}],276:[function(require,module,exports){arguments[4][206][0].apply(exports,arguments)},{"dup":206,"process-nextick-args":374}],277:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],278:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":270,"./lib/_stream_passthrough.js":271,"./lib/_stream_readable.js":272,"./lib/_stream_transform.js":273,"./lib/_stream_writable.js":274,"dup":208}],279:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],280:[function(require,module,exports){(function(__dirname){'use strict'
var electron=require('electron-prebuilt')
var spawn=require('child_process').spawn
var json=require('newline-json')
var path=require('path')
var EventEmitter=require('events').EventEmitter
module.exports=function(opts){return new Daemon(opts)}
var daemonMain=path.join(__dirname,'daemon.js')
var i=0
class Daemon extends EventEmitter{constructor(opts){super()
opts=opts||{}
opts.timeout=typeof opts.timeout==='number'?opts.timeout:10e3
this.child=spawn(electron,[daemonMain])
this.stdout=this.child.stdout.pipe(json.Parser())
this.stdout.on('error',err=>this.emit('error',err))
this.stdin=json.Stringifier()
this.stdin.on('error',err=>this.emit('error',err))
this.stdin.pipe(this.child.stdin)
this.stdin.write(opts)
this.keepaliveInterval=setInterval(this.keepalive.bind(this),opts.timeout/2)
this.queue=[]
this.ready=!1
this.stdout.once('data',()=>{this.stdout.on('data',message=>this.emit(message[0],message[1]))
this.ready=!0
this.queue.forEach(item=>this.eval(item.code,item.cb))
this.queue=null
this.emit('ready')})}
eval(code,cb){var id=(i++).toString(36)
this.once(id,res=>{if(res.err){var err=new Error(`Error evaluating "${code}": ${res.err}`)
err.original=res.err}
if(cb){if(err)return cb(err)
return cb(null,res.res)}
if(err)this.emit('error',err)})
if(!this.ready)return this.queue.push({code,cb})
this.stdin.write({id,code})}
keepalive(){this.stdin.write(0)}
close(signal){this.child.kill(signal)
this.stdout=this.stdin=null
clearInterval(this.keepaliveInterval)}}}).call(this,"/node_modules/electron-eval")},{"child_process":1,"electron-prebuilt":281,"events":90,"newline-json":359,"path":132}],281:[function(require,module,exports){(function(__dirname){var fs=require('fs')
var path=require('path')
module.exports=path.join(__dirname,fs.readFileSync(path.join(__dirname,'path.txt'),'utf-8'))}).call(this,"/node_modules/electron-eval/node_modules/electron-prebuilt")},{"fs":1,"path":132}],282:[function(require,module,exports){var electron=require('electron-eval')
module.exports=function(cb){var daemon=electron()
return{electronDaemon:daemon,RTCPeerConnection:require('./src/RTCPeerConnection.js')(daemon,cb),RTCSessionDescription:require('./src/RTCSessionDescription.js'),RTCIceCandidate:require('./src/RTCIceCandidate.js'),RTCDataChannel:require('./src/RTCDataChannel.js')}}},{"./src/RTCDataChannel.js":283,"./src/RTCIceCandidate.js":284,"./src/RTCPeerConnection.js":285,"./src/RTCSessionDescription.js":286,"electron-eval":280}],283:[function(require,module,exports){(function(Buffer){'use strict'
var EventEmitter=require('events').EventEmitter
module.exports=function(daemon){daemon.eval(`
    window.arrayBufferToBase64 = function (buffer) {
      var binary = ''
      var bytes = new Uint8Array(buffer)
      for (var i = 0; i < bytes.byteLength; i++) {
        binary += String.fromCharCode(bytes[i])
      }
      return window.btoa(binary)
    }

    window.base64ToArrayBuffer = function (base64) {
      var binary = window.atob(base64)
      var bytes = new Uint8Array(binary.length)
      for (var i = 0; i < binary.length; i++) {
        bytes[i] = binary.charCodeAt(i)
      }
      return bytes.buffer
    }
  `)
return class RTCDataChannel extends EventEmitter{constructor(pcId,label,opts){super()
if(typeof pcId==='object'){this._wrap(pcId)}else{this._create(pcId,label,opts)}}
_create(pcId,label,opts){opts=opts||{}
this._pcId=pcId
this.label=label
this.ordered=null
this.protocol=''
this.id=this.stream=null
this.readyState='connecting'
this.bufferedAmount=0
this._bufferedAmountLowThreshold=0
this._binaryType='blob'
this.maxPacketLifeType=null
this.maxRetransmits=null
this.negotiated=!1
this.reliable=typeof opts.reliable==='boolean'?opts.reliable:!0
daemon.eval(`
        var pc = conns[${JSON.stringify(pcId)}]
        var dc = pc.createDataChannel(
          ${JSON.stringify(label)}, ${JSON.stringify(opts)})
        pc.dataChannels[dc.id] = dc
        dc.id
      `,(err,id)=>{if(err)this.emit('error',err)
this.id=this.stream=id
this._registerListeners()
this.emit('init')})}
_wrap(init){for(let k in init){this[k]=init[k]}
this.stream=this.id
this._registerListeners()}
_registerListeners(cb){daemon.on(`dc:${this._pcId}:${this.id}`,this.onMessage.bind(this))
this._eval(`
        var id = 'dc:' + ${JSON.stringify(this._pcId)} + ':' + dc.id
        dc.onopen = function () {
          send(id, {
            type: 'open',
            state: {
              ordered: dc.ordered,
              protocol: dc.protocol,
              maxPacketLifeType: dc.maxPacketLifeType,
              maxRetransmits: dc.maxRetransmits,
              negotiated: dc.negotiated,
              reliable: dc.reliable
            }
          })
        }
        dc.onmessage = function (e) {
          send(id, {
            type: 'message',
            event: {
              data: e.data instanceof ArrayBuffer ? arrayBufferToBase64(e.data) : e.data,
              origin: e.origin
            },
            dataType: e.data instanceof ArrayBuffer ? 'binary' : 'string'
          })
        }
        dc.onbufferedamountlow = function () {
          send(id, { type: 'bufferedamountlow' })
        }
        dc.onclose = function () {
          delete pc.dataChannels[dc.id]
          send(id, { type: 'close' })
        }
        dc.onerror = function () {
          send(id, { type: 'error' })
        }
        if (dc.readyState === 'open') dc.onopen()
      `,cb||(err=>{if(err)return this.emit('error',err)}))}
onMessage(message){var handler=this['on'+message.type]
var event=message.event||{}
console.log('dc<<',this.id,message.type,message,!!handler)
switch(message.type){case 'open':this.readyState='open'
break
case 'message':if(message.dataType==='binary'){var b=new Buffer(event.data,'base64')
event.data=b.buffer.slice(b.byteOffset,b.byteOffset+b.byteLength)}
break
case 'close':this.readyState='closed'
break}
if(handler)handler(event)}
close(){this.readyState='closing'
this._eval('if (dc) dc.close()',err=>{if(err)this.emit('error',err)})}
send(data){var convert=''
if(data instanceof ArrayBuffer){data=toBuffer(data)}
if(data instanceof Buffer){data=data.toString('base64')
convert='data = base64ToArrayBuffer(data)'}
this._eval(`
        var data = ${JSON.stringify(data)}
        ${convert}
        dc.send(data)
        dc.bufferedAmount
      `,(err,bufferedAmount)=>{if(err)return this.emit('error',err)
this.bufferedAmount=bufferedAmount})}
_eval(code,cb){return daemon.eval(`
        var pc = conns[${JSON.stringify(this._pcId)}]
        var dc = pc.dataChannels[${JSON.stringify(this.id)}]
      `+code,cb||(err=>{if(err)this.emit('error',err)}))}
_setProp(name,value){if(this.id==null){return this.once('init',()=>this._setProp(name,value))}
return this._eval(`dc["${name}"] = ${JSON.stringify(value)}`)}
get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}
set bufferedAmountLowThreshold(value){this._bufferedAmountLowThreshold=value
this._setProp('bufferedAmountLowThreshold',value)}
get binaryType(){return this._binaryType}
set binaryType(value){this._binaryType=value
this._setProp('binaryType',value)}}}
function toBuffer(ab){var buffer=new Buffer(ab.byteLength)
var view=new Uint8Array(ab)
for(var i=0;i<buffer.length;++i){buffer[i]=view[i]}
return buffer}}).call(this,require("buffer").Buffer)},{"buffer":54,"events":90}],284:[function(require,module,exports){'use strict'
module.exports=class RTCIceCandidate{constructor(obj){this.candidate=obj.candidate
this.sdpMid=obj.sdpMid
this.sdpMLineIndex=obj.sdpMLineIndex}}},{}],285:[function(require,module,exports){'use strict'
var EventEmitter=require('events').EventEmitter
var hat=require('hat')
module.exports=function(daemon){var RTCDataChannel=require('./RTCDataChannel.js')(daemon)
var i=0
daemon.eval('window.conns = {}',err=>{if(err)daemon.emit('error',err)})
return class RTCPeerConnection extends EventEmitter{constructor(opts){super()
this._id=(i++).toString(36)
this._dataChannels=new Map()
this.iceConnectionState='new'
this.iceGatheringState='new'
this.localDescription=null
this.peerIdentity=null
this.remoteDescription=null
this.signalingState='stable'
daemon.on(`pc:${this._id}`,this.onMessage.bind(this))
daemon.eval(`
        (function () {
          var pc = conns[${JSON.stringify(this._id)}] = new webkitRTCPeerConnection(${JSON.stringify(opts)})
          pc.dataChannels = {}
          var id = 'pc:' + ${JSON.stringify(this._id)}
          pc.onaddstream = function (e) {
            // TODO: send MediaStream info
            send(id, { type: 'addstream' })
          }
          pc.ondatachannel = function (e) {
            pc.dataChannels[e.channel.id] = e.channel
            var channel = {}
            for (var key in e.channel) {
              if (typeof e.channel[key] === 'function' || e.channel[key] == null) continue
              channel[key] = e.channel[key]
            }
            send(id, {
              type: 'datachannel',
              channel: channel
            })
          }
          pc.onicecandidate = function (e) {
            var event = {}
            if (e.candidate) {
              event.candidate = {
                candidate: e.candidate.candidate,
                sdpMid: e.candidate.sdpMid,
                sdpMLineIndex: e.candidate.sdpMLineIndex
              }
            }
            send(id, {
              type: 'icecandidate',
              event: event,
              iceGatheringState: pc.iceGatheringState
            })
          }
          pc.oniceconnectionstatechange = function (e) {
            send(id, { type: 'iceconnectionstatechange', iceConnectionState: pc.iceConnectionState })
          }
          pc.onidentityresult = function (e) {
            send(id, { type: 'identityresult', event: {
              assertion: e.assertion
            }})
          }
          pc.onidpassertionerror = function (e) {
            send(id, {
              type: 'idpassertionerror',
              event: {
                idp: e.idp,
                loginUrl: e.loginUrl,
                protocol: e.protocol,
              }
            })
          }
          pc.onidpvalidationerror = function (e) {
            send(id, {
              type: 'idpvalidationerror',
              event: {
                idp: e.idp,
                loginUrl: e.loginUrl,
                protocol: e.protocol,
              }
            })
          }
          pc.onnegotiationneeded = function (e) {
            send(id, { type: 'negotiationneeded' })
          }
          pc.onremovestream = function (e) {
            send(id, {
              type: 'removestream',
              event: { id: e.stream.id }
            })
          }
          pc.onsignalingstatechange = function (e) {
            send(id, {
              type: 'signalingstatechange',
              signalingState: pc.signalingState
            })
          }
        })()
      `,err=>{if(err)this.emit('error',err)})}
onMessage(message){var handler=this['on'+message.type]
var event=message.event||{}
switch(message.type){case 'addstream':break
case 'datachannel':message.channel._pcId=this._id
event.channel=new RTCDataChannel(message.channel)
this._dataChannels.set(event.channel.id,event.channel)
break
case 'icecandidate':this.iceGatheringState=message.iceGatheringState
break
case 'iceconnectionstatechange':this.iceConnectionState=message.iceConnectionState
break
case 'removestream':break
case 'signalingstatechange':this.signalingState=message.signalingState
break}
if(handler)handler(event)}
createDataChannel(label,options){var dc=new RTCDataChannel(this._id,label,options)
dc.once('init',()=>this._dataChannels.set(dc.id,dc))
return dc}
createOffer(cb,errCb,options){return this._callRemote('createOffer',`onSuccess, onFailure, ${JSON.stringify(options)}`,cb,errCb)}
createAnswer(cb,errCb,options){return this._callRemote('createAnswer',`onSuccess, onFailure, ${JSON.stringify(options)}`,cb,errCb)}
setLocalDescription(desc,cb,errCb){this.localDescription=desc
this._callRemote('setLocalDescription',`new RTCSessionDescription(${JSON.stringify(desc)}), onSuccess, onFailure`,cb,errCb)}
setRemoteDescription(desc,cb,errCb){this.remoteDescription=desc
this._callRemote('setRemoteDescription',`new RTCSessionDescription(${JSON.stringify(desc)}), onSuccess, onFailure`,cb,errCb)}
addIceCandidate(candidate,cb,errCb){this._callRemote('addIceCandidate',`new RTCIceCandidate(${JSON.stringify(candidate)}), onSuccess, onFailure`,cb,errCb)}
close(){this._callRemote('close')}
getStats(cb){this._callRemote('getStats',`
        function (res) {
          res = res.result()
          var output = new Array(res.length)
          res.forEach(function (res) {
            var item = {
              id: res.id,
              timestamp: res.timestamp,
              type: res.type,
              stats: {}
            }
            res.names().forEach(function (name) {
              item.stats[name] = res.stat(name)
            })
            output.push(item)
          })
          onSuccess(output)
        }
      `,res=>{for(let item of res){let stats=item.stats
delete item.stats
item.names=()=>Object.keys(stats)
item.stat=name=>stats[name]}
cb({result:()=>res})})}
_callRemote(name,args,cb,errCb){var resolve
var reject
var promise=new Promise((res,rej)=>{resolve=res
reject=rej})
var reqId=hat()
daemon.once(reqId,res=>{if(res.err&&errCb){errCb(res.err)
reject(res.err)}else if(!res.err&&cb){cb(res.res)
resolve(res.res)}})
daemon.eval(`
        (function () {
          var id = ${JSON.stringify(this._id)}
          var reqId = ${JSON.stringify(reqId)}
          var pc = conns[id]
          var onSuccess = function (res) {
            send(reqId, { res: res && res.toJSON ? res.toJSON() : res })
          }
          var onFailure = function (err) {
            send(reqId, { err: err })
          }
          pc.${name}(${args || ''})
        })()
      `,err=>{if(err)this.emit('error',err)})
return promise}}}},{"./RTCDataChannel.js":283,"events":90,"hat":303}],286:[function(require,module,exports){'use strict'
module.exports=class RTCSessionDescription{constructor(obj){this.type=obj.type
this.sdp=obj.sdp}
toJSON(){return this}}},{}],287:[function(require,module,exports){(function(process,__dirname){var fs=require('fs')
var path=require('path')
var pathFile=path.join(__dirname,'path.txt')
function getElectronPath(){if(fs.existsSync(pathFile)){var executablePath=fs.readFileSync(pathFile,'utf-8')
if(process.env.ELECTRON_OVERRIDE_DIST_PATH){return path.join(process.env.ELECTRON_OVERRIDE_DIST_PATH,executablePath)}
return path.join(__dirname,'dist',executablePath)}else{throw new Error('Electron failed to install correctly, please delete node_modules/electron and try installing again')}}
module.exports=getElectronPath()}).call(this,require('_process'),"/node_modules/electron")},{"_process":139,"fs":1,"path":132}],288:[function(require,module,exports){var once=require('once');var noop=function(){};var isRequest=function(stream){return stream.setHeader&&typeof stream.abort==='function'};var isChildProcess=function(stream){return stream.stdio&&Array.isArray(stream.stdio)&&stream.stdio.length===3};var eos=function(stream,opts,callback){if(typeof opts==='function')return eos(stream,null,opts);if(!opts)opts={};callback=once(callback||noop);var ws=stream._writableState;var rs=stream._readableState;var readable=opts.readable||(opts.readable!==!1&&stream.readable);var writable=opts.writable||(opts.writable!==!1&&stream.writable);var onlegacyfinish=function(){if(!stream.writable)onfinish()};var onfinish=function(){writable=!1;if(!readable)callback.call(stream)};var onend=function(){readable=!1;if(!writable)callback.call(stream)};var onexit=function(exitCode){callback.call(stream,exitCode?new Error('exited with error code: '+exitCode):null)};var onerror=function(err){callback.call(stream,err)};var onclose=function(){if(readable&&!(rs&&rs.ended))return callback.call(stream,new Error('premature close'));if(writable&&!(ws&&ws.ended))return callback.call(stream,new Error('premature close'))};var onrequest=function(){stream.req.on('finish',onfinish)};if(isRequest(stream)){stream.on('complete',onfinish);stream.on('abort',onclose);if(stream.req)onrequest();else stream.on('request',onrequest)}else if(writable&&!ws){stream.on('end',onlegacyfinish);stream.on('close',onlegacyfinish)}
if(isChildProcess(stream))stream.on('exit',onexit);stream.on('end',onend);stream.on('finish',onfinish);if(opts.error!==!1)stream.on('error',onerror);stream.on('close',onclose);return function(){stream.removeListener('complete',onfinish);stream.removeListener('abort',onclose);stream.removeListener('request',onrequest);if(stream.req)stream.req.removeListener('finish',onfinish);stream.removeListener('end',onlegacyfinish);stream.removeListener('close',onlegacyfinish);stream.removeListener('finish',onfinish);stream.removeListener('exit',onexit);stream.removeListener('end',onend);stream.removeListener('error',onerror);stream.removeListener('close',onclose)}};module.exports=eos},{"once":363}],289:[function(require,module,exports){arguments[4][199][0].apply(exports,arguments)},{"dup":199}],290:[function(require,module,exports){arguments[4][200][0].apply(exports,arguments)},{"./_stream_readable":292,"./_stream_writable":294,"core-util-is":248,"dup":200,"inherits":305,"process-nextick-args":374}],291:[function(require,module,exports){arguments[4][201][0].apply(exports,arguments)},{"./_stream_transform":293,"core-util-is":248,"dup":201,"inherits":305}],292:[function(require,module,exports){arguments[4][202][0].apply(exports,arguments)},{"./_stream_duplex":290,"./internal/streams/BufferList":295,"./internal/streams/destroy":296,"./internal/streams/stream":297,"_process":139,"core-util-is":248,"dup":202,"events":90,"inherits":305,"isarray":289,"process-nextick-args":374,"safe-buffer":401,"string_decoder/":299,"util":23}],293:[function(require,module,exports){arguments[4][203][0].apply(exports,arguments)},{"./_stream_duplex":290,"core-util-is":248,"dup":203,"inherits":305}],294:[function(require,module,exports){arguments[4][204][0].apply(exports,arguments)},{"./_stream_duplex":290,"./internal/streams/destroy":296,"./internal/streams/stream":297,"_process":139,"core-util-is":248,"dup":204,"inherits":305,"process-nextick-args":374,"safe-buffer":401,"timers":182,"util-deprecate":467}],295:[function(require,module,exports){arguments[4][205][0].apply(exports,arguments)},{"dup":205,"safe-buffer":401,"util":23}],296:[function(require,module,exports){arguments[4][206][0].apply(exports,arguments)},{"dup":206,"process-nextick-args":374}],297:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],298:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":290,"./lib/_stream_passthrough.js":291,"./lib/_stream_readable.js":292,"./lib/_stream_transform.js":293,"./lib/_stream_writable.js":294,"dup":208}],299:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],300:[function(require,module,exports){var Readable=require('readable-stream').Readable;var inherits=require('inherits');var reExtension=/^.*\.(\w+)$/;var toBuffer=require('typedarray-to-buffer');function FileReadStream(file,opts){var readStream=this;if(!(this instanceof FileReadStream)){return new FileReadStream(file,opts)}
opts=opts||{};Readable.call(this,opts);this._offset=0;this._ready=!1;this._file=file;this._size=file.size;this._chunkSize=opts.chunkSize||Math.max(this._size/1000,200*1024);this.reader=new FileReader();this._generateHeaderBlocks(file,opts,function(err,blocks){if(err){return readStream.emit('error',err)}
if(Array.isArray(blocks)){blocks.forEach(function(block){readStream.push(block)})}
readStream._ready=!0;readStream.emit('_ready')})}
inherits(FileReadStream,Readable);module.exports=FileReadStream;FileReadStream.prototype._generateHeaderBlocks=function(file,opts,callback){callback(null,[])};FileReadStream.prototype._read=function(){if(!this._ready){this.once('_ready',this._read.bind(this));return}
var readStream=this;var reader=this.reader;var startOffset=this._offset;var endOffset=this._offset+this._chunkSize;if(endOffset>this._size)endOffset=this._size;if(startOffset===this._size){this.destroy();this.push(null);return}
reader.onload=function(){readStream._offset=endOffset;readStream.push(toBuffer(reader.result))}
reader.onerror=function(){readStream.emit('error',reader.error)}
reader.readAsArrayBuffer(this._file.slice(startOffset,endOffset))};FileReadStream.prototype.destroy=function(){this._file=null;if(this.reader){this.reader.onload=null;this.reader.onerror=null;try{this.reader.abort()}catch(e){}}
this.reader=null}},{"inherits":305,"readable-stream":298,"typedarray-to-buffer":458}],301:[function(require,module,exports){module.exports=function flatten(list,depth){depth=(typeof depth=='number')?depth:Infinity;if(!depth){if(Array.isArray(list)){return list.map(function(i){return i})}
return list}
return _flatten(list,1);function _flatten(list,d){return list.reduce(function(acc,item){if(Array.isArray(item)&&d<depth){return acc.concat(_flatten(item,d+1))}
else{return acc.concat(item)}},[])}}},{}],302:[function(require,module,exports){module.exports=function getBrowserRTC(){if(typeof window==='undefined')return null
var wrtc={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate}
if(!wrtc.RTCPeerConnection)return null
return wrtc}},{}],303:[function(require,module,exports){var hat=module.exports=function(bits,base){if(!base)base=16;if(bits===undefined)bits=128;if(bits<=0)return'0';var digits=Math.log(Math.pow(2,bits))/Math.log(base);for(var i=2;digits===Infinity;i*=2){digits=Math.log(Math.pow(2,bits/i))/Math.log(base)*i}
var rem=digits-Math.floor(digits);var res='';for(var i=0;i<Math.floor(digits);i++){var x=Math.floor(Math.random()*base).toString(base);res=x+res}
if(rem){var b=Math.pow(base,rem);var x=Math.floor(Math.random()*b).toString(base);res=x+res}
var parsed=parseInt(res,base);if(parsed!==Infinity&&parsed>=Math.pow(2,bits)){return hat(bits,base)}
else return res};hat.rack=function(bits,base,expandBy){var fn=function(data){var iters=0;do{if(iters ++>10){if(expandBy)bits+=expandBy;else throw new Error('too many ID collisions, use more bits')}
var id=hat(bits,base)}while(Object.hasOwnProperty.call(hats,id));hats[id]=data;return id};var hats=fn.hats={};fn.get=function(id){return fn.hats[id]};fn.set=function(id,value){fn.hats[id]=value;return fn};fn.bits=bits||128;fn.base=base||16;return fn}},{}],304:[function(require,module,exports){(function(process){class ImmediateStore{constructor(store){this.store=store
this.chunkLength=store.chunkLength
if(!this.store||!this.store.get||!this.store.put){throw new Error('First argument must be abstract-chunk-store compliant')}
this.mem=[]}
put(index,buf,cb){this.mem[index]=buf
this.store.put(index,buf,err=>{this.mem[index]=null
if(cb)cb(err)})}
get(index,opts,cb){if(typeof opts==='function')return this.get(index,null,opts)
const start=(opts&&opts.offset)||0
const end=opts&&opts.length&&(start+opts.length)
const buf=this.mem[index]
if(buf)return nextTick(cb,null,opts?buf.slice(start,end):buf)
this.store.get(index,opts,cb)}
close(cb){this.store.close(cb)}
destroy(cb){this.store.destroy(cb)}}
function nextTick(cb,err,val){process.nextTick(()=>{if(cb)cb(err,val)})}
module.exports=ImmediateStore}).call(this,require('_process'))},{"_process":139}],305:[function(require,module,exports){if(typeof Object.create==='function'){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor
ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor
var TempCtor=function(){}
TempCtor.prototype=superCtor.prototype
ctor.prototype=new TempCtor()
ctor.prototype.constructor=ctor}}},{}],306:[function(require,module,exports){var MAX_ASCII_CHAR_CODE=127;module.exports=function isAscii(str){for(var i=0,strLen=str.length;i<strLen;++i){if(str.charCodeAt(i)>MAX_ASCII_CHAR_CODE)return!1}
return!0}},{}],307:[function(require,module,exports){'use strict';var fs=require('fs');module.exports=function isFile(path,cb){if(!cb)return isFileSync(path);fs.stat(path,function(err,stats){if(err)return cb(err);return cb(null,stats.isFile())})};module.exports.sync=isFileSync;function isFileSync(path){return fs.existsSync(path)&&fs.statSync(path).isFile()}},{"fs":1}],308:[function(require,module,exports){module.exports=isTypedArray
isTypedArray.strict=isStrictTypedArray
isTypedArray.loose=isLooseTypedArray
var toString=Object.prototype.toString
var names={'[object Int8Array]':!0,'[object Int16Array]':!0,'[object Int32Array]':!0,'[object Uint8Array]':!0,'[object Uint8ClampedArray]':!0,'[object Uint16Array]':!0,'[object Uint32Array]':!0,'[object Float32Array]':!0,'[object Float64Array]':!0}
function isTypedArray(arr){return(isStrictTypedArray(arr)||isLooseTypedArray(arr))}
function isStrictTypedArray(arr){return(arr instanceof Int8Array||arr instanceof Int16Array||arr instanceof Int32Array||arr instanceof Uint8Array||arr instanceof Uint8ClampedArray||arr instanceof Uint16Array||arr instanceof Uint32Array||arr instanceof Float32Array||arr instanceof Float64Array)}
function isLooseTypedArray(arr){return names[toString.call(arr)]}},{}],309:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=='[object Array]'}},{}],310:[function(require,module,exports){'use strict';exports.regex=exports.re=/^npm-debug\.log$|^\..*\.swp$|^\.DS_Store$|^\.AppleDouble$|^\.LSOverride$|^Icon\r$|^\._.*|^\.Spotlight-V100(?:$|\/)|\.Trashes|^__MACOSX$|~$|^Thumbs\.db$|^ehthumbs\.db$|^Desktop\.ini$|^@eaDir$/;exports.is=filename=>exports.re.test(filename);exports.not=filename=>!exports.is(filename)},{}],311:[function(require,module,exports){(function(Buffer){module.exports=magnetURIDecode
module.exports.decode=magnetURIDecode
module.exports.encode=magnetURIEncode
const base32=require('thirty-two')
const uniq=require('uniq')
function magnetURIDecode(uri){const result={}
const data=uri.split('magnet:?')[1]
const params=(data&&data.length>=0)?data.split('&'):[]
params.forEach(param=>{const keyval=param.split('=')
if(keyval.length!==2)return
const key=keyval[0]
let val=keyval[1]
if(key==='dn')val=decodeURIComponent(val).replace(/\+/g,' ')
if(key==='tr'||key==='xs'||key==='as'||key==='ws'){val=decodeURIComponent(val)}
if(key==='kt')val=decodeURIComponent(val).split('+')
if(key==='ix')val=Number(val)
if(result[key]){if(Array.isArray(result[key])){result[key].push(val)}else{const old=result[key]
result[key]=[old,val]}}else{result[key]=val}})
let m
if(result.xt){const xts=Array.isArray(result.xt)?result.xt:[result.xt]
xts.forEach(xt=>{if((m=xt.match(/^urn:btih:(.{40})/))){result.infoHash=m[1].toLowerCase()}else if((m=xt.match(/^urn:btih:(.{32})/))){const decodedStr=base32.decode(m[1])
result.infoHash=Buffer.from(decodedStr,'binary').toString('hex')}})}
if(result.infoHash)result.infoHashBuffer=Buffer.from(result.infoHash,'hex')
if(result.dn)result.name=result.dn
if(result.kt)result.keywords=result.kt
if(typeof result.tr==='string')result.announce=[result.tr]
else if(Array.isArray(result.tr))result.announce=result.tr
else result.announce=[]
result.urlList=[]
if(typeof result.as==='string'||Array.isArray(result.as)){result.urlList=result.urlList.concat(result.as)}
if(typeof result.ws==='string'||Array.isArray(result.ws)){result.urlList=result.urlList.concat(result.ws)}
uniq(result.announce)
uniq(result.urlList)
return result}
function magnetURIEncode(obj){obj=Object.assign({},obj)
if(obj.infoHashBuffer)obj.xt=`urn:btih:${obj.infoHashBuffer.toString('hex')}`
if(obj.infoHash)obj.xt=`urn:btih:${obj.infoHash}`
if(obj.name)obj.dn=obj.name
if(obj.keywords)obj.kt=obj.keywords
if(obj.announce)obj.tr=obj.announce
if(obj.urlList){obj.ws=obj.urlList
delete obj.as}
let result='magnet:?'
Object.keys(obj).filter(key=>key.length===2).forEach((key,i)=>{const values=Array.isArray(obj[key])?obj[key]:[obj[key]]
values.forEach((val,j)=>{if((i>0||j>0)&&(key!=='kt'||j===0))result+='&'
if(key==='dn')val=encodeURIComponent(val).replace(/%20/g,'+')
if(key==='tr'||key==='xs'||key==='as'||key==='ws'){val=encodeURIComponent(val)}
if(key==='kt')val=encodeURIComponent(val)
if(key==='kt'&&j>0)result+=`+${val}`
else result+=`${key}=${val}`})})
return result}}).call(this,require("buffer").Buffer)},{"buffer":54,"thirty-two":453,"uniq":460}],312:[function(require,module,exports){module.exports=MediaElementWrapper
var inherits=require('inherits')
var stream=require('readable-stream')
var toArrayBuffer=require('to-arraybuffer')
var MediaSource=typeof window!=='undefined'&&window.MediaSource
var DEFAULT_BUFFER_DURATION=60
function MediaElementWrapper(elem,opts){var self=this
if(!(self instanceof MediaElementWrapper))return new MediaElementWrapper(elem,opts)
if(!MediaSource)throw new Error('web browser lacks MediaSource support')
if(!opts)opts={}
self._debug=opts.debug
self._bufferDuration=opts.bufferDuration||DEFAULT_BUFFER_DURATION
self._elem=elem
self._mediaSource=new MediaSource()
self._streams=[]
self.detailedError=null
self._errorHandler=function(){self._elem.removeEventListener('error',self._errorHandler)
var streams=self._streams.slice()
streams.forEach(function(stream){stream.destroy(self._elem.error)})}
self._elem.addEventListener('error',self._errorHandler)
self._elem.src=window.URL.createObjectURL(self._mediaSource)}
MediaElementWrapper.prototype.createWriteStream=function(obj){var self=this
return new MediaSourceStream(self,obj)}
MediaElementWrapper.prototype.error=function(err){var self=this
if(!self.detailedError){self.detailedError=err}
self._dumpDebugData()
try{self._mediaSource.endOfStream('decode')}catch(err){}
try{window.URL.revokeObjectURL(self._elem.src)}catch(err){}}
MediaElementWrapper.prototype._dumpDebugData=function(){var self=this
if(self._debug){self._debug=!1
self._streams.forEach(function(stream,i){downloadBuffers(stream._debugBuffers,'mediasource-stream-'+i)})}}
inherits(MediaSourceStream,stream.Writable)
function MediaSourceStream(wrapper,obj){var self=this
stream.Writable.call(self)
self._wrapper=wrapper
self._elem=wrapper._elem
self._mediaSource=wrapper._mediaSource
self._allStreams=wrapper._streams
self._allStreams.push(self)
self._bufferDuration=wrapper._bufferDuration
self._sourceBuffer=null
self._debugBuffers=[]
self._openHandler=function(){self._onSourceOpen()}
self._flowHandler=function(){self._flow()}
self._errorHandler=function(err){if(!self.destroyed){self.emit('error',err)}}
if(typeof obj==='string'){self._type=obj
if(self._mediaSource.readyState==='open'){self._createSourceBuffer()}else{self._mediaSource.addEventListener('sourceopen',self._openHandler)}}else if(obj._sourceBuffer===null){obj.destroy()
self._type=obj._type
self._mediaSource.addEventListener('sourceopen',self._openHandler)}else if(obj._sourceBuffer){obj.destroy()
self._type=obj._type
self._sourceBuffer=obj._sourceBuffer
self._debugBuffers=obj._debugBuffers
self._sourceBuffer.addEventListener('updateend',self._flowHandler)
self._sourceBuffer.addEventListener('error',self._errorHandler)}else{throw new Error('The argument to MediaElementWrapper.createWriteStream must be a string or a previous stream returned from that function')}
self._elem.addEventListener('timeupdate',self._flowHandler)
self.on('error',function(err){self._wrapper.error(err)})
self.on('finish',function(){if(self.destroyed)return
self._finished=!0
if(self._allStreams.every(function(other){return other._finished})){self._wrapper._dumpDebugData()
try{self._mediaSource.endOfStream()}catch(err){}}})}
MediaSourceStream.prototype._onSourceOpen=function(){var self=this
if(self.destroyed)return
self._mediaSource.removeEventListener('sourceopen',self._openHandler)
self._createSourceBuffer()}
MediaSourceStream.prototype.destroy=function(err){var self=this
if(self.destroyed)return
self.destroyed=!0
self._allStreams.splice(self._allStreams.indexOf(self),1)
self._mediaSource.removeEventListener('sourceopen',self._openHandler)
self._elem.removeEventListener('timeupdate',self._flowHandler)
if(self._sourceBuffer){self._sourceBuffer.removeEventListener('updateend',self._flowHandler)
self._sourceBuffer.removeEventListener('error',self._errorHandler)
if(self._mediaSource.readyState==='open'){self._sourceBuffer.abort()}}
if(err)self.emit('error',err)
self.emit('close')}
MediaSourceStream.prototype._createSourceBuffer=function(){var self=this
if(self.destroyed)return
if(MediaSource.isTypeSupported(self._type)){self._sourceBuffer=self._mediaSource.addSourceBuffer(self._type)
self._sourceBuffer.addEventListener('updateend',self._flowHandler)
self._sourceBuffer.addEventListener('error',self._errorHandler)
if(self._cb){var cb=self._cb
self._cb=null
cb()}}else{self.destroy(new Error('The provided type is not supported'))}}
MediaSourceStream.prototype._write=function(chunk,encoding,cb){var self=this
if(self.destroyed)return
if(!self._sourceBuffer){self._cb=function(err){if(err)return cb(err)
self._write(chunk,encoding,cb)}
return}
if(self._sourceBuffer.updating){return cb(new Error('Cannot append buffer while source buffer updating'))}
var arr=toArrayBuffer(chunk)
if(self._wrapper._debug){self._debugBuffers.push(arr)}
try{self._sourceBuffer.appendBuffer(arr)}catch(err){self.destroy(err)
return}
self._cb=cb}
MediaSourceStream.prototype._flow=function(){var self=this
if(self.destroyed||!self._sourceBuffer||self._sourceBuffer.updating){return}
if(self._mediaSource.readyState==='open'){if(self._getBufferDuration()>self._bufferDuration){return}}
if(self._cb){var cb=self._cb
self._cb=null
cb()}}
var EPSILON=0
MediaSourceStream.prototype._getBufferDuration=function(){var self=this
var buffered=self._sourceBuffer.buffered
var currentTime=self._elem.currentTime
var bufferEnd=-1
for(var i=0;i<buffered.length;i++){var start=buffered.start(i)
var end=buffered.end(i)+EPSILON
if(start>currentTime){break}else if(bufferEnd>=0||currentTime<=end){bufferEnd=end}}
var bufferedTime=bufferEnd-currentTime
if(bufferedTime<0){bufferedTime=0}
return bufferedTime}
function downloadBuffers(bufs,name){var a=document.createElement('a')
a.href=window.URL.createObjectURL(new window.Blob(bufs))
a.download=name
a.click()}},{"inherits":305,"readable-stream":326,"to-arraybuffer":455}],313:[function(require,module,exports){arguments[4][250][0].apply(exports,arguments)},{"dup":250}],314:[function(require,module,exports){arguments[4][251][0].apply(exports,arguments)},{"_process":139,"dup":251}],315:[function(require,module,exports){arguments[4][252][0].apply(exports,arguments)},{"./_stream_readable":317,"./_stream_writable":319,"_process":139,"dup":252,"inherits":305}],316:[function(require,module,exports){arguments[4][253][0].apply(exports,arguments)},{"./_stream_transform":318,"dup":253,"inherits":305}],317:[function(require,module,exports){arguments[4][254][0].apply(exports,arguments)},{"../errors":313,"../experimentalWarning":314,"./_stream_duplex":315,"./internal/streams/async_iterator":320,"./internal/streams/buffer_list":321,"./internal/streams/destroy":322,"./internal/streams/state":324,"./internal/streams/stream":325,"_process":139,"buffer":54,"dup":254,"events":90,"inherits":305,"string_decoder/":327,"util":23}],318:[function(require,module,exports){arguments[4][255][0].apply(exports,arguments)},{"../errors":313,"./_stream_duplex":315,"dup":255,"inherits":305}],319:[function(require,module,exports){arguments[4][256][0].apply(exports,arguments)},{"../errors":313,"./_stream_duplex":315,"./internal/streams/destroy":322,"./internal/streams/state":324,"./internal/streams/stream":325,"_process":139,"buffer":54,"dup":256,"inherits":305,"util-deprecate":467}],320:[function(require,module,exports){arguments[4][257][0].apply(exports,arguments)},{"./end-of-stream":323,"_process":139,"dup":257}],321:[function(require,module,exports){arguments[4][258][0].apply(exports,arguments)},{"buffer":54,"dup":258,"util":23}],322:[function(require,module,exports){arguments[4][259][0].apply(exports,arguments)},{"_process":139,"dup":259}],323:[function(require,module,exports){arguments[4][260][0].apply(exports,arguments)},{"../../../errors":313,"dup":260}],324:[function(require,module,exports){arguments[4][261][0].apply(exports,arguments)},{"../../../errors":313,"dup":261}],325:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],326:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":315,"./lib/_stream_passthrough.js":316,"./lib/_stream_readable.js":317,"./lib/_stream_transform.js":318,"./lib/_stream_writable.js":319,"dup":208}],327:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],328:[function(require,module,exports){(function(process){module.exports=Storage
function Storage(chunkLength,opts){if(!(this instanceof Storage))return new Storage(chunkLength,opts)
if(!opts)opts={}
this.chunkLength=Number(chunkLength)
if(!this.chunkLength)throw new Error('First argument must be a chunk length')
this.chunks=[]
this.closed=!1
this.length=Number(opts.length)||Infinity
if(this.length!==Infinity){this.lastChunkLength=(this.length%this.chunkLength)||this.chunkLength
this.lastChunkIndex=Math.ceil(this.length/this.chunkLength)-1}}
Storage.prototype.put=function(index,buf,cb){if(this.closed)return nextTick(cb,new Error('Storage is closed'))
var isLastChunk=(index===this.lastChunkIndex)
if(isLastChunk&&buf.length!==this.lastChunkLength){return nextTick(cb,new Error('Last chunk length must be '+this.lastChunkLength))}
if(!isLastChunk&&buf.length!==this.chunkLength){return nextTick(cb,new Error('Chunk length must be '+this.chunkLength))}
this.chunks[index]=buf
nextTick(cb,null)}
Storage.prototype.get=function(index,opts,cb){if(typeof opts==='function')return this.get(index,null,opts)
if(this.closed)return nextTick(cb,new Error('Storage is closed'))
var buf=this.chunks[index]
if(!buf){var err=new Error('Chunk not found')
err.notFound=!0
return nextTick(cb,err)}
if(!opts)return nextTick(cb,null,buf)
var offset=opts.offset||0
var len=opts.length||(buf.length-offset)
nextTick(cb,null,buf.slice(offset,len+offset))}
Storage.prototype.close=Storage.prototype.destroy=function(cb){if(this.closed)return nextTick(cb,new Error('Storage is closed'))
this.closed=!0
this.chunks=null
nextTick(cb,null)}
function nextTick(cb,err,val){process.nextTick(function(){if(cb)cb(err,val)})}}).call(this,require('_process'))},{"_process":139}],329:[function(require,module,exports){var Box=require('./index')
var Descriptor=require('./descriptor')
var bufferAlloc=require('buffer-alloc')
var bufferFrom=require('buffer-from')
var uint64be=require('uint64be')
var TIME_OFFSET=2082844800000
exports.fullBoxes={}
var fullBoxes=['mvhd','tkhd','mdhd','vmhd','smhd','stsd','esds','stsz','stco','co64','stss','stts','ctts','stsc','dref','elst','hdlr','mehd','trex','mfhd','tfhd','tfdt','trun']
fullBoxes.forEach(function(type){exports.fullBoxes[type]=!0})
exports.ftyp={}
exports.ftyp.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(exports.ftyp.encodingLength(box))
var brands=box.compatibleBrands||[]
buf.write(box.brand,0,4,'ascii')
buf.writeUInt32BE(box.brandVersion,4)
for(var i=0;i<brands.length;i++)buf.write(brands[i],8+(i*4),4,'ascii')
exports.ftyp.encode.bytes=8+brands.length*4
return buf}
exports.ftyp.decode=function(buf,offset){buf=buf.slice(offset)
var brand=buf.toString('ascii',0,4)
var version=buf.readUInt32BE(4)
var compatibleBrands=[]
for(var i=8;i<buf.length;i+=4)compatibleBrands.push(buf.toString('ascii',i,i+4))
return{brand:brand,brandVersion:version,compatibleBrands:compatibleBrands}}
exports.ftyp.encodingLength=function(box){return 8+(box.compatibleBrands||[]).length*4}
exports.mvhd={}
exports.mvhd.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(96)
writeDate(box.ctime||new Date(),buf,0)
writeDate(box.mtime||new Date(),buf,4)
buf.writeUInt32BE(box.timeScale||0,8)
buf.writeUInt32BE(box.duration||0,12)
writeFixed32(box.preferredRate||0,buf,16)
writeFixed16(box.preferredVolume||0,buf,20)
writeReserved(buf,22,32)
writeMatrix(box.matrix,buf,32)
buf.writeUInt32BE(box.previewTime||0,68)
buf.writeUInt32BE(box.previewDuration||0,72)
buf.writeUInt32BE(box.posterTime||0,76)
buf.writeUInt32BE(box.selectionTime||0,80)
buf.writeUInt32BE(box.selectionDuration||0,84)
buf.writeUInt32BE(box.currentTime||0,88)
buf.writeUInt32BE(box.nextTrackId||0,92)
exports.mvhd.encode.bytes=96
return buf}
exports.mvhd.decode=function(buf,offset){buf=buf.slice(offset)
return{ctime:readDate(buf,0),mtime:readDate(buf,4),timeScale:buf.readUInt32BE(8),duration:buf.readUInt32BE(12),preferredRate:readFixed32(buf,16),preferredVolume:readFixed16(buf,20),matrix:readMatrix(buf.slice(32,68)),previewTime:buf.readUInt32BE(68),previewDuration:buf.readUInt32BE(72),posterTime:buf.readUInt32BE(76),selectionTime:buf.readUInt32BE(80),selectionDuration:buf.readUInt32BE(84),currentTime:buf.readUInt32BE(88),nextTrackId:buf.readUInt32BE(92)}}
exports.mvhd.encodingLength=function(box){return 96}
exports.tkhd={}
exports.tkhd.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(80)
writeDate(box.ctime||new Date(),buf,0)
writeDate(box.mtime||new Date(),buf,4)
buf.writeUInt32BE(box.trackId||0,8)
writeReserved(buf,12,16)
buf.writeUInt32BE(box.duration||0,16)
writeReserved(buf,20,28)
buf.writeUInt16BE(box.layer||0,28)
buf.writeUInt16BE(box.alternateGroup||0,30)
buf.writeUInt16BE(box.volume||0,32)
writeMatrix(box.matrix,buf,36)
buf.writeUInt32BE(box.trackWidth||0,72)
buf.writeUInt32BE(box.trackHeight||0,76)
exports.tkhd.encode.bytes=80
return buf}
exports.tkhd.decode=function(buf,offset){buf=buf.slice(offset)
return{ctime:readDate(buf,0),mtime:readDate(buf,4),trackId:buf.readUInt32BE(8),duration:buf.readUInt32BE(16),layer:buf.readUInt16BE(28),alternateGroup:buf.readUInt16BE(30),volume:buf.readUInt16BE(32),matrix:readMatrix(buf.slice(36,72)),trackWidth:buf.readUInt32BE(72),trackHeight:buf.readUInt32BE(76)}}
exports.tkhd.encodingLength=function(box){return 80}
exports.mdhd={}
exports.mdhd.encode=function(box,buf,offset){if(box.version===1){buf=buf?buf.slice(offset):bufferAlloc(32)
writeDate64(box.ctime||new Date(),buf,0)
writeDate64(box.mtime||new Date(),buf,8)
buf.writeUInt32BE(box.timeScale||0,16)
buf.writeUIntBE(box.duration||0,20,6)
buf.writeUInt16BE(box.language||0,28)
buf.writeUInt16BE(box.quality||0,30)
exports.mdhd.encode.bytes=32
return buf}
buf=buf?buf.slice(offset):bufferAlloc(20)
writeDate(box.ctime||new Date(),buf,0)
writeDate(box.mtime||new Date(),buf,4)
buf.writeUInt32BE(box.timeScale||0,8)
buf.writeUInt32BE(box.duration||0,12)
buf.writeUInt16BE(box.language||0,16)
buf.writeUInt16BE(box.quality||0,18)
exports.mdhd.encode.bytes=20
return buf}
exports.mdhd.decode=function(buf,offset,end){buf=buf.slice(offset)
var version1=(end-offset)!==20
if(version1){return{ctime:readDate64(buf,0),mtime:readDate64(buf,8),timeScale:buf.readUInt32BE(16),duration:buf.readUIntBE(20,6),language:buf.readUInt16BE(28),quality:buf.readUInt16BE(30)}}
return{ctime:readDate(buf,0),mtime:readDate(buf,4),timeScale:buf.readUInt32BE(8),duration:buf.readUInt32BE(12),language:buf.readUInt16BE(16),quality:buf.readUInt16BE(18)}}
exports.mdhd.encodingLength=function(box){if(box.version===1)return 32
return 20}
exports.vmhd={}
exports.vmhd.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(8)
buf.writeUInt16BE(box.graphicsMode||0,0)
var opcolor=box.opcolor||[0,0,0]
buf.writeUInt16BE(opcolor[0],2)
buf.writeUInt16BE(opcolor[1],4)
buf.writeUInt16BE(opcolor[2],6)
exports.vmhd.encode.bytes=8
return buf}
exports.vmhd.decode=function(buf,offset){buf=buf.slice(offset)
return{graphicsMode:buf.readUInt16BE(0),opcolor:[buf.readUInt16BE(2),buf.readUInt16BE(4),buf.readUInt16BE(6)]}}
exports.vmhd.encodingLength=function(box){return 8}
exports.smhd={}
exports.smhd.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(4)
buf.writeUInt16BE(box.balance||0,0)
writeReserved(buf,2,4)
exports.smhd.encode.bytes=4
return buf}
exports.smhd.decode=function(buf,offset){buf=buf.slice(offset)
return{balance:buf.readUInt16BE(0)}}
exports.smhd.encodingLength=function(box){return 4}
exports.stsd={}
exports.stsd.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(exports.stsd.encodingLength(box))
var entries=box.entries||[]
buf.writeUInt32BE(entries.length,0)
var ptr=4
for(var i=0;i<entries.length;i++){var entry=entries[i]
Box.encode(entry,buf,ptr)
ptr+=Box.encode.bytes}
exports.stsd.encode.bytes=ptr
return buf}
exports.stsd.decode=function(buf,offset,end){buf=buf.slice(offset)
var num=buf.readUInt32BE(0)
var entries=new Array(num)
var ptr=4
for(var i=0;i<num;i++){var entry=Box.decode(buf,ptr,end)
entries[i]=entry
ptr+=entry.length}
return{entries:entries}}
exports.stsd.encodingLength=function(box){var totalSize=4
if(!box.entries)return totalSize
for(var i=0;i<box.entries.length;i++){totalSize+=Box.encodingLength(box.entries[i])}
return totalSize}
exports.avc1=exports.VisualSampleEntry={}
exports.VisualSampleEntry.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(exports.VisualSampleEntry.encodingLength(box))
writeReserved(buf,0,6)
buf.writeUInt16BE(box.dataReferenceIndex||0,6)
writeReserved(buf,8,24)
buf.writeUInt16BE(box.width||0,24)
buf.writeUInt16BE(box.height||0,26)
buf.writeUInt32BE(box.hResolution||0x480000,28)
buf.writeUInt32BE(box.vResolution||0x480000,32)
writeReserved(buf,36,40)
buf.writeUInt16BE(box.frameCount||1,40)
var compressorName=box.compressorName||''
var nameLen=Math.min(compressorName.length,31)
buf.writeUInt8(nameLen,42)
buf.write(compressorName,43,nameLen,'utf8')
buf.writeUInt16BE(box.depth||0x18,74)
buf.writeInt16BE(-1,76)
var ptr=78
var children=box.children||[]
children.forEach(function(child){Box.encode(child,buf,ptr)
ptr+=Box.encode.bytes})
exports.VisualSampleEntry.encode.bytes=ptr}
exports.VisualSampleEntry.decode=function(buf,offset,end){buf=buf.slice(offset)
var length=end-offset
var nameLen=Math.min(buf.readUInt8(42),31)
var box={dataReferenceIndex:buf.readUInt16BE(6),width:buf.readUInt16BE(24),height:buf.readUInt16BE(26),hResolution:buf.readUInt32BE(28),vResolution:buf.readUInt32BE(32),frameCount:buf.readUInt16BE(40),compressorName:buf.toString('utf8',43,43+nameLen),depth:buf.readUInt16BE(74),children:[]}
var ptr=78
while(length-ptr>=8){var child=Box.decode(buf,ptr,length)
box.children.push(child)
box[child.type]=child
ptr+=child.length}
return box}
exports.VisualSampleEntry.encodingLength=function(box){var len=78
var children=box.children||[]
children.forEach(function(child){len+=Box.encodingLength(child)})
return len}
exports.avcC={}
exports.avcC.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(box.buffer.length)
box.buffer.copy(buf)
exports.avcC.encode.bytes=box.buffer.length}
exports.avcC.decode=function(buf,offset,end){buf=buf.slice(offset,end)
return{mimeCodec:buf.toString('hex',1,4),buffer:bufferFrom(buf)}}
exports.avcC.encodingLength=function(box){return box.buffer.length}
exports.mp4a=exports.AudioSampleEntry={}
exports.AudioSampleEntry.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(exports.AudioSampleEntry.encodingLength(box))
writeReserved(buf,0,6)
buf.writeUInt16BE(box.dataReferenceIndex||0,6)
writeReserved(buf,8,16)
buf.writeUInt16BE(box.channelCount||2,16)
buf.writeUInt16BE(box.sampleSize||16,18)
writeReserved(buf,20,24)
buf.writeUInt32BE(box.sampleRate||0,24)
var ptr=28
var children=box.children||[]
children.forEach(function(child){Box.encode(child,buf,ptr)
ptr+=Box.encode.bytes})
exports.AudioSampleEntry.encode.bytes=ptr}
exports.AudioSampleEntry.decode=function(buf,offset,end){buf=buf.slice(offset,end)
var length=end-offset
var box={dataReferenceIndex:buf.readUInt16BE(6),channelCount:buf.readUInt16BE(16),sampleSize:buf.readUInt16BE(18),sampleRate:buf.readUInt32BE(24),children:[]}
var ptr=28
while(length-ptr>=8){var child=Box.decode(buf,ptr,length)
box.children.push(child)
box[child.type]=child
ptr+=child.length}
return box}
exports.AudioSampleEntry.encodingLength=function(box){var len=28
var children=box.children||[]
children.forEach(function(child){len+=Box.encodingLength(child)})
return len}
exports.esds={}
exports.esds.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(box.buffer.length)
box.buffer.copy(buf,0)
exports.esds.encode.bytes=box.buffer.length}
exports.esds.decode=function(buf,offset,end){buf=buf.slice(offset,end)
var desc=Descriptor.Descriptor.decode(buf,0,buf.length)
var esd=(desc.tagName==='ESDescriptor')?desc:{}
var dcd=esd.DecoderConfigDescriptor||{}
var oti=dcd.oti||0
var dsi=dcd.DecoderSpecificInfo
var audioConfig=dsi?(dsi.buffer.readUInt8(0)&0xf8)>>3:0
var mimeCodec=null
if(oti){mimeCodec=oti.toString(16)
if(audioConfig){mimeCodec+='.'+audioConfig}}
return{mimeCodec:mimeCodec,buffer:bufferFrom(buf.slice(0))}}
exports.esds.encodingLength=function(box){return box.buffer.length}
exports.stsz={}
exports.stsz.encode=function(box,buf,offset){var entries=box.entries||[]
buf=buf?buf.slice(offset):bufferAlloc(exports.stsz.encodingLength(box))
buf.writeUInt32BE(0,0)
buf.writeUInt32BE(entries.length,4)
for(var i=0;i<entries.length;i++){buf.writeUInt32BE(entries[i],i*4+8)}
exports.stsz.encode.bytes=8+entries.length*4
return buf}
exports.stsz.decode=function(buf,offset){buf=buf.slice(offset)
var size=buf.readUInt32BE(0)
var num=buf.readUInt32BE(4)
var entries=new Array(num)
for(var i=0;i<num;i++){if(size===0){entries[i]=buf.readUInt32BE(i*4+8)}else{entries[i]=size}}
return{entries:entries}}
exports.stsz.encodingLength=function(box){return 8+box.entries.length*4}
exports.stss=exports.stco={}
exports.stco.encode=function(box,buf,offset){var entries=box.entries||[]
buf=buf?buf.slice(offset):bufferAlloc(exports.stco.encodingLength(box))
buf.writeUInt32BE(entries.length,0)
for(var i=0;i<entries.length;i++){buf.writeUInt32BE(entries[i],i*4+4)}
exports.stco.encode.bytes=4+entries.length*4
return buf}
exports.stco.decode=function(buf,offset){buf=buf.slice(offset)
var num=buf.readUInt32BE(0)
var entries=new Array(num)
for(var i=0;i<num;i++){entries[i]=buf.readUInt32BE(i*4+4)}
return{entries:entries}}
exports.stco.encodingLength=function(box){return 4+box.entries.length*4}
exports.co64={}
exports.co64.encode=function(box,buf,offset){var entries=box.entries||[]
buf=buf?buf.slice(offset):bufferAlloc(exports.co64.encodingLength(box))
buf.writeUInt32BE(entries.length,0)
for(var i=0;i<entries.length;i++){uint64be.encode(entries[i],buf,i*8+4)}
exports.co64.encode.bytes=4+entries.length*8
return buf}
exports.co64.decode=function(buf,offset){buf=buf.slice(offset)
var num=buf.readUInt32BE(0)
var entries=new Array(num)
for(var i=0;i<num;i++){entries[i]=uint64be.decode(buf,i*8+4)}
return{entries:entries}}
exports.co64.encodingLength=function(box){return 4+box.entries.length*8}
exports.stts={}
exports.stts.encode=function(box,buf,offset){var entries=box.entries||[]
buf=buf?buf.slice(offset):bufferAlloc(exports.stts.encodingLength(box))
buf.writeUInt32BE(entries.length,0)
for(var i=0;i<entries.length;i++){var ptr=i*8+4
buf.writeUInt32BE(entries[i].count||0,ptr)
buf.writeUInt32BE(entries[i].duration||0,ptr+4)}
exports.stts.encode.bytes=4+box.entries.length*8
return buf}
exports.stts.decode=function(buf,offset){buf=buf.slice(offset)
var num=buf.readUInt32BE(0)
var entries=new Array(num)
for(var i=0;i<num;i++){var ptr=i*8+4
entries[i]={count:buf.readUInt32BE(ptr),duration:buf.readUInt32BE(ptr+4)}}
return{entries:entries}}
exports.stts.encodingLength=function(box){return 4+box.entries.length*8}
exports.ctts={}
exports.ctts.encode=function(box,buf,offset){var entries=box.entries||[]
buf=buf?buf.slice(offset):bufferAlloc(exports.ctts.encodingLength(box))
buf.writeUInt32BE(entries.length,0)
for(var i=0;i<entries.length;i++){var ptr=i*8+4
buf.writeUInt32BE(entries[i].count||0,ptr)
buf.writeUInt32BE(entries[i].compositionOffset||0,ptr+4)}
exports.ctts.encode.bytes=4+entries.length*8
return buf}
exports.ctts.decode=function(buf,offset){buf=buf.slice(offset)
var num=buf.readUInt32BE(0)
var entries=new Array(num)
for(var i=0;i<num;i++){var ptr=i*8+4
entries[i]={count:buf.readUInt32BE(ptr),compositionOffset:buf.readInt32BE(ptr+4)}}
return{entries:entries}}
exports.ctts.encodingLength=function(box){return 4+box.entries.length*8}
exports.stsc={}
exports.stsc.encode=function(box,buf,offset){var entries=box.entries||[]
buf=buf?buf.slice(offset):bufferAlloc(exports.stsc.encodingLength(box))
buf.writeUInt32BE(entries.length,0)
for(var i=0;i<entries.length;i++){var ptr=i*12+4
buf.writeUInt32BE(entries[i].firstChunk||0,ptr)
buf.writeUInt32BE(entries[i].samplesPerChunk||0,ptr+4)
buf.writeUInt32BE(entries[i].sampleDescriptionId||0,ptr+8)}
exports.stsc.encode.bytes=4+entries.length*12
return buf}
exports.stsc.decode=function(buf,offset){buf=buf.slice(offset)
var num=buf.readUInt32BE(0)
var entries=new Array(num)
for(var i=0;i<num;i++){var ptr=i*12+4
entries[i]={firstChunk:buf.readUInt32BE(ptr),samplesPerChunk:buf.readUInt32BE(ptr+4),sampleDescriptionId:buf.readUInt32BE(ptr+8)}}
return{entries:entries}}
exports.stsc.encodingLength=function(box){return 4+box.entries.length*12}
exports.dref={}
exports.dref.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(exports.dref.encodingLength(box))
var entries=box.entries||[]
buf.writeUInt32BE(entries.length,0)
var ptr=4
for(var i=0;i<entries.length;i++){var entry=entries[i]
var size=(entry.buf?entry.buf.length:0)+4+4
buf.writeUInt32BE(size,ptr)
ptr+=4
buf.write(entry.type,ptr,4,'ascii')
ptr+=4
if(entry.buf){entry.buf.copy(buf,ptr)
ptr+=entry.buf.length}}
exports.dref.encode.bytes=ptr
return buf}
exports.dref.decode=function(buf,offset){buf=buf.slice(offset)
var num=buf.readUInt32BE(0)
var entries=new Array(num)
var ptr=4
for(var i=0;i<num;i++){var size=buf.readUInt32BE(ptr)
var type=buf.toString('ascii',ptr+4,ptr+8)
var tmp=buf.slice(ptr+8,ptr+size)
ptr+=size
entries[i]={type:type,buf:tmp}}
return{entries:entries}}
exports.dref.encodingLength=function(box){var totalSize=4
if(!box.entries)return totalSize
for(var i=0;i<box.entries.length;i++){var buf=box.entries[i].buf
totalSize+=(buf?buf.length:0)+4+4}
return totalSize}
exports.elst={}
exports.elst.encode=function(box,buf,offset){var entries=box.entries||[]
buf=buf?buf.slice(offset):bufferAlloc(exports.elst.encodingLength(box))
buf.writeUInt32BE(entries.length,0)
for(var i=0;i<entries.length;i++){var ptr=i*12+4
buf.writeUInt32BE(entries[i].trackDuration||0,ptr)
buf.writeUInt32BE(entries[i].mediaTime||0,ptr+4)
writeFixed32(entries[i].mediaRate||0,buf,ptr+8)}
exports.elst.encode.bytes=4+entries.length*12
return buf}
exports.elst.decode=function(buf,offset){buf=buf.slice(offset)
var num=buf.readUInt32BE(0)
var entries=new Array(num)
for(var i=0;i<num;i++){var ptr=i*12+4
entries[i]={trackDuration:buf.readUInt32BE(ptr),mediaTime:buf.readInt32BE(ptr+4),mediaRate:readFixed32(buf,ptr+8)}}
return{entries:entries}}
exports.elst.encodingLength=function(box){return 4+box.entries.length*12}
exports.hdlr={}
exports.hdlr.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(exports.hdlr.encodingLength(box))
var len=21+(box.name||'').length
buf.fill(0,0,len)
buf.write(box.handlerType||'',4,4,'ascii')
writeString(box.name||'',buf,20)
exports.hdlr.encode.bytes=len
return buf}
exports.hdlr.decode=function(buf,offset,end){buf=buf.slice(offset)
return{handlerType:buf.toString('ascii',4,8),name:readString(buf,20,end)}}
exports.hdlr.encodingLength=function(box){return 21+(box.name||'').length}
exports.mehd={}
exports.mehd.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(4)
buf.writeUInt32BE(box.fragmentDuration||0,0)
exports.mehd.encode.bytes=4
return buf}
exports.mehd.decode=function(buf,offset){buf=buf.slice(offset)
return{fragmentDuration:buf.readUInt32BE(0)}}
exports.mehd.encodingLength=function(box){return 4}
exports.trex={}
exports.trex.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(20)
buf.writeUInt32BE(box.trackId||0,0)
buf.writeUInt32BE(box.defaultSampleDescriptionIndex||0,4)
buf.writeUInt32BE(box.defaultSampleDuration||0,8)
buf.writeUInt32BE(box.defaultSampleSize||0,12)
buf.writeUInt32BE(box.defaultSampleFlags||0,16)
exports.trex.encode.bytes=20
return buf}
exports.trex.decode=function(buf,offset){buf=buf.slice(offset)
return{trackId:buf.readUInt32BE(0),defaultSampleDescriptionIndex:buf.readUInt32BE(4),defaultSampleDuration:buf.readUInt32BE(8),defaultSampleSize:buf.readUInt32BE(12),defaultSampleFlags:buf.readUInt32BE(16)}}
exports.trex.encodingLength=function(box){return 20}
exports.mfhd={}
exports.mfhd.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(4)
buf.writeUInt32BE(box.sequenceNumber||0,0)
exports.mfhd.encode.bytes=4
return buf}
exports.mfhd.decode=function(buf,offset){return{sequenceNumber:buf.readUInt32BE(0)}}
exports.mfhd.encodingLength=function(box){return 4}
exports.tfhd={}
exports.tfhd.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(4)
buf.writeUInt32BE(box.trackId,0)
exports.tfhd.encode.bytes=4
return buf}
exports.tfhd.decode=function(buf,offset){}
exports.tfhd.encodingLength=function(box){return 4}
exports.tfdt={}
exports.tfdt.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(4)
buf.writeUInt32BE(box.baseMediaDecodeTime||0,0)
exports.tfdt.encode.bytes=4
return buf}
exports.tfdt.decode=function(buf,offset){}
exports.tfdt.encodingLength=function(box){return 4}
exports.trun={}
exports.trun.encode=function(box,buf,offset){buf=buf?buf.slice(offset):bufferAlloc(8+box.entries.length*16)
buf.writeUInt32BE(box.entries.length,0)
buf.writeInt32BE(box.dataOffset,4)
var ptr=8
for(var i=0;i<box.entries.length;i++){var entry=box.entries[i]
buf.writeUInt32BE(entry.sampleDuration,ptr)
ptr+=4
buf.writeUInt32BE(entry.sampleSize,ptr)
ptr+=4
buf.writeUInt32BE(entry.sampleFlags,ptr)
ptr+=4
if((box.version||0)===0){buf.writeUInt32BE(entry.sampleCompositionTimeOffset,ptr)}else{buf.writeInt32BE(entry.sampleCompositionTimeOffset,ptr)}
ptr+=4}
exports.trun.encode.bytes=ptr}
exports.trun.decode=function(buf,offset){}
exports.trun.encodingLength=function(box){return 8+box.entries.length*16}
exports.mdat={}
exports.mdat.encode=function(box,buf,offset){if(box.buffer){box.buffer.copy(buf,offset)
exports.mdat.encode.bytes=box.buffer.length}else{exports.mdat.encode.bytes=exports.mdat.encodingLength(box)}}
exports.mdat.decode=function(buf,start,end){return{buffer:bufferFrom(buf.slice(start,end))}}
exports.mdat.encodingLength=function(box){return box.buffer?box.buffer.length:box.contentLength}
function writeReserved(buf,offset,end){for(var i=offset;i<end;i++)buf[i]=0}
function writeDate(date,buf,offset){buf.writeUInt32BE(Math.floor((date.getTime()+TIME_OFFSET)/1000),offset)}
function writeDate64(date,buf,offset){buf.writeUIntBE(Math.floor((date.getTime()+TIME_OFFSET)/1000),offset,6)}
function writeFixed32(num,buf,offset){buf.writeUInt16BE(Math.floor(num)%(256*256),offset)
buf.writeUInt16BE(Math.floor(num*256*256)%(256*256),offset+2)}
function writeFixed16(num,buf,offset){buf[offset]=Math.floor(num)%256
buf[offset+1]=Math.floor(num*256)%256}
function writeMatrix(list,buf,offset){if(!list)list=[0,0,0,0,0,0,0,0,0]
for(var i=0;i<list.length;i++){writeFixed32(list[i],buf,offset+i*4)}}
function writeString(str,buf,offset){var strBuffer=bufferFrom(str,'utf8')
strBuffer.copy(buf,offset)
buf[offset+strBuffer.length]=0}
function readMatrix(buf){var list=new Array(buf.length/4)
for(var i=0;i<list.length;i++)list[i]=readFixed32(buf,i*4)
return list}
function readDate64(buf,offset){return new Date(buf.readUIntBE(offset,6)*1000-TIME_OFFSET)}
function readDate(buf,offset){return new Date(buf.readUInt32BE(offset)*1000-TIME_OFFSET)}
function readFixed32(buf,offset){return buf.readUInt16BE(offset)+buf.readUInt16BE(offset+2)/(256*256)}
function readFixed16(buf,offset){return buf[offset]+buf[offset+1]/256}
function readString(buf,offset,length){var i
for(i=0;i<length;i++){if(buf[offset+i]===0){break}}
return buf.toString('utf8',offset,offset+i)}},{"./descriptor":330,"./index":331,"buffer-alloc":232,"buffer-from":234,"uint64be":459}],330:[function(require,module,exports){var bufferFrom=require('buffer-from')
var tagToName={0x03:'ESDescriptor',0x04:'DecoderConfigDescriptor',0x05:'DecoderSpecificInfo',0x06:'SLConfigDescriptor'}
exports.Descriptor={}
exports.Descriptor.decode=function(buf,start,end){var tag=buf.readUInt8(start)
var ptr=start+1
var lenByte
var len=0
do{lenByte=buf.readUInt8(ptr++)
len=(len<<7)|(lenByte&0x7f)}while(lenByte&0x80)
var obj
var tagName=tagToName[tag]
if(exports[tagName]){obj=exports[tagName].decode(buf,ptr,end)}else{obj={buffer:bufferFrom(buf.slice(ptr,ptr+len))}}
obj.tag=tag
obj.tagName=tagName
obj.length=(ptr-start)+len
obj.contentsLen=len
return obj}
exports.DescriptorArray={}
exports.DescriptorArray.decode=function(buf,start,end){var ptr=start
var obj={}
while(ptr+2<=end){var descriptor=exports.Descriptor.decode(buf,ptr,end)
ptr+=descriptor.length
var tagName=tagToName[descriptor.tag]||('Descriptor'+descriptor.tag)
obj[tagName]=descriptor}
return obj}
exports.ESDescriptor={}
exports.ESDescriptor.decode=function(buf,start,end){var flags=buf.readUInt8(start+2)
var ptr=start+3
if(flags&0x80){ptr+=2}
if(flags&0x40){var len=buf.readUInt8(ptr)
ptr+=len+1}
if(flags&0x20){ptr+=2}
return exports.DescriptorArray.decode(buf,ptr,end)}
exports.DecoderConfigDescriptor={}
exports.DecoderConfigDescriptor.decode=function(buf,start,end){var oti=buf.readUInt8(start)
var obj=exports.DescriptorArray.decode(buf,start+13,end)
obj.oti=oti
return obj}},{"buffer-from":234}],331:[function(require,module,exports){var uint64be=require('uint64be')
var bufferAlloc=require('buffer-alloc')
var bufferFrom=require('buffer-from')
var boxes=require('./boxes')
var UINT32_MAX=4294967295
var Box=exports
var containers=exports.containers={'moov':['mvhd','meta','traks','mvex'],'trak':['tkhd','tref','trgr','edts','meta','mdia','udta'],'edts':['elst'],'mdia':['mdhd','hdlr','elng','minf'],'minf':['vmhd','smhd','hmhd','sthd','nmhd','dinf','stbl'],'dinf':['dref'],'stbl':['stsd','stts','ctts','cslg','stsc','stsz','stz2','stco','co64','stss','stsh','padb','stdp','sdtp','sbgps','sgpds','subss','saizs','saios'],'mvex':['mehd','trexs','leva'],'moof':['mfhd','meta','trafs'],'traf':['tfhd','tfdt','trun','sbgps','sgpds','subss','saizs','saios','meta']}
Box.encode=function(obj,buffer,offset){Box.encodingLength(obj)
offset=offset||0
buffer=buffer||bufferAlloc(obj.length)
return Box._encode(obj,buffer,offset)}
Box._encode=function(obj,buffer,offset){var type=obj.type
var len=obj.length
if(len>UINT32_MAX){len=1}
buffer.writeUInt32BE(len,offset)
buffer.write(obj.type,offset+4,4,'ascii')
var ptr=offset+8
if(len===1){uint64be.encode(obj.length,buffer,ptr)
ptr+=8}
if(boxes.fullBoxes[type]){buffer.writeUInt32BE(obj.flags||0,ptr)
buffer.writeUInt8(obj.version||0,ptr)
ptr+=4}
if(containers[type]){var contents=containers[type]
contents.forEach(function(childType){if(childType.length===5){var entry=obj[childType]||[]
childType=childType.substr(0,4)
entry.forEach(function(child){Box._encode(child,buffer,ptr)
ptr+=Box.encode.bytes})}else if(obj[childType]){Box._encode(obj[childType],buffer,ptr)
ptr+=Box.encode.bytes}})
if(obj.otherBoxes){obj.otherBoxes.forEach(function(child){Box._encode(child,buffer,ptr)
ptr+=Box.encode.bytes})}}else if(boxes[type]){var encode=boxes[type].encode
encode(obj,buffer,ptr)
ptr+=encode.bytes}else if(obj.buffer){var buf=obj.buffer
buf.copy(buffer,ptr)
ptr+=obj.buffer.length}else{throw new Error('Either `type` must be set to a known type (not\''+type+'\') or `buffer` must be set')}
Box.encode.bytes=ptr-offset
return buffer}
Box.readHeaders=function(buffer,start,end){start=start||0
end=end||buffer.length
if(end-start<8){return 8}
var len=buffer.readUInt32BE(start)
var type=buffer.toString('ascii',start+4,start+8)
var ptr=start+8
if(len===1){if(end-start<16){return 16}
len=uint64be.decode(buffer,ptr)
ptr+=8}
var version
var flags
if(boxes.fullBoxes[type]){version=buffer.readUInt8(ptr)
flags=buffer.readUInt32BE(ptr)&0xffffff
ptr+=4}
return{length:len,headersLen:ptr-start,contentLen:len-(ptr-start),type:type,version:version,flags:flags}}
Box.decode=function(buffer,start,end){start=start||0
end=end||buffer.length
var headers=Box.readHeaders(buffer,start,end)
if(!headers||headers.length>end-start){throw new Error('Data too short')}
return Box.decodeWithoutHeaders(headers,buffer,start+headers.headersLen,start+headers.length)}
Box.decodeWithoutHeaders=function(headers,buffer,start,end){start=start||0
end=end||buffer.length
var type=headers.type
var obj={}
if(containers[type]){obj.otherBoxes=[]
var contents=containers[type]
var ptr=start
while(end-ptr>=8){var child=Box.decode(buffer,ptr,end)
ptr+=child.length
if(contents.indexOf(child.type)>=0){obj[child.type]=child}else if(contents.indexOf(child.type+'s')>=0){var childType=child.type+'s'
var entry=obj[childType]=obj[childType]||[]
entry.push(child)}else{obj.otherBoxes.push(child)}}}else if(boxes[type]){var decode=boxes[type].decode
obj=decode(buffer,start,end)}else{obj.buffer=bufferFrom(buffer.slice(start,end))}
obj.length=headers.length
obj.contentLen=headers.contentLen
obj.type=headers.type
obj.version=headers.version
obj.flags=headers.flags
return obj}
Box.encodingLength=function(obj){var type=obj.type
var len=8
if(boxes.fullBoxes[type]){len+=4}
if(containers[type]){var contents=containers[type]
contents.forEach(function(childType){if(childType.length===5){var entry=obj[childType]||[]
childType=childType.substr(0,4)
entry.forEach(function(child){child.type=childType
len+=Box.encodingLength(child)})}else if(obj[childType]){var child=obj[childType]
child.type=childType
len+=Box.encodingLength(child)}})
if(obj.otherBoxes){obj.otherBoxes.forEach(function(child){len+=Box.encodingLength(child)})}}else if(boxes[type]){len+=boxes[type].encodingLength(obj)}else if(obj.buffer){len+=obj.buffer.length}else{throw new Error('Either `type` must be set to a known type (not\''+type+'\') or `buffer` must be set')}
if(len>UINT32_MAX){len+=8}
obj.length=len
return len}},{"./boxes":329,"buffer-alloc":232,"buffer-from":234,"uint64be":459}],332:[function(require,module,exports){(function(Buffer){var stream=require('readable-stream')
var inherits=require('inherits')
var nextEvent=require('next-event')
var Box=require('mp4-box-encoding')
var bufferAlloc=require('buffer-alloc')
var EMPTY=bufferAlloc(0)
module.exports=Decoder
function Decoder(){if(!(this instanceof Decoder))return new Decoder()
stream.Writable.call(this)
this.destroyed=!1
this._pending=0
this._missing=0
this._buf=null
this._str=null
this._cb=null
this._ondrain=null
this._writeBuffer=null
this._writeCb=null
this._ondrain=null
this._kick()}
inherits(Decoder,stream.Writable)
Decoder.prototype.destroy=function(err){if(this.destroyed)return
this.destroyed=!0
if(err)this.emit('error',err)
this.emit('close')}
Decoder.prototype._write=function(data,enc,next){if(this.destroyed)return
var drained=!this._str||!this._str._writableState.needDrain
while(data.length&&!this.destroyed){if(!this._missing){this._writeBuffer=data
this._writeCb=next
return}
var consumed=data.length<this._missing?data.length:this._missing
if(this._buf)data.copy(this._buf,this._buf.length-this._missing)
else if(this._str)drained=this._str.write(consumed===data.length?data:data.slice(0,consumed))
this._missing-=consumed
if(!this._missing){var buf=this._buf
var cb=this._cb
var stream=this._str
this._buf=this._cb=this._str=this._ondrain=null
drained=!0
if(stream)stream.end()
if(cb)cb(buf)}
data=consumed===data.length?EMPTY:data.slice(consumed)}
if(this._pending&&!this._missing){this._writeBuffer=data
this._writeCb=next
return}
if(drained)next()
else this._ondrain(next)}
Decoder.prototype._buffer=function(size,cb){this._missing=size
this._buf=bufferAlloc(size)
this._cb=cb}
Decoder.prototype._stream=function(size,cb){var self=this
this._missing=size
this._str=new MediaData(this)
this._ondrain=nextEvent(this._str,'drain')
this._pending++
this._str.on('end',function(){self._pending--
self._kick()})
this._cb=cb
return this._str}
Decoder.prototype._readBox=function(){var self=this
bufferHeaders(8)
function bufferHeaders(len,buf){self._buffer(len,function(additionalBuf){if(buf){buf=Buffer.concat([buf,additionalBuf])}else{buf=additionalBuf}
var headers=Box.readHeaders(buf)
if(typeof headers==='number'){bufferHeaders(headers-buf.length,buf)}else{self._pending++
self._headers=headers
self.emit('box',headers)}})}}
Decoder.prototype.stream=function(){var self=this
if(!self._headers)throw new Error('this function can only be called once after \'box\' is emitted')
var headers=self._headers
self._headers=null
return self._stream(headers.contentLen,null)}
Decoder.prototype.decode=function(cb){var self=this
if(!self._headers)throw new Error('this function can only be called once after \'box\' is emitted')
var headers=self._headers
self._headers=null
self._buffer(headers.contentLen,function(buf){var box=Box.decodeWithoutHeaders(headers,buf)
cb(box)
self._pending--
self._kick()})}
Decoder.prototype.ignore=function(){var self=this
if(!self._headers)throw new Error('this function can only be called once after \'box\' is emitted')
var headers=self._headers
self._headers=null
this._missing=headers.contentLen
this._cb=function(){self._pending--
self._kick()}}
Decoder.prototype._kick=function(){if(this._pending)return
if(!this._buf&&!this._str)this._readBox()
if(this._writeBuffer){var next=this._writeCb
var buffer=this._writeBuffer
this._writeBuffer=null
this._writeCb=null
this._write(buffer,null,next)}}
function MediaData(parent){this._parent=parent
this.destroyed=!1
stream.PassThrough.call(this)}
inherits(MediaData,stream.PassThrough)
MediaData.prototype.destroy=function(err){if(this.destroyed)return
this.destroyed=!0
this._parent.destroy(err)
if(err)this.emit('error',err)
this.emit('close')}}).call(this,require("buffer").Buffer)},{"buffer":54,"buffer-alloc":232,"inherits":305,"mp4-box-encoding":331,"next-event":362,"readable-stream":344}],333:[function(require,module,exports){(function(process){var stream=require('readable-stream')
var inherits=require('inherits')
var Box=require('mp4-box-encoding')
var bufferAlloc=require('buffer-alloc')
module.exports=Encoder
function noop(){}
function Encoder(){if(!(this instanceof Encoder))return new Encoder()
stream.Readable.call(this)
this.destroyed=!1
this._reading=!1
this._stream=null
this._drain=null
this._want=!1
this._onreadable=onreadable
this._onend=onend
var self=this
function onreadable(){if(!self._want)return
self._want=!1
self._read()}
function onend(){self._stream=null}}
inherits(Encoder,stream.Readable)
Encoder.prototype.mediaData=Encoder.prototype.mdat=function(size,cb){var stream=new MediaData(this)
this.box({type:'mdat',contentLength:size,encodeBufferLen:8,stream:stream},cb)
return stream}
Encoder.prototype.box=function(box,cb){if(!cb)cb=noop
if(this.destroyed)return cb(new Error('Encoder is destroyed'))
var buf
if(box.encodeBufferLen){buf=bufferAlloc(box.encodeBufferLen)}
if(box.stream){box.buffer=null
buf=Box.encode(box,buf)
this.push(buf)
this._stream=box.stream
this._stream.on('readable',this._onreadable)
this._stream.on('end',this._onend)
this._stream.on('end',cb)
this._forward()}else{buf=Box.encode(box,buf)
var drained=this.push(buf)
if(drained)return process.nextTick(cb)
this._drain=cb}}
Encoder.prototype.destroy=function(err){if(this.destroyed)return
this.destroyed=!0
if(this._stream&&this._stream.destroy)this._stream.destroy()
this._stream=null
if(this._drain){var cb=this._drain
this._drain=null
cb(err)}
if(err)this.emit('error',err)
this.emit('close')}
Encoder.prototype.finalize=function(){this.push(null)}
Encoder.prototype._forward=function(){if(!this._stream)return
while(!this.destroyed){var buf=this._stream.read()
if(!buf){this._want=!!this._stream
return}
if(!this.push(buf))return}}
Encoder.prototype._read=function(){if(this._reading||this.destroyed)return
this._reading=!0
if(this._stream)this._forward()
if(this._drain){var drain=this._drain
this._drain=null
drain()}
this._reading=!1}
function MediaData(parent){this._parent=parent
this.destroyed=!1
stream.PassThrough.call(this)}
inherits(MediaData,stream.PassThrough)
MediaData.prototype.destroy=function(err){if(this.destroyed)return
this.destroyed=!0
this._parent.destroy(err)
if(err)this.emit('error',err)
this.emit('close')}}).call(this,require('_process'))},{"_process":139,"buffer-alloc":232,"inherits":305,"mp4-box-encoding":331,"readable-stream":344}],334:[function(require,module,exports){exports.decode=require('./decode')
exports.encode=require('./encode')},{"./decode":332,"./encode":333}],335:[function(require,module,exports){arguments[4][199][0].apply(exports,arguments)},{"dup":199}],336:[function(require,module,exports){arguments[4][200][0].apply(exports,arguments)},{"./_stream_readable":338,"./_stream_writable":340,"core-util-is":248,"dup":200,"inherits":305,"process-nextick-args":374}],337:[function(require,module,exports){arguments[4][201][0].apply(exports,arguments)},{"./_stream_transform":339,"core-util-is":248,"dup":201,"inherits":305}],338:[function(require,module,exports){arguments[4][202][0].apply(exports,arguments)},{"./_stream_duplex":336,"./internal/streams/BufferList":341,"./internal/streams/destroy":342,"./internal/streams/stream":343,"_process":139,"core-util-is":248,"dup":202,"events":90,"inherits":305,"isarray":335,"process-nextick-args":374,"safe-buffer":401,"string_decoder/":345,"util":23}],339:[function(require,module,exports){arguments[4][203][0].apply(exports,arguments)},{"./_stream_duplex":336,"core-util-is":248,"dup":203,"inherits":305}],340:[function(require,module,exports){arguments[4][204][0].apply(exports,arguments)},{"./_stream_duplex":336,"./internal/streams/destroy":342,"./internal/streams/stream":343,"_process":139,"core-util-is":248,"dup":204,"inherits":305,"process-nextick-args":374,"safe-buffer":401,"timers":182,"util-deprecate":467}],341:[function(require,module,exports){arguments[4][205][0].apply(exports,arguments)},{"dup":205,"safe-buffer":401,"util":23}],342:[function(require,module,exports){arguments[4][206][0].apply(exports,arguments)},{"dup":206,"process-nextick-args":374}],343:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],344:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":336,"./lib/_stream_passthrough.js":337,"./lib/_stream_readable.js":338,"./lib/_stream_transform.js":339,"./lib/_stream_writable.js":340,"dup":208}],345:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],346:[function(require,module,exports){var s=1000;var m=s*60;var h=m*60;var d=h*24;var w=d*7;var y=d*365.25;module.exports=function(val,options){options=options||{};var type=typeof val;if(type==='string'&&val.length>0){return parse(val)}else if(type==='number'&&isNaN(val)===!1){return options.long?fmtLong(val):fmtShort(val)}
throw new Error('val is not a non-empty string or a valid number. val='+JSON.stringify(val))};function parse(str){str=String(str);if(str.length>100){return}
var match=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(str);if(!match){return}
var n=parseFloat(match[1]);var type=(match[2]||'ms').toLowerCase();switch(type){case 'years':case 'year':case 'yrs':case 'yr':case 'y':return n*y;case 'weeks':case 'week':case 'w':return n*w;case 'days':case 'day':case 'd':return n*d;case 'hours':case 'hour':case 'hrs':case 'hr':case 'h':return n*h;case 'minutes':case 'minute':case 'mins':case 'min':case 'm':return n*m;case 'seconds':case 'second':case 'secs':case 'sec':case 's':return n*s;case 'milliseconds':case 'millisecond':case 'msecs':case 'msec':case 'ms':return n;default:return undefined}}
function fmtShort(ms){var msAbs=Math.abs(ms);if(msAbs>=d){return Math.round(ms/d)+'d'}
if(msAbs>=h){return Math.round(ms/h)+'h'}
if(msAbs>=m){return Math.round(ms/m)+'m'}
if(msAbs>=s){return Math.round(ms/s)+'s'}
return ms+'ms'}
function fmtLong(ms){var msAbs=Math.abs(ms);if(msAbs>=d){return plural(ms,msAbs,d,'day')}
if(msAbs>=h){return plural(ms,msAbs,h,'hour')}
if(msAbs>=m){return plural(ms,msAbs,m,'minute')}
if(msAbs>=s){return plural(ms,msAbs,s,'second')}
return ms+' ms'}
function plural(ms,msAbs,n,name){var isPlural=msAbs>=n*1.5;return Math.round(ms/n)+' '+name+(isPlural?'s':'')}},{}],347:[function(require,module,exports){module.exports=MultiStream
var inherits=require('inherits')
var stream=require('readable-stream')
inherits(MultiStream,stream.Readable)
function MultiStream(streams,opts){var self=this
if(!(self instanceof MultiStream))return new MultiStream(streams,opts)
stream.Readable.call(self,opts)
self.destroyed=!1
self._drained=!1
self._forwarding=!1
self._current=null
self._toStreams2=(opts&&opts.objectMode)?toStreams2Obj:toStreams2Buf
if(typeof streams==='function'){self._queue=streams}else{self._queue=streams.map(self._toStreams2)
self._queue.forEach(function(stream){if(typeof stream!=='function')self._attachErrorListener(stream)})}
self._next()}
MultiStream.obj=function(streams){return new MultiStream(streams,{objectMode:!0,highWaterMark:16})}
MultiStream.prototype._read=function(){this._drained=!0
this._forward()}
MultiStream.prototype._forward=function(){if(this._forwarding||!this._drained||!this._current)return
this._forwarding=!0
var chunk
while((chunk=this._current.read())!==null){this._drained=this.push(chunk)}
this._forwarding=!1}
MultiStream.prototype.destroy=function(err){if(this.destroyed)return
this.destroyed=!0
if(this._current&&this._current.destroy)this._current.destroy()
if(typeof this._queue!=='function'){this._queue.forEach(function(stream){if(stream.destroy)stream.destroy()})}
if(err)this.emit('error',err)
this.emit('close')}
MultiStream.prototype._next=function(){var self=this
self._current=null
if(typeof self._queue==='function'){self._queue(function(err,stream){if(err)return self.destroy(err)
stream=self._toStreams2(stream)
self._attachErrorListener(stream)
self._gotNextStream(stream)})}else{var stream=self._queue.shift()
if(typeof stream==='function'){stream=self._toStreams2(stream())
self._attachErrorListener(stream)}
self._gotNextStream(stream)}}
MultiStream.prototype._gotNextStream=function(stream){var self=this
if(!stream){self.push(null)
self.destroy()
return}
self._current=stream
self._forward()
stream.on('readable',onReadable)
stream.once('end',onEnd)
stream.once('close',onClose)
function onReadable(){self._forward()}
function onClose(){if(!stream._readableState.ended){self.destroy()}}
function onEnd(){self._current=null
stream.removeListener('readable',onReadable)
stream.removeListener('end',onEnd)
stream.removeListener('close',onClose)
self._next()}}
MultiStream.prototype._attachErrorListener=function(stream){var self=this
if(!stream)return
stream.once('error',onError)
function onError(err){stream.removeListener('error',onError)
self.destroy(err)}}
function toStreams2Obj(s){return toStreams2(s,{objectMode:!0,highWaterMark:16})}
function toStreams2Buf(s){return toStreams2(s)}
function toStreams2(s,opts){if(!s||typeof s==='function'||s._readableState)return s
var wrap=new stream.Readable(opts).wrap(s)
if(s.destroy){wrap.destroy=s.destroy.bind(s)}
return wrap}},{"inherits":305,"readable-stream":357}],348:[function(require,module,exports){arguments[4][199][0].apply(exports,arguments)},{"dup":199}],349:[function(require,module,exports){arguments[4][200][0].apply(exports,arguments)},{"./_stream_readable":351,"./_stream_writable":353,"core-util-is":248,"dup":200,"inherits":305,"process-nextick-args":374}],350:[function(require,module,exports){arguments[4][201][0].apply(exports,arguments)},{"./_stream_transform":352,"core-util-is":248,"dup":201,"inherits":305}],351:[function(require,module,exports){arguments[4][202][0].apply(exports,arguments)},{"./_stream_duplex":349,"./internal/streams/BufferList":354,"./internal/streams/destroy":355,"./internal/streams/stream":356,"_process":139,"core-util-is":248,"dup":202,"events":90,"inherits":305,"isarray":348,"process-nextick-args":374,"safe-buffer":401,"string_decoder/":358,"util":23}],352:[function(require,module,exports){arguments[4][203][0].apply(exports,arguments)},{"./_stream_duplex":349,"core-util-is":248,"dup":203,"inherits":305}],353:[function(require,module,exports){arguments[4][204][0].apply(exports,arguments)},{"./_stream_duplex":349,"./internal/streams/destroy":355,"./internal/streams/stream":356,"_process":139,"core-util-is":248,"dup":204,"inherits":305,"process-nextick-args":374,"safe-buffer":401,"timers":182,"util-deprecate":467}],354:[function(require,module,exports){arguments[4][205][0].apply(exports,arguments)},{"dup":205,"safe-buffer":401,"util":23}],355:[function(require,module,exports){arguments[4][206][0].apply(exports,arguments)},{"dup":206,"process-nextick-args":374}],356:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],357:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":349,"./lib/_stream_passthrough.js":350,"./lib/_stream_readable.js":351,"./lib/_stream_transform.js":352,"./lib/_stream_writable.js":353,"dup":208}],358:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],359:[function(require,module,exports){exports.Stringifier=require('./stringifier');exports.Parser=require('./parser')},{"./parser":360,"./stringifier":361}],360:[function(require,module,exports){var util=require('util');var StringDecoder=require('string_decoder').StringDecoder;var Transform=require('stream').Transform;util.inherits(Parser,Transform);function Parser(options){if(!(this instanceof Parser))
return new Parser(options);Transform.call(this,options);this._writableState.objectMode=!1;this._readableState.objectMode=!0;this._buffer='';this._decoder=new StringDecoder('utf8')}
Parser.prototype._transform=function(chunk,encoding,cb){this._buffer+=this._decoder.write(chunk);var lines=this._buffer.split(/\r?\n/);this._buffer=lines.pop();for(var l=0;l<lines.length;l++){var line=lines[l];try{var obj=JSON.parse(line);this.push((obj===null||obj===undefined)?!1:obj)}catch(err){var context=lines.slice(l).join('\n')+'\n'+this._buffer;er=new Error(err.message+' in '+JSON.stringify(context));this.emit('error',er);return}}
cb()};Parser.prototype._flush=function(cb){var rem=this._buffer.trim();if(rem){try{var obj=JSON.parse(rem);this.push(obj)}catch(err){this.emit('error',err);return}}
cb()};module.exports=Parser},{"stream":176,"string_decoder":181,"util":188}],361:[function(require,module,exports){var util=require('util');var Transform=require('stream').Transform;util.inherits(Stringifier,Transform);function Stringifier(options){if(!options)
options={};if(!(this instanceof Stringifier))
return new Stringifier(options);Transform.call(this,options);this._writableState.objectMode=!0;this._readableState.objectMode=!1}
Stringifier.prototype._transform=function(chunk,encoding,done){this.push(JSON.stringify(chunk)+'\n');done()};module.exports=Stringifier},{"stream":176,"util":188}],362:[function(require,module,exports){module.exports=nextEvent
function nextEvent(emitter,name){var next=null
emitter.on(name,function(data){if(!next)return
var fn=next
next=null
fn(data)})
return function(once){next=once}}},{}],363:[function(require,module,exports){var wrappy=require('wrappy')
module.exports=wrappy(once)
module.exports.strict=wrappy(onceStrict)
once.proto=once(function(){Object.defineProperty(Function.prototype,'once',{value:function(){return once(this)},configurable:!0})
Object.defineProperty(Function.prototype,'onceStrict',{value:function(){return onceStrict(this)},configurable:!0})})
function once(fn){var f=function(){if(f.called)return f.value
f.called=!0
return f.value=fn.apply(this,arguments)}
f.called=!1
return f}
function onceStrict(fn){var f=function(){if(f.called)
throw new Error(f.onceError)
f.called=!0
return f.value=fn.apply(this,arguments)}
var name=fn.name||'Function wrapped with `once`'
f.onceError=name+" shouldn't be called more than once"
f.called=!1
return f}},{"wrappy":498}],364:[function(require,module,exports){const OS=require('./lib/opensubtitles.js')
const libhash=require('./lib/hash.js')
const libsearch=require('./lib/search.js')
const libupload=require('./lib/upload.js')
const libid=require('./lib/identify.js')
module.exports=class OpenSubtitles{constructor(creds){if(!creds||(typeof creds==='object'&&!creds.useragent))throw Error('Missing useragent')
this.credentials={username:creds.username||String(),password:creds.password||String(),useragent:creds.useragent||creds,status:Object(),userinfo:Object()}
this.api=new OS(creds.endpoint,creds.ssl)}
login(){if(this.credentials.status.auth_as===this.credentials.username&&this.credentials.status.ttl>Date.now()){return Promise.resolve({token:this.credentials.status.token,userinfo:this.credentials.userinfo})}
return this.api.LogIn(this.credentials.username,this.credentials.password,'en',this.credentials.useragent).then(response=>{if(response.token&&(response.status&&response.status.match(/200/))){this.credentials.status.ttl=Date.now()+895000
this.credentials.status.token=response.token
this.credentials.status.auth_as=this.credentials.username
this.credentials.userinfo=response.data
return{token:response.token,userinfo:response.data}}
this.credentials.status=this.credentials.userinfo=Object()
throw Error(response.status||'LogIn unknown error')})}
search(info){let subs=Array()
return this.login().then(()=>libsearch.optimizeQueryTerms(info)).then(optimizedQT=>{return Promise.all(optimizedQT.map(op=>{return this.api.SearchSubtitles(this.credentials.status.token,[op]).then(result=>subs=subs.concat(result.data))}))}).then(()=>libsearch.optimizeSubs(subs,info)).then(list=>libsearch.filter(list,info))}
upload(subtitle){return new Promise((resolve,reject)=>{let persistent_data=Object()
this.login().then(()=>libupload.createTryData(subtitle)).then(tryArray=>{persistent_data=tryArray.cd1
return this.api.TryUploadSubtitles(this.credentials.status.token,tryArray)}).then(response=>{if(response.alreadyindb===1){resolve(response)}else{persistent_data.subpath=subtitle.subpath
return libupload.parseResponse(response,persistent_data)}}).then(libupload.createContent).then(libupload.arrangeUploadData).then(uploadArray=>this.api.UploadSubtitles(this.credentials.status.token,uploadArray)).then(response=>{if(response.data===String()||!response.status.match(/200/))throw Error(response.status||'UploadSubtitles unknown error')
resolve(response)}).catch(reject)})}
hash(path){if(!path)throw Error('Missing path')
return libhash.computeHash(path)}
identify(query){if(!query&&!query.path)throw Error('Missing path')
if(!query.path)query={path:query}
return this.login().then(()=>this.hash(query.path)).then(info=>{query.moviehash=info.moviehash
query.moviebytesize=info.moviebytesize
return this.api.CheckMovieHash(this.credentials.status.token,[query.moviehash])}).then(response=>{if(response.data===String()||!response.status.match(/200/))throw Error(response.status||'OpenSubtitles unknown error')
const id=query.imdb||libid.readNFO(query.path)
if(response.data[query.moviehash].length===0&&id){return this.api.InsertMovieHash(this.credentials.status.token,[{moviehash:query.moviehash,moviebytesize:query.moviebytesize,imdbid:id.replace('tt',''),moviefilename:require('path').basename(query.path)}])}else{return response}}).then(response=>libid.parseResponse(response,query)).then(data=>{if(data.metadata&&data.metadata.imdbid&&query.extend){return this.api.GetIMDBMovieDetails(this.credentials.status.token,data.metadata.imdbid.replace('tt','')).then(ext=>libid.extend(data,ext))}else{return data}})}
md5(path){if(!path)throw Error('Missing path')
return libhash.computeMD5(path)}}},{"./lib/hash.js":365,"./lib/identify.js":366,"./lib/opensubtitles.js":367,"./lib/search.js":368,"./lib/upload.js":369,"path":132}],365:[function(require,module,exports){(function(Buffer){const fs=require('fs')
const crypto=require('crypto')
const zlib=require('zlib')
module.exports=new class LibHash{computeSubContent(path){return new Promise((resolve,reject)=>{fs.readFile(path,(err,data)=>{if(err)return reject(err)
zlib.deflate(data,(err,buffer)=>{if(err)return reject(err)
resolve(buffer.toString('base64'))})})})}
computeMD5(path){return new Promise((resolve,reject)=>{let hash=crypto.createHash('md5')
fs.createReadStream(path).on('data',data=>hash.update(data,'utf8')).on('end',()=>resolve(hash.digest('hex'))).on('error',reject)})}
computeHash(path){return new Promise((resolve,reject)=>{let chunk_size=65536
let buf_start=Buffer.alloc(chunk_size*2)
let buf_end=Buffer.alloc(chunk_size*2)
let file_size=0
let checksum
let array_checksum=Array()
const checksumReady=checksum_part=>{array_checksum.push(checksum_part)
if(array_checksum.length===3){checksum=this.sumHex64bits(array_checksum[0],array_checksum[1])
checksum=this.sumHex64bits(checksum,array_checksum[2])
checksum=checksum.substr(-16)
resolve({moviehash:this.padLeft(checksum,'0',16),moviebytesize:file_size.toString()})}}
fs.stat(path,(err,stat)=>{if(err)return reject(err)
file_size=stat.size
checksumReady(file_size.toString(16))
fs.open(path,'r',(err,fd)=>{if(err)return reject(err)
fs.read(fd,buf_start,0,chunk_size*2,0,(er1,bytesRead,buf1)=>{fs.read(fd,buf_end,0,chunk_size*2,file_size-chunk_size,(er2,bytesRead,buf2)=>{fs.close(fd,er3=>{if(er1||er2)return reject(er1||er2)
checksumReady(this.checksumBuffer(buf1,16))
checksumReady(this.checksumBuffer(buf2,16))})})})})})})}
read64LE(buffer,offset){const ret_64_be=buffer.toString('hex',offset*8,((offset+1)*8))
const array=Array()
for(let i=0;i<8;i++){array.push(ret_64_be.substr(i*2,2))}
array.reverse()
return array.join('')}
checksumBuffer(buf,length){let checksum=0
let checksum_hex=0
for(let i=0;i<(buf.length/length);i++){checksum_hex=this.read64LE(buf,i)
checksum=this.sumHex64bits(checksum.toString(),checksum_hex).substr(-16)}
return checksum}
sumHex64bits(n1,n2){if(n1.length<16)n1=this.padLeft(n1,'0',16)
if(n2.length<16)n2=this.padLeft(n2,'0',16)
let n1_0=n1.substr(0,8)
let n2_0=n2.substr(0,8)
let i_0=parseInt(n1_0,16)+parseInt(n2_0,16)
let n1_1=n1.substr(8,8)
let n2_1=n2.substr(8,8)
let i_1=parseInt(n1_1,16)+parseInt(n2_1,16)
let h_1=i_1.toString(16)
let i_1_over=0
if(h_1.length>8){i_1_over=parseInt(h_1.substr(0,h_1.length-8),16)}else{h_1=this.padLeft(h_1,'0',8)}
let h_0=(i_1_over+i_0).toString(16)
return h_0+h_1.substr(-8)}
padLeft(str,c,length){while(str.length<length){str=c.toString()+str}
return str}}}).call(this,require("buffer").Buffer)},{"buffer":54,"crypto":63,"fs":1,"zlib":52}],366:[function(require,module,exports){const libhash=require('./hash.js')
const path=require('path')
const fs=require('fs')
module.exports=new class LibID{readNFO(file){let p=path.parse(file)
let nfo=path.join(p.dir,p.name+'.nfo')
let detectedId
if(!fs.existsSync(nfo)){for(let f of fs.readdirSync(p.dir)){if(f.match(/\.nfo/i)!==null){nfo=path.join(p.dir,f)
break}}}
if(fs.existsSync(nfo))detectedId=fs.readFileSync(nfo).toString().match(/tt\d+/i)
return detectedId?detectedId[0]:undefined}
parseResponse(response,info){if(response.data===String()||!response.status.match(/200/))throw new Error(response.status||'OpenSubtitles unknown error')
let data=Object()
if(response.data[info.moviehash]&&Object.keys(response.data[info.moviehash]).length){data={subcount:response.data[info.moviehash].SubCount,added:response.data.accepted_moviehashes?!0:!1,metadata:{imdbid:response.data[info.moviehash].MovieImdbID!=='0'?'tt'+response.data[info.moviehash].MovieImdbID:undefined,title:response.data[info.moviehash].MovieName,year:response.data[info.moviehash].MovieYear,}}
if(response.data[info.moviehash].SeriesEpisode+response.data[info.moviehash].SeriesSeason!=='00'){data.metadata.episode=response.data[info.moviehash].SeriesEpisode
data.metadata.season=response.data[info.moviehash].SeriesSeason
data.metadata.episode_title=data.metadata.title.split('"')[2].trim()
data.metadata.title=data.metadata.title.split('"')[1].trim()}}else if(response.data.accepted_moviehashes&&response.data.accepted_moviehashes.length){data.added=!0}else{data.added=!1}
data.moviehash=info.moviehash
data.moviebytesize=info.moviebytesize
if(info.imdb&&!data.metadata){data.metadata={imdbid:'tt'+info.imdb.replace('tt','')}}
return data}
extend(data,response){if(response.data!==String()&&response.status.match(/200/)){if(response.data.kind.match(/episode/i)){data.type='episode'}else if(response.data.kind.match(/movie/i)){data.type='movie'}else{delete data.metadata
return data}
data.metadata.cast=response.data.cast?response.data.cast:Object()
data.metadata.country=response.data.country?response.data.country:Array()
data.metadata.cover=response.data.cover
data.metadata.directors=response.data.directors?response.data.directors:Object()
data.metadata.duration=response.data.duration
data.metadata.genres=response.data.genres?response.data.genres:Array()
data.metadata.rating=response.data.rating
data.metadata.synopsis=response.data.plot&&response.data.plot.match(/add a plot/i)!==null?undefined:response.data.plot
data.metadata.year=response.data.year
data.metadata.trivia=response.data.trivia?response.data.trivia.replace('See more >>','').trim():undefined
data.metadata.goofs=response.data.goofs
data.metadata.votes=response.data.votes
data.metadata.language=response.data.language?response.data.language:Array()
data.metadata.aka=response.data.aka?response.data.aka:Array()
data.metadata.awards=response.data.awards?response.data.awards:Array()
data.metadata.tagline=response.data.tagline
if(data.type==='episode'&&response.data.episodeof){data.metadata.show_imdbid=Object.keys(response.data.episodeof).length>0?Object.keys(response.data.episodeof)[0].replace('_','tt'):undefined}}
return data}}},{"./hash.js":365,"fs":1,"path":132}],367:[function(require,module,exports){const xmlrpc=require('xmlrpc')
const URIjs=require('urijs')
const pjson=require('../package.json')
const url='http://api.opensubtitles.org:80/xml-rpc'
const url_ssl='https://api.opensubtitles.org:443/xml-rpc'
module.exports=class OS{constructor(endpoint,ssl){const UA=pjson.name+' v'+pjson.version
const uri=endpoint||(ssl?url_ssl:url)
const req=URIjs(uri)._parts
const secure=req.protocol==='https'
const opts={host:req.hostname,port:req.port||(secure?443:80),path:req.path,headers:{'User-Agent':UA}}
this.client=secure?xmlrpc.createSecureClient(opts):xmlrpc.createClient(opts)}
handleError(error){error.message&&error.message.match('XML-RPC tag \'TITLE\'')&&(error.message='API seems offline')
return error}
call(method,args){return new Promise((resolve,reject)=>{this.client.methodCall(method,[...args],(err,data)=>{if(err)return reject(this.handleError(err))
resolve(data)})})}
LogIn(username,password,language,useragent){return this.call('LogIn',arguments)}
LogOut(token){return this.call('LogOut',arguments)}
SearchSubtitles(token,array_queries){return this.call('SearchSubtitles',arguments)}
SearchToMail(token,array_langs,array_movies){return this.call('SearchToMail',arguments)}
CheckSubHash(token,array_subs_hash){return this.call('CheckSubHash',arguments)}
CheckMovieHash(token,array_movies_hash){return this.call('CheckMovieHash',arguments)}
CheckMovieHash2(token,array_movies_hash){return this.call('CheckMovieHash2',arguments)}
InsertMovieHash(token,array_movies_info){return this.call('InsertMovieHash',arguments)}
TryUploadSubtitles(token,array_sub){return this.call('TryUploadSubtitles',arguments)}
UploadSubtitles(token,array_sub){return this.call('UploadSubtitles',arguments)}
DetectLanguage(token,array_texts){return this.call('DetectLanguage',arguments)}
DownloadSubtitles(token,array_subid){return this.call('DownloadSubtitles',arguments)}
ReportWrongMovieHash(token,IDSubMovieFile){return this.call('ReportWrongMovieHash',arguments)}
ReportWrongImdbMovie(token,array_movie){return this.call('ReportWrongImdbMovie',arguments)}
GetSubLanguages(language){return this.call('GetSubLanguages',arguments)}
GetAvailableTranslations(token,program){return this.call('GetAvailableTranslations',arguments)}
GetTranslation(token,iso639,format,program){return this.call('GetTranslation',arguments)}
GetUserInfo(token){return this.call('GetUserInfo',arguments)}
SearchMoviesOnIMDB(token,query){return this.call('SearchMoviesOnIMDB',arguments)}
GuessMovieFromString(token,array_titles){return this.call('GuessMovieFromString',arguments)}
GetIMDBMovieDetails(token,imdbid){return this.call('GetIMDBMovieDetails',arguments)}
InsertMovie(token,array_movie){return this.call('InsertMovie',arguments)}
SubtitlesVote(token,array_vote){return this.call('SubtitlesVote',arguments)}
GetComments(token,array_subids){return this.call('GetComments',arguments)}
AddComment(token,array_comments){return this.call('AddComment',arguments)}
AddRequest(token,array_request){return this.call('AddRequest',arguments)}
SetSubscribeUrl(token,url){return this.call('SetSubscribeUrl',arguments)}
SubscribeToHash(token,array_hashs){return this.call('SubscribeToHash',arguments)}
AutoUpdate(program_name){return this.call('AutoUpdate',arguments)}
SuggestMovie(token,querystring){return this.call('SuggestMovie',arguments)}
QuickSuggest(token,str,sublanguageid){return this.call('QuickSuggest',arguments)}
NoOperation(token){return this.call('NoOperation',arguments)}
ServerInfo(){return this.call('ServerInfo',[])}}},{"../package.json":370,"urijs":464,"xmlrpc":528}],368:[function(require,module,exports){const OS=require('./opensubtitles.js')
const libhash=require('./hash.js')
const path=require('path')
module.exports=new class LibSearch{checkHash(input){return new Promise((resolve,reject)=>{if(!input.hash&&!input.path)return resolve(!1)
if(!input.hash&&input.path)return libhash.computeHash(input.path).then(resolve).catch(reject)
const tmpObj={moviehash:input.hash}
if(input.filesize)tmpObj.moviebytesize=input.filesize.toString()
resolve(tmpObj)})}
optimizeQueryTerms(input){const normalize=this.normalizeProt();input.imdbid=input.imdbid&&parseInt(input.imdbid.toString().replace('tt',''),10)
input.season=input.season&&parseInt(input.season)
input.episode=input.episode&&parseInt(input.episode)
input.hash=input.hash&&input.hash.toString().length>=32&&input.hash.toString().toLowerCase()
input.filesize=input.filesize&&parseInt(input.filesize)
input.fps=input.fps&&input.fps.toString()
input.filename=input.filename||input.path&&path.basename(input.path)
return this.checkHash(input).then(obj=>{const output=Array()
let i=0
if(obj){input.hash=obj.moviehash.toLowerCase()
input.filesize=parseInt(obj.moviebytesize)}
if(input.hash||input.filesize){output[i]={moviehash:input.hash&&input.hash,moviebytesize:input.filesize&&input.filesize.toString()}
i++}
if(input.filename){output[i]=Object()
output[i].tag=input.filename
i++}
if(input.imdbid){output[i]=Object()
output[i].imdbid=input.imdbid.toString()
if(input.season&&input.episode){output[i].season=input.season.toString()
output[i].episode=input.episode.toString()}
i++}
if(!input.imdbid&&!input.hash&&!input.path&&!input.filename&&input.query){output[i]=Object()
output[i].query=input.query
if(input.season&&input.episode){output[i].season=input.season.toString()
output[i].episode=input.episode.toString()}
i++}
for(let o of output){o.sublanguageid=input.sublanguageid||'all'}
return output})}
normalizeProt(){const from='├â├Ç├ü├ä├é├ê├ë├ï├è├î├ì├Å├Ä├Æ├ô├û├ö├Ö├Ü├£├ø├ú├á├í├ñ├ó├¿├®├½├¬├¼├¡├»├«├▓├│├Â├┤├╣├║├╝├╗├æ├▒├ç├º'
const to='AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc'
const mapping=Object()
for(let i=0,j=from.length;i<j;i++){mapping[from.charAt(i)]=to.charAt(i)}
return str=>{const ret=Array()
for(let i=0,j=str.length;i<j;i++){let c=str.charAt(i)
ret.push(mapping[c]||c)}
return ret.join('')}}
optimizeSubs(response,input){let inputTags
let inputTagsDic=Object()
const normalize=this.normalizeProt()
const matchTags=(sub,maxScore)=>{if(!input.filename)return 0
if(!inputTags)
inputTags=input.filename&&normalize(input.filename).toLowerCase().match(/[a-z0-9]{2,}/gi)
if(!inputTags||inputTags.length<=2)return 0
const subNames=normalize(sub.MovieReleaseName+'_'+sub.SubFileName)
const subTags=subNames.toLowerCase().match(/[a-z0-9]{2,}/gi)
if(!subTags.length)return 0
for(let tag of inputTags)inputTagsDic[tag]=!1
let matches=0
for(let subTag of subTags){if(inputTagsDic[subTag]==!1){inputTagsDic[subTag]=!0
matches++}}
return parseInt((matches/inputTags.length)*maxScore)}
const subtitles=Object()
if(input.extensions&&typeof input.extensions==='string')input.extensions=[input.extensions]
if(!input.extensions||!input.extensions instanceof Array)input.extensions=['srt']
var seen={}
response=response.filter(sub=>{return sub&&seen.hasOwnProperty(sub.IDSubtitle)?!1:(seen[sub.IDSubtitle]=!0)})
return Promise.all(response.map(sub=>{sub.imdbid=(sub.SeriesIMDBParent&&sub.SeriesIMDBParent!=='0')?parseInt(sub.SeriesIMDBParent,10):sub.IDMovieImdb&&parseInt(sub.IDMovieImdb,10)
sub.season=sub.SeriesSeason&&parseInt(sub.SeriesSeason)
sub.episode=sub.SeriesEpisode&&parseInt(sub.SeriesEpisode)
sub.filesize=parseInt(sub.MovieByteSize)
sub.hash=sub.MovieHash!="0"&&sub.MovieHash.toLowerCase()
sub.fps=sub.MovieFPS&&parseInt(sub.MovieFPS)>0&&sub.MovieFPS.toString()
if((input.extensions.indexOf(sub.SubFormat)==-1)||(input.imdbid&&input.imdbid!=sub.imdbid)||(input.season&&input.episode&&(input.season!=sub.season||input.episode!=sub.episode)))return
const tmp={url:input.gzip?sub.SubDownloadLink:sub.SubDownloadLink.replace('.gz',''),langcode:sub.ISO639,downloads:parseInt(sub.SubDownloadsCnt),lang:sub.LanguageName,encoding:sub.SubEncoding,id:sub.IDSubtitleFile,filename:sub.SubFileName,date:sub.SubAddDate,score:0,fps:parseFloat(sub.MovieFPS)||null,format:sub.SubFormat,utf8:input.gzip?sub.SubDownloadLink.replace('download/','download/subencoding-utf8/'):sub.SubDownloadLink.replace('.gz','').replace('download/','download/subencoding-utf8/'),vtt:sub.SubDownloadLink.replace('download/','download/subformat-vtt/').replace('.gz','')}
if(input.hash&&sub.hash==input.hash||input.filesize&&input.filesize==sub.filesize){tmp.score+=9}else{tmp.score+=matchTags(sub,7)
if((input.fps&&sub.fps)&&(sub.fps.startsWith(input.fps)||input.fps.startsWith(sub.fps)))(tmp.score+=1)}
sub.UserRank.match(/trusted|administrator/)&&(tmp.score+=0.5)
sub.UserRank.match(/platinum member|gold member/)&&(tmp.score+=0.2)
if(!subtitles[tmp.langcode]){subtitles[tmp.langcode]=[tmp]}else{subtitles[tmp.langcode][Object.keys(subtitles[tmp.langcode]).length]=tmp}
return})).then(()=>subtitles)}
filter(list=Object(),input){const subtitles=Object()
if(!input.limit||(isNaN(input.limit)&&['best','all'].indexOf(input.limit.toLowerCase())==-1)){input.limit='best'}
for(let i in list){let lang=list[i]
let langcode=lang[0].langcode
lang=lang.sort((a,b)=>{if(a.score===b.score){let x=a.downloads
let y=b.downloads
return y<x?-1:y>x?1:0}
return b.score-a.score})
switch(input.limit.toString().toLowerCase()){case 'best':subtitles[langcode]=lang[0]
break
case 'all':subtitles[langcode]=lang
break
default:subtitles[langcode]=lang.slice(0,parseInt(input.limit))}}
return Promise.resolve(subtitles)}}},{"./hash.js":365,"./opensubtitles.js":367,"path":132}],369:[function(require,module,exports){const libhash=require('./hash.js')
const path=require('path')
module.exports=new class LibUpload{createTryData(input){const checkMovie=(obj=Object())=>{if(!input.path)return Promise.resolve(obj)
return libhash.computeHash(input.path).then(response=>{obj=response
obj.moviefilename=path.basename(input.path)
return obj})}
const checkSub=(obj=Object())=>{if(!input.subpath)return Promise.reject('Missing subpath parameter (path to subtitle file)')
return libhash.computeMD5(input.subpath).then(md5=>{obj.subhash=md5
obj.subfilename=path.basename(input.subpath)
return obj})}
const injectInput=(obj=Object())=>{if(input.imdbid)obj.idmovieimdb=input.imdbid.toString().replace('tt','')
if(input.sublanguageid)obj.sublanguageid=input.sublanguageid
if(input.moviefps)obj.moviefps=input.moviefps.toString()
if(input.movieframes)obj.movieframes=input.movieframes.toString()
if(input.movietimems)obj.movietimems=input.movietimems.toString()
if(input.subauthorcomment)obj.subauthorcomment=input.subauthorcomment
if(input.subtranslator)obj.subtranslator=input.subtranslator
if(input.moviereleasename)obj.moviereleasename=input.moviereleasename
if(input.movieaka)obj.movieaka=input.movieaka
if(input.hearingimpaired)obj.hearingimpaired=isNaN(parseInt(input.hearingimpaired))?input.hearingimpaired?'1':'0':input.hearingimpaired.toString()
if(input.highdefinition)obj.highdefinition=isNaN(parseInt(input.highdefinition))?input.highdefinition?'1':'0':input.highdefinition.toString()
if(input.automatictranslation)obj.automatictranslation=isNaN(parseInt(input.automatictranslation))?input.automatictranslation?'1':'0':input.automatictranslation.toString()
if(input.foreignpartsonly)obj.foreignpartsonly=isNaN(parseInt(input.foreignpartsonly))?input.foreignpartsonly?'1':'0':input.foreignpartsonly.toString()
return obj}
return checkMovie().then(checkSub).then(injectInput).then(data=>({cd1:data}))}
arrangeUploadData(input){let baseinfo=Object()
if(input.idmovieimdb)baseinfo.idmovieimdb=input.idmovieimdb.toString()
if(input.moviereleasename)baseinfo.moviereleasename=input.moviereleasename.toString()
if(input.movieaka)baseinfo.movieaka=input.movieaka.toString()
if(input.sublanguageid)baseinfo.sublanguageid=input.sublanguageid.toString()
if(input.subauthorcomment)baseinfo.subauthorcomment=input.subauthorcomment.toString()
if(input.hearingimpaired)baseinfo.hearingimpaired=input.hearingimpaired.toString()
if(input.highdefinition)baseinfo.highdefinition=input.highdefinition.toString()
if(input.automatictranslation)baseinfo.automatictranslation=input.automatictranslation.toString()
if(input.subtranslator)baseinfo.subtranslator=input.subtranslator.toString()
if(input.foreignpartsonly)baseinfo.foreignpartsonly=input.foreignpartsonly.toString()
let cd1={subhash:input.subhash,subfilename:input.subfilename,subcontent:input.subcontent}
if(input.moviebytesize)cd1.moviebytesize=input.moviebytesize.toString()
if(input.moviehash)cd1.moviehash=input.moviehash
if(input.moviefilename)cd1.moviefilename=input.moviefilename
if(input.moviefps)cd1.moviefps=input.moviefps
if(input.movieframes)cd1.movieframes=input.movieframes.toString()
if(input.movietimems)cd1.movietimems=input.movietimems.toString()
return{baseinfo:baseinfo,cd1:cd1}}
createContent(input){return libhash.computeSubContent(input.subpath).then(base64=>{delete input.subpath
input.subcontent=base64
return input})}
parseResponse(response,input){if(response.data&&response.data[0]){if(response.data[0].IDMovieImdb){input.idmovieimdb=response.data[0].IDMovieImdb
return input}else{if(input.idmovieimdb){return input}else{throw Error('Matching IMDB ID cannot be found')}}}else{if(input.idmovieimdb){return input}else{throw Error('Matching IMDB ID cannot be found')}}}}},{"./hash.js":365,"path":132}],370:[function(require,module,exports){module.exports={"_from":"opensubtitles-api","_id":"opensubtitles-api@5.0.1","_inBundle":!1,"_integrity":"sha512-Iurb30SrY5eHoZz/ORxBfuXCApBy5uHkUae7AZ6gfyNgpbRlBnQAvEtHWGu5caOHT/61n98O8Kmh2f2sX+4quQ==","_location":"/opensubtitles-api","_phantomChildren":{},"_requested":{"type":"tag","registry":!0,"raw":"opensubtitles-api","name":"opensubtitles-api","escapedName":"opensubtitles-api","rawSpec":"","saveSpec":null,"fetchSpec":"latest"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/opensubtitles-api/-/opensubtitles-api-5.0.1.tgz","_shasum":"ee76851ea6a07c775302ae8cb322195f5a62a8da","_spec":"opensubtitles-api","_where":"G:\\Proyectos\\barbanarca\\playflix","author":{"name":"vankasteelj","email":"vankasteelj@gmail.com"},"bugs":{"url":"https://github.com/vankasteelj/opensubtitles-api/issues"},"bundleDependencies":!1,"dependencies":{"urijs":"^1.19.1","xmlrpc":"^1.3.2"},"deprecated":!1,"description":"opensubtitles.org api wrapper","homepage":"https://github.com/vankasteelj/opensubtitles-api#readme","keywords":["opensubtitles","subtitles","api","wrapper","srt"],"license":"MIT","main":"index.js","name":"opensubtitles-api","repository":{"type":"git","url":"git+https://github.com/vankasteelj/opensubtitles-api.git"},"scripts":{"test":"node tests.js"},"version":"5.0.1"}},{}],371:[function(require,module,exports){function parsePart(str){if(/^-?\d+$/.test(str)){return parseInt(str,10)}
var m;if((m=str.match(/^(-?\d+)(-|\.\.\.?|\u2025|\u2026|\u22EF)(-?\d+)$/))){var lhs=m[1];var sep=m[2];var rhs=m[3];if(lhs&&rhs){lhs=parseInt(lhs);rhs=parseInt(rhs);var res=[];var incr=lhs<rhs?1:-1;if(sep=='-'||sep=='..'||sep=='\u2025'){rhs+=incr}
for(var i=lhs;i!=rhs;i+=incr)res.push(i);return res}}
return[]}
module.exports.parse=function(str){var parts=str.split(',');var toFlatten=parts.map(function(el){return parsePart(el)});if(toFlatten.length===0)return[];if(toFlatten.length===1){if(Array.isArray(toFlatten[0]))
return toFlatten[0];return toFlatten}
return toFlatten.reduce(function(lhs,rhs){if(!Array.isArray(lhs))lhs=[lhs];if(!Array.isArray(rhs))rhs=[rhs];return lhs.concat(rhs)})}},{}],372:[function(require,module,exports){(function(process,Buffer){const bencode=require('bencode')
const blobToBuffer=require('blob-to-buffer')
const fs=require('fs')
const get=require('simple-get')
const magnet=require('magnet-uri')
const path=require('path')
const sha1=require('simple-sha1')
const uniq=require('uniq')
module.exports=parseTorrent
module.exports.remote=parseTorrentRemote
module.exports.toMagnetURI=magnet.encode
module.exports.toTorrentFile=encodeTorrentFile
function parseTorrent(torrentId){if(typeof torrentId==='string'&&/^(stream-)?magnet:/.test(torrentId)){return magnet(torrentId)}else if(typeof torrentId==='string'&&(/^[a-f0-9]{40}$/i.test(torrentId)||/^[a-z2-7]{32}$/i.test(torrentId))){return magnet(`magnet:?xt=urn:btih:${torrentId}`)}else if(Buffer.isBuffer(torrentId)&&torrentId.length===20){return magnet(`magnet:?xt=urn:btih:${torrentId.toString('hex')}`)}else if(Buffer.isBuffer(torrentId)){return decodeTorrentFile(torrentId)}else if(torrentId&&torrentId.infoHash){torrentId.infoHash=torrentId.infoHash.toLowerCase()
if(!torrentId.announce)torrentId.announce=[]
if(typeof torrentId.announce==='string'){torrentId.announce=[torrentId.announce]}
if(!torrentId.urlList)torrentId.urlList=[]
return torrentId}else{throw new Error('Invalid torrent identifier')}}
function parseTorrentRemote(torrentId,cb){let parsedTorrent
if(typeof cb!=='function')throw new Error('second argument must be a Function')
try{parsedTorrent=parseTorrent(torrentId)}catch(err){}
if(parsedTorrent&&parsedTorrent.infoHash){process.nextTick(()=>{cb(null,parsedTorrent)})}else if(isBlob(torrentId)){blobToBuffer(torrentId,(err,torrentBuf)=>{if(err)return cb(new Error(`Error converting Blob: ${err.message}`))
parseOrThrow(torrentBuf)})}else if(typeof get==='function'&&/^https?:/.test(torrentId)){get.concat({url:torrentId,timeout:30*1000,headers:{'user-agent':'WebTorrent (https://webtorrent.io)'}},(err,res,torrentBuf)=>{if(err)return cb(new Error(`Error downloading torrent: ${err.message}`))
parseOrThrow(torrentBuf)})}else if(typeof fs.readFile==='function'&&typeof torrentId==='string'){fs.readFile(torrentId,(err,torrentBuf)=>{if(err)return cb(new Error('Invalid torrent identifier'))
parseOrThrow(torrentBuf)})}else{process.nextTick(()=>{cb(new Error('Invalid torrent identifier'))})}
function parseOrThrow(torrentBuf){try{parsedTorrent=parseTorrent(torrentBuf)}catch(err){return cb(err)}
if(parsedTorrent&&parsedTorrent.infoHash)cb(null,parsedTorrent)
else cb(new Error('Invalid torrent identifier'))}}
function decodeTorrentFile(torrent){if(Buffer.isBuffer(torrent)){torrent=bencode.decode(torrent)}
ensure(torrent.info,'info')
ensure(torrent.info['name.utf-8']||torrent.info.name,'info.name')
ensure(torrent.info['piece length'],'info[\'piece length\']')
ensure(torrent.info.pieces,'info.pieces')
if(torrent.info.files){torrent.info.files.forEach(file=>{ensure(typeof file.length==='number','info.files[0].length')
ensure(file['path.utf-8']||file.path,'info.files[0].path')})}else{ensure(typeof torrent.info.length==='number','info.length')}
const result={info:torrent.info,infoBuffer:bencode.encode(torrent.info),name:(torrent.info['name.utf-8']||torrent.info.name).toString(),announce:[]}
result.infoHash=sha1.sync(result.infoBuffer)
result.infoHashBuffer=Buffer.from(result.infoHash,'hex')
if(torrent.info.private!==undefined)result.private=!!torrent.info.private
if(torrent['creation date'])result.created=new Date(torrent['creation date']*1000)
if(torrent['created by'])result.createdBy=torrent['created by'].toString()
if(Buffer.isBuffer(torrent.comment))result.comment=torrent.comment.toString()
if(Array.isArray(torrent['announce-list'])&&torrent['announce-list'].length>0){torrent['announce-list'].forEach(urls=>{urls.forEach(url=>{result.announce.push(url.toString())})})}else if(torrent.announce){result.announce.push(torrent.announce.toString())}
if(Buffer.isBuffer(torrent['url-list'])){torrent['url-list']=torrent['url-list'].length>0?[torrent['url-list']]:[]}
result.urlList=(torrent['url-list']||[]).map(url=>url.toString())
uniq(result.announce)
uniq(result.urlList)
const files=torrent.info.files||[torrent.info]
result.files=files.map((file,i)=>{const parts=[].concat(result.name,file['path.utf-8']||file.path||[]).map(p=>p.toString())
return{path:path.join.apply(null,[path.sep].concat(parts)).slice(1),name:parts[parts.length-1],length:file.length,offset:files.slice(0,i).reduce(sumLength,0)}})
result.length=files.reduce(sumLength,0)
const lastFile=result.files[result.files.length-1]
result.pieceLength=torrent.info['piece length']
result.lastPieceLength=((lastFile.offset+lastFile.length)%result.pieceLength)||result.pieceLength
result.pieces=splitPieces(torrent.info.pieces)
return result}
function encodeTorrentFile(parsed){const torrent={info:parsed.info}
torrent['announce-list']=(parsed.announce||[]).map(url=>{if(!torrent.announce)torrent.announce=url
url=Buffer.from(url,'utf8')
return[url]})
torrent['url-list']=parsed.urlList||[]
if(parsed.private!==undefined){torrent['private']=Number(parsed.private)}
if(parsed.created){torrent['creation date']=(parsed.created.getTime()/1000)|0}
if(parsed.createdBy){torrent['created by']=parsed.createdBy}
if(parsed.comment){torrent.comment=parsed.comment}
return bencode.encode(torrent)}
function isBlob(obj){return typeof Blob!=='undefined'&&obj instanceof Blob}
function sumLength(sum,file){return sum+file.length}
function splitPieces(buf){const pieces=[]
for(let i=0;i<buf.length;i+=20){pieces.push(buf.slice(i,i+20).toString('hex'))}
return pieces}
function ensure(bool,fieldName){if(!bool)throw new Error(`Torrent is missing required field: ${fieldName}`)};((()=>{Buffer.alloc(0)}))()}).call(this,require('_process'),require("buffer").Buffer)},{"_process":139,"bencode":195,"blob-to-buffer":218,"buffer":54,"fs":1,"magnet-uri":311,"path":132,"simple-get":404,"simple-sha1":419,"uniq":460}],373:[function(require,module,exports){var closest=require('closest-to')
var kB=Math.pow(2,10)
var p=13,range=[]
while(p++<22)range.push(Math.pow(2,p))
module.exports=function(bytes){return closest(bytes/kB,range)}},{"closest-to":247}],374:[function(require,module,exports){(function(process){'use strict';if(!process.version||process.version.indexOf('v0.')===0||process.version.indexOf('v1.')===0&&process.version.indexOf('v1.8.')!==0){module.exports={nextTick:nextTick}}else{module.exports=process}
function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=='function'){throw new TypeError('"callback" argument must be a function')}
var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}
return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require('_process'))},{"_process":139}],375:[function(require,module,exports){(function(process){var once=require('once')
var eos=require('end-of-stream')
var fs=require('fs')
var noop=function(){}
var ancient=/^v?\.0/.test(process.version)
var isFn=function(fn){return typeof fn==='function'}
var isFS=function(stream){if(!ancient)return!1
if(!fs)return!1
return(stream instanceof(fs.ReadStream||noop)||stream instanceof(fs.WriteStream||noop))&&isFn(stream.close)}
var isRequest=function(stream){return stream.setHeader&&isFn(stream.abort)}
var destroyer=function(stream,reading,writing,callback){callback=once(callback)
var closed=!1
stream.on('close',function(){closed=!0})
eos(stream,{readable:reading,writable:writing},function(err){if(err)return callback(err)
closed=!0
callback()})
var destroyed=!1
return function(err){if(closed)return
if(destroyed)return
destroyed=!0
if(isFS(stream))return stream.close(noop)
if(isRequest(stream))return stream.abort()
if(isFn(stream.destroy))return stream.destroy()
callback(err||new Error('stream was destroyed'))}}
var call=function(fn){fn()}
var pipe=function(from,to){return from.pipe(to)}
var pump=function(){var streams=Array.prototype.slice.call(arguments)
var callback=isFn(streams[streams.length-1]||noop)&&streams.pop()||noop
if(Array.isArray(streams[0]))streams=streams[0]
if(streams.length<2)throw new Error('pump requires two streams per minimum')
var error
var destroys=streams.map(function(stream,i){var reading=i<streams.length-1
var writing=i>0
return destroyer(stream,reading,writing,function(err){if(!error)error=err
if(err)destroys.forEach(call)
if(reading)return
destroys.forEach(call)
callback(error)})})
return streams.reduce(pipe)}
module.exports=pump}).call(this,require('_process'))},{"_process":139,"end-of-stream":288,"fs":23,"once":363}],376:[function(require,module,exports){var pump=require('pump')
var inherits=require('inherits')
var Duplexify=require('duplexify')
var toArray=function(args){if(!args.length)return[]
return Array.isArray(args[0])?args[0]:Array.prototype.slice.call(args)}
var define=function(opts){var Pumpify=function(){var streams=toArray(arguments)
if(!(this instanceof Pumpify))return new Pumpify(streams)
Duplexify.call(this,null,null,opts)
if(streams.length)this.setPipeline(streams)}
inherits(Pumpify,Duplexify)
Pumpify.prototype.setPipeline=function(){var streams=toArray(arguments)
var self=this
var ended=!1
var w=streams[0]
var r=streams[streams.length-1]
r=r.readable?r:null
w=w.writable?w:null
var onclose=function(){streams[0].emit('error',new Error('stream was destroyed'))}
this.on('close',onclose)
this.on('prefinish',function(){if(!ended)self.cork()})
pump(streams,function(err){self.removeListener('close',onclose)
if(err)return self.destroy(err.message==='premature close'?null:err)
ended=!0
if(self._autoDestroy===!1)self._autoDestroy=!0
self.uncork()})
if(this.destroyed)return onclose()
this.setWritable(w)
this.setReadable(r)}
return Pumpify}
module.exports=define({autoDestroy:!1,destroy:!1})
module.exports.obj=define({autoDestroy:!1,destroy:!1,objectMode:!0,highWaterMark:16})
module.exports.ctor=define},{"duplexify":268,"inherits":305,"pump":377}],377:[function(require,module,exports){(function(process){var once=require('once')
var eos=require('end-of-stream')
var fs=require('fs')
var noop=function(){}
var ancient=/^v?\.0/.test(process.version)
var isFn=function(fn){return typeof fn==='function'}
var isFS=function(stream){if(!ancient)return!1
if(!fs)return!1
return(stream instanceof(fs.ReadStream||noop)||stream instanceof(fs.WriteStream||noop))&&isFn(stream.close)}
var isRequest=function(stream){return stream.setHeader&&isFn(stream.abort)}
var destroyer=function(stream,reading,writing,callback){callback=once(callback)
var closed=!1
stream.on('close',function(){closed=!0})
eos(stream,{readable:reading,writable:writing},function(err){if(err)return callback(err)
closed=!0
callback()})
var destroyed=!1
return function(err){if(closed)return
if(destroyed)return
destroyed=!0
if(isFS(stream))return stream.close(noop)
if(isRequest(stream))return stream.abort()
if(isFn(stream.destroy))return stream.destroy()
callback(err||new Error('stream was destroyed'))}}
var call=function(fn){fn()}
var pipe=function(from,to){return from.pipe(to)}
var pump=function(){var streams=Array.prototype.slice.call(arguments)
var callback=isFn(streams[streams.length-1]||noop)&&streams.pop()||noop
if(Array.isArray(streams[0]))streams=streams[0]
if(streams.length<2)throw new Error('pump requires two streams per minimum')
var error
var destroys=streams.map(function(stream,i){var reading=i<streams.length-1
var writing=i>0
return destroyer(stream,reading,writing,function(err){if(!error)error=err
if(err)destroys.forEach(call)
if(reading)return
destroys.forEach(call)
callback(error)})})
streams.reduce(pipe)}
module.exports=pump}).call(this,require('_process'))},{"_process":139,"end-of-stream":288,"fs":23,"once":363}],378:[function(require,module,exports){var iterate=function(list){var offset=0
return function(){if(offset===list.length)return null
var len=list.length-offset
var i=(Math.random()*len)|0
var el=list[offset+i]
var tmp=list[offset]
list[offset]=el
list[offset+i]=tmp
offset++
return el}}
module.exports=iterate},{}],379:[function(require,module,exports){(function(process,global){'use strict'
var MAX_BYTES=65536
var MAX_UINT32=4294967295
function oldBrowser(){throw new Error('Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11')}
var Buffer=require('safe-buffer').Buffer
var crypto=global.crypto||global.msCrypto
if(crypto&&crypto.getRandomValues){module.exports=randomBytes}else{module.exports=oldBrowser}
function randomBytes(size,cb){if(size>MAX_UINT32)throw new RangeError('requested too many random bytes')
var bytes=Buffer.allocUnsafe(size)
if(size>0){if(size>MAX_BYTES){for(var generated=0;generated<size;generated+=MAX_BYTES){crypto.getRandomValues(bytes.slice(generated,generated+MAX_BYTES))}}else{crypto.getRandomValues(bytes)}}
if(typeof cb==='function'){return process.nextTick(function(){cb(null,bytes)})}
return bytes}}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"_process":139,"safe-buffer":401}],380:[function(require,module,exports){const{Writable,PassThrough}=require('readable-stream')
class RangeSliceStream extends Writable{constructor(offset,opts={}){super(opts)
this.destroyed=!1
this._queue=[]
this._position=offset||0
this._cb=null
this._buffer=null
this._out=null}
_write(chunk,encoding,cb){let drained=!0
while(!0){if(this.destroyed){return}
if(this._queue.length===0){this._buffer=chunk
this._cb=cb
return}
this._buffer=null
var currRange=this._queue[0]
const writeStart=Math.max(currRange.start-this._position,0)
const writeEnd=currRange.end-this._position
if(writeStart>=chunk.length){this._position+=chunk.length
return cb(null)}
let toWrite
if(writeEnd>chunk.length){this._position+=chunk.length
if(writeStart===0){toWrite=chunk}else{toWrite=chunk.slice(writeStart)}
drained=currRange.stream.write(toWrite)&&drained
break}
this._position+=writeEnd
toWrite=(writeStart===0&&writeEnd===chunk.length)?chunk:chunk.slice(writeStart,writeEnd)
drained=currRange.stream.write(toWrite)&&drained
if(currRange.last){currRange.stream.end()}
chunk=chunk.slice(writeEnd)
this._queue.shift()}
if(drained){cb(null)}else{currRange.stream.once('drain',cb.bind(null,null))}}
slice(ranges){if(this.destroyed)return null
if(!Array.isArray(ranges))ranges=[ranges]
const str=new PassThrough()
ranges.forEach((range,i)=>{this._queue.push({start:range.start,end:range.end,stream:str,last:i===ranges.length-1})})
if(this._buffer){this._write(this._buffer,null,this._cb)}
return str}
destroy(err){if(this.destroyed)return
this.destroyed=!0
if(err)this.emit('error',err)}}
module.exports=RangeSliceStream},{"readable-stream":394}],381:[function(require,module,exports){arguments[4][250][0].apply(exports,arguments)},{"dup":250}],382:[function(require,module,exports){arguments[4][251][0].apply(exports,arguments)},{"_process":139,"dup":251}],383:[function(require,module,exports){arguments[4][252][0].apply(exports,arguments)},{"./_stream_readable":385,"./_stream_writable":387,"_process":139,"dup":252,"inherits":305}],384:[function(require,module,exports){arguments[4][253][0].apply(exports,arguments)},{"./_stream_transform":386,"dup":253,"inherits":305}],385:[function(require,module,exports){arguments[4][254][0].apply(exports,arguments)},{"../errors":381,"../experimentalWarning":382,"./_stream_duplex":383,"./internal/streams/async_iterator":388,"./internal/streams/buffer_list":389,"./internal/streams/destroy":390,"./internal/streams/state":392,"./internal/streams/stream":393,"_process":139,"buffer":54,"dup":254,"events":90,"inherits":305,"string_decoder/":395,"util":23}],386:[function(require,module,exports){arguments[4][255][0].apply(exports,arguments)},{"../errors":381,"./_stream_duplex":383,"dup":255,"inherits":305}],387:[function(require,module,exports){arguments[4][256][0].apply(exports,arguments)},{"../errors":381,"./_stream_duplex":383,"./internal/streams/destroy":390,"./internal/streams/state":392,"./internal/streams/stream":393,"_process":139,"buffer":54,"dup":256,"inherits":305,"util-deprecate":467}],388:[function(require,module,exports){arguments[4][257][0].apply(exports,arguments)},{"./end-of-stream":391,"_process":139,"dup":257}],389:[function(require,module,exports){arguments[4][258][0].apply(exports,arguments)},{"buffer":54,"dup":258,"util":23}],390:[function(require,module,exports){arguments[4][259][0].apply(exports,arguments)},{"_process":139,"dup":259}],391:[function(require,module,exports){arguments[4][260][0].apply(exports,arguments)},{"../../../errors":381,"dup":260}],392:[function(require,module,exports){arguments[4][261][0].apply(exports,arguments)},{"../../../errors":381,"dup":261}],393:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],394:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":383,"./lib/_stream_passthrough.js":384,"./lib/_stream_readable.js":385,"./lib/_stream_transform.js":386,"./lib/_stream_writable.js":387,"dup":208}],395:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],396:[function(require,module,exports){exports.render=render
exports.append=append
exports.mime=require('./lib/mime.json')
var debug=require('debug')('render-media')
var isAscii=require('is-ascii')
var MediaElementWrapper=require('mediasource')
var path=require('path')
var streamToBlobURL=require('stream-to-blob-url')
var videostream=require('videostream')
var VIDEOSTREAM_EXTS=['.m4a','.m4v','.mp4']
var MEDIASOURCE_VIDEO_EXTS=['.m4v','.mkv','.mp4','.webm']
var MEDIASOURCE_AUDIO_EXTS=['.m4a','.mp3']
var MEDIASOURCE_EXTS=[].concat(MEDIASOURCE_VIDEO_EXTS,MEDIASOURCE_AUDIO_EXTS)
var AUDIO_EXTS=['.aac','.oga','.ogg','.wav','.flac']
var IMAGE_EXTS=['.bmp','.gif','.jpeg','.jpg','.png','.svg']
var IFRAME_EXTS=['.css','.html','.js','.md','.pdf','.txt']
var MAX_BLOB_LENGTH=200*1000*1000
var MediaSource=typeof window!=='undefined'&&window.MediaSource
function render(file,elem,opts,cb){if(typeof opts==='function'){cb=opts
opts={}}
if(!opts)opts={}
if(!cb)cb=function(){}
validateFile(file)
parseOpts(opts)
if(typeof elem==='string')elem=document.querySelector(elem)
renderMedia(file,function(tagName){if(elem.nodeName!==tagName.toUpperCase()){var extname=path.extname(file.name).toLowerCase()
throw new Error('Cannot render "'+extname+'" inside a "'+elem.nodeName.toLowerCase()+'" element, expected "'+tagName+'"')}
return elem},opts,cb)}
function append(file,rootElem,opts,cb){if(typeof opts==='function'){cb=opts
opts={}}
if(!opts)opts={}
if(!cb)cb=function(){}
validateFile(file)
parseOpts(opts)
if(typeof rootElem==='string')rootElem=document.querySelector(rootElem)
if(rootElem&&(rootElem.nodeName==='VIDEO'||rootElem.nodeName==='AUDIO')){throw new Error('Invalid video/audio node argument. Argument must be root element that '+'video/audio tag will be appended to.')}
renderMedia(file,getElem,opts,done)
function getElem(tagName){if(tagName==='video'||tagName==='audio')return createMedia(tagName)
else return createElem(tagName)}
function createMedia(tagName){var elem=createElem(tagName)
if(opts.autoplay)elem.autoplay=!0
if(opts.muted)elem.muted=!0
if(opts.controls)elem.controls=!0
rootElem.appendChild(elem)
return elem}
function createElem(tagName){var elem=document.createElement(tagName)
rootElem.appendChild(elem)
return elem}
function done(err,elem){if(err&&elem)elem.remove()
cb(err,elem)}}
function renderMedia(file,getElem,opts,cb){var extname=path.extname(file.name).toLowerCase()
var currentTime=0
var elem
if(MEDIASOURCE_EXTS.indexOf(extname)>=0){renderMediaSource()}else if(AUDIO_EXTS.indexOf(extname)>=0){renderAudio()}else if(IMAGE_EXTS.indexOf(extname)>=0){renderImage()}else if(IFRAME_EXTS.indexOf(extname)>=0){renderIframe()}else{tryRenderIframe()}
function renderMediaSource(){var tagName=MEDIASOURCE_VIDEO_EXTS.indexOf(extname)>=0?'video':'audio'
if(MediaSource){if(VIDEOSTREAM_EXTS.indexOf(extname)>=0){useVideostream()}else{useMediaSource()}}else{useBlobURL()}
function useVideostream(){debug('Use `videostream` package for '+file.name)
prepareElem()
elem.addEventListener('error',fallbackToMediaSource)
elem.addEventListener('loadstart',onLoadStart)
elem.addEventListener('canplay',onCanPlay)
videostream(file,elem)}
function useMediaSource(){debug('Use MediaSource API for '+file.name)
prepareElem()
elem.addEventListener('error',fallbackToBlobURL)
elem.addEventListener('loadstart',onLoadStart)
elem.addEventListener('canplay',onCanPlay)
var wrapper=new MediaElementWrapper(elem)
var writable=wrapper.createWriteStream(getCodec(file.name))
file.createReadStream().pipe(writable)
if(currentTime)elem.currentTime=currentTime}
function useBlobURL(){debug('Use Blob URL for '+file.name)
prepareElem()
elem.addEventListener('error',fatalError)
elem.addEventListener('loadstart',onLoadStart)
elem.addEventListener('canplay',onCanPlay)
getBlobURL(file,function(err,url){if(err)return fatalError(err)
elem.src=url
if(currentTime)elem.currentTime=currentTime})}
function fallbackToMediaSource(err){debug('videostream error: fallback to MediaSource API: %o',err.message||err)
elem.removeEventListener('error',fallbackToMediaSource)
elem.removeEventListener('canplay',onCanPlay)
useMediaSource()}
function fallbackToBlobURL(err){debug('MediaSource API error: fallback to Blob URL: %o',err.message||err)
if(typeof file.length==='number'&&file.length>opts.maxBlobLength){debug('File length too large for Blob URL approach: %d (max: %d)',file.length,opts.maxBlobLength)
return fatalError(new Error('File length too large for Blob URL approach: '+file.length+' (max: '+opts.maxBlobLength+')'))}
elem.removeEventListener('error',fallbackToBlobURL)
elem.removeEventListener('canplay',onCanPlay)
useBlobURL()}
function prepareElem(){if(!elem){elem=getElem(tagName)
elem.addEventListener('progress',function(){currentTime=elem.currentTime})}}}
function renderAudio(){elem=getElem('audio')
getBlobURL(file,function(err,url){if(err)return fatalError(err)
elem.addEventListener('error',fatalError)
elem.addEventListener('loadstart',onLoadStart)
elem.addEventListener('canplay',onCanPlay)
elem.src=url})}
function onLoadStart(){elem.removeEventListener('loadstart',onLoadStart)
if(opts.autoplay)elem.play()}
function onCanPlay(){elem.removeEventListener('canplay',onCanPlay)
cb(null,elem)}
function renderImage(){elem=getElem('img')
getBlobURL(file,function(err,url){if(err)return fatalError(err)
elem.src=url
elem.alt=file.name
cb(null,elem)})}
function renderIframe(){getBlobURL(file,function(err,url){if(err)return fatalError(err)
if(extname!=='.pdf'){elem=getElem('iframe')
elem.sandbox='allow-forms allow-scripts'
elem.src=url}else{elem=getElem('object')
elem.setAttribute('typemustmatch',!0)
elem.setAttribute('type','application/pdf')
elem.setAttribute('data',url)}
cb(null,elem)})}
function tryRenderIframe(){debug('Unknown file extension "%s" - will attempt to render into iframe',extname)
var str=''
file.createReadStream({start:0,end:1000}).setEncoding('utf8').on('data',function(chunk){str+=chunk}).on('end',done).on('error',cb)
function done(){if(isAscii(str)){debug('File extension "%s" appears ascii, so will render.',extname)
renderIframe()}else{debug('File extension "%s" appears non-ascii, will not render.',extname)
cb(new Error('Unsupported file type "'+extname+'": Cannot append to DOM'))}}}
function fatalError(err){err.message='Error rendering file "'+file.name+'": '+err.message
debug(err.message)
cb(err)}}
function getBlobURL(file,cb){var extname=path.extname(file.name).toLowerCase()
streamToBlobURL(file.createReadStream(),exports.mime[extname],cb)}
function validateFile(file){if(file==null){throw new Error('file cannot be null or undefined')}
if(typeof file.name!=='string'){throw new Error('missing or invalid file.name property')}
if(typeof file.createReadStream!=='function'){throw new Error('missing or invalid file.createReadStream property')}}
function getCodec(name){var extname=path.extname(name).toLowerCase()
return{'.m4a':'audio/mp4; codecs="mp4a.40.5"','.m4v':'video/mp4; codecs="avc1.640029, mp4a.40.5"','.mkv':'video/webm; codecs="avc1.640029, mp4a.40.5"','.mp3':'audio/mpeg','.mp4':'video/mp4; codecs="avc1.640029, mp4a.40.5"','.webm':'video/webm; codecs="vorbis, vp8"'}[extname]}
function parseOpts(opts){if(opts.autoplay==null)opts.autoplay=!1
if(opts.muted==null)opts.muted=!1
if(opts.controls==null)opts.controls=!0
if(opts.maxBlobLength==null)opts.maxBlobLength=MAX_BLOB_LENGTH}},{"./lib/mime.json":397,"debug":265,"is-ascii":306,"mediasource":312,"path":132,"stream-to-blob-url":449,"videostream":469}],397:[function(require,module,exports){module.exports={".3gp":"video/3gpp",".aac":"audio/aac",".aif":"audio/x-aiff",".aiff":"audio/x-aiff",".atom":"application/atom+xml",".avi":"video/x-msvideo",".bmp":"image/bmp",".bz2":"application/x-bzip2",".conf":"text/plain",".css":"text/css",".csv":"text/plain",".diff":"text/x-diff",".doc":"application/msword",".flv":"video/x-flv",".gif":"image/gif",".gz":"application/x-gzip",".htm":"text/html",".html":"text/html",".ico":"image/vnd.microsoft.icon",".ics":"text/calendar",".iso":"application/octet-stream",".jar":"application/java-archive",".jpeg":"image/jpeg",".jpg":"image/jpeg",".js":"application/javascript",".json":"application/json",".less":"text/css",".log":"text/plain",".m3u":"audio/x-mpegurl",".m4a":"audio/mp4",".m4v":"video/mp4",".manifest":"text/cache-manifest",".markdown":"text/x-markdown",".mathml":"application/mathml+xml",".md":"text/x-markdown",".mid":"audio/midi",".midi":"audio/midi",".mov":"video/quicktime",".mp3":"audio/mpeg",".mp4":"video/mp4",".mp4v":"video/mp4",".mpeg":"video/mpeg",".mpg":"video/mpeg",".odp":"application/vnd.oasis.opendocument.presentation",".ods":"application/vnd.oasis.opendocument.spreadsheet",".odt":"application/vnd.oasis.opendocument.text",".oga":"audio/ogg",".ogg":"application/ogg",".pdf":"application/pdf",".png":"image/png",".pps":"application/vnd.ms-powerpoint",".ppt":"application/vnd.ms-powerpoint",".ps":"application/postscript",".psd":"image/vnd.adobe.photoshop",".qt":"video/quicktime",".rar":"application/x-rar-compressed",".rdf":"application/rdf+xml",".rss":"application/rss+xml",".rtf":"application/rtf",".svg":"image/svg+xml",".svgz":"image/svg+xml",".swf":"application/x-shockwave-flash",".tar":"application/x-tar",".tbz":"application/x-bzip-compressed-tar",".text":"text/plain",".tif":"image/tiff",".tiff":"image/tiff",".torrent":"application/x-bittorrent",".ttf":"application/x-font-ttf",".txt":"text/plain",".wav":"audio/wav",".webm":"video/webm",".wma":"audio/x-ms-wma",".wmv":"video/x-ms-wmv",".xls":"application/vnd.ms-excel",".xml":"application/xml",".yaml":"text/yaml",".yml":"text/yaml",".zip":"application/zip"}},{}],398:[function(require,module,exports){(function(process){module.exports=runParallelLimit
function runParallelLimit(tasks,limit,cb){if(typeof limit!=='number')throw new Error('second argument must be a Number')
var results,len,pending,keys,isErrored
var isSync=!0
if(Array.isArray(tasks)){results=[]
pending=len=tasks.length}else{keys=Object.keys(tasks)
results={}
pending=len=keys.length}
function done(err){function end(){if(cb)cb(err,results)
cb=null}
if(isSync)process.nextTick(end)
else end()}
function each(i,err,result){results[i]=result
if(err)isErrored=!0
if(--pending===0||err){done(err)}else if(!isErrored&&next<len){var key
if(keys){key=keys[next]
next+=1
tasks[key](function(err,result){each(key,err,result)})}else{key=next
next+=1
tasks[key](function(err,result){each(key,err,result)})}}}
var next=limit
if(!pending){done(null)}else if(keys){keys.some(function(key,i){tasks[key](function(err,result){each(key,err,result)})
if(i===limit-1)return!0})}else{tasks.some(function(task,i){task(function(err,result){each(i,err,result)})
if(i===limit-1)return!0})}
isSync=!1}}).call(this,require('_process'))},{"_process":139}],399:[function(require,module,exports){(function(process){module.exports=runParallel
function runParallel(tasks,cb){var results,pending,keys
var isSync=!0
if(Array.isArray(tasks)){results=[]
pending=tasks.length}else{keys=Object.keys(tasks)
results={}
pending=keys.length}
function done(err){function end(){if(cb)cb(err,results)
cb=null}
if(isSync)process.nextTick(end)
else end()}
function each(i,err,result){results[i]=result
if(--pending===0||err){done(err)}}
if(!pending){done(null)}else if(keys){keys.forEach(function(key){tasks[key](function(err,result){each(key,err,result)})})}else{tasks.forEach(function(task,i){task(function(err,result){each(i,err,result)})})}
isSync=!1}}).call(this,require('_process'))},{"_process":139}],400:[function(require,module,exports){(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==='object'&&typeof module==='object')
module.exports=factory();else if(typeof define==='function'&&define.amd)
define([],factory);else if(typeof exports==='object')
exports.Rusha=factory();else root.Rusha=factory()})(typeof self!=='undefined'?self:this,function(){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}
var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=!0;return module.exports}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};__webpack_require__.d(getter,'a',getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=3)})([(function(module,exports,__webpack_require__){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}
var RushaCore=__webpack_require__(5);var _require=__webpack_require__(1),toHex=_require.toHex,ceilHeapSize=_require.ceilHeapSize;var conv=__webpack_require__(6);var padlen=function(len){for(len+=9;len%64>0;len+=1){}
return len};var padZeroes=function(bin,len){var h8=new Uint8Array(bin.buffer);var om=len%4,align=len-om;switch(om){case 0:h8[align+3]=0;case 1:h8[align+2]=0;case 2:h8[align+1]=0;case 3:h8[align+0]=0}
for(var i=(len>>2)+1;i<bin.length;i++){bin[i]=0}};var padData=function(bin,chunkLen,msgLen){bin[chunkLen>>2]|=0x80<<24-(chunkLen%4<<3);bin[((chunkLen>>2)+2&~0x0f)+14]=msgLen/(1<<29)|0;bin[((chunkLen>>2)+2&~0x0f)+15]=msgLen<<3};var getRawDigest=function(heap,padMaxChunkLen){var io=new Int32Array(heap,padMaxChunkLen+320,5);var out=new Int32Array(5);var arr=new DataView(out.buffer);arr.setInt32(0,io[0],!1);arr.setInt32(4,io[1],!1);arr.setInt32(8,io[2],!1);arr.setInt32(12,io[3],!1);arr.setInt32(16,io[4],!1);return out};var Rusha=function(){function Rusha(chunkSize){_classCallCheck(this,Rusha);chunkSize=chunkSize||64*1024;if(chunkSize%64>0){throw new Error('Chunk size must be a multiple of 128 bit')}
this._offset=0;this._maxChunkLen=chunkSize;this._padMaxChunkLen=padlen(chunkSize);this._heap=new ArrayBuffer(ceilHeapSize(this._padMaxChunkLen+320+20));this._h32=new Int32Array(this._heap);this._h8=new Int8Array(this._heap);this._core=new RushaCore({Int32Array:Int32Array},{},this._heap)}
Rusha.prototype._initState=function _initState(heap,padMsgLen){this._offset=0;var io=new Int32Array(heap,padMsgLen+320,5);io[0]=1732584193;io[1]=-271733879;io[2]=-1732584194;io[3]=271733878;io[4]=-1009589776};Rusha.prototype._padChunk=function _padChunk(chunkLen,msgLen){var padChunkLen=padlen(chunkLen);var view=new Int32Array(this._heap,0,padChunkLen>>2);padZeroes(view,chunkLen);padData(view,chunkLen,msgLen);return padChunkLen};Rusha.prototype._write=function _write(data,chunkOffset,chunkLen,off){conv(data,this._h8,this._h32,chunkOffset,chunkLen,off||0)};Rusha.prototype._coreCall=function _coreCall(data,chunkOffset,chunkLen,msgLen,finalize){var padChunkLen=chunkLen;this._write(data,chunkOffset,chunkLen);if(finalize){padChunkLen=this._padChunk(chunkLen,msgLen)}
this._core.hash(padChunkLen,this._padMaxChunkLen)};Rusha.prototype.rawDigest=function rawDigest(str){var msgLen=str.byteLength||str.length||str.size||0;this._initState(this._heap,this._padMaxChunkLen);var chunkOffset=0,chunkLen=this._maxChunkLen;for(chunkOffset=0;msgLen>chunkOffset+chunkLen;chunkOffset+=chunkLen){this._coreCall(str,chunkOffset,chunkLen,msgLen,!1)}
this._coreCall(str,chunkOffset,msgLen-chunkOffset,msgLen,!0);return getRawDigest(this._heap,this._padMaxChunkLen)};Rusha.prototype.digest=function digest(str){return toHex(this.rawDigest(str).buffer)};Rusha.prototype.digestFromString=function digestFromString(str){return this.digest(str)};Rusha.prototype.digestFromBuffer=function digestFromBuffer(str){return this.digest(str)};Rusha.prototype.digestFromArrayBuffer=function digestFromArrayBuffer(str){return this.digest(str)};Rusha.prototype.resetState=function resetState(){this._initState(this._heap,this._padMaxChunkLen);return this};Rusha.prototype.append=function append(chunk){var chunkOffset=0;var chunkLen=chunk.byteLength||chunk.length||chunk.size||0;var turnOffset=this._offset%this._maxChunkLen;var inputLen=void 0;this._offset+=chunkLen;while(chunkOffset<chunkLen){inputLen=Math.min(chunkLen-chunkOffset,this._maxChunkLen-turnOffset);this._write(chunk,chunkOffset,inputLen,turnOffset);turnOffset+=inputLen;chunkOffset+=inputLen;if(turnOffset===this._maxChunkLen){this._core.hash(this._maxChunkLen,this._padMaxChunkLen);turnOffset=0}}
return this};Rusha.prototype.getState=function getState(){var turnOffset=this._offset%this._maxChunkLen;var heap=void 0;if(!turnOffset){var io=new Int32Array(this._heap,this._padMaxChunkLen+320,5);heap=io.buffer.slice(io.byteOffset,io.byteOffset+io.byteLength)}else{heap=this._heap.slice(0)}
return{offset:this._offset,heap:heap}};Rusha.prototype.setState=function setState(state){this._offset=state.offset;if(state.heap.byteLength===20){var io=new Int32Array(this._heap,this._padMaxChunkLen+320,5);io.set(new Int32Array(state.heap))}else{this._h32.set(new Int32Array(state.heap))}
return this};Rusha.prototype.rawEnd=function rawEnd(){var msgLen=this._offset;var chunkLen=msgLen%this._maxChunkLen;var padChunkLen=this._padChunk(chunkLen,msgLen);this._core.hash(padChunkLen,this._padMaxChunkLen);var result=getRawDigest(this._heap,this._padMaxChunkLen);this._initState(this._heap,this._padMaxChunkLen);return result};Rusha.prototype.end=function end(){return toHex(this.rawEnd().buffer)};return Rusha}();module.exports=Rusha;module.exports._core=RushaCore}),(function(module,exports){var precomputedHex=new Array(256);for(var i=0;i<256;i++){precomputedHex[i]=(i<0x10?'0':'')+i.toString(16)}
module.exports.toHex=function(arrayBuffer){var binarray=new Uint8Array(arrayBuffer);var res=new Array(arrayBuffer.byteLength);for(var _i=0;_i<res.length;_i++){res[_i]=precomputedHex[binarray[_i]]}
return res.join('')};module.exports.ceilHeapSize=function(v){var p=0;if(v<=65536)return 65536;if(v<16777216){for(p=1;p<v;p=p<<1){}}else{for(p=16777216;p<v;p+=16777216){}}
return p};module.exports.isDedicatedWorkerScope=function(self){var isRunningInWorker='WorkerGlobalScope' in self&&self instanceof self.WorkerGlobalScope;var isRunningInSharedWorker='SharedWorkerGlobalScope' in self&&self instanceof self.SharedWorkerGlobalScope;var isRunningInServiceWorker='ServiceWorkerGlobalScope' in self&&self instanceof self.ServiceWorkerGlobalScope;return isRunningInWorker&&!isRunningInSharedWorker&&!isRunningInServiceWorker}}),(function(module,exports,__webpack_require__){module.exports=function(){var Rusha=__webpack_require__(0);var hashData=function(hasher,data,cb){try{return cb(null,hasher.digest(data))}catch(e){return cb(e)}};var hashFile=function(hasher,readTotal,blockSize,file,cb){var reader=new self.FileReader();reader.onloadend=function onloadend(){if(reader.error){return cb(reader.error)}
var buffer=reader.result;readTotal+=reader.result.byteLength;try{hasher.append(buffer)}catch(e){cb(e);return}
if(readTotal<file.size){hashFile(hasher,readTotal,blockSize,file,cb)}else{cb(null,hasher.end())}};reader.readAsArrayBuffer(file.slice(readTotal,readTotal+blockSize))};var workerBehaviourEnabled=!0;self.onmessage=function(event){if(!workerBehaviourEnabled){return}
var data=event.data.data,file=event.data.file,id=event.data.id;if(typeof id==='undefined')return;if(!file&&!data)return;var blockSize=event.data.blockSize||4*1024*1024;var hasher=new Rusha(blockSize);hasher.resetState();var done=function(err,hash){if(!err){self.postMessage({id:id,hash:hash})}else{self.postMessage({id:id,error:err.name})}};if(data)hashData(hasher,data,done);if(file)hashFile(hasher,0,blockSize,file,done)};return function(){workerBehaviourEnabled=!1}}}),(function(module,exports,__webpack_require__){var work=__webpack_require__(4);var Rusha=__webpack_require__(0);var createHash=__webpack_require__(7);var runWorker=__webpack_require__(2);var _require=__webpack_require__(1),isDedicatedWorkerScope=_require.isDedicatedWorkerScope;var isRunningInDedicatedWorker=typeof self!=='undefined'&&isDedicatedWorkerScope(self);Rusha.disableWorkerBehaviour=isRunningInDedicatedWorker?runWorker():function(){};Rusha.createWorker=function(){var worker=work((2));var terminate=worker.terminate;worker.terminate=function(){URL.revokeObjectURL(worker.objectURL);terminate.call(worker)};return worker};Rusha.createHash=createHash;module.exports=Rusha}),(function(module,exports,__webpack_require__){function webpackBootstrapFunc(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])
return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=!0;return module.exports}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})}};__webpack_require__.r=function(exports){Object.defineProperty(exports,'__esModule',{value:!0})};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default']}:function getModuleExports(){return module};__webpack_require__.d(getter,'a',getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="/";__webpack_require__.oe=function(err){console.error(err);throw err};var f=__webpack_require__(__webpack_require__.s=ENTRY_MODULE)
return f.default||f}
var moduleNameReqExp='[\\.|\\-|\\+|\\w|\/|@]+'
var dependencyRegExp='\\((\/\\*.*?\\*\/)?\s?.*?('+moduleNameReqExp+').*?\\)'
function quoteRegExp(str){return(str+'').replace(/[.?*+^$[\]\\(){}|-]/g,'\\$&')}
function getModuleDependencies(sources,module,queueName){var retval={}
retval[queueName]=[]
var fnString=module.toString()
var wrapperSignature=fnString.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/)
if(!wrapperSignature)return retval
var webpackRequireName=wrapperSignature[1]
var re=new RegExp('(\\\\n|\\W)'+quoteRegExp(webpackRequireName)+dependencyRegExp,'g')
var match
while((match=re.exec(fnString))){if(match[3]==='dll-reference')continue
retval[queueName].push(match[3])}
re=new RegExp('\\('+quoteRegExp(webpackRequireName)+'\\("(dll-reference\\s('+moduleNameReqExp+'))"\\)\\)'+dependencyRegExp,'g')
while((match=re.exec(fnString))){if(!sources[match[2]]){retval[queueName].push(match[1])
sources[match[2]]=__webpack_require__(match[1]).m}
retval[match[2]]=retval[match[2]]||[]
retval[match[2]].push(match[4])}
return retval}
function hasValuesInQueues(queues){var keys=Object.keys(queues)
return keys.reduce(function(hasValues,key){return hasValues||queues[key].length>0},!1)}
function getRequiredModules(sources,moduleId){var modulesQueue={main:[moduleId]}
var requiredModules={main:[]}
var seenModules={main:{}}
while(hasValuesInQueues(modulesQueue)){var queues=Object.keys(modulesQueue)
for(var i=0;i<queues.length;i++){var queueName=queues[i]
var queue=modulesQueue[queueName]
var moduleToCheck=queue.pop()
seenModules[queueName]=seenModules[queueName]||{}
if(seenModules[queueName][moduleToCheck]||!sources[queueName][moduleToCheck])continue
seenModules[queueName][moduleToCheck]=!0
requiredModules[queueName]=requiredModules[queueName]||[]
requiredModules[queueName].push(moduleToCheck)
var newModules=getModuleDependencies(sources,sources[queueName][moduleToCheck],queueName)
var newModulesKeys=Object.keys(newModules)
for(var j=0;j<newModulesKeys.length;j++){modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]]||[]
modulesQueue[newModulesKeys[j]]=modulesQueue[newModulesKeys[j]].concat(newModules[newModulesKeys[j]])}}}
return requiredModules}
module.exports=function(moduleId,options){options=options||{}
var sources={main:__webpack_require__.m}
var requiredModules=options.all?{main:Object.keys(sources)}:getRequiredModules(sources,moduleId)
var src=''
Object.keys(requiredModules).filter(function(m){return m!=='main'}).forEach(function(module){var entryModule=0
while(requiredModules[module][entryModule]){entryModule++}
requiredModules[module].push(entryModule)
sources[module][entryModule]='(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })'
src=src+'var '+module+' = ('+webpackBootstrapFunc.toString().replace('ENTRY_MODULE',JSON.stringify(entryModule))+')({'+requiredModules[module].map(function(id){return''+JSON.stringify(id)+': '+sources[module][id].toString()}).join(',')+'});\n'})
src=src+'('+webpackBootstrapFunc.toString().replace('ENTRY_MODULE',JSON.stringify(moduleId))+')({'+requiredModules.main.map(function(id){return''+JSON.stringify(id)+': '+sources.main[id].toString()}).join(',')+'})(self);'
var blob=new window.Blob([src],{type:'text/javascript'})
if(options.bare){return blob}
var URL=window.URL||window.webkitURL||window.mozURL||window.msURL
var workerUrl=URL.createObjectURL(blob)
var worker=new window.Worker(workerUrl)
worker.objectURL=workerUrl
return worker}}),(function(module,exports){module.exports=function RushaCore(stdlib$846,foreign$847,heap$848){'use asm';var H$849=new stdlib$846.Int32Array(heap$848);function hash$850(k$851,x$852){k$851=k$851|0;x$852=x$852|0;var i$853=0,j$854=0,y0$855=0,z0$856=0,y1$857=0,z1$858=0,y2$859=0,z2$860=0,y3$861=0,z3$862=0,y4$863=0,z4$864=0,t0$865=0,t1$866=0;y0$855=H$849[x$852+320>>2]|0;y1$857=H$849[x$852+324>>2]|0;y2$859=H$849[x$852+328>>2]|0;y3$861=H$849[x$852+332>>2]|0;y4$863=H$849[x$852+336>>2]|0;for(i$853=0;(i$853|0)<(k$851|0);i$853=i$853+64|0){z0$856=y0$855;z1$858=y1$857;z2$860=y2$859;z3$862=y3$861;z4$864=y4$863;for(j$854=0;(j$854|0)<64;j$854=j$854+4|0){t1$866=H$849[i$853+j$854>>2]|0;t0$865=((y0$855<<5|y0$855>>>27)+(y1$857&y2$859|~y1$857&y3$861)|0)+((t1$866+y4$863|0)+1518500249|0)|0;y4$863=y3$861;y3$861=y2$859;y2$859=y1$857<<30|y1$857>>>2;y1$857=y0$855;y0$855=t0$865;H$849[k$851+j$854>>2]=t1$866}
for(j$854=k$851+64|0;(j$854|0)<(k$851+80|0);j$854=j$854+4|0){t1$866=(H$849[j$854-12>>2]^H$849[j$854-32>>2]^H$849[j$854-56>>2]^H$849[j$854-64>>2])<<1|(H$849[j$854-12>>2]^H$849[j$854-32>>2]^H$849[j$854-56>>2]^H$849[j$854-64>>2])>>>31;t0$865=((y0$855<<5|y0$855>>>27)+(y1$857&y2$859|~y1$857&y3$861)|0)+((t1$866+y4$863|0)+1518500249|0)|0;y4$863=y3$861;y3$861=y2$859;y2$859=y1$857<<30|y1$857>>>2;y1$857=y0$855;y0$855=t0$865;H$849[j$854>>2]=t1$866}
for(j$854=k$851+80|0;(j$854|0)<(k$851+160|0);j$854=j$854+4|0){t1$866=(H$849[j$854-12>>2]^H$849[j$854-32>>2]^H$849[j$854-56>>2]^H$849[j$854-64>>2])<<1|(H$849[j$854-12>>2]^H$849[j$854-32>>2]^H$849[j$854-56>>2]^H$849[j$854-64>>2])>>>31;t0$865=((y0$855<<5|y0$855>>>27)+(y1$857^y2$859^y3$861)|0)+((t1$866+y4$863|0)+1859775393|0)|0;y4$863=y3$861;y3$861=y2$859;y2$859=y1$857<<30|y1$857>>>2;y1$857=y0$855;y0$855=t0$865;H$849[j$854>>2]=t1$866}
for(j$854=k$851+160|0;(j$854|0)<(k$851+240|0);j$854=j$854+4|0){t1$866=(H$849[j$854-12>>2]^H$849[j$854-32>>2]^H$849[j$854-56>>2]^H$849[j$854-64>>2])<<1|(H$849[j$854-12>>2]^H$849[j$854-32>>2]^H$849[j$854-56>>2]^H$849[j$854-64>>2])>>>31;t0$865=((y0$855<<5|y0$855>>>27)+(y1$857&y2$859|y1$857&y3$861|y2$859&y3$861)|0)+((t1$866+y4$863|0)-1894007588|0)|0;y4$863=y3$861;y3$861=y2$859;y2$859=y1$857<<30|y1$857>>>2;y1$857=y0$855;y0$855=t0$865;H$849[j$854>>2]=t1$866}
for(j$854=k$851+240|0;(j$854|0)<(k$851+320|0);j$854=j$854+4|0){t1$866=(H$849[j$854-12>>2]^H$849[j$854-32>>2]^H$849[j$854-56>>2]^H$849[j$854-64>>2])<<1|(H$849[j$854-12>>2]^H$849[j$854-32>>2]^H$849[j$854-56>>2]^H$849[j$854-64>>2])>>>31;t0$865=((y0$855<<5|y0$855>>>27)+(y1$857^y2$859^y3$861)|0)+((t1$866+y4$863|0)-899497514|0)|0;y4$863=y3$861;y3$861=y2$859;y2$859=y1$857<<30|y1$857>>>2;y1$857=y0$855;y0$855=t0$865;H$849[j$854>>2]=t1$866}
y0$855=y0$855+z0$856|0;y1$857=y1$857+z1$858|0;y2$859=y2$859+z2$860|0;y3$861=y3$861+z3$862|0;y4$863=y4$863+z4$864|0}
H$849[x$852+320>>2]=y0$855;H$849[x$852+324>>2]=y1$857;H$849[x$852+328>>2]=y2$859;H$849[x$852+332>>2]=y3$861;H$849[x$852+336>>2]=y4$863}
return{hash:hash$850}}}),(function(module,exports){var _this=this;var reader=void 0;if(typeof self!=='undefined'&&typeof self.FileReaderSync!=='undefined'){reader=new self.FileReaderSync()}
var convStr=function(str,H8,H32,start,len,off){var i=void 0,om=off%4,lm=(len+om)%4,j=len-lm;switch(om){case 0:H8[off]=str.charCodeAt(start+3);case 1:H8[off+1-(om<<1)|0]=str.charCodeAt(start+2);case 2:H8[off+2-(om<<1)|0]=str.charCodeAt(start+1);case 3:H8[off+3-(om<<1)|0]=str.charCodeAt(start)}
if(len<lm+(4-om)){return}
for(i=4-om;i<j;i=i+4|0){H32[off+i>>2]=str.charCodeAt(start+i)<<24|str.charCodeAt(start+i+1)<<16|str.charCodeAt(start+i+2)<<8|str.charCodeAt(start+i+3)}
switch(lm){case 3:H8[off+j+1|0]=str.charCodeAt(start+j+2);case 2:H8[off+j+2|0]=str.charCodeAt(start+j+1);case 1:H8[off+j+3|0]=str.charCodeAt(start+j)}};var convBuf=function(buf,H8,H32,start,len,off){var i=void 0,om=off%4,lm=(len+om)%4,j=len-lm;switch(om){case 0:H8[off]=buf[start+3];case 1:H8[off+1-(om<<1)|0]=buf[start+2];case 2:H8[off+2-(om<<1)|0]=buf[start+1];case 3:H8[off+3-(om<<1)|0]=buf[start]}
if(len<lm+(4-om)){return}
for(i=4-om;i<j;i=i+4|0){H32[off+i>>2|0]=buf[start+i]<<24|buf[start+i+1]<<16|buf[start+i+2]<<8|buf[start+i+3]}
switch(lm){case 3:H8[off+j+1|0]=buf[start+j+2];case 2:H8[off+j+2|0]=buf[start+j+1];case 1:H8[off+j+3|0]=buf[start+j]}};var convBlob=function(blob,H8,H32,start,len,off){var i=void 0,om=off%4,lm=(len+om)%4,j=len-lm;var buf=new Uint8Array(reader.readAsArrayBuffer(blob.slice(start,start+len)));switch(om){case 0:H8[off]=buf[3];case 1:H8[off+1-(om<<1)|0]=buf[2];case 2:H8[off+2-(om<<1)|0]=buf[1];case 3:H8[off+3-(om<<1)|0]=buf[0]}
if(len<lm+(4-om)){return}
for(i=4-om;i<j;i=i+4|0){H32[off+i>>2|0]=buf[i]<<24|buf[i+1]<<16|buf[i+2]<<8|buf[i+3]}
switch(lm){case 3:H8[off+j+1|0]=buf[j+2];case 2:H8[off+j+2|0]=buf[j+1];case 1:H8[off+j+3|0]=buf[j]}};module.exports=function(data,H8,H32,start,len,off){if(typeof data==='string'){return convStr(data,H8,H32,start,len,off)}
if(data instanceof Array){return convBuf(data,H8,H32,start,len,off)}
if(_this&&_this.Buffer&&_this.Buffer.isBuffer(data)){return convBuf(data,H8,H32,start,len,off)}
if(data instanceof ArrayBuffer){return convBuf(new Uint8Array(data),H8,H32,start,len,off)}
if(data.buffer instanceof ArrayBuffer){return convBuf(new Uint8Array(data.buffer,data.byteOffset,data.byteLength),H8,H32,start,len,off)}
if(data instanceof Blob){return convBlob(data,H8,H32,start,len,off)}
throw new Error('Unsupported data type.')}}),(function(module,exports,__webpack_require__){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}
var Rusha=__webpack_require__(0);var _require=__webpack_require__(1),toHex=_require.toHex;var Hash=function(){function Hash(){_classCallCheck(this,Hash);this._rusha=new Rusha();this._rusha.resetState()}
Hash.prototype.update=function update(data){this._rusha.append(data);return this};Hash.prototype.digest=function digest(encoding){var digest=this._rusha.rawEnd().buffer;if(!encoding){return digest}
if(encoding==='hex'){return toHex(digest)}
throw new Error('unsupported digest encoding')};return Hash}();module.exports=function(){return new Hash()}})])})},{}],401:[function(require,module,exports){var buffer=require('buffer')
var Buffer=buffer.Buffer
function copyProps(src,dst){for(var key in src){dst[key]=src[key]}}
if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=buffer}else{copyProps(buffer,exports)
exports.Buffer=SafeBuffer}
function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}
copyProps(Buffer,SafeBuffer)
SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==='number'){throw new TypeError('Argument must not be a number')}
return Buffer(arg,encodingOrOffset,length)}
SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=='number'){throw new TypeError('Argument must be a number')}
var buf=Buffer(size)
if(fill!==undefined){if(typeof encoding==='string'){buf.fill(fill,encoding)}else{buf.fill(fill)}}else{buf.fill(0)}
return buf}
SafeBuffer.allocUnsafe=function(size){if(typeof size!=='number'){throw new TypeError('Argument must be a number')}
return Buffer(size)}
SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=='number'){throw new TypeError('Argument must be a number')}
return buffer.SlowBuffer(size)}},{"buffer":54}],402:[function(require,module,exports){(function(Buffer){;(function(sax){sax.parser=function(strict,opt){return new SAXParser(strict,opt)}
sax.SAXParser=SAXParser
sax.SAXStream=SAXStream
sax.createStream=createStream
sax.MAX_BUFFER_LENGTH=64*1024
var buffers=['comment','sgmlDecl','textNode','tagName','doctype','procInstName','procInstBody','entity','attribName','attribValue','cdata','script']
sax.EVENTS=['text','processinginstruction','sgmldeclaration','doctype','comment','opentagstart','attribute','opentag','closetag','opencdata','cdata','closecdata','error','end','ready','script','opennamespace','closenamespace']
function SAXParser(strict,opt){if(!(this instanceof SAXParser)){return new SAXParser(strict,opt)}
var parser=this
clearBuffers(parser)
parser.q=parser.c=''
parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH
parser.opt=opt||{}
parser.opt.lowercase=parser.opt.lowercase||parser.opt.lowercasetags
parser.looseCase=parser.opt.lowercase?'toLowerCase':'toUpperCase'
parser.tags=[]
parser.closed=parser.closedRoot=parser.sawRoot=!1
parser.tag=parser.error=null
parser.strict=!!strict
parser.noscript=!!(strict||parser.opt.noscript)
parser.state=S.BEGIN
parser.strictEntities=parser.opt.strictEntities
parser.ENTITIES=parser.strictEntities?Object.create(sax.XML_ENTITIES):Object.create(sax.ENTITIES)
parser.attribList=[]
if(parser.opt.xmlns){parser.ns=Object.create(rootNS)}
parser.trackPosition=parser.opt.position!==!1
if(parser.trackPosition){parser.position=parser.line=parser.column=0}
emit(parser,'onready')}
if(!Object.create){Object.create=function(o){function F(){}
F.prototype=o
var newf=new F()
return newf}}
if(!Object.keys){Object.keys=function(o){var a=[]
for(var i in o)if(o.hasOwnProperty(i))a.push(i)
return a}}
function checkBufferLength(parser){var maxAllowed=Math.max(sax.MAX_BUFFER_LENGTH,10)
var maxActual=0
for(var i=0,l=buffers.length;i<l;i++){var len=parser[buffers[i]].length
if(len>maxAllowed){switch(buffers[i]){case 'textNode':closeText(parser)
break
case 'cdata':emitNode(parser,'oncdata',parser.cdata)
parser.cdata=''
break
case 'script':emitNode(parser,'onscript',parser.script)
parser.script=''
break
default:error(parser,'Max buffer length exceeded: '+buffers[i])}}
maxActual=Math.max(maxActual,len)}
var m=sax.MAX_BUFFER_LENGTH-maxActual
parser.bufferCheckPosition=m+parser.position}
function clearBuffers(parser){for(var i=0,l=buffers.length;i<l;i++){parser[buffers[i]]=''}}
function flushBuffers(parser){closeText(parser)
if(parser.cdata!==''){emitNode(parser,'oncdata',parser.cdata)
parser.cdata=''}
if(parser.script!==''){emitNode(parser,'onscript',parser.script)
parser.script=''}}
SAXParser.prototype={end:function(){end(this)},write:write,resume:function(){this.error=null;return this},close:function(){return this.write(null)},flush:function(){flushBuffers(this)}}
var Stream
try{Stream=require('stream').Stream}catch(ex){Stream=function(){}}
var streamWraps=sax.EVENTS.filter(function(ev){return ev!=='error'&&ev!=='end'})
function createStream(strict,opt){return new SAXStream(strict,opt)}
function SAXStream(strict,opt){if(!(this instanceof SAXStream)){return new SAXStream(strict,opt)}
Stream.apply(this)
this._parser=new SAXParser(strict,opt)
this.writable=!0
this.readable=!0
var me=this
this._parser.onend=function(){me.emit('end')}
this._parser.onerror=function(er){me.emit('error',er)
me._parser.error=null}
this._decoder=null
streamWraps.forEach(function(ev){Object.defineProperty(me,'on'+ev,{get:function(){return me._parser['on'+ev]},set:function(h){if(!h){me.removeAllListeners(ev)
me._parser['on'+ev]=h
return h}
me.on(ev,h)},enumerable:!0,configurable:!1})})}
SAXStream.prototype=Object.create(Stream.prototype,{constructor:{value:SAXStream}})
SAXStream.prototype.write=function(data){if(typeof Buffer==='function'&&typeof Buffer.isBuffer==='function'&&Buffer.isBuffer(data)){if(!this._decoder){var SD=require('string_decoder').StringDecoder
this._decoder=new SD('utf8')}
data=this._decoder.write(data)}
this._parser.write(data.toString())
this.emit('data',data)
return!0}
SAXStream.prototype.end=function(chunk){if(chunk&&chunk.length){this.write(chunk)}
this._parser.end()
return!0}
SAXStream.prototype.on=function(ev,handler){var me=this
if(!me._parser['on'+ev]&&streamWraps.indexOf(ev)!==-1){me._parser['on'+ev]=function(){var args=arguments.length===1?[arguments[0]]:Array.apply(null,arguments)
args.splice(0,0,ev)
me.emit.apply(me,args)}}
return Stream.prototype.on.call(me,ev,handler)}
var CDATA='[CDATA['
var DOCTYPE='DOCTYPE'
var XML_NAMESPACE='http://www.w3.org/XML/1998/namespace'
var XMLNS_NAMESPACE='http://www.w3.org/2000/xmlns/'
var rootNS={xml:XML_NAMESPACE,xmlns:XMLNS_NAMESPACE}
var nameStart=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/
var nameBody=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/
var entityStart=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/
var entityBody=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/
function isWhitespace(c){return c===' '||c==='\n'||c==='\r'||c==='\t'}
function isQuote(c){return c==='"'||c==='\''}
function isAttribEnd(c){return c==='>'||isWhitespace(c)}
function isMatch(regex,c){return regex.test(c)}
function notMatch(regex,c){return!isMatch(regex,c)}
var S=0
sax.STATE={BEGIN:S++,BEGIN_WHITESPACE:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++}
sax.XML_ENTITIES={'amp':'&','gt':'>','lt':'<','quot':'"','apos':"'"}
sax.ENTITIES={'amp':'&','gt':'>','lt':'<','quot':'"','apos':"'",'AElig':198,'Aacute':193,'Acirc':194,'Agrave':192,'Aring':197,'Atilde':195,'Auml':196,'Ccedil':199,'ETH':208,'Eacute':201,'Ecirc':202,'Egrave':200,'Euml':203,'Iacute':205,'Icirc':206,'Igrave':204,'Iuml':207,'Ntilde':209,'Oacute':211,'Ocirc':212,'Ograve':210,'Oslash':216,'Otilde':213,'Ouml':214,'THORN':222,'Uacute':218,'Ucirc':219,'Ugrave':217,'Uuml':220,'Yacute':221,'aacute':225,'acirc':226,'aelig':230,'agrave':224,'aring':229,'atilde':227,'auml':228,'ccedil':231,'eacute':233,'ecirc':234,'egrave':232,'eth':240,'euml':235,'iacute':237,'icirc':238,'igrave':236,'iuml':239,'ntilde':241,'oacute':243,'ocirc':244,'ograve':242,'oslash':248,'otilde':245,'ouml':246,'szlig':223,'thorn':254,'uacute':250,'ucirc':251,'ugrave':249,'uuml':252,'yacute':253,'yuml':255,'copy':169,'reg':174,'nbsp':160,'iexcl':161,'cent':162,'pound':163,'curren':164,'yen':165,'brvbar':166,'sect':167,'uml':168,'ordf':170,'laquo':171,'not':172,'shy':173,'macr':175,'deg':176,'plusmn':177,'sup1':185,'sup2':178,'sup3':179,'acute':180,'micro':181,'para':182,'middot':183,'cedil':184,'ordm':186,'raquo':187,'frac14':188,'frac12':189,'frac34':190,'iquest':191,'times':215,'divide':247,'OElig':338,'oelig':339,'Scaron':352,'scaron':353,'Yuml':376,'fnof':402,'circ':710,'tilde':732,'Alpha':913,'Beta':914,'Gamma':915,'Delta':916,'Epsilon':917,'Zeta':918,'Eta':919,'Theta':920,'Iota':921,'Kappa':922,'Lambda':923,'Mu':924,'Nu':925,'Xi':926,'Omicron':927,'Pi':928,'Rho':929,'Sigma':931,'Tau':932,'Upsilon':933,'Phi':934,'Chi':935,'Psi':936,'Omega':937,'alpha':945,'beta':946,'gamma':947,'delta':948,'epsilon':949,'zeta':950,'eta':951,'theta':952,'iota':953,'kappa':954,'lambda':955,'mu':956,'nu':957,'xi':958,'omicron':959,'pi':960,'rho':961,'sigmaf':962,'sigma':963,'tau':964,'upsilon':965,'phi':966,'chi':967,'psi':968,'omega':969,'thetasym':977,'upsih':978,'piv':982,'ensp':8194,'emsp':8195,'thinsp':8201,'zwnj':8204,'zwj':8205,'lrm':8206,'rlm':8207,'ndash':8211,'mdash':8212,'lsquo':8216,'rsquo':8217,'sbquo':8218,'ldquo':8220,'rdquo':8221,'bdquo':8222,'dagger':8224,'Dagger':8225,'bull':8226,'hellip':8230,'permil':8240,'prime':8242,'Prime':8243,'lsaquo':8249,'rsaquo':8250,'oline':8254,'frasl':8260,'euro':8364,'image':8465,'weierp':8472,'real':8476,'trade':8482,'alefsym':8501,'larr':8592,'uarr':8593,'rarr':8594,'darr':8595,'harr':8596,'crarr':8629,'lArr':8656,'uArr':8657,'rArr':8658,'dArr':8659,'hArr':8660,'forall':8704,'part':8706,'exist':8707,'empty':8709,'nabla':8711,'isin':8712,'notin':8713,'ni':8715,'prod':8719,'sum':8721,'minus':8722,'lowast':8727,'radic':8730,'prop':8733,'infin':8734,'ang':8736,'and':8743,'or':8744,'cap':8745,'cup':8746,'int':8747,'there4':8756,'sim':8764,'cong':8773,'asymp':8776,'ne':8800,'equiv':8801,'le':8804,'ge':8805,'sub':8834,'sup':8835,'nsub':8836,'sube':8838,'supe':8839,'oplus':8853,'otimes':8855,'perp':8869,'sdot':8901,'lceil':8968,'rceil':8969,'lfloor':8970,'rfloor':8971,'lang':9001,'rang':9002,'loz':9674,'spades':9824,'clubs':9827,'hearts':9829,'diams':9830}
Object.keys(sax.ENTITIES).forEach(function(key){var e=sax.ENTITIES[key]
var s=typeof e==='number'?String.fromCharCode(e):e
sax.ENTITIES[key]=s})
for(var s in sax.STATE){sax.STATE[sax.STATE[s]]=s}
S=sax.STATE
function emit(parser,event,data){parser[event]&&parser[event](data)}
function emitNode(parser,nodeType,data){if(parser.textNode)closeText(parser)
emit(parser,nodeType,data)}
function closeText(parser){parser.textNode=textopts(parser.opt,parser.textNode)
if(parser.textNode)emit(parser,'ontext',parser.textNode)
parser.textNode=''}
function textopts(opt,text){if(opt.trim)text=text.trim()
if(opt.normalize)text=text.replace(/\s+/g,' ')
return text}
function error(parser,er){closeText(parser)
if(parser.trackPosition){er+='\nLine: '+parser.line+'\nColumn: '+parser.column+'\nChar: '+parser.c}
er=new Error(er)
parser.error=er
emit(parser,'onerror',er)
return parser}
function end(parser){if(parser.sawRoot&&!parser.closedRoot)strictFail(parser,'Unclosed root tag')
if((parser.state!==S.BEGIN)&&(parser.state!==S.BEGIN_WHITESPACE)&&(parser.state!==S.TEXT)){error(parser,'Unexpected end')}
closeText(parser)
parser.c=''
parser.closed=!0
emit(parser,'onend')
SAXParser.call(parser,parser.strict,parser.opt)
return parser}
function strictFail(parser,message){if(typeof parser!=='object'||!(parser instanceof SAXParser)){throw new Error('bad call to strictFail')}
if(parser.strict){error(parser,message)}}
function newTag(parser){if(!parser.strict)parser.tagName=parser.tagName[parser.looseCase]()
var parent=parser.tags[parser.tags.length-1]||parser
var tag=parser.tag={name:parser.tagName,attributes:{}}
if(parser.opt.xmlns){tag.ns=parent.ns}
parser.attribList.length=0
emitNode(parser,'onopentagstart',tag)}
function qname(name,attribute){var i=name.indexOf(':')
var qualName=i<0?['',name]:name.split(':')
var prefix=qualName[0]
var local=qualName[1]
if(attribute&&name==='xmlns'){prefix='xmlns'
local=''}
return{prefix:prefix,local:local}}
function attrib(parser){if(!parser.strict){parser.attribName=parser.attribName[parser.looseCase]()}
if(parser.attribList.indexOf(parser.attribName)!==-1||parser.tag.attributes.hasOwnProperty(parser.attribName)){parser.attribName=parser.attribValue=''
return}
if(parser.opt.xmlns){var qn=qname(parser.attribName,!0)
var prefix=qn.prefix
var local=qn.local
if(prefix==='xmlns'){if(local==='xml'&&parser.attribValue!==XML_NAMESPACE){strictFail(parser,'xml: prefix must be bound to '+XML_NAMESPACE+'\n'+'Actual: '+parser.attribValue)}else if(local==='xmlns'&&parser.attribValue!==XMLNS_NAMESPACE){strictFail(parser,'xmlns: prefix must be bound to '+XMLNS_NAMESPACE+'\n'+'Actual: '+parser.attribValue)}else{var tag=parser.tag
var parent=parser.tags[parser.tags.length-1]||parser
if(tag.ns===parent.ns){tag.ns=Object.create(parent.ns)}
tag.ns[local]=parser.attribValue}}
parser.attribList.push([parser.attribName,parser.attribValue])}else{parser.tag.attributes[parser.attribName]=parser.attribValue
emitNode(parser,'onattribute',{name:parser.attribName,value:parser.attribValue})}
parser.attribName=parser.attribValue=''}
function openTag(parser,selfClosing){if(parser.opt.xmlns){var tag=parser.tag
var qn=qname(parser.tagName)
tag.prefix=qn.prefix
tag.local=qn.local
tag.uri=tag.ns[qn.prefix]||''
if(tag.prefix&&!tag.uri){strictFail(parser,'Unbound namespace prefix: '+JSON.stringify(parser.tagName))
tag.uri=qn.prefix}
var parent=parser.tags[parser.tags.length-1]||parser
if(tag.ns&&parent.ns!==tag.ns){Object.keys(tag.ns).forEach(function(p){emitNode(parser,'onopennamespace',{prefix:p,uri:tag.ns[p]})})}
for(var i=0,l=parser.attribList.length;i<l;i++){var nv=parser.attribList[i]
var name=nv[0]
var value=nv[1]
var qualName=qname(name,!0)
var prefix=qualName.prefix
var local=qualName.local
var uri=prefix===''?'':(tag.ns[prefix]||'')
var a={name:name,value:value,prefix:prefix,local:local,uri:uri}
if(prefix&&prefix!=='xmlns'&&!uri){strictFail(parser,'Unbound namespace prefix: '+JSON.stringify(prefix))
a.uri=prefix}
parser.tag.attributes[name]=a
emitNode(parser,'onattribute',a)}
parser.attribList.length=0}
parser.tag.isSelfClosing=!!selfClosing
parser.sawRoot=!0
parser.tags.push(parser.tag)
emitNode(parser,'onopentag',parser.tag)
if(!selfClosing){if(!parser.noscript&&parser.tagName.toLowerCase()==='script'){parser.state=S.SCRIPT}else{parser.state=S.TEXT}
parser.tag=null
parser.tagName=''}
parser.attribName=parser.attribValue=''
parser.attribList.length=0}
function closeTag(parser){if(!parser.tagName){strictFail(parser,'Weird empty close tag.')
parser.textNode+='</>'
parser.state=S.TEXT
return}
if(parser.script){if(parser.tagName!=='script'){parser.script+='</'+parser.tagName+'>'
parser.tagName=''
parser.state=S.SCRIPT
return}
emitNode(parser,'onscript',parser.script)
parser.script=''}
var t=parser.tags.length
var tagName=parser.tagName
if(!parser.strict){tagName=tagName[parser.looseCase]()}
var closeTo=tagName
while(t--){var close=parser.tags[t]
if(close.name!==closeTo){strictFail(parser,'Unexpected close tag')}else{break}}
if(t<0){strictFail(parser,'Unmatched closing tag: '+parser.tagName)
parser.textNode+='</'+parser.tagName+'>'
parser.state=S.TEXT
return}
parser.tagName=tagName
var s=parser.tags.length
while(s-->t){var tag=parser.tag=parser.tags.pop()
parser.tagName=parser.tag.name
emitNode(parser,'onclosetag',parser.tagName)
var x={}
for(var i in tag.ns){x[i]=tag.ns[i]}
var parent=parser.tags[parser.tags.length-1]||parser
if(parser.opt.xmlns&&tag.ns!==parent.ns){Object.keys(tag.ns).forEach(function(p){var n=tag.ns[p]
emitNode(parser,'onclosenamespace',{prefix:p,uri:n})})}}
if(t===0)parser.closedRoot=!0
parser.tagName=parser.attribValue=parser.attribName=''
parser.attribList.length=0
parser.state=S.TEXT}
function parseEntity(parser){var entity=parser.entity
var entityLC=entity.toLowerCase()
var num
var numStr=''
if(parser.ENTITIES[entity]){return parser.ENTITIES[entity]}
if(parser.ENTITIES[entityLC]){return parser.ENTITIES[entityLC]}
entity=entityLC
if(entity.charAt(0)==='#'){if(entity.charAt(1)==='x'){entity=entity.slice(2)
num=parseInt(entity,16)
numStr=num.toString(16)}else{entity=entity.slice(1)
num=parseInt(entity,10)
numStr=num.toString(10)}}
entity=entity.replace(/^0+/,'')
if(isNaN(num)||numStr.toLowerCase()!==entity){strictFail(parser,'Invalid character entity')
return'&'+parser.entity+';'}
return String.fromCodePoint(num)}
function beginWhiteSpace(parser,c){if(c==='<'){parser.state=S.OPEN_WAKA
parser.startTagPosition=parser.position}else if(!isWhitespace(c)){strictFail(parser,'Non-whitespace before first tag.')
parser.textNode=c
parser.state=S.TEXT}}
function charAt(chunk,i){var result=''
if(i<chunk.length){result=chunk.charAt(i)}
return result}
function write(chunk){var parser=this
if(this.error){throw this.error}
if(parser.closed){return error(parser,'Cannot write after close. Assign an onready handler.')}
if(chunk===null){return end(parser)}
if(typeof chunk==='object'){chunk=chunk.toString()}
var i=0
var c=''
while(!0){c=charAt(chunk,i++)
parser.c=c
if(!c){break}
if(parser.trackPosition){parser.position++
if(c==='\n'){parser.line++
parser.column=0}else{parser.column++}}
switch(parser.state){case S.BEGIN:parser.state=S.BEGIN_WHITESPACE
if(c==='\uFEFF'){continue}
beginWhiteSpace(parser,c)
continue
case S.BEGIN_WHITESPACE:beginWhiteSpace(parser,c)
continue
case S.TEXT:if(parser.sawRoot&&!parser.closedRoot){var starti=i-1
while(c&&c!=='<'&&c!=='&'){c=charAt(chunk,i++)
if(c&&parser.trackPosition){parser.position++
if(c==='\n'){parser.line++
parser.column=0}else{parser.column++}}}
parser.textNode+=chunk.substring(starti,i-1)}
if(c==='<'&&!(parser.sawRoot&&parser.closedRoot&&!parser.strict)){parser.state=S.OPEN_WAKA
parser.startTagPosition=parser.position}else{if(!isWhitespace(c)&&(!parser.sawRoot||parser.closedRoot)){strictFail(parser,'Text data outside of root node.')}
if(c==='&'){parser.state=S.TEXT_ENTITY}else{parser.textNode+=c}}
continue
case S.SCRIPT:if(c==='<'){parser.state=S.SCRIPT_ENDING}else{parser.script+=c}
continue
case S.SCRIPT_ENDING:if(c==='/'){parser.state=S.CLOSE_TAG}else{parser.script+='<'+c
parser.state=S.SCRIPT}
continue
case S.OPEN_WAKA:if(c==='!'){parser.state=S.SGML_DECL
parser.sgmlDecl=''}else if(isWhitespace(c)){}else if(isMatch(nameStart,c)){parser.state=S.OPEN_TAG
parser.tagName=c}else if(c==='/'){parser.state=S.CLOSE_TAG
parser.tagName=''}else if(c==='?'){parser.state=S.PROC_INST
parser.procInstName=parser.procInstBody=''}else{strictFail(parser,'Unencoded <')
if(parser.startTagPosition+1<parser.position){var pad=parser.position-parser.startTagPosition
c=new Array(pad).join(' ')+c}
parser.textNode+='<'+c
parser.state=S.TEXT}
continue
case S.SGML_DECL:if((parser.sgmlDecl+c).toUpperCase()===CDATA){emitNode(parser,'onopencdata')
parser.state=S.CDATA
parser.sgmlDecl=''
parser.cdata=''}else if(parser.sgmlDecl+c==='--'){parser.state=S.COMMENT
parser.comment=''
parser.sgmlDecl=''}else if((parser.sgmlDecl+c).toUpperCase()===DOCTYPE){parser.state=S.DOCTYPE
if(parser.doctype||parser.sawRoot){strictFail(parser,'Inappropriately located doctype declaration')}
parser.doctype=''
parser.sgmlDecl=''}else if(c==='>'){emitNode(parser,'onsgmldeclaration',parser.sgmlDecl)
parser.sgmlDecl=''
parser.state=S.TEXT}else if(isQuote(c)){parser.state=S.SGML_DECL_QUOTED
parser.sgmlDecl+=c}else{parser.sgmlDecl+=c}
continue
case S.SGML_DECL_QUOTED:if(c===parser.q){parser.state=S.SGML_DECL
parser.q=''}
parser.sgmlDecl+=c
continue
case S.DOCTYPE:if(c==='>'){parser.state=S.TEXT
emitNode(parser,'ondoctype',parser.doctype)
parser.doctype=!0}else{parser.doctype+=c
if(c==='['){parser.state=S.DOCTYPE_DTD}else if(isQuote(c)){parser.state=S.DOCTYPE_QUOTED
parser.q=c}}
continue
case S.DOCTYPE_QUOTED:parser.doctype+=c
if(c===parser.q){parser.q=''
parser.state=S.DOCTYPE}
continue
case S.DOCTYPE_DTD:parser.doctype+=c
if(c===']'){parser.state=S.DOCTYPE}else if(isQuote(c)){parser.state=S.DOCTYPE_DTD_QUOTED
parser.q=c}
continue
case S.DOCTYPE_DTD_QUOTED:parser.doctype+=c
if(c===parser.q){parser.state=S.DOCTYPE_DTD
parser.q=''}
continue
case S.COMMENT:if(c==='-'){parser.state=S.COMMENT_ENDING}else{parser.comment+=c}
continue
case S.COMMENT_ENDING:if(c==='-'){parser.state=S.COMMENT_ENDED
parser.comment=textopts(parser.opt,parser.comment)
if(parser.comment){emitNode(parser,'oncomment',parser.comment)}
parser.comment=''}else{parser.comment+='-'+c
parser.state=S.COMMENT}
continue
case S.COMMENT_ENDED:if(c!=='>'){strictFail(parser,'Malformed comment')
parser.comment+='--'+c
parser.state=S.COMMENT}else{parser.state=S.TEXT}
continue
case S.CDATA:if(c===']'){parser.state=S.CDATA_ENDING}else{parser.cdata+=c}
continue
case S.CDATA_ENDING:if(c===']'){parser.state=S.CDATA_ENDING_2}else{parser.cdata+=']'+c
parser.state=S.CDATA}
continue
case S.CDATA_ENDING_2:if(c==='>'){if(parser.cdata){emitNode(parser,'oncdata',parser.cdata)}
emitNode(parser,'onclosecdata')
parser.cdata=''
parser.state=S.TEXT}else if(c===']'){parser.cdata+=']'}else{parser.cdata+=']]'+c
parser.state=S.CDATA}
continue
case S.PROC_INST:if(c==='?'){parser.state=S.PROC_INST_ENDING}else if(isWhitespace(c)){parser.state=S.PROC_INST_BODY}else{parser.procInstName+=c}
continue
case S.PROC_INST_BODY:if(!parser.procInstBody&&isWhitespace(c)){continue}else if(c==='?'){parser.state=S.PROC_INST_ENDING}else{parser.procInstBody+=c}
continue
case S.PROC_INST_ENDING:if(c==='>'){emitNode(parser,'onprocessinginstruction',{name:parser.procInstName,body:parser.procInstBody})
parser.procInstName=parser.procInstBody=''
parser.state=S.TEXT}else{parser.procInstBody+='?'+c
parser.state=S.PROC_INST_BODY}
continue
case S.OPEN_TAG:if(isMatch(nameBody,c)){parser.tagName+=c}else{newTag(parser)
if(c==='>'){openTag(parser)}else if(c==='/'){parser.state=S.OPEN_TAG_SLASH}else{if(!isWhitespace(c)){strictFail(parser,'Invalid character in tag name')}
parser.state=S.ATTRIB}}
continue
case S.OPEN_TAG_SLASH:if(c==='>'){openTag(parser,!0)
closeTag(parser)}else{strictFail(parser,'Forward-slash in opening tag not followed by >')
parser.state=S.ATTRIB}
continue
case S.ATTRIB:if(isWhitespace(c)){continue}else if(c==='>'){openTag(parser)}else if(c==='/'){parser.state=S.OPEN_TAG_SLASH}else if(isMatch(nameStart,c)){parser.attribName=c
parser.attribValue=''
parser.state=S.ATTRIB_NAME}else{strictFail(parser,'Invalid attribute name')}
continue
case S.ATTRIB_NAME:if(c==='='){parser.state=S.ATTRIB_VALUE}else if(c==='>'){strictFail(parser,'Attribute without value')
parser.attribValue=parser.attribName
attrib(parser)
openTag(parser)}else if(isWhitespace(c)){parser.state=S.ATTRIB_NAME_SAW_WHITE}else if(isMatch(nameBody,c)){parser.attribName+=c}else{strictFail(parser,'Invalid attribute name')}
continue
case S.ATTRIB_NAME_SAW_WHITE:if(c==='='){parser.state=S.ATTRIB_VALUE}else if(isWhitespace(c)){continue}else{strictFail(parser,'Attribute without value')
parser.tag.attributes[parser.attribName]=''
parser.attribValue=''
emitNode(parser,'onattribute',{name:parser.attribName,value:''})
parser.attribName=''
if(c==='>'){openTag(parser)}else if(isMatch(nameStart,c)){parser.attribName=c
parser.state=S.ATTRIB_NAME}else{strictFail(parser,'Invalid attribute name')
parser.state=S.ATTRIB}}
continue
case S.ATTRIB_VALUE:if(isWhitespace(c)){continue}else if(isQuote(c)){parser.q=c
parser.state=S.ATTRIB_VALUE_QUOTED}else{strictFail(parser,'Unquoted attribute value')
parser.state=S.ATTRIB_VALUE_UNQUOTED
parser.attribValue=c}
continue
case S.ATTRIB_VALUE_QUOTED:if(c!==parser.q){if(c==='&'){parser.state=S.ATTRIB_VALUE_ENTITY_Q}else{parser.attribValue+=c}
continue}
attrib(parser)
parser.q=''
parser.state=S.ATTRIB_VALUE_CLOSED
continue
case S.ATTRIB_VALUE_CLOSED:if(isWhitespace(c)){parser.state=S.ATTRIB}else if(c==='>'){openTag(parser)}else if(c==='/'){parser.state=S.OPEN_TAG_SLASH}else if(isMatch(nameStart,c)){strictFail(parser,'No whitespace between attributes')
parser.attribName=c
parser.attribValue=''
parser.state=S.ATTRIB_NAME}else{strictFail(parser,'Invalid attribute name')}
continue
case S.ATTRIB_VALUE_UNQUOTED:if(!isAttribEnd(c)){if(c==='&'){parser.state=S.ATTRIB_VALUE_ENTITY_U}else{parser.attribValue+=c}
continue}
attrib(parser)
if(c==='>'){openTag(parser)}else{parser.state=S.ATTRIB}
continue
case S.CLOSE_TAG:if(!parser.tagName){if(isWhitespace(c)){continue}else if(notMatch(nameStart,c)){if(parser.script){parser.script+='</'+c
parser.state=S.SCRIPT}else{strictFail(parser,'Invalid tagname in closing tag.')}}else{parser.tagName=c}}else if(c==='>'){closeTag(parser)}else if(isMatch(nameBody,c)){parser.tagName+=c}else if(parser.script){parser.script+='</'+parser.tagName
parser.tagName=''
parser.state=S.SCRIPT}else{if(!isWhitespace(c)){strictFail(parser,'Invalid tagname in closing tag')}
parser.state=S.CLOSE_TAG_SAW_WHITE}
continue
case S.CLOSE_TAG_SAW_WHITE:if(isWhitespace(c)){continue}
if(c==='>'){closeTag(parser)}else{strictFail(parser,'Invalid characters in closing tag')}
continue
case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:var returnState
var buffer
switch(parser.state){case S.TEXT_ENTITY:returnState=S.TEXT
buffer='textNode'
break
case S.ATTRIB_VALUE_ENTITY_Q:returnState=S.ATTRIB_VALUE_QUOTED
buffer='attribValue'
break
case S.ATTRIB_VALUE_ENTITY_U:returnState=S.ATTRIB_VALUE_UNQUOTED
buffer='attribValue'
break}
if(c===';'){parser[buffer]+=parseEntity(parser)
parser.entity=''
parser.state=returnState}else if(isMatch(parser.entity.length?entityBody:entityStart,c)){parser.entity+=c}else{strictFail(parser,'Invalid character in entity name')
parser[buffer]+='&'+parser.entity+c
parser.entity=''
parser.state=returnState}
continue
default:throw new Error(parser,'Unknown state: '+parser.state)}}
if(parser.position>=parser.bufferCheckPosition){checkBufferLength(parser)}
return parser}
if(!String.fromCodePoint){(function(){var stringFromCharCode=String.fromCharCode
var floor=Math.floor
var fromCodePoint=function(){var MAX_SIZE=0x4000
var codeUnits=[]
var highSurrogate
var lowSurrogate
var index=-1
var length=arguments.length
if(!length){return''}
var result=''
while(++index<length){var codePoint=Number(arguments[index])
if(!isFinite(codePoint)||codePoint<0||codePoint>0x10FFFF||floor(codePoint)!==codePoint){throw RangeError('Invalid code point: '+codePoint)}
if(codePoint<=0xFFFF){codeUnits.push(codePoint)}else{codePoint-=0x10000
highSurrogate=(codePoint>>10)+0xD800
lowSurrogate=(codePoint%0x400)+0xDC00
codeUnits.push(highSurrogate,lowSurrogate)}
if(index+1===length||codeUnits.length>MAX_SIZE){result+=stringFromCharCode.apply(null,codeUnits)
codeUnits.length=0}}
return result}
if(Object.defineProperty){Object.defineProperty(String,'fromCodePoint',{value:fromCodePoint,configurable:!0,writable:!0})}else{String.fromCodePoint=fromCodePoint}}())}})(typeof exports==='undefined'?this.sax={}:exports)}).call(this,require("buffer").Buffer)},{"buffer":54,"stream":176,"string_decoder":181}],403:[function(require,module,exports){(function(Buffer){module.exports=function(stream,cb){var chunks=[]
stream.on('data',function(chunk){chunks.push(chunk)})
stream.once('end',function(){if(cb)cb(null,Buffer.concat(chunks))
cb=null})
stream.once('error',function(err){if(cb)cb(err)
cb=null})}}).call(this,require("buffer").Buffer)},{"buffer":54}],404:[function(require,module,exports){(function(Buffer){module.exports=simpleGet
const concat=require('simple-concat')
const decompressResponse=require('decompress-response')
const http=require('http')
const https=require('https')
const once=require('once')
const querystring=require('querystring')
const url=require('url')
const isStream=o=>o!==null&&typeof o==='object'&&typeof o.pipe==='function'
function simpleGet(opts,cb){opts=Object.assign({maxRedirects:10},typeof opts==='string'?{url:opts}:opts)
cb=once(cb)
if(opts.url){const{hostname,port,protocol,auth,path}=url.parse(opts.url)
delete opts.url
if(!hostname&&!port&&!protocol&&!auth)opts.path=path
else Object.assign(opts,{hostname,port,protocol,auth,path})}
const headers={'accept-encoding':'gzip, deflate'}
if(opts.headers)Object.keys(opts.headers).forEach(k=>(headers[k.toLowerCase()]=opts.headers[k]))
opts.headers=headers
let body
if(opts.body){body=opts.json&&!isStream(opts.body)?JSON.stringify(opts.body):opts.body}else if(opts.form){body=typeof opts.form==='string'?opts.form:querystring.stringify(opts.form)
opts.headers['content-type']='application/x-www-form-urlencoded'}
if(body){if(!opts.method)opts.method='POST'
if(!isStream(body))opts.headers['content-length']=Buffer.byteLength(body)
if(opts.json&&!opts.form)opts.headers['content-type']='application/json'}
delete opts.body;delete opts.form
if(opts.json)opts.headers.accept='application/json'
if(opts.method)opts.method=opts.method.toUpperCase()
const protocol=opts.protocol==='https:'?https:http
const req=protocol.request(opts,res=>{if(res.statusCode>=300&&res.statusCode<400&&res.headers.location){opts.url=res.headers.location
delete opts.headers.host
res.resume()
if(opts.method==='POST'&&[301,302].includes(res.statusCode)){opts.method='GET'
delete opts.headers['content-length'];delete opts.headers['content-type']}
if(opts.maxRedirects--===0)return cb(new Error('too many redirects'))
else return simpleGet(opts,cb)}
const tryUnzip=typeof decompressResponse==='function'&&opts.method!=='HEAD'
cb(null,tryUnzip?decompressResponse(res):res)})
req.on('timeout',()=>{req.abort()
cb(new Error('Request timed out'))})
req.on('error',cb)
if(isStream(body))body.on('error',cb).pipe(req)
else req.end(body)
return req}
simpleGet.concat=(opts,cb)=>{return simpleGet(opts,(err,res)=>{if(err)return cb(err)
concat(res,(err,data)=>{if(err)return cb(err)
if(opts.json){try{data=JSON.parse(data.toString())}catch(err){return cb(err,res,data)}}
cb(null,res,data)})})};['get','post','put','patch','head','delete'].forEach(method=>{simpleGet[method]=(opts,cb)=>{if(typeof opts==='string')opts={url:opts}
return simpleGet(Object.assign({method:method.toUpperCase()},opts),cb)}})}).call(this,require("buffer").Buffer)},{"buffer":54,"decompress-response":23,"http":177,"https":106,"once":363,"querystring":149,"simple-concat":403,"url":184}],405:[function(require,module,exports){(function(Buffer){module.exports=Peer
var debug=require('debug')('simple-peer')
var getBrowserRTC=require('get-browser-rtc')
var inherits=require('inherits')
var randombytes=require('randombytes')
var stream=require('readable-stream')
var MAX_BUFFERED_AMOUNT=64*1024
var ICECOMPLETE_TIMEOUT=5*1000
var CHANNEL_CLOSING_TIMEOUT=5*1000
inherits(Peer,stream.Duplex)
function Peer(opts){var self=this
if(!(self instanceof Peer))return new Peer(opts)
self._id=randombytes(4).toString('hex').slice(0,7)
self._debug('new peer %o',opts)
opts=Object.assign({allowHalfOpen:!1},opts)
stream.Duplex.call(self,opts)
self.channelName=opts.initiator?opts.channelName||randombytes(20).toString('hex'):null
self.initiator=opts.initiator||!1
self.channelConfig=opts.channelConfig||Peer.channelConfig
self.config=Object.assign({},Peer.config,opts.config)
self.offerOptions=opts.offerOptions||{}
self.answerOptions=opts.answerOptions||{}
self.sdpTransform=opts.sdpTransform||function(sdp){return sdp}
self.streams=opts.streams||(opts.stream?[opts.stream]:[])
self.trickle=opts.trickle!==undefined?opts.trickle:!0
self.allowHalfTrickle=opts.allowHalfTrickle!==undefined?opts.allowHalfTrickle:!1
self.iceCompleteTimeout=opts.iceCompleteTimeout||ICECOMPLETE_TIMEOUT
self.destroyed=!1
self.connected=!1
self.remoteAddress=undefined
self.remoteFamily=undefined
self.remotePort=undefined
self.localAddress=undefined
self.localFamily=undefined
self.localPort=undefined
self._wrtc=(opts.wrtc&&typeof opts.wrtc==='object')?opts.wrtc:getBrowserRTC()
if(!self._wrtc){if(typeof window==='undefined'){throw makeError('No WebRTC support: Specify `opts.wrtc` option in this environment','ERR_WEBRTC_SUPPORT')}else{throw makeError('No WebRTC support: Not a supported browser','ERR_WEBRTC_SUPPORT')}}
self._pcReady=!1
self._channelReady=!1
self._iceComplete=!1
self._iceCompleteTimer=null
self._channel=null
self._pendingCandidates=[]
self._isNegotiating=!self.initiator
self._batchedNegotiation=!1
self._queuedNegotiation=!1
self._sendersAwaitingStable=[]
self._senderMap=new Map()
self._firstStable=!0
self._closingInterval=null
self._remoteTracks=[]
self._remoteStreams=[]
self._chunk=null
self._cb=null
self._interval=null
try{self._pc=new(self._wrtc.RTCPeerConnection)(self.config)}catch(err){self.destroy(err)}
self._isReactNativeWebrtc=typeof self._pc._peerConnectionId==='number'
self._pc.oniceconnectionstatechange=function(){self._onIceStateChange()}
self._pc.onicegatheringstatechange=function(){self._onIceStateChange()}
self._pc.onsignalingstatechange=function(){self._onSignalingStateChange()}
self._pc.onicecandidate=function(event){self._onIceCandidate(event)}
if(self.initiator){self._setupData({channel:self._pc.createDataChannel(self.channelName,self.channelConfig)})}else{self._pc.ondatachannel=function(event){self._setupData(event)}}
if(self.streams){self.streams.forEach(function(stream){self.addStream(stream)})}
self._pc.ontrack=function(event){self._onTrack(event)}
if(self.initiator){self._needsNegotiation()}
self._onFinishBound=function(){self._onFinish()}
self.once('finish',self._onFinishBound)}
Peer.WEBRTC_SUPPORT=!!getBrowserRTC()
Peer.config={iceServers:[{urls:'stun:stun.l.google.com:19302'},{urls:'stun:global.stun.twilio.com:3478?transport=udp'}],sdpSemantics:'unified-plan'}
Peer.channelConfig={}
Object.defineProperty(Peer.prototype,'bufferSize',{get:function(){var self=this
return(self._channel&&self._channel.bufferedAmount)||0}})
Peer.prototype.address=function(){var self=this
return{port:self.localPort,family:self.localFamily,address:self.localAddress}}
Peer.prototype.signal=function(data){var self=this
if(self.destroyed)throw makeError('cannot signal after peer is destroyed','ERR_SIGNALING')
if(typeof data==='string'){try{data=JSON.parse(data)}catch(err){data={}}}
self._debug('signal()')
if(data.renegotiate&&self.initiator){self._debug('got request to renegotiate')
self._needsNegotiation()}
if(data.transceiverRequest&&self.initiator){self._debug('got request for transceiver')
self.addTransceiver(data.transceiverRequest.kind,data.transceiverRequest.init)}
if(data.candidate){if(self._pc.localDescription&&self._pc.localDescription.type&&self._pc.remoteDescription&&self._pc.remoteDescription.type){self._addIceCandidate(data.candidate)}else{self._pendingCandidates.push(data.candidate)}}
if(data.sdp){self._pc.setRemoteDescription(new(self._wrtc.RTCSessionDescription)(data)).then(function(){if(self.destroyed)return
self._pendingCandidates.forEach(function(candidate){self._addIceCandidate(candidate)})
self._pendingCandidates=[]
if(self._pc.remoteDescription.type==='offer')self._createAnswer()}).catch(function(err){self.destroy(makeError(err,'ERR_SET_REMOTE_DESCRIPTION'))})}
if(!data.sdp&&!data.candidate&&!data.renegotiate&&!data.transceiverRequest){self.destroy(makeError('signal() called with invalid signal data','ERR_SIGNALING'))}}
Peer.prototype._addIceCandidate=function(candidate){var self=this
self._pc.addIceCandidate(new self._wrtc.RTCIceCandidate(candidate)).catch(function(err){if(self._pc.signalingState!=='closed'&&err.message==='Failed to set ICE candidate; RTCPeerConnection is closed.'){return self._debug('ignoring incorrect wrtc error')}
self.destroy(makeError(err,'ERR_ADD_ICE_CANDIDATE'))})}
Peer.prototype.send=function(chunk){var self=this
self._channel.send(chunk)}
Peer.prototype.addTransceiver=function(kind,init){var self=this
self._debug('addTransceiver()')
if(self.initiator){try{self._pc.addTransceiver(kind,init)
self._needsNegotiation()}catch(err){self.destroy(err)}}else{self.emit('signal',{transceiverRequest:{kind,init}})}}
Peer.prototype.addStream=function(stream){var self=this
self._debug('addStream()')
stream.getTracks().forEach(function(track){self.addTrack(track,stream)})}
Peer.prototype.addTrack=function(track,stream){var self=this
self._debug('addTrack()')
var submap=self._senderMap.get(track)||new Map()
var sender=submap.get(stream)
if(!sender){sender=self._pc.addTrack(track,stream)
submap.set(stream,sender)
self._senderMap.set(track,submap)
self._needsNegotiation()}else if(sender.removed){self.destroy(makeError('Track has been removed. You should enable/disable tracks that you want to re-add.'),'ERR_SENDER_REMOVED')}else{self.destroy(makeError('Track has already been added to that stream.'),'ERR_SENDER_ALREADY_ADDED')}}
Peer.prototype.replaceTrack=function(oldTrack,newTrack,stream){var self=this
self._debug('replaceTrack()')
var submap=self._senderMap.get(oldTrack)
var sender=submap?submap.get(stream):null
if(!sender){self.destroy(makeError('Cannot replace track that was never added.'),'ERR_TRACK_NOT_ADDED')}
if(newTrack)self._senderMap.set(newTrack,submap)
if(sender.replaceTrack!=null){sender.replaceTrack(newTrack)}else{self.destroy(makeError('replaceTrack is not supported in this browser','ERR_UNSUPPORTED_REPLACETRACK'))}}
Peer.prototype.removeTrack=function(track,stream){var self=this
self._debug('removeSender()')
var submap=self._senderMap.get(track)
var sender=submap?submap.get(stream):null
if(!sender){self.destroy(makeError('Cannot remove track that was never added.','ERR_TRACK_NOT_ADDED'))}
try{sender.removed=!0
self._pc.removeTrack(sender)}catch(err){if(err.name==='NS_ERROR_UNEXPECTED'){self._sendersAwaitingStable.push(sender)}else{self.destroy(err)}}
self._needsNegotiation()}
Peer.prototype.removeStream=function(stream){var self=this
self._debug('removeSenders()')
stream.getTracks().forEach(function(track){self.removeTrack(track,stream)})}
Peer.prototype._needsNegotiation=function(){var self=this
self._debug('_needsNegotiation')
if(self._batchedNegotiation)return
self._batchedNegotiation=!0
setTimeout(function(){self._batchedNegotiation=!1
self._debug('starting batched negotiation')
self.negotiate()},0)}
Peer.prototype.negotiate=function(){var self=this
if(self.initiator){if(self._isNegotiating){self._queuedNegotiation=!0
self._debug('already negotiating, queueing')}else{self._debug('start negotiation')
setTimeout(()=>{self._createOffer()},0)}}else{if(!self._isNegotiating){self._debug('requesting negotiation from initiator')
self.emit('signal',{renegotiate:!0})}}
self._isNegotiating=!0}
Peer.prototype.destroy=function(err){var self=this
self._destroy(err,function(){})}
Peer.prototype._destroy=function(err,cb){var self=this
if(self.destroyed)return
self._debug('destroy (error: %s)',err&&(err.message||err))
self.readable=self.writable=!1
if(!self._readableState.ended)self.push(null)
if(!self._writableState.finished)self.end()
self.destroyed=!0
self.connected=!1
self._pcReady=!1
self._channelReady=!1
self._remoteTracks=null
self._remoteStreams=null
self._senderMap=null
clearInterval(self._closingInterval)
self._closingInterval=null
clearInterval(self._interval)
self._interval=null
self._chunk=null
self._cb=null
if(self._onFinishBound)self.removeListener('finish',self._onFinishBound)
self._onFinishBound=null
if(self._channel){try{self._channel.close()}catch(err){}
self._channel.onmessage=null
self._channel.onopen=null
self._channel.onclose=null
self._channel.onerror=null}
if(self._pc){try{self._pc.close()}catch(err){}
self._pc.oniceconnectionstatechange=null
self._pc.onicegatheringstatechange=null
self._pc.onsignalingstatechange=null
self._pc.onicecandidate=null
self._pc.ontrack=null
self._pc.ondatachannel=null}
self._pc=null
self._channel=null
if(err)self.emit('error',err)
self.emit('close')
cb()}
Peer.prototype._setupData=function(event){var self=this
if(!event.channel){return self.destroy(makeError('Data channel event is missing `channel` property','ERR_DATA_CHANNEL'))}
self._channel=event.channel
self._channel.binaryType='arraybuffer'
if(typeof self._channel.bufferedAmountLowThreshold==='number'){self._channel.bufferedAmountLowThreshold=MAX_BUFFERED_AMOUNT}
self.channelName=self._channel.label
self._channel.onmessage=function(event){self._onChannelMessage(event)}
self._channel.onbufferedamountlow=function(){self._onChannelBufferedAmountLow()}
self._channel.onopen=function(){self._onChannelOpen()}
self._channel.onclose=function(){self._onChannelClose()}
self._channel.onerror=function(err){self.destroy(makeError(err,'ERR_DATA_CHANNEL'))}
var isClosing=!1
self._closingInterval=setInterval(function(){if(self._channel&&self._channel.readyState==='closing'){if(isClosing)self._onChannelClose()
isClosing=!0}else{isClosing=!1}},CHANNEL_CLOSING_TIMEOUT)}
Peer.prototype._read=function(){}
Peer.prototype._write=function(chunk,encoding,cb){var self=this
if(self.destroyed)return cb(makeError('cannot write after peer is destroyed','ERR_DATA_CHANNEL'))
if(self.connected){try{self.send(chunk)}catch(err){return self.destroy(makeError(err,'ERR_DATA_CHANNEL'))}
if(self._channel.bufferedAmount>MAX_BUFFERED_AMOUNT){self._debug('start backpressure: bufferedAmount %d',self._channel.bufferedAmount)
self._cb=cb}else{cb(null)}}else{self._debug('write before connect')
self._chunk=chunk
self._cb=cb}}
Peer.prototype._onFinish=function(){var self=this
if(self.destroyed)return
if(self.connected){destroySoon()}else{self.once('connect',destroySoon)}
function destroySoon(){setTimeout(function(){self.destroy()},1000)}}
Peer.prototype._startIceCompleteTimeout=function(){var self=this
if(self.destroyed)return
if(self._iceCompleteTimer)return
self._debug('started iceComplete timeout')
self._iceCompleteTimer=setTimeout(function(){if(!self._iceComplete){self._iceComplete=!0
self._debug('iceComplete timeout completed')
self.emit('iceTimeout')
self.emit('_iceComplete')}},self.iceCompleteTimeout)}
Peer.prototype._createOffer=function(){var self=this
if(self.destroyed)return
self._pc.createOffer(self.offerOptions).then(function(offer){if(self.destroyed)return
if(!self.trickle&&!self.allowHalfTrickle)offer.sdp=filterTrickle(offer.sdp)
offer.sdp=self.sdpTransform(offer.sdp)
self._pc.setLocalDescription(offer).then(onSuccess).catch(onError)
function onSuccess(){self._debug('createOffer success')
if(self.destroyed)return
if(self.trickle||self._iceComplete)sendOffer()
else self.once('_iceComplete',sendOffer)}
function onError(err){self.destroy(makeError(err,'ERR_SET_LOCAL_DESCRIPTION'))}
function sendOffer(){if(self.destroyed)return
var signal=self._pc.localDescription||offer
self._debug('signal')
self.emit('signal',{type:signal.type,sdp:signal.sdp})}}).catch(function(err){self.destroy(makeError(err,'ERR_CREATE_OFFER'))})}
Peer.prototype._requestMissingTransceivers=function(){var self=this
if(self._pc.getTransceivers){self._pc.getTransceivers().forEach(transceiver=>{if(!transceiver.mid&&transceiver.sender.track){self.addTransceiver(transceiver.sender.track.kind)}})}}
Peer.prototype._createAnswer=function(){var self=this
if(self.destroyed)return
self._pc.createAnswer(self.answerOptions).then(function(answer){if(self.destroyed)return
if(!self.trickle&&!self.allowHalfTrickle)answer.sdp=filterTrickle(answer.sdp)
answer.sdp=self.sdpTransform(answer.sdp)
self._pc.setLocalDescription(answer).then(onSuccess).catch(onError)
function onSuccess(){if(self.destroyed)return
if(self.trickle||self._iceComplete)sendAnswer()
else self.once('_iceComplete',sendAnswer)}
function onError(err){self.destroy(makeError(err,'ERR_SET_LOCAL_DESCRIPTION'))}
function sendAnswer(){if(self.destroyed)return
var signal=self._pc.localDescription||answer
self._debug('signal')
self.emit('signal',{type:signal.type,sdp:signal.sdp})
if(!self.initiator)self._requestMissingTransceivers()}}).catch(function(err){self.destroy(makeError(err,'ERR_CREATE_ANSWER'))})}
Peer.prototype._onIceStateChange=function(){var self=this
if(self.destroyed)return
var iceConnectionState=self._pc.iceConnectionState
var iceGatheringState=self._pc.iceGatheringState
self._debug('iceStateChange (connection: %s) (gathering: %s)',iceConnectionState,iceGatheringState)
self.emit('iceStateChange',iceConnectionState,iceGatheringState)
if(iceConnectionState==='connected'||iceConnectionState==='completed'){self._pcReady=!0
self._maybeReady()}
if(iceConnectionState==='failed'){self.destroy(makeError('Ice connection failed.','ERR_ICE_CONNECTION_FAILURE'))}
if(iceConnectionState==='closed'){self.destroy(makeError('Ice connection closed.','ERR_ICE_CONNECTION_CLOSED'))}}
Peer.prototype.getStats=function(cb){var self=this
if(self._pc.getStats.length===0){self._pc.getStats().then(function(res){var reports=[]
res.forEach(function(report){reports.push(flattenValues(report))})
cb(null,reports)},function(err){cb(err)})}else if(self._isReactNativeWebrtc){self._pc.getStats(null,function(res){var reports=[]
res.forEach(function(report){reports.push(flattenValues(report))})
cb(null,reports)},function(err){cb(err)})}else if(self._pc.getStats.length>0){self._pc.getStats(function(res){if(self.destroyed)return
var reports=[]
res.result().forEach(function(result){var report={}
result.names().forEach(function(name){report[name]=result.stat(name)})
report.id=result.id
report.type=result.type
report.timestamp=result.timestamp
reports.push(flattenValues(report))})
cb(null,reports)},function(err){cb(err)})}else{cb(null,[])}
function flattenValues(report){if(Object.prototype.toString.call(report.values)==='[object Array]'){report.values.forEach(function(value){Object.assign(report,value)})}
return report}}
Peer.prototype._maybeReady=function(){var self=this
self._debug('maybeReady pc %s channel %s',self._pcReady,self._channelReady)
if(self.connected||self._connecting||!self._pcReady||!self._channelReady)return
self._connecting=!0
function findCandidatePair(){if(self.destroyed)return
self.getStats(function(err,items){if(self.destroyed)return
if(err)items=[]
var remoteCandidates={}
var localCandidates={}
var candidatePairs={}
var foundSelectedCandidatePair=!1
items.forEach(function(item){if(item.type==='remotecandidate'||item.type==='remote-candidate'){remoteCandidates[item.id]=item}
if(item.type==='localcandidate'||item.type==='local-candidate'){localCandidates[item.id]=item}
if(item.type==='candidatepair'||item.type==='candidate-pair'){candidatePairs[item.id]=item}})
items.forEach(function(item){if(item.type==='transport'&&item.selectedCandidatePairId){setSelectedCandidatePair(candidatePairs[item.selectedCandidatePairId])}
if((item.type==='googCandidatePair'&&item.googActiveConnection==='true')||((item.type==='candidatepair'||item.type==='candidate-pair')&&item.selected)){setSelectedCandidatePair(item)}})
function setSelectedCandidatePair(selectedCandidatePair){foundSelectedCandidatePair=!0
var local=localCandidates[selectedCandidatePair.localCandidateId]
if(local&&(local.ip||local.address)){self.localAddress=local.ip||local.address
self.localPort=Number(local.port)}else if(local&&local.ipAddress){self.localAddress=local.ipAddress
self.localPort=Number(local.portNumber)}else if(typeof selectedCandidatePair.googLocalAddress==='string'){local=selectedCandidatePair.googLocalAddress.split(':')
self.localAddress=local[0]
self.localPort=Number(local[1])}
if(self.localAddress){self.localFamily=self.localAddress.includes(':')?'IPv6':'IPv4'}
var remote=remoteCandidates[selectedCandidatePair.remoteCandidateId]
if(remote&&(remote.ip||remote.address)){self.remoteAddress=remote.ip||remote.address
self.remotePort=Number(remote.port)}else if(remote&&remote.ipAddress){self.remoteAddress=remote.ipAddress
self.remotePort=Number(remote.portNumber)}else if(typeof selectedCandidatePair.googRemoteAddress==='string'){remote=selectedCandidatePair.googRemoteAddress.split(':')
self.remoteAddress=remote[0]
self.remotePort=Number(remote[1])}
if(self.remoteAddress){self.remoteFamily=self.remoteAddress.includes(':')?'IPv6':'IPv4'}
self._debug('connect local: %s:%s remote: %s:%s',self.localAddress,self.localPort,self.remoteAddress,self.remotePort)}
if(!foundSelectedCandidatePair&&(!Object.keys(candidatePairs).length||Object.keys(localCandidates).length)){setTimeout(findCandidatePair,100)
return}else{self._connecting=!1
self.connected=!0}
if(self._chunk){try{self.send(self._chunk)}catch(err){return self.destroy(makeError(err,'ERR_DATA_CHANNEL'))}
self._chunk=null
self._debug('sent chunk from "write before connect"')
var cb=self._cb
self._cb=null
cb(null)}
if(typeof self._channel.bufferedAmountLowThreshold!=='number'){self._interval=setInterval(function(){self._onInterval()},150)
if(self._interval.unref)self._interval.unref()}
self._debug('connect')
self.emit('connect')})}
findCandidatePair()}
Peer.prototype._onInterval=function(){var self=this
if(!self._cb||!self._channel||self._channel.bufferedAmount>MAX_BUFFERED_AMOUNT){return}
self._onChannelBufferedAmountLow()}
Peer.prototype._onSignalingStateChange=function(){var self=this
if(self.destroyed)return
if(self._pc.signalingState==='stable'&&!self._firstStable){self._isNegotiating=!1
self._debug('flushing sender queue',self._sendersAwaitingStable)
self._sendersAwaitingStable.forEach(function(sender){self._pc.removeTrack(sender)
self._queuedNegotiation=!0})
self._sendersAwaitingStable=[]
if(self._queuedNegotiation){self._debug('flushing negotiation queue')
self._queuedNegotiation=!1
self._needsNegotiation()}
self._debug('negotiate')
self.emit('negotiate')}
self._firstStable=!1
self._debug('signalingStateChange %s',self._pc.signalingState)
self.emit('signalingStateChange',self._pc.signalingState)}
Peer.prototype._onIceCandidate=function(event){var self=this
if(self.destroyed)return
if(event.candidate&&self.trickle){self.emit('signal',{candidate:{candidate:event.candidate.candidate,sdpMLineIndex:event.candidate.sdpMLineIndex,sdpMid:event.candidate.sdpMid}})}else if(!event.candidate&&!self._iceComplete){self._iceComplete=!0
self.emit('_iceComplete')}
if(event.candidate){self._startIceCompleteTimeout()}}
Peer.prototype._onChannelMessage=function(event){var self=this
if(self.destroyed)return
var data=event.data
if(data instanceof ArrayBuffer)data=Buffer.from(data)
self.push(data)}
Peer.prototype._onChannelBufferedAmountLow=function(){var self=this
if(self.destroyed||!self._cb)return
self._debug('ending backpressure: bufferedAmount %d',self._channel.bufferedAmount)
var cb=self._cb
self._cb=null
cb(null)}
Peer.prototype._onChannelOpen=function(){var self=this
if(self.connected||self.destroyed)return
self._debug('on channel open')
self._channelReady=!0
self._maybeReady()}
Peer.prototype._onChannelClose=function(){var self=this
if(self.destroyed)return
self._debug('on channel close')
self.destroy()}
Peer.prototype._onTrack=function(event){var self=this
if(self.destroyed)return
event.streams.forEach(function(eventStream){self._debug('on track')
self.emit('track',event.track,eventStream)
self._remoteTracks.push({track:event.track,stream:eventStream})
if(self._remoteStreams.some(function(remoteStream){return remoteStream.id===eventStream.id}))return
self._remoteStreams.push(eventStream)
setTimeout(function(){self.emit('stream',eventStream)},0)})}
Peer.prototype._debug=function(){var self=this
var args=[].slice.call(arguments)
args[0]='['+self._id+'] '+args[0]
debug.apply(null,args)}
function filterTrickle(sdp){return sdp.replace(/a=ice-options:trickle\s\n/g,'')}
function makeError(message,code){var err=new Error(message)
err.code=code
return err}}).call(this,require("buffer").Buffer)},{"buffer":54,"debug":406,"get-browser-rtc":302,"inherits":305,"randombytes":379,"readable-stream":417}],406:[function(require,module,exports){arguments[4][216][0].apply(exports,arguments)},{"./common":407,"_process":139,"dup":216}],407:[function(require,module,exports){arguments[4][217][0].apply(exports,arguments)},{"dup":217,"ms":346}],408:[function(require,module,exports){arguments[4][199][0].apply(exports,arguments)},{"dup":199}],409:[function(require,module,exports){arguments[4][200][0].apply(exports,arguments)},{"./_stream_readable":411,"./_stream_writable":413,"core-util-is":248,"dup":200,"inherits":305,"process-nextick-args":374}],410:[function(require,module,exports){arguments[4][201][0].apply(exports,arguments)},{"./_stream_transform":412,"core-util-is":248,"dup":201,"inherits":305}],411:[function(require,module,exports){arguments[4][202][0].apply(exports,arguments)},{"./_stream_duplex":409,"./internal/streams/BufferList":414,"./internal/streams/destroy":415,"./internal/streams/stream":416,"_process":139,"core-util-is":248,"dup":202,"events":90,"inherits":305,"isarray":408,"process-nextick-args":374,"safe-buffer":401,"string_decoder/":418,"util":23}],412:[function(require,module,exports){arguments[4][203][0].apply(exports,arguments)},{"./_stream_duplex":409,"core-util-is":248,"dup":203,"inherits":305}],413:[function(require,module,exports){arguments[4][204][0].apply(exports,arguments)},{"./_stream_duplex":409,"./internal/streams/destroy":415,"./internal/streams/stream":416,"_process":139,"core-util-is":248,"dup":204,"inherits":305,"process-nextick-args":374,"safe-buffer":401,"timers":182,"util-deprecate":467}],414:[function(require,module,exports){arguments[4][205][0].apply(exports,arguments)},{"dup":205,"safe-buffer":401,"util":23}],415:[function(require,module,exports){arguments[4][206][0].apply(exports,arguments)},{"dup":206,"process-nextick-args":374}],416:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],417:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":409,"./lib/_stream_passthrough.js":410,"./lib/_stream_readable.js":411,"./lib/_stream_transform.js":412,"./lib/_stream_writable.js":413,"dup":208}],418:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],419:[function(require,module,exports){var Rusha=require('rusha')
var rusha=new Rusha
var scope=typeof window!=='undefined'?window:self
var crypto=scope.crypto||scope.msCrypto||{}
var subtle=crypto.subtle||crypto.webkitSubtle
function sha1sync(buf){return rusha.digest(buf)}
try{subtle.digest({name:'sha-1'},new Uint8Array).catch(function(){subtle=!1})}catch(err){subtle=!1}
function sha1(buf,cb){if(!subtle){setTimeout(cb,0,sha1sync(buf))
return}
if(typeof buf==='string'){buf=uint8array(buf)}
subtle.digest({name:'sha-1'},buf).then(function succeed(result){cb(hex(new Uint8Array(result)))},function fail(error){cb(sha1sync(buf))})}
function uint8array(s){var l=s.length
var array=new Uint8Array(l)
for(var i=0;i<l;i++){array[i]=s.charCodeAt(i)}
return array}
function hex(buf){var l=buf.length
var chars=[]
for(var i=0;i<l;i++){var bite=buf[i]
chars.push((bite>>>4).toString(16))
chars.push((bite&0x0f).toString(16))}
return chars.join('')}
module.exports=sha1
module.exports.sync=sha1sync},{"rusha":400}],420:[function(require,module,exports){(function(process,Buffer){module.exports=Socket
var debug=require('debug')('simple-websocket')
var inherits=require('inherits')
var randombytes=require('randombytes')
var stream=require('readable-stream')
var ws=require('ws')
var _WebSocket=typeof ws!=='function'?WebSocket:ws
var MAX_BUFFERED_AMOUNT=64*1024
inherits(Socket,stream.Duplex)
function Socket(opts){var self=this
if(!(self instanceof Socket))return new Socket(opts)
if(!opts)opts={}
if(typeof opts==='string'){opts={url:opts}}
if(opts.url==null&&opts.socket==null){throw new Error('Missing required `url` or `socket` option')}
if(opts.url!=null&&opts.socket!=null){throw new Error('Must specify either `url` or `socket` option, not both')}
self._id=randombytes(4).toString('hex').slice(0,7)
self._debug('new websocket: %o',opts)
opts=Object.assign({allowHalfOpen:!1},opts)
stream.Duplex.call(self,opts)
self.connected=!1
self.destroyed=!1
self._chunk=null
self._cb=null
self._interval=null
if(opts.socket){self.url=opts.socket.url
self._ws=opts.socket}else{self.url=opts.url
try{if(typeof ws==='function'){self._ws=new _WebSocket(opts.url,opts)}else{self._ws=new _WebSocket(opts.url)}}catch(err){process.nextTick(function(){self.destroy(err)})
return}}
self._ws.binaryType='arraybuffer'
self._ws.onopen=function(){self._onOpen()}
self._ws.onmessage=function(event){self._onMessage(event)}
self._ws.onclose=function(){self._onClose()}
self._ws.onerror=function(){self.destroy(new Error('connection error to '+self.url))}
self._onFinishBound=function(){self._onFinish()}
self.once('finish',self._onFinishBound)}
Socket.WEBSOCKET_SUPPORT=!!_WebSocket
Socket.prototype.send=function(chunk){this._ws.send(chunk)}
Socket.prototype.destroy=function(err){this._destroy(err,function(){})}
Socket.prototype._destroy=function(err,cb){var self=this
if(self.destroyed)return
self._debug('destroy (error: %s)',err&&(err.message||err))
self.readable=self.writable=!1
if(!self._readableState.ended)self.push(null)
if(!self._writableState.finished)self.end()
self.connected=!1
self.destroyed=!0
clearInterval(self._interval)
self._interval=null
self._chunk=null
self._cb=null
if(self._onFinishBound)self.removeListener('finish',self._onFinishBound)
self._onFinishBound=null
if(self._ws){var ws=self._ws
var onClose=function(){ws.onclose=null}
if(ws.readyState===_WebSocket.CLOSED){onClose()}else{try{ws.onclose=onClose
ws.close()}catch(err){onClose()}}
ws.onopen=null
ws.onmessage=null
ws.onerror=function(){}}
self._ws=null
if(err){if(typeof DOMException!=='undefined'&&err instanceof DOMException){var code=err.code
err=new Error(err.message)
err.code=code}
self.emit('error',err)}
self.emit('close')
cb()}
Socket.prototype._read=function(){}
Socket.prototype._write=function(chunk,encoding,cb){if(this.destroyed)return cb(new Error('cannot write after socket is destroyed'))
if(this.connected){try{this.send(chunk)}catch(err){return this.destroy(err)}
if(typeof ws!=='function'&&this._ws.bufferedAmount>MAX_BUFFERED_AMOUNT){this._debug('start backpressure: bufferedAmount %d',this._ws.bufferedAmount)
this._cb=cb}else{cb(null)}}else{this._debug('write before connect')
this._chunk=chunk
this._cb=cb}}
Socket.prototype._onFinish=function(){var self=this
if(self.destroyed)return
if(self.connected){destroySoon()}else{self.once('connect',destroySoon)}
function destroySoon(){setTimeout(function(){self.destroy()},1000)}}
Socket.prototype._onMessage=function(event){if(this.destroyed)return
var data=event.data
if(data instanceof ArrayBuffer)data=Buffer.from(data)
this.push(data)}
Socket.prototype._onOpen=function(){var self=this
if(self.connected||self.destroyed)return
self.connected=!0
if(self._chunk){try{self.send(self._chunk)}catch(err){return self.destroy(err)}
self._chunk=null
self._debug('sent chunk from "write before connect"')
var cb=self._cb
self._cb=null
cb(null)}
if(typeof ws!=='function'){self._interval=setInterval(function(){self._onInterval()},150)
if(self._interval.unref)self._interval.unref()}
self._debug('connect')
self.emit('connect')}
Socket.prototype._onInterval=function(){if(!this._cb||!this._ws||this._ws.bufferedAmount>MAX_BUFFERED_AMOUNT){return}
this._debug('ending backpressure: bufferedAmount %d',this._ws.bufferedAmount)
var cb=this._cb
this._cb=null
cb(null)}
Socket.prototype._onClose=function(){if(this.destroyed)return
this._debug('on close')
this.destroy()}
Socket.prototype._debug=function(){var args=[].slice.call(arguments)
args[0]='['+this._id+'] '+args[0]
debug.apply(null,args)}}).call(this,require('_process'),require("buffer").Buffer)},{"_process":139,"buffer":54,"debug":265,"inherits":305,"randombytes":379,"readable-stream":430,"ws":23}],421:[function(require,module,exports){arguments[4][199][0].apply(exports,arguments)},{"dup":199}],422:[function(require,module,exports){arguments[4][200][0].apply(exports,arguments)},{"./_stream_readable":424,"./_stream_writable":426,"core-util-is":248,"dup":200,"inherits":305,"process-nextick-args":374}],423:[function(require,module,exports){arguments[4][201][0].apply(exports,arguments)},{"./_stream_transform":425,"core-util-is":248,"dup":201,"inherits":305}],424:[function(require,module,exports){arguments[4][202][0].apply(exports,arguments)},{"./_stream_duplex":422,"./internal/streams/BufferList":427,"./internal/streams/destroy":428,"./internal/streams/stream":429,"_process":139,"core-util-is":248,"dup":202,"events":90,"inherits":305,"isarray":421,"process-nextick-args":374,"safe-buffer":401,"string_decoder/":431,"util":23}],425:[function(require,module,exports){arguments[4][203][0].apply(exports,arguments)},{"./_stream_duplex":422,"core-util-is":248,"dup":203,"inherits":305}],426:[function(require,module,exports){arguments[4][204][0].apply(exports,arguments)},{"./_stream_duplex":422,"./internal/streams/destroy":428,"./internal/streams/stream":429,"_process":139,"core-util-is":248,"dup":204,"inherits":305,"process-nextick-args":374,"safe-buffer":401,"timers":182,"util-deprecate":467}],427:[function(require,module,exports){arguments[4][205][0].apply(exports,arguments)},{"dup":205,"safe-buffer":401,"util":23}],428:[function(require,module,exports){arguments[4][206][0].apply(exports,arguments)},{"dup":206,"process-nextick-args":374}],429:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],430:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":422,"./lib/_stream_passthrough.js":423,"./lib/_stream_readable.js":424,"./lib/_stream_transform.js":425,"./lib/_stream_writable.js":426,"dup":208}],431:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],432:[function(require,module,exports){'use strict';var through=require('through2')
function transform(chunk,enc,cb){var list=chunk.toString('utf8').split(this.matcher),remaining=list.pop(),i
if(list.length>=1){push(this,this.mapper((this._last+list.shift())))}else{remaining=this._last+remaining}
for(i=0;i<list.length;i++){push(this,this.mapper(list[i]))}
this._last=remaining
cb()}
function flush(cb){if(this._last)
push(this,this.mapper(this._last))
cb()}
function push(self,val){if(val!==undefined)
self.push(val)}
function noop(incoming){return incoming}
function split(matcher,mapper,options){if(typeof matcher==='object'&&!(matcher instanceof RegExp)){options=matcher
matcher=null}
if(typeof matcher==='function'){mapper=matcher
matcher=null}
options=options||{}
var stream=through(options,transform,flush)
stream._readableState.objectMode=!0;stream._last=''
stream.matcher=matcher||/\r?\n/stream.mapper=mapper||noop
return stream}
module.exports=split},{"through2":438}],433:[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys}
var util=require('core-util-is');util.inherits=require('inherits');var Readable=require('./_stream_readable');var Writable=require('./_stream_writable');util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])
Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))
return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===!1)
this.readable=!1;if(options&&options.writable===!1)
this.writable=!1;this.allowHalfOpen=!0;if(options&&options.allowHalfOpen===!1)
this.allowHalfOpen=!1;this.once('end',onend)}
function onend(){if(this.allowHalfOpen||this._writableState.ended)
return;process.nextTick(this.end.bind(this))}
function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require('_process'))},{"./_stream_readable":434,"./_stream_writable":436,"_process":139,"core-util-is":248,"inherits":305}],434:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require('isarray');var Buffer=require('buffer').Buffer;Readable.ReadableState=ReadableState;var EE=require('events').EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require('stream');var util=require('core-util-is');util.inherits=require('inherits');var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=(hwm||hwm===0)?hwm:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=!1;this.ended=!1;this.endEmitted=!1;this.reading=!1;this.calledRead=!1;this.sync=!0;this.needReadable=!1;this.emittedReadable=!1;this.readableListening=!1;this.objectMode=!!options.objectMode;this.defaultEncoding=options.defaultEncoding||'utf8';this.ranOut=!1;this.awaitDrain=0;this.readingMore=!1;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)
StringDecoder=require('string_decoder/').StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}
function Readable(options){if(!(this instanceof Readable))
return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=!0;Stream.call(this)}
Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(typeof chunk==='string'&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=''}}
return readableAddChunk(this,state,chunk,encoding,!1)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,'',!0)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit('error',er)}else if(chunk===null||chunk===undefined){state.reading=!1;if(!state.ended)
onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error('stream.push() after EOF');stream.emit('error',e)}else if(state.endEmitted&&addToFront){var e=new Error('stream.unshift() after end event');stream.emit('error',e)}else{if(state.decoder&&!addToFront&&!encoding)
chunk=state.decoder.write(chunk);state.length+=state.objectMode?1:chunk.length;if(addToFront){state.buffer.unshift(chunk)}else{state.reading=!1;state.buffer.push(chunk)}
if(state.needReadable)
emitReadable(stream);maybeReadMore(stream,state)}}else if(!addToFront){state.reading=!1}
return needMoreData(state)}
function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}
Readable.prototype.setEncoding=function(enc){if(!StringDecoder)
StringDecoder=require('string_decoder/').StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc};var MAX_HWM=0x800000;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}
return n}
function howMuchToRead(n,state){if(state.length===0&&state.ended)
return 0;if(state.objectMode)
return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)
return state.buffer[0].length;else return state.length}
if(n<=0)
return 0;if(n>state.highWaterMark)
state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=!0;return 0}else return state.length}
return n}
Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=!0;var nOrig=n;var ret;if(typeof n!=='number'||n>0)
state.emittedReadable=!1;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){emitReadable(this);return null}
n=howMuchToRead(n,state);if(n===0&&state.ended){ret=null;if(state.length>0&&state.decoder){ret=fromList(n,state);state.length-=ret.length}
if(state.length===0)
endReadable(this);return ret}
var doRead=state.needReadable;if(state.length-n<=state.highWaterMark)
doRead=!0;if(state.ended||state.reading)
doRead=!1;if(doRead){state.reading=!0;state.sync=!0;if(state.length===0)
state.needReadable=!0;this._read(state.highWaterMark);state.sync=!1}
if(doRead&&!state.reading)
n=howMuchToRead(nOrig,state);if(n>0)
ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=!0;n=0}
state.length-=n;if(state.length===0&&!state.ended)
state.needReadable=!0;if(state.ended&&!state.endEmitted&&state.length===0)
endReadable(this);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&'string'!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError('Invalid non-string/buffer chunk')}
return er}
function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}
state.ended=!0;if(state.length>0)
emitReadable(stream);else endReadable(stream)}
function emitReadable(stream){var state=stream._readableState;state.needReadable=!1;if(state.emittedReadable)
return;state.emittedReadable=!0;if(state.sync)
process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}
function emitReadable_(stream){stream.emit('readable')}
function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=!0;process.nextTick(function(){maybeReadMore_(stream,state)})}}
function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){stream.read(0);if(len===state.length)
break;else len=state.length}
state.readingMore=!1}
Readable.prototype._read=function(n){this.emit('error',new Error('not implemented'))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}
state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)
process.nextTick(endFn);else src.once('end',endFn);dest.on('unpipe',onunpipe);function onunpipe(readable){if(readable!==src)return;cleanup()}
function onend(){dest.end()}
var ondrain=pipeOnDrain(src);dest.on('drain',ondrain);function cleanup(){dest.removeListener('close',onclose);dest.removeListener('finish',onfinish);dest.removeListener('drain',ondrain);dest.removeListener('error',onerror);dest.removeListener('unpipe',onunpipe);src.removeListener('end',onend);src.removeListener('end',cleanup);if(!dest._writableState||dest._writableState.needDrain)
ondrain()}
function onerror(er){unpipe();dest.removeListener('error',onerror);if(EE.listenerCount(dest,'error')===0)
dest.emit('error',er)}
if(!dest._events||!dest._events.error)
dest.on('error',onerror);else if(isArray(dest._events.error))
dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener('finish',onfinish);unpipe()}
dest.once('close',onclose);function onfinish(){dest.removeListener('close',onclose);unpipe()}
dest.once('finish',onfinish);function unpipe(){src.unpipe(dest)}
dest.emit('pipe',src);if(!state.flowing){this.on('readable',pipeOnReadable);state.flowing=!0;process.nextTick(function(){flow(src)})}
return dest};function pipeOnDrain(src){return function(){var dest=this;var state=src._readableState;state.awaitDrain--;if(state.awaitDrain===0)
flow(src)}}
function flow(src){var state=src._readableState;var chunk;state.awaitDrain=0;function write(dest,i,list){var written=dest.write(chunk);if(!1===written){state.awaitDrain++}}
while(state.pipesCount&&null!==(chunk=src.read())){if(state.pipesCount===1)
write(state.pipes,0,null);else forEach(state.pipes,write);src.emit('data',chunk);if(state.awaitDrain>0)
return}
if(state.pipesCount===0){state.flowing=!1;if(EE.listenerCount(src,'data')>0)
emitDataEvents(src);return}
state.ranOut=!0}
function pipeOnReadable(){if(this._readableState.ranOut){this._readableState.ranOut=!1;flow(this)}}
Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)
return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)
return this;if(!dest)
dest=state.pipes;state.pipes=null;state.pipesCount=0;this.removeListener('readable',pipeOnReadable);state.flowing=!1;if(dest)
dest.emit('unpipe',this);return this}
if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;this.removeListener('readable',pipeOnReadable);state.flowing=!1;for(var i=0;i<len;i++)
dests[i].emit('unpipe',this);return this}
var i=indexOf(state.pipes,dest);if(i===-1)
return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)
state.pipes=state.pipes[0];dest.emit('unpipe',this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==='data'&&!this._readableState.flowing)
emitDataEvents(this);if(ev==='readable'&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=!0;state.emittedReadable=!1;state.needReadable=!0;if(!state.reading){this.read(0)}else if(state.length){emitReadable(this,state)}}}
return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){emitDataEvents(this);this.read(0);this.emit('resume')};Readable.prototype.pause=function(){emitDataEvents(this,!0);this.emit('pause')};function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing){throw new Error('Cannot switch to old mode now.')}
var paused=startPaused||!1;var readable=!1;stream.readable=!0;stream.pipe=Stream.prototype.pipe;stream.on=stream.addListener=Stream.prototype.on;stream.on('readable',function(){readable=!0;var c;while(!paused&&(null!==(c=stream.read())))
stream.emit('data',c);if(c===null){readable=!1;stream._readableState.needReadable=!0}});stream.pause=function(){paused=!0;this.emit('pause')};stream.resume=function(){paused=!1;if(readable)
process.nextTick(function(){stream.emit('readable')});else this.read(0);this.emit('resume')};stream.emit('readable')}
Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=!1;var self=this;stream.on('end',function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)
self.push(chunk)}
self.push(null)});stream.on('data',function(chunk){if(state.decoder)
chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))
return;else if(!state.objectMode&&(!chunk||!chunk.length))
return;var ret=self.push(chunk);if(!ret){paused=!0;stream.pause()}});for(var i in stream){if(typeof stream[i]==='function'&&typeof this[i]==='undefined'){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}
var events=['error','close','destroy','pause','resume'];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){if(paused){paused=!1;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)
return null;if(length===0)
ret=null;else if(objectMode)
ret=list.shift();else if(!n||n>=length){if(stringMode)
ret=list.join('');else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)
ret='';else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)
ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)
list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}
return ret}
function endReadable(stream){var state=stream._readableState;if(state.length>0)
throw new Error('endReadable called on non-empty stream');if(!state.endEmitted&&state.calledRead){state.ended=!0;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=!0;stream.readable=!1;stream.emit('end')}})}}
function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}
function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}
return-1}}).call(this,require('_process'))},{"_process":139,"buffer":54,"core-util-is":248,"events":90,"inherits":305,"isarray":309,"stream":176,"string_decoder/":452}],435:[function(require,module,exports){module.exports=Transform;var Duplex=require('./_stream_duplex');var util=require('core-util-is');util.inherits=require('inherits');util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=!1;this.transforming=!1;this.writecb=null;this.writechunk=null}
function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)
return stream.emit('error',new Error('no writecb in Transform class'));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)
stream.push(data);if(cb)
cb(er);var rs=stream._readableState;rs.reading=!1;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}
function Transform(options){if(!(this instanceof Transform))
return new Transform(options);Duplex.call(this,options);var ts=this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=!0;this._readableState.sync=!1;this.once('finish',function(){if('function'===typeof this._flush)
this._flush(function(er){done(stream,er)});else done(stream)})}
Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=!1;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error('not implemented')};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)
this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=!0;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=!0}};function done(stream,er){if(er)
return stream.emit('error',er);var ws=stream._writableState;var rs=stream._readableState;var ts=stream._transformState;if(ws.length)
throw new Error('calling transform done when ws.length != 0');if(ts.transforming)
throw new Error('calling transform done when still transforming');return stream.push(null)}},{"./_stream_duplex":433,"core-util-is":248,"inherits":305}],436:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require('buffer').Buffer;Writable.WritableState=WritableState;var util=require('core-util-is');util.inherits=require('inherits');var Stream=require('stream');util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}
function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=(hwm||hwm===0)?hwm:16*1024;this.objectMode=!!options.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=!1;this.ending=!1;this.ended=!1;this.finished=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||'utf8';this.length=0;this.writing=!1;this.sync=!0;this.bufferProcessing=!1;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.errorEmitted=!1}
function Writable(options){var Duplex=require('./_stream_duplex');if(!(this instanceof Writable)&&!(this instanceof Duplex))
return new Writable(options);this._writableState=new WritableState(options,this);this.writable=!0;Stream.call(this)}
Writable.prototype.pipe=function(){this.emit('error',new Error('Cannot pipe. Not readable.'))};function writeAfterEnd(stream,state,cb){var er=new Error('write after end');stream.emit('error',er);process.nextTick(function(){cb(er)})}
function validChunk(stream,state,chunk,cb){var valid=!0;if(!Buffer.isBuffer(chunk)&&'string'!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError('Invalid non-string/buffer chunk');stream.emit('error',er);process.nextTick(function(){cb(er)});valid=!1}
return valid}
Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=!1;if(typeof encoding==='function'){cb=encoding;encoding=null}
if(Buffer.isBuffer(chunk))
encoding='buffer';else if(!encoding)
encoding=state.defaultEncoding;if(typeof cb!=='function')
cb=function(){};if(state.ended)
writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb))
ret=writeOrBuffer(this,state,chunk,encoding,cb);return ret};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==!1&&typeof chunk==='string'){chunk=new Buffer(chunk,encoding)}
return chunk}
function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))
encoding='buffer';var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)
state.needDrain=!0;if(state.writing)
state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,len,chunk,encoding,cb);return ret}
function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=!0;state.sync=!0;stream._write(chunk,encoding,state.onwrite);state.sync=!1}
function onwriteError(stream,state,sync,er,cb){if(sync)
process.nextTick(function(){cb(er)});else cb(er);stream._writableState.errorEmitted=!0;stream.emit('error',er)}
function onwriteStateUpdate(state){state.writing=!1;state.writecb=null;state.length-=state.writelen;state.writelen=0}
function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)
onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.bufferProcessing&&state.buffer.length)
clearBuffer(stream,state);if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}
function afterWrite(stream,state,finished,cb){if(!finished)
onwriteDrain(stream,state);cb();if(finished)
finishMaybe(stream,state)}
function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=!1;stream.emit('drain')}}
function clearBuffer(stream,state){state.bufferProcessing=!0;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,len,chunk,encoding,cb);if(state.writing){c++;break}}
state.bufferProcessing=!1;if(c<state.buffer.length)
state.buffer=state.buffer.slice(c);else state.buffer.length=0}
Writable.prototype._write=function(chunk,encoding,cb){cb(new Error('not implemented'))};Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==='function'){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==='function'){cb=encoding;encoding=null}
if(typeof chunk!=='undefined'&&chunk!==null)
this.write(chunk,encoding);if(!state.ending&&!state.finished)
endWritable(this,state,cb)};function needFinish(stream,state){return(state.ending&&state.length===0&&!state.finished&&!state.writing)}
function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){state.finished=!0;stream.emit('finish')}
return need}
function endWritable(stream,state,cb){state.ending=!0;finishMaybe(stream,state);if(cb){if(state.finished)
process.nextTick(cb);else stream.once('finish',cb)}
state.ended=!0}}).call(this,require('_process'))},{"./_stream_duplex":433,"_process":139,"buffer":54,"core-util-is":248,"inherits":305,"stream":176}],437:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":435}],438:[function(require,module,exports){(function(process){var Transform=require('readable-stream/transform'),inherits=require('util').inherits,xtend=require('xtend')
function DestroyableTransform(opts){Transform.call(this,opts)
this._destroyed=!1}
inherits(DestroyableTransform,Transform)
DestroyableTransform.prototype.destroy=function(err){if(this._destroyed)return
this._destroyed=!0
var self=this
process.nextTick(function(){if(err)
self.emit('error',err)
self.emit('close')})}
function noop(chunk,enc,callback){callback(null,chunk)}
function through2(construct){return function(options,transform,flush){if(typeof options=='function'){flush=transform
transform=options
options={}}
if(typeof transform!='function')
transform=noop
if(typeof flush!='function')
flush=null
return construct(options,transform,flush)}}
module.exports=through2(function(options,transform,flush){var t2=new DestroyableTransform(options)
t2._transform=transform
if(flush)
t2._flush=flush
return t2})
module.exports.ctor=through2(function(options,transform,flush){function Through2(override){if(!(this instanceof Through2))
return new Through2(override)
this.options=xtend(options,override)
DestroyableTransform.call(this,this.options)}
inherits(Through2,DestroyableTransform)
Through2.prototype._transform=transform
if(flush)
Through2.prototype._flush=flush
return Through2})
module.exports.obj=through2(function(options,transform,flush){var t2=new DestroyableTransform(xtend({objectMode:!0,highWaterMark:16},options))
t2._transform=transform
if(flush)
t2._flush=flush
return t2})}).call(this,require('_process'))},{"_process":139,"readable-stream/transform":437,"util":188,"xtend":439}],439:[function(require,module,exports){arguments[4][211][0].apply(exports,arguments)},{"dup":211}],440:[function(require,module,exports){var split=require('split2')
var pumpify=require('pumpify')
var through=require('through2')
var utf8=require('to-utf-8')
module.exports=function(){var buf=[]
var convert=function(){return buf.join('\r\n').replace(/\{\\([ibu])\}/g,'</$1>').replace(/\{\\([ibu])1\}/g,'<$1>').replace(/\{([ibu])\}/g,'<$1>').replace(/\{\/([ibu])\}/g,'</$1>').replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,'$1.$2').replace(/\r\n\{\\an8\}/g,' line:5%\r\n')+'\r\n\r\n'}
var write=function(line,enc,cb){if(line.trim()){buf.push(line.trim())
return cb()}
line=convert()
buf=[]
cb(null,line)}
var flush=function(cb){if(buf.length)this.push(convert())
cb()}
var parse=through.obj(write,flush)
parse.push('WEBVTT FILE\r\n\r\n')
return pumpify(utf8({newline:!1,detectSize:4095}),split(),parse)}},{"pumpify":376,"split2":432,"through2":446,"to-utf-8":446}],441:[function(require,module,exports){arguments[4][433][0].apply(exports,arguments)},{"./_stream_readable":442,"./_stream_writable":444,"_process":139,"core-util-is":248,"dup":433,"inherits":305}],442:[function(require,module,exports){arguments[4][434][0].apply(exports,arguments)},{"_process":139,"buffer":54,"core-util-is":248,"dup":434,"events":90,"inherits":305,"isarray":309,"stream":176,"string_decoder/":452}],443:[function(require,module,exports){arguments[4][435][0].apply(exports,arguments)},{"./_stream_duplex":441,"core-util-is":248,"dup":435,"inherits":305}],444:[function(require,module,exports){arguments[4][436][0].apply(exports,arguments)},{"./_stream_duplex":441,"_process":139,"buffer":54,"core-util-is":248,"dup":436,"inherits":305,"stream":176}],445:[function(require,module,exports){arguments[4][437][0].apply(exports,arguments)},{"./lib/_stream_transform.js":443,"dup":437}],446:[function(require,module,exports){arguments[4][438][0].apply(exports,arguments)},{"_process":139,"dup":438,"readable-stream/transform":445,"util":188,"xtend":447}],447:[function(require,module,exports){arguments[4][211][0].apply(exports,arguments)},{"dup":211}],448:[function(require,module,exports){module.exports=shift
function shift(stream){var rs=stream._readableState
if(!rs)return null
return rs.objectMode?stream.read():stream.read(getStateLength(rs))}
function getStateLength(state){if(state.buffer.length){if(state.buffer.head){return state.buffer.head.data.length}
return state.buffer[0].length}
return state.length}},{}],449:[function(require,module,exports){var getBlob=require('stream-to-blob')
module.exports=function getBlobURL(stream,mimeType,cb){if(typeof mimeType==='function')return getBlobURL(stream,null,mimeType)
getBlob(stream,mimeType,function(err,blob){if(err)return cb(err)
var url=URL.createObjectURL(blob)
cb(null,url)})}},{"stream-to-blob":450}],450:[function(require,module,exports){var once=require('once')
module.exports=function getBlob(stream,mimeType,cb){if(typeof mimeType==='function')return getBlob(stream,null,mimeType)
cb=once(cb)
var chunks=[]
stream.on('data',function(chunk){chunks.push(chunk)}).on('end',function(){var blob=mimeType?new Blob(chunks,{type:mimeType}):new Blob(chunks)
cb(null,blob)}).on('error',cb)}},{"once":363}],451:[function(require,module,exports){(function(Buffer){var once=require('once')
module.exports=function getBuffer(stream,length,cb){cb=once(cb)
var buf=Buffer.alloc(length)
var offset=0
stream.on('data',function(chunk){chunk.copy(buf,offset)
offset+=chunk.length}).on('end',function(){cb(null,buf)}).on('error',cb)}}).call(this,require("buffer").Buffer)},{"buffer":54,"once":363}],452:[function(require,module,exports){var Buffer=require('buffer').Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case 'hex':case 'utf8':case 'utf-8':case 'ascii':case 'binary':case 'base64':case 'ucs2':case 'ucs-2':case 'utf16le':case 'utf-16le':case 'raw':return!0;default:return!1}}
function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error('Unknown encoding: '+encoding)}}
var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||'utf8').toLowerCase().replace(/[-_]/,'');assertEncoding(encoding);switch(this.encoding){case 'utf8':this.surrogateSize=3;break;case 'ucs2':case 'utf16le':this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case 'base64':this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}
this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr='';while(this.charLength){var available=(buffer.length>=this.charLength-this.charReceived)?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return''}
buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=0xD800&&charCode<=0xDBFF){this.charLength+=this.surrogateSize;charStr='';continue}
this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}
break}
this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}
charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=0xD800&&charCode<=0xDBFF){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}
return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=(buffer.length>=3)?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==0x06){this.charLength=2;break}
if(i<=2&&c>>4==0x0E){this.charLength=3;break}
if(i<=3&&c>>3==0x1E){this.charLength=4;break}}
this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res='';if(buffer&&buffer.length)
res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}
return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}
function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}
function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{"buffer":54}],453:[function(require,module,exports){var base32=require('./thirty-two');exports.encode=base32.encode;exports.decode=base32.decode},{"./thirty-two":454}],454:[function(require,module,exports){(function(Buffer){'use strict';var charTable="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";var byteTable=[0xff,0xff,0x1a,0x1b,0x1c,0x1d,0x1e,0x1f,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0xff,0xff,0xff,0xff,0xff];function quintetCount(buff){var quintets=Math.floor(buff.length/5);return buff.length%5===0?quintets:quintets+1}
exports.encode=function(plain){if(!Buffer.isBuffer(plain)){plain=new Buffer(plain)}
var i=0;var j=0;var shiftIndex=0;var digit=0;var encoded=new Buffer(quintetCount(plain)*8);while(i<plain.length){var current=plain[i];if(shiftIndex>3){digit=current&(0xff>>shiftIndex);shiftIndex=(shiftIndex+5)%8;digit=(digit<<shiftIndex)|((i+1<plain.length)?plain[i+1]:0)>>(8-shiftIndex);i++}else{digit=(current>>(8-(shiftIndex+5)))&0x1f;shiftIndex=(shiftIndex+5)%8;if(shiftIndex===0)i++}
encoded[j]=charTable.charCodeAt(digit);j++}
for(i=j;i<encoded.length;i++){encoded[i]=0x3d}
return encoded};exports.decode=function(encoded){var shiftIndex=0;var plainDigit=0;var plainChar;var plainPos=0;if(!Buffer.isBuffer(encoded)){encoded=new Buffer(encoded)}
var decoded=new Buffer(Math.ceil(encoded.length*5/8));for(var i=0;i<encoded.length;i++){if(encoded[i]===0x3d){break}
var encodedByte=encoded[i]-0x30;if(encodedByte<byteTable.length){plainDigit=byteTable[encodedByte];if(shiftIndex<=3){shiftIndex=(shiftIndex+5)%8;if(shiftIndex===0){plainChar|=plainDigit;decoded[plainPos]=plainChar;plainPos++;plainChar=0}else{plainChar|=0xff&(plainDigit<<(8-shiftIndex))}}else{shiftIndex=(shiftIndex+5)%8;plainChar|=0xff&(plainDigit>>>shiftIndex);decoded[plainPos]=plainChar;plainPos++;plainChar=0xff&(plainDigit<<(8-shiftIndex))}}else{throw new Error('Invalid input - it is not base32 encoded string')}}
return decoded.slice(0,plainPos)}}).call(this,require("buffer").Buffer)},{"buffer":54}],455:[function(require,module,exports){var Buffer=require('buffer').Buffer
module.exports=function(buf){if(buf instanceof Uint8Array){if(buf.byteOffset===0&&buf.byteLength===buf.buffer.byteLength){return buf.buffer}else if(typeof buf.buffer.slice==='function'){return buf.buffer.slice(buf.byteOffset,buf.byteOffset+buf.byteLength)}}
if(Buffer.isBuffer(buf)){var arrayCopy=new Uint8Array(buf.length)
var len=buf.length
for(var i=0;i<len;i++){arrayCopy[i]=buf[i]}
return arrayCopy.buffer}else{throw new Error('Argument must be a Buffer')}}},{"buffer":54}],456:[function(require,module,exports){(function(process){const debug=require('debug')('torrent-discovery')
const DHT=require('bittorrent-dht/client')
const EventEmitter=require('events').EventEmitter
const parallel=require('run-parallel')
const Tracker=require('bittorrent-tracker/client')
class Discovery extends EventEmitter{constructor(opts){super()
if(!opts.peerId)throw new Error('Option `peerId` is required')
if(!opts.infoHash)throw new Error('Option `infoHash` is required')
if(!process.browser&&!opts.port)throw new Error('Option `port` is required')
this.peerId=typeof opts.peerId==='string'?opts.peerId:opts.peerId.toString('hex')
this.infoHash=typeof opts.infoHash==='string'?opts.infoHash.toLowerCase():opts.infoHash.toString('hex')
this._port=opts.port
this._userAgent=opts.userAgent
this.destroyed=!1
this._announce=opts.announce||[]
this._intervalMs=opts.intervalMs||(15*60*1000)
this._trackerOpts=null
this._dhtAnnouncing=!1
this._dhtTimeout=!1
this._internalDHT=!1
this._onWarning=err=>{this.emit('warning',err)}
this._onError=err=>{this.emit('error',err)}
this._onDHTPeer=(peer,infoHash)=>{if(infoHash.toString('hex')!==this.infoHash)return
this.emit('peer',`${peer.host}:${peer.port}`,'dht')}
this._onTrackerPeer=peer=>{this.emit('peer',peer,'tracker')}
this._onTrackerAnnounce=()=>{this.emit('trackerAnnounce')}
const createDHT=(port,opts)=>{const dht=new DHT(opts)
dht.on('warning',this._onWarning)
dht.on('error',this._onError)
dht.listen(port)
this._internalDHT=!0
return dht}
if(opts.tracker===!1){this.tracker=null}else if(opts.tracker&&typeof opts.tracker==='object'){this._trackerOpts=Object.assign({},opts.tracker)
this.tracker=this._createTracker()}else{this.tracker=this._createTracker()}
if(opts.dht===!1||typeof DHT!=='function'){this.dht=null}else if(opts.dht&&typeof opts.dht.addNode==='function'){this.dht=opts.dht}else if(opts.dht&&typeof opts.dht==='object'){this.dht=createDHT(opts.dhtPort,opts.dht)}else{this.dht=createDHT(opts.dhtPort)}
if(this.dht){this.dht.on('peer',this._onDHTPeer)
this._dhtAnnounce()}}
updatePort(port){if(port===this._port)return
this._port=port
if(this.dht)this._dhtAnnounce()
if(this.tracker){this.tracker.stop()
this.tracker.destroy(()=>{this.tracker=this._createTracker()})}}
complete(opts){if(this.tracker){this.tracker.complete(opts)}}
destroy(cb){if(this.destroyed)return
this.destroyed=!0
clearTimeout(this._dhtTimeout)
const tasks=[]
if(this.tracker){this.tracker.stop()
this.tracker.removeListener('warning',this._onWarning)
this.tracker.removeListener('error',this._onError)
this.tracker.removeListener('peer',this._onTrackerPeer)
this.tracker.removeListener('update',this._onTrackerAnnounce)
tasks.push(cb=>{this.tracker.destroy(cb)})}
if(this.dht){this.dht.removeListener('peer',this._onDHTPeer)}
if(this._internalDHT){this.dht.removeListener('warning',this._onWarning)
this.dht.removeListener('error',this._onError)
tasks.push(cb=>{this.dht.destroy(cb)})}
parallel(tasks,cb)
this.dht=null
this.tracker=null
this._announce=null}
_createTracker(){const opts=Object.assign({},this._trackerOpts,{infoHash:this.infoHash,announce:this._announce,peerId:this.peerId,port:this._port,userAgent:this._userAgent})
const tracker=new Tracker(opts)
tracker.on('warning',this._onWarning)
tracker.on('error',this._onError)
tracker.on('peer',this._onTrackerPeer)
tracker.on('update',this._onTrackerAnnounce)
tracker.setInterval(this._intervalMs)
tracker.start()
return tracker}
_dhtAnnounce(){if(this._dhtAnnouncing)return
debug('dht announce')
this._dhtAnnouncing=!0
clearTimeout(this._dhtTimeout)
this.dht.announce(this.infoHash,this._port,err=>{this._dhtAnnouncing=!1
debug('dht announce complete')
if(err)this.emit('warning',err)
this.emit('dhtAnnounce')
if(!this.destroyed){this._dhtTimeout=setTimeout(()=>{this._dhtAnnounce()},this._intervalMs+Math.floor(Math.random()*this._intervalMs/5))
if(this._dhtTimeout.unref)this._dhtTimeout.unref()}})}}
module.exports=Discovery}).call(this,require('_process'))},{"_process":139,"bittorrent-dht/client":23,"bittorrent-tracker/client":212,"debug":265,"events":90,"run-parallel":399}],457:[function(require,module,exports){(function(Buffer){const BLOCK_LENGTH=1<<14
class Piece{constructor(length){this.length=length
this.missing=length
this.sources=null
this._chunks=Math.ceil(length/BLOCK_LENGTH)
this._remainder=(length%BLOCK_LENGTH)||BLOCK_LENGTH
this._buffered=0
this._buffer=null
this._cancellations=null
this._reservations=0
this._flushed=!1}
chunkLength(i){return i===this._chunks-1?this._remainder:BLOCK_LENGTH}
chunkLengthRemaining(i){return this.length-(i*BLOCK_LENGTH)}
chunkOffset(i){return i*BLOCK_LENGTH}
reserve(){if(!this.init())return-1
if(this._cancellations.length)return this._cancellations.pop()
if(this._reservations<this._chunks)return this._reservations++
return-1}
reserveRemaining(){if(!this.init())return-1
if(this._reservations<this._chunks){const min=this._reservations
this._reservations=this._chunks
return min}
return-1}
cancel(i){if(!this.init())return
this._cancellations.push(i)}
cancelRemaining(i){if(!this.init())return
this._reservations=i}
get(i){if(!this.init())return null
return this._buffer[i]}
set(i,data,source){if(!this.init())return!1
const len=data.length
const blocks=Math.ceil(len/BLOCK_LENGTH)
for(let j=0;j<blocks;j++){if(!this._buffer[i+j]){const offset=j*BLOCK_LENGTH
const splitData=data.slice(offset,offset+BLOCK_LENGTH)
this._buffered++
this._buffer[i+j]=splitData
this.missing-=splitData.length
if(!this.sources.includes(source)){this.sources.push(source)}}}
return this._buffered===this._chunks}
flush(){if(!this._buffer||this._chunks!==this._buffered)return null
const buffer=Buffer.concat(this._buffer,this.length)
this._buffer=null
this._cancellations=null
this.sources=null
this._flushed=!0
return buffer}
init(){if(this._flushed)return!1
if(this._buffer)return!0
this._buffer=new Array(this._chunks)
this._cancellations=[]
this.sources=[]
return!0}}
Object.defineProperty(Piece,'BLOCK_LENGTH',{value:BLOCK_LENGTH})
module.exports=Piece}).call(this,require("buffer").Buffer)},{"buffer":54}],458:[function(require,module,exports){(function(Buffer){var isTypedArray=require('is-typedarray').strict
module.exports=function typedarrayToBuffer(arr){if(isTypedArray(arr)){var buf=Buffer.from(arr.buffer)
if(arr.byteLength!==arr.buffer.byteLength){buf=buf.slice(arr.byteOffset,arr.byteOffset+arr.byteLength)}
return buf}else{return Buffer.from(arr)}}}).call(this,require("buffer").Buffer)},{"buffer":54,"is-typedarray":308}],459:[function(require,module,exports){var bufferAlloc=require('buffer-alloc')
var UINT_32_MAX=Math.pow(2,32)
exports.encodingLength=function(){return 8}
exports.encode=function(num,buf,offset){if(!buf)buf=bufferAlloc(8)
if(!offset)offset=0
var top=Math.floor(num/UINT_32_MAX)
var rem=num-top*UINT_32_MAX
buf.writeUInt32BE(top,offset)
buf.writeUInt32BE(rem,offset+4)
return buf}
exports.decode=function(buf,offset){if(!offset)offset=0
var top=buf.readUInt32BE(offset)
var rem=buf.readUInt32BE(offset+4)
return top*UINT_32_MAX+rem}
exports.encode.bytes=8
exports.decode.bytes=8},{"buffer-alloc":232}],460:[function(require,module,exports){"use strict"
function unique_pred(list,compare){var ptr=1,len=list.length,a=list[0],b=list[0]
for(var i=1;i<len;++i){b=a
a=list[i]
if(compare(a,b)){if(i===ptr){ptr++
continue}
list[ptr++]=a}}
list.length=ptr
return list}
function unique_eq(list){var ptr=1,len=list.length,a=list[0],b=list[0]
for(var i=1;i<len;++i,b=a){b=a
a=list[i]
if(a!==b){if(i===ptr){ptr++
continue}
list[ptr++]=a}}
list.length=ptr
return list}
function unique(list,compare,sorted){if(list.length===0){return list}
if(compare){if(!sorted){list.sort(compare)}
return unique_pred(list,compare)}
if(!sorted){list.sort()}
return unique_eq(list)}
module.exports=unique},{}],461:[function(require,module,exports){module.exports=remove
function remove(arr,i){if(i>=arr.length||i<0)return
var last=arr.pop()
if(i<arr.length){var tmp=arr[i]
arr[i]=last
return tmp}
return last}},{}],462:[function(require,module,exports){(function(root,factory){'use strict';if(typeof module==='object'&&module.exports){module.exports=factory()}else if(typeof define==='function'&&define.amd){define(factory)}else{root.IPv6=factory(root)}}(this,function(root){'use strict';var _IPv6=root&&root.IPv6;function bestPresentation(address){var _address=address.toLowerCase();var segments=_address.split(':');var length=segments.length;var total=8;if(segments[0]===''&&segments[1]===''&&segments[2]===''){segments.shift();segments.shift()}else if(segments[0]===''&&segments[1]===''){segments.shift()}else if(segments[length-1]===''&&segments[length-2]===''){segments.pop()}
length=segments.length;if(segments[length-1].indexOf('.')!==-1){total=7}
var pos;for(pos=0;pos<length;pos++){if(segments[pos]===''){break}}
if(pos<total){segments.splice(pos,1,'0000');while(segments.length<total){segments.splice(pos,0,'0000')}}
var _segments;for(var i=0;i<total;i++){_segments=segments[i].split('');for(var j=0;j<3;j++){if(_segments[0]==='0'&&_segments.length>1){_segments.splice(0,1)}else{break}}
segments[i]=_segments.join('')}
var best=-1;var _best=0;var _current=0;var current=-1;var inzeroes=!1;for(i=0;i<total;i++){if(inzeroes){if(segments[i]==='0'){_current+=1}else{inzeroes=!1;if(_current>_best){best=current;_best=_current}}}else{if(segments[i]==='0'){inzeroes=!0;current=i;_current=1}}}
if(_current>_best){best=current;_best=_current}
if(_best>1){segments.splice(best,_best,'')}
length=segments.length;var result='';if(segments[0]===''){result=':'}
for(i=0;i<length;i++){result+=segments[i];if(i===length-1){break}
result+=':'}
if(segments[length-1]===''){result+=':'}
return result}
function noConflict(){if(root.IPv6===this){root.IPv6=_IPv6}
return this}
return{best:bestPresentation,noConflict:noConflict}}))},{}],463:[function(require,module,exports){(function(root,factory){'use strict';if(typeof module==='object'&&module.exports){module.exports=factory()}else if(typeof define==='function'&&define.amd){define(factory)}else{root.SecondLevelDomains=factory(root)}}(this,function(root){'use strict';var _SecondLevelDomains=root&&root.SecondLevelDomains;var SLD={list:{'ac':' com gov mil net org ','ae':' ac co gov mil name net org pro sch ','af':' com edu gov net org ','al':' com edu gov mil net org ','ao':' co ed gv it og pb ','ar':' com edu gob gov int mil net org tur ','at':' ac co gv or ','au':' asn com csiro edu gov id net org ','ba':' co com edu gov mil net org rs unbi unmo unsa untz unze ','bb':' biz co com edu gov info net org store tv ','bh':' biz cc com edu gov info net org ','bn':' com edu gov net org ','bo':' com edu gob gov int mil net org tv ','br':' adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ','bs':' com edu gov net org ','bz':' du et om ov rg ','ca':' ab bc mb nb nf nl ns nt nu on pe qc sk yk ','ck':' biz co edu gen gov info net org ','cn':' ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ','co':' com edu gov mil net nom org ','cr':' ac c co ed fi go or sa ','cy':' ac biz com ekloges gov ltd name net org parliament press pro tm ','do':' art com edu gob gov mil net org sld web ','dz':' art asso com edu gov net org pol ','ec':' com edu fin gov info med mil net org pro ','eg':' com edu eun gov mil name net org sci ','er':' com edu gov ind mil net org rochest w ','es':' com edu gob nom org ','et':' biz com edu gov info name net org ','fj':' ac biz com info mil name net org pro ','fk':' ac co gov net nom org ','fr':' asso com f gouv nom prd presse tm ','gg':' co net org ','gh':' com edu gov mil org ','gn':' ac com gov net org ','gr':' com edu gov mil net org ','gt':' com edu gob ind mil net org ','gu':' com edu gov net org ','hk':' com edu gov idv net org ','hu':' 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ','id':' ac co go mil net or sch web ','il':' ac co gov idf k12 muni net org ','in':' ac co edu ernet firm gen gov i ind mil net nic org res ','iq':' com edu gov i mil net org ','ir':' ac co dnssec gov i id net org sch ','it':' edu gov ','je':' co net org ','jo':' com edu gov mil name net org sch ','jp':' ac ad co ed go gr lg ne or ','ke':' ac co go info me mobi ne or sc ','kh':' com edu gov mil net org per ','ki':' biz com de edu gov info mob net org tel ','km':' asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ','kn':' edu gov net org ','kr':' ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ','kw':' com edu gov net org ','ky':' com edu gov net org ','kz':' com edu gov mil net org ','lb':' com edu gov net org ','lk':' assn com edu gov grp hotel int ltd net ngo org sch soc web ','lr':' com edu gov net org ','lv':' asn com conf edu gov id mil net org ','ly':' com edu gov id med net org plc sch ','ma':' ac co gov m net org press ','mc':' asso tm ','me':' ac co edu gov its net org priv ','mg':' com edu gov mil nom org prd tm ','mk':' com edu gov inf name net org pro ','ml':' com edu gov net org presse ','mn':' edu gov org ','mo':' com edu gov net org ','mt':' com edu gov net org ','mv':' aero biz com coop edu gov info int mil museum name net org pro ','mw':' ac co com coop edu gov int museum net org ','mx':' com edu gob net org ','my':' com edu gov mil name net org sch ','nf':' arts com firm info net other per rec store web ','ng':' biz com edu gov mil mobi name net org sch ','ni':' ac co com edu gob mil net nom org ','np':' com edu gov mil net org ','nr':' biz com edu gov info net org ','om':' ac biz co com edu gov med mil museum net org pro sch ','pe':' com edu gob mil net nom org sld ','ph':' com edu gov i mil net ngo org ','pk':' biz com edu fam gob gok gon gop gos gov net org web ','pl':' art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ','pr':' ac biz com edu est gov info isla name net org pro prof ','ps':' com edu gov net org plo sec ','pw':' belau co ed go ne or ','ro':' arts com firm info nom nt org rec store tm www ','rs':' ac co edu gov in org ','sb':' com edu gov net org ','sc':' com edu gov net org ','sh':' co com edu gov net nom org ','sl':' com edu gov net org ','st':' co com consulado edu embaixada gov mil net org principe saotome store ','sv':' com edu gob org red ','sz':' ac co org ','tr':' av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ','tt':' aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ','tw':' club com ebiz edu game gov idv mil net org ','mu':' ac co com gov net or org ','mz':' ac co edu gov org ','na':' co com ','nz':' ac co cri geek gen govt health iwi maori mil net org parliament school ','pa':' abo ac com edu gob ing med net nom org sld ','pt':' com edu gov int net nome org publ ','py':' com edu gov mil net org ','qa':' com edu gov mil net org ','re':' asso com nom ','ru':' ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ','rw':' ac co com edu gouv gov int mil net ','sa':' com edu gov med net org pub sch ','sd':' com edu gov info med net org tv ','se':' a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ','sg':' com edu gov idn net org per ','sn':' art com edu gouv org perso univ ','sy':' com edu gov mil net news org ','th':' ac co go in mi net or ','tj':' ac biz co com edu go gov info int mil name net nic org test web ','tn':' agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ','tz':' ac co go ne or ','ua':' biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ','ug':' ac co go ne or org sc ','uk':' ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ','us':' dni fed isa kids nsn ','uy':' com edu gub mil net org ','ve':' co com edu gob info mil net org web ','vi':' co com k12 net org ','vn':' ac biz com edu gov health info int name net org pro ','ye':' co com gov ltd me net org plc ','yu':' ac co edu gov org ','za':' ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ','zm':' ac co com edu gov net org sch ','com':'ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ','net':'gb jp se uk ','org':'ae','de':'com '},has:function(domain){var tldOffset=domain.lastIndexOf('.');if(tldOffset<=0||tldOffset>=(domain.length-1)){return!1}
var sldOffset=domain.lastIndexOf('.',tldOffset-1);if(sldOffset<=0||sldOffset>=(tldOffset-1)){return!1}
var sldList=SLD.list[domain.slice(tldOffset+1)];if(!sldList){return!1}
return sldList.indexOf(' '+domain.slice(sldOffset+1,tldOffset)+' ')>=0},is:function(domain){var tldOffset=domain.lastIndexOf('.');if(tldOffset<=0||tldOffset>=(domain.length-1)){return!1}
var sldOffset=domain.lastIndexOf('.',tldOffset-1);if(sldOffset>=0){return!1}
var sldList=SLD.list[domain.slice(tldOffset+1)];if(!sldList){return!1}
return sldList.indexOf(' '+domain.slice(0,tldOffset)+' ')>=0},get:function(domain){var tldOffset=domain.lastIndexOf('.');if(tldOffset<=0||tldOffset>=(domain.length-1)){return null}
var sldOffset=domain.lastIndexOf('.',tldOffset-1);if(sldOffset<=0||sldOffset>=(tldOffset-1)){return null}
var sldList=SLD.list[domain.slice(tldOffset+1)];if(!sldList){return null}
if(sldList.indexOf(' '+domain.slice(sldOffset+1,tldOffset)+' ')<0){return null}
return domain.slice(sldOffset+1)},noConflict:function(){if(root.SecondLevelDomains===this){root.SecondLevelDomains=_SecondLevelDomains}
return this}};return SLD}))},{}],464:[function(require,module,exports){(function(root,factory){'use strict';if(typeof module==='object'&&module.exports){module.exports=factory(require('./punycode'),require('./IPv6'),require('./SecondLevelDomains'))}else if(typeof define==='function'&&define.amd){define(['./punycode','./IPv6','./SecondLevelDomains'],factory)}else{root.URI=factory(root.punycode,root.IPv6,root.SecondLevelDomains,root)}}(this,function(punycode,IPv6,SLD,root){'use strict';var _URI=root&&root.URI;function URI(url,base){var _urlSupplied=arguments.length>=1;var _baseSupplied=arguments.length>=2;if(!(this instanceof URI)){if(_urlSupplied){if(_baseSupplied){return new URI(url,base)}
return new URI(url)}
return new URI()}
if(url===undefined){if(_urlSupplied){throw new TypeError('undefined is not a valid argument for URI')}
if(typeof location!=='undefined'){url=location.href+''}else{url=''}}
if(url===null){if(_urlSupplied){throw new TypeError('null is not a valid argument for URI')}}
this.href(url);if(base!==undefined){return this.absoluteTo(base)}
return this}
function isInteger(value){return/^[0-9]+$/.test(value)}
URI.version='1.19.1';var p=URI.prototype;var hasOwn=Object.prototype.hasOwnProperty;function escapeRegEx(string){return string.replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1')}
function getType(value){if(value===undefined){return'Undefined'}
return String(Object.prototype.toString.call(value)).slice(8,-1)}
function isArray(obj){return getType(obj)==='Array'}
function filterArrayValues(data,value){var lookup={};var i,length;if(getType(value)==='RegExp'){lookup=null}else if(isArray(value)){for(i=0,length=value.length;i<length;i++){lookup[value[i]]=!0}}else{lookup[value]=!0}
for(i=0,length=data.length;i<length;i++){var _match=lookup&&lookup[data[i]]!==undefined||!lookup&&value.test(data[i]);if(_match){data.splice(i,1);length--;i--}}
return data}
function arrayContains(list,value){var i,length;if(isArray(value)){for(i=0,length=value.length;i<length;i++){if(!arrayContains(list,value[i])){return!1}}
return!0}
var _type=getType(value);for(i=0,length=list.length;i<length;i++){if(_type==='RegExp'){if(typeof list[i]==='string'&&list[i].match(value)){return!0}}else if(list[i]===value){return!0}}
return!1}
function arraysEqual(one,two){if(!isArray(one)||!isArray(two)){return!1}
if(one.length!==two.length){return!1}
one.sort();two.sort();for(var i=0,l=one.length;i<l;i++){if(one[i]!==two[i]){return!1}}
return!0}
function trimSlashes(text){var trim_expression=/^\/+|\/+$/g;return text.replace(trim_expression,'')}
URI._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:URI.preventInvalidHostname,duplicateQueryParameters:URI.duplicateQueryParameters,escapeQuerySpace:URI.escapeQuerySpace}};URI.preventInvalidHostname=!1;URI.duplicateQueryParameters=!1;URI.escapeQuerySpace=!0;URI.protocol_expression=/^[a-z][a-z0-9.+-]*$/i;URI.idn_expression=/[^a-z0-9\._-]/i;URI.punycode_expression=/(xn--)/i;URI.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;URI.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;URI.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?┬½┬╗ÔÇ£ÔÇØÔÇÿÔÇÖ]))/ig;URI.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?┬½┬╗ÔÇ£ÔÇØÔÇ×ÔÇÿÔÇÖ]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g,};URI.defaultPorts={http:'80',https:'443',ftp:'21',gopher:'70',ws:'80',wss:'443'};URI.hostProtocols=['http','https'];URI.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/;URI.domAttributes={'a':'href','blockquote':'cite','link':'href','base':'href','script':'src','form':'action','img':'src','area':'href','iframe':'src','embed':'src','source':'src','track':'src','input':'src','audio':'src','video':'src'};URI.getDomAttribute=function(node){if(!node||!node.nodeName){return undefined}
var nodeName=node.nodeName.toLowerCase();if(nodeName==='input'&&node.type!=='image'){return undefined}
return URI.domAttributes[nodeName]};function escapeForDumbFirefox36(value){return escape(value)}
function strictEncodeURIComponent(string){return encodeURIComponent(string).replace(/[!'()*]/g,escapeForDumbFirefox36).replace(/\*/g,'%2A')}
URI.encode=strictEncodeURIComponent;URI.decode=decodeURIComponent;URI.iso8859=function(){URI.encode=escape;URI.decode=unescape};URI.unicode=function(){URI.encode=strictEncodeURIComponent;URI.decode=decodeURIComponent};URI.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{'%24':'$','%26':'&','%2B':'+','%2C':',','%3B':';','%3D':'=','%3A':':','%40':'@'}},decode:{expression:/[\/\?#]/g,map:{'/':'%2F','?':'%3F','#':'%23'}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{'%3A':':','%2F':'/','%3F':'?','%23':'#','%5B':'[','%5D':']','%40':'@','%21':'!','%24':'$','%26':'&','%27':'\'','%28':'(','%29':')','%2A':'*','%2B':'+','%2C':',','%3B':';','%3D':'='}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{'%21':'!','%24':'$','%27':'\'','%28':'(','%29':')','%2A':'*','%2B':'+','%2C':',','%3B':';','%3D':'=','%40':'@'}},decode:{expression:/[\/\?#:]/g,map:{'/':'%2F','?':'%3F','#':'%23',':':'%3A'}}}};URI.encodeQuery=function(string,escapeQuerySpace){var escaped=URI.encode(string+'');if(escapeQuerySpace===undefined){escapeQuerySpace=URI.escapeQuerySpace}
return escapeQuerySpace?escaped.replace(/%20/g,'+'):escaped};URI.decodeQuery=function(string,escapeQuerySpace){string+='';if(escapeQuerySpace===undefined){escapeQuerySpace=URI.escapeQuerySpace}
try{return URI.decode(escapeQuerySpace?string.replace(/\+/g,'%20'):string)}catch(e){return string}};var _parts={'encode':'encode','decode':'decode'};var _part;var generateAccessor=function(_group,_part){return function(string){try{return URI[_part](string+'').replace(URI.characters[_group][_part].expression,function(c){return URI.characters[_group][_part].map[c]})}catch(e){return string}}};for(_part in _parts){URI[_part+'PathSegment']=generateAccessor('pathname',_parts[_part]);URI[_part+'UrnPathSegment']=generateAccessor('urnpath',_parts[_part])}
var generateSegmentedPathFunction=function(_sep,_codingFuncName,_innerCodingFuncName){return function(string){var actualCodingFunc;if(!_innerCodingFuncName){actualCodingFunc=URI[_codingFuncName]}else{actualCodingFunc=function(string){return URI[_codingFuncName](URI[_innerCodingFuncName](string))}}
var segments=(string+'').split(_sep);for(var i=0,length=segments.length;i<length;i++){segments[i]=actualCodingFunc(segments[i])}
return segments.join(_sep)}};URI.decodePath=generateSegmentedPathFunction('/','decodePathSegment');URI.decodeUrnPath=generateSegmentedPathFunction(':','decodeUrnPathSegment');URI.recodePath=generateSegmentedPathFunction('/','encodePathSegment','decode');URI.recodeUrnPath=generateSegmentedPathFunction(':','encodeUrnPathSegment','decode');URI.encodeReserved=generateAccessor('reserved','encode');URI.parse=function(string,parts){var pos;if(!parts){parts={preventInvalidHostname:URI.preventInvalidHostname}}
pos=string.indexOf('#');if(pos>-1){parts.fragment=string.substring(pos+1)||null;string=string.substring(0,pos)}
pos=string.indexOf('?');if(pos>-1){parts.query=string.substring(pos+1)||null;string=string.substring(0,pos)}
if(string.substring(0,2)==='//'){parts.protocol=null;string=string.substring(2);string=URI.parseAuthority(string,parts)}else{pos=string.indexOf(':');if(pos>-1){parts.protocol=string.substring(0,pos)||null;if(parts.protocol&&!parts.protocol.match(URI.protocol_expression)){parts.protocol=undefined}else if(string.substring(pos+1,pos+3)==='//'){string=string.substring(pos+3);string=URI.parseAuthority(string,parts)}else{string=string.substring(pos+1);parts.urn=!0}}}
parts.path=string;return parts};URI.parseHost=function(string,parts){if(!string){string=''}
string=string.replace(/\\/g,'/');var pos=string.indexOf('/');var bracketPos;var t;if(pos===-1){pos=string.length}
if(string.charAt(0)==='['){bracketPos=string.indexOf(']');parts.hostname=string.substring(1,bracketPos)||null;parts.port=string.substring(bracketPos+2,pos)||null;if(parts.port==='/'){parts.port=null}}else{var firstColon=string.indexOf(':');var firstSlash=string.indexOf('/');var nextColon=string.indexOf(':',firstColon+1);if(nextColon!==-1&&(firstSlash===-1||nextColon<firstSlash)){parts.hostname=string.substring(0,pos)||null;parts.port=null}else{t=string.substring(0,pos).split(':');parts.hostname=t[0]||null;parts.port=t[1]||null}}
if(parts.hostname&&string.substring(pos).charAt(0)!=='/'){pos++;string='/'+string}
if(parts.preventInvalidHostname){URI.ensureValidHostname(parts.hostname,parts.protocol)}
if(parts.port){URI.ensureValidPort(parts.port)}
return string.substring(pos)||'/'};URI.parseAuthority=function(string,parts){string=URI.parseUserinfo(string,parts);return URI.parseHost(string,parts)};URI.parseUserinfo=function(string,parts){var firstSlash=string.indexOf('/');var pos=string.lastIndexOf('@',firstSlash>-1?firstSlash:string.length-1);var t;if(pos>-1&&(firstSlash===-1||pos<firstSlash)){t=string.substring(0,pos).split(':');parts.username=t[0]?URI.decode(t[0]):null;t.shift();parts.password=t[0]?URI.decode(t.join(':')):null;string=string.substring(pos+1)}else{parts.username=null;parts.password=null}
return string};URI.parseQuery=function(string,escapeQuerySpace){if(!string){return{}}
string=string.replace(/&+/g,'&').replace(/^\?*&*|&+$/g,'');if(!string){return{}}
var items={};var splits=string.split('&');var length=splits.length;var v,name,value;for(var i=0;i<length;i++){v=splits[i].split('=');name=URI.decodeQuery(v.shift(),escapeQuerySpace);value=v.length?URI.decodeQuery(v.join('='),escapeQuerySpace):null;if(hasOwn.call(items,name)){if(typeof items[name]==='string'||items[name]===null){items[name]=[items[name]]}
items[name].push(value)}else{items[name]=value}}
return items};URI.build=function(parts){var t='';if(parts.protocol){t+=parts.protocol+':'}
if(!parts.urn&&(t||parts.hostname)){t+='//'}
t+=(URI.buildAuthority(parts)||'');if(typeof parts.path==='string'){if(parts.path.charAt(0)!=='/'&&typeof parts.hostname==='string'){t+='/'}
t+=parts.path}
if(typeof parts.query==='string'&&parts.query){t+='?'+parts.query}
if(typeof parts.fragment==='string'&&parts.fragment){t+='#'+parts.fragment}
return t};URI.buildHost=function(parts){var t='';if(!parts.hostname){return''}else if(URI.ip6_expression.test(parts.hostname)){t+='['+parts.hostname+']'}else{t+=parts.hostname}
if(parts.port){t+=':'+parts.port}
return t};URI.buildAuthority=function(parts){return URI.buildUserinfo(parts)+URI.buildHost(parts)};URI.buildUserinfo=function(parts){var t='';if(parts.username){t+=URI.encode(parts.username)}
if(parts.password){t+=':'+URI.encode(parts.password)}
if(t){t+='@'}
return t};URI.buildQuery=function(data,duplicateQueryParameters,escapeQuerySpace){var t='';var unique,key,i,length;for(key in data){if(hasOwn.call(data,key)&&key){if(isArray(data[key])){unique={};for(i=0,length=data[key].length;i<length;i++){if(data[key][i]!==undefined&&unique[data[key][i]+'']===undefined){t+='&'+URI.buildQueryParameter(key,data[key][i],escapeQuerySpace);if(duplicateQueryParameters!==!0){unique[data[key][i]+'']=!0}}}}else if(data[key]!==undefined){t+='&'+URI.buildQueryParameter(key,data[key],escapeQuerySpace)}}}
return t.substring(1)};URI.buildQueryParameter=function(name,value,escapeQuerySpace){return URI.encodeQuery(name,escapeQuerySpace)+(value!==null?'='+URI.encodeQuery(value,escapeQuerySpace):'')};URI.addQuery=function(data,name,value){if(typeof name==='object'){for(var key in name){if(hasOwn.call(name,key)){URI.addQuery(data,key,name[key])}}}else if(typeof name==='string'){if(data[name]===undefined){data[name]=value;return}else if(typeof data[name]==='string'){data[name]=[data[name]]}
if(!isArray(value)){value=[value]}
data[name]=(data[name]||[]).concat(value)}else{throw new TypeError('URI.addQuery() accepts an object, string as the name parameter')}};URI.setQuery=function(data,name,value){if(typeof name==='object'){for(var key in name){if(hasOwn.call(name,key)){URI.setQuery(data,key,name[key])}}}else if(typeof name==='string'){data[name]=value===undefined?null:value}else{throw new TypeError('URI.setQuery() accepts an object, string as the name parameter')}};URI.removeQuery=function(data,name,value){var i,length,key;if(isArray(name)){for(i=0,length=name.length;i<length;i++){data[name[i]]=undefined}}else if(getType(name)==='RegExp'){for(key in data){if(name.test(key)){data[key]=undefined}}}else if(typeof name==='object'){for(key in name){if(hasOwn.call(name,key)){URI.removeQuery(data,key,name[key])}}}else if(typeof name==='string'){if(value!==undefined){if(getType(value)==='RegExp'){if(!isArray(data[name])&&value.test(data[name])){data[name]=undefined}else{data[name]=filterArrayValues(data[name],value)}}else if(data[name]===String(value)&&(!isArray(value)||value.length===1)){data[name]=undefined}else if(isArray(data[name])){data[name]=filterArrayValues(data[name],value)}}else{data[name]=undefined}}else{throw new TypeError('URI.removeQuery() accepts an object, string, RegExp as the first parameter')}};URI.hasQuery=function(data,name,value,withinArray){switch(getType(name)){case 'String':break;case 'RegExp':for(var key in data){if(hasOwn.call(data,key)){if(name.test(key)&&(value===undefined||URI.hasQuery(data,key,value))){return!0}}}
return!1;case 'Object':for(var _key in name){if(hasOwn.call(name,_key)){if(!URI.hasQuery(data,_key,name[_key])){return!1}}}
return!0;default:throw new TypeError('URI.hasQuery() accepts a string, regular expression or object as the name parameter')}
switch(getType(value)){case 'Undefined':return name in data;case 'Boolean':var _booly=Boolean(isArray(data[name])?data[name].length:data[name]);return value===_booly;case 'Function':return!!value(data[name],name,data);case 'Array':if(!isArray(data[name])){return!1}
var op=withinArray?arrayContains:arraysEqual;return op(data[name],value);case 'RegExp':if(!isArray(data[name])){return Boolean(data[name]&&data[name].match(value))}
if(!withinArray){return!1}
return arrayContains(data[name],value);case 'Number':value=String(value);case 'String':if(!isArray(data[name])){return data[name]===value}
if(!withinArray){return!1}
return arrayContains(data[name],value);default:throw new TypeError('URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter')}};URI.joinPaths=function(){var input=[];var segments=[];var nonEmptySegments=0;for(var i=0;i<arguments.length;i++){var url=new URI(arguments[i]);input.push(url);var _segments=url.segment();for(var s=0;s<_segments.length;s++){if(typeof _segments[s]==='string'){segments.push(_segments[s])}
if(_segments[s]){nonEmptySegments++}}}
if(!segments.length||!nonEmptySegments){return new URI('')}
var uri=new URI('').segment(segments);if(input[0].path()===''||input[0].path().slice(0,1)==='/'){uri.path('/'+uri.path())}
return uri.normalize()};URI.commonPath=function(one,two){var length=Math.min(one.length,two.length);var pos;for(pos=0;pos<length;pos++){if(one.charAt(pos)!==two.charAt(pos)){pos--;break}}
if(pos<1){return one.charAt(0)===two.charAt(0)&&one.charAt(0)==='/'?'/':''}
if(one.charAt(pos)!=='/'||two.charAt(pos)!=='/'){pos=one.substring(0,pos).lastIndexOf('/')}
return one.substring(0,pos+1)};URI.withinString=function(string,callback,options){options||(options={});var _start=options.start||URI.findUri.start;var _end=options.end||URI.findUri.end;var _trim=options.trim||URI.findUri.trim;var _parens=options.parens||URI.findUri.parens;var _attributeOpen=/[a-z0-9-]=["']?$/i;_start.lastIndex=0;while(!0){var match=_start.exec(string);if(!match){break}
var start=match.index;if(options.ignoreHtml){var attributeOpen=string.slice(Math.max(start-3,0),start);if(attributeOpen&&_attributeOpen.test(attributeOpen)){continue}}
var end=start+string.slice(start).search(_end);var slice=string.slice(start,end);var parensEnd=-1;while(!0){var parensMatch=_parens.exec(slice);if(!parensMatch){break}
var parensMatchEnd=parensMatch.index+parensMatch[0].length;parensEnd=Math.max(parensEnd,parensMatchEnd)}
if(parensEnd>-1){slice=slice.slice(0,parensEnd)+slice.slice(parensEnd).replace(_trim,'')}else{slice=slice.replace(_trim,'')}
if(slice.length<=match[0].length){continue}
if(options.ignore&&options.ignore.test(slice)){continue}
end=start+slice.length;var result=callback(slice,start,end,string);if(result===undefined){_start.lastIndex=end;continue}
result=String(result);string=string.slice(0,start)+result+string.slice(end);_start.lastIndex=start+result.length}
_start.lastIndex=0;return string};URI.ensureValidHostname=function(v,protocol){var hasHostname=!!v;var hasProtocol=!!protocol;var rejectEmptyHostname=!1;if(hasProtocol){rejectEmptyHostname=arrayContains(URI.hostProtocols,protocol)}
if(rejectEmptyHostname&&!hasHostname){throw new TypeError('Hostname cannot be empty, if protocol is '+protocol)}else if(v&&v.match(URI.invalid_hostname_characters)){if(!punycode){throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available')}
if(punycode.toASCII(v).match(URI.invalid_hostname_characters)){throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-:_]')}}};URI.ensureValidPort=function(v){if(!v){return}
var port=Number(v);if(isInteger(port)&&(port>0)&&(port<65536)){return}
throw new TypeError('Port "'+v+'" is not a valid port')};URI.noConflict=function(removeAll){if(removeAll){var unconflicted={URI:this.noConflict()};if(root.URITemplate&&typeof root.URITemplate.noConflict==='function'){unconflicted.URITemplate=root.URITemplate.noConflict()}
if(root.IPv6&&typeof root.IPv6.noConflict==='function'){unconflicted.IPv6=root.IPv6.noConflict()}
if(root.SecondLevelDomains&&typeof root.SecondLevelDomains.noConflict==='function'){unconflicted.SecondLevelDomains=root.SecondLevelDomains.noConflict()}
return unconflicted}else if(root.URI===this){root.URI=_URI}
return this};p.build=function(deferBuild){if(deferBuild===!0){this._deferred_build=!0}else if(deferBuild===undefined||this._deferred_build){this._string=URI.build(this._parts);this._deferred_build=!1}
return this};p.clone=function(){return new URI(this)};p.valueOf=p.toString=function(){return this.build(!1)._string};function generateSimpleAccessor(_part){return function(v,build){if(v===undefined){return this._parts[_part]||''}else{this._parts[_part]=v||null;this.build(!build);return this}}}
function generatePrefixAccessor(_part,_key){return function(v,build){if(v===undefined){return this._parts[_part]||''}else{if(v!==null){v=v+'';if(v.charAt(0)===_key){v=v.substring(1)}}
this._parts[_part]=v;this.build(!build);return this}}}
p.protocol=generateSimpleAccessor('protocol');p.username=generateSimpleAccessor('username');p.password=generateSimpleAccessor('password');p.hostname=generateSimpleAccessor('hostname');p.port=generateSimpleAccessor('port');p.query=generatePrefixAccessor('query','?');p.fragment=generatePrefixAccessor('fragment','#');p.search=function(v,build){var t=this.query(v,build);return typeof t==='string'&&t.length?('?'+t):t};p.hash=function(v,build){var t=this.fragment(v,build);return typeof t==='string'&&t.length?('#'+t):t};p.pathname=function(v,build){if(v===undefined||v===!0){var res=this._parts.path||(this._parts.hostname?'/':'');return v?(this._parts.urn?URI.decodeUrnPath:URI.decodePath)(res):res}else{if(this._parts.urn){this._parts.path=v?URI.recodeUrnPath(v):''}else{this._parts.path=v?URI.recodePath(v):'/'}
this.build(!build);return this}};p.path=p.pathname;p.href=function(href,build){var key;if(href===undefined){return this.toString()}
this._string='';this._parts=URI._parts();var _URI=href instanceof URI;var _object=typeof href==='object'&&(href.hostname||href.path||href.pathname);if(href.nodeName){var attribute=URI.getDomAttribute(href);href=href[attribute]||'';_object=!1}
if(!_URI&&_object&&href.pathname!==undefined){href=href.toString()}
if(typeof href==='string'||href instanceof String){this._parts=URI.parse(String(href),this._parts)}else if(_URI||_object){var src=_URI?href._parts:href;for(key in src){if(key==='query'){continue}
if(hasOwn.call(this._parts,key)){this._parts[key]=src[key]}}
if(src.query){this.query(src.query,!1)}}else{throw new TypeError('invalid input')}
this.build(!build);return this};p.is=function(what){var ip=!1;var ip4=!1;var ip6=!1;var name=!1;var sld=!1;var idn=!1;var punycode=!1;var relative=!this._parts.urn;if(this._parts.hostname){relative=!1;ip4=URI.ip4_expression.test(this._parts.hostname);ip6=URI.ip6_expression.test(this._parts.hostname);ip=ip4||ip6;name=!ip;sld=name&&SLD&&SLD.has(this._parts.hostname);idn=name&&URI.idn_expression.test(this._parts.hostname);punycode=name&&URI.punycode_expression.test(this._parts.hostname)}
switch(what.toLowerCase()){case 'relative':return relative;case 'absolute':return!relative;case 'domain':case 'name':return name;case 'sld':return sld;case 'ip':return ip;case 'ip4':case 'ipv4':case 'inet4':return ip4;case 'ip6':case 'ipv6':case 'inet6':return ip6;case 'idn':return idn;case 'url':return!this._parts.urn;case 'urn':return!!this._parts.urn;case 'punycode':return punycode}
return null};var _protocol=p.protocol;var _port=p.port;var _hostname=p.hostname;p.protocol=function(v,build){if(v){v=v.replace(/:(\/\/)?$/,'');if(!v.match(URI.protocol_expression)){throw new TypeError('Protocol "'+v+'" contains characters other than [A-Z0-9.+-] or doesn\'t start with [A-Z]')}}
return _protocol.call(this,v,build)};p.scheme=p.protocol;p.port=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(v!==undefined){if(v===0){v=null}
if(v){v+='';if(v.charAt(0)===':'){v=v.substring(1)}
URI.ensureValidPort(v)}}
return _port.call(this,v,build)};p.hostname=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(v!==undefined){var x={preventInvalidHostname:this._parts.preventInvalidHostname};var res=URI.parseHost(v,x);if(res!=='/'){throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-]')}
v=x.hostname;if(this._parts.preventInvalidHostname){URI.ensureValidHostname(v,this._parts.protocol)}}
return _hostname.call(this,v,build)};p.origin=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(v===undefined){var protocol=this.protocol();var authority=this.authority();if(!authority){return''}
return(protocol?protocol+'://':'')+this.authority()}else{var origin=URI(v);this.protocol(origin.protocol()).authority(origin.authority()).build(!build);return this}};p.host=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(v===undefined){return this._parts.hostname?URI.buildHost(this._parts):''}else{var res=URI.parseHost(v,this._parts);if(res!=='/'){throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-]')}
this.build(!build);return this}};p.authority=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(v===undefined){return this._parts.hostname?URI.buildAuthority(this._parts):''}else{var res=URI.parseAuthority(v,this._parts);if(res!=='/'){throw new TypeError('Hostname "'+v+'" contains characters other than [A-Z0-9.-]')}
this.build(!build);return this}};p.userinfo=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(v===undefined){var t=URI.buildUserinfo(this._parts);return t?t.substring(0,t.length-1):t}else{if(v[v.length-1]!=='@'){v+='@'}
URI.parseUserinfo(v,this._parts);this.build(!build);return this}};p.resource=function(v,build){var parts;if(v===undefined){return this.path()+this.search()+this.hash()}
parts=URI.parse(v);this._parts.path=parts.path;this._parts.query=parts.query;this._parts.fragment=parts.fragment;this.build(!build);return this};p.subdomain=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(v===undefined){if(!this._parts.hostname||this.is('IP')){return''}
var end=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,end)||''}else{var e=this._parts.hostname.length-this.domain().length;var sub=this._parts.hostname.substring(0,e);var replace=new RegExp('^'+escapeRegEx(sub));if(v&&v.charAt(v.length-1)!=='.'){v+='.'}
if(v.indexOf(':')!==-1){throw new TypeError('Domains cannot contain colons')}
if(v){URI.ensureValidHostname(v,this._parts.protocol)}
this._parts.hostname=this._parts.hostname.replace(replace,v);this.build(!build);return this}};p.domain=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(typeof v==='boolean'){build=v;v=undefined}
if(v===undefined){if(!this._parts.hostname||this.is('IP')){return''}
var t=this._parts.hostname.match(/\./g);if(t&&t.length<2){return this._parts.hostname}
var end=this._parts.hostname.length-this.tld(build).length-1;end=this._parts.hostname.lastIndexOf('.',end-1)+1;return this._parts.hostname.substring(end)||''}else{if(!v){throw new TypeError('cannot set domain empty')}
if(v.indexOf(':')!==-1){throw new TypeError('Domains cannot contain colons')}
URI.ensureValidHostname(v,this._parts.protocol);if(!this._parts.hostname||this.is('IP')){this._parts.hostname=v}else{var replace=new RegExp(escapeRegEx(this.domain())+'$');this._parts.hostname=this._parts.hostname.replace(replace,v)}
this.build(!build);return this}};p.tld=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(typeof v==='boolean'){build=v;v=undefined}
if(v===undefined){if(!this._parts.hostname||this.is('IP')){return''}
var pos=this._parts.hostname.lastIndexOf('.');var tld=this._parts.hostname.substring(pos+1);if(build!==!0&&SLD&&SLD.list[tld.toLowerCase()]){return SLD.get(this._parts.hostname)||tld}
return tld}else{var replace;if(!v){throw new TypeError('cannot set TLD empty')}else if(v.match(/[^a-zA-Z0-9-]/)){if(SLD&&SLD.is(v)){replace=new RegExp(escapeRegEx(this.tld())+'$');this._parts.hostname=this._parts.hostname.replace(replace,v)}else{throw new TypeError('TLD "'+v+'" contains characters other than [A-Z0-9]')}}else if(!this._parts.hostname||this.is('IP')){throw new ReferenceError('cannot set TLD on non-domain host')}else{replace=new RegExp(escapeRegEx(this.tld())+'$');this._parts.hostname=this._parts.hostname.replace(replace,v)}
this.build(!build);return this}};p.directory=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(v===undefined||v===!0){if(!this._parts.path&&!this._parts.hostname){return''}
if(this._parts.path==='/'){return'/'}
var end=this._parts.path.length-this.filename().length-1;var res=this._parts.path.substring(0,end)||(this._parts.hostname?'/':'');return v?URI.decodePath(res):res}else{var e=this._parts.path.length-this.filename().length;var directory=this._parts.path.substring(0,e);var replace=new RegExp('^'+escapeRegEx(directory));if(!this.is('relative')){if(!v){v='/'}
if(v.charAt(0)!=='/'){v='/'+v}}
if(v&&v.charAt(v.length-1)!=='/'){v+='/'}
v=URI.recodePath(v);this._parts.path=this._parts.path.replace(replace,v);this.build(!build);return this}};p.filename=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(typeof v!=='string'){if(!this._parts.path||this._parts.path==='/'){return''}
var pos=this._parts.path.lastIndexOf('/');var res=this._parts.path.substring(pos+1);return v?URI.decodePathSegment(res):res}else{var mutatedDirectory=!1;if(v.charAt(0)==='/'){v=v.substring(1)}
if(v.match(/\.?\//)){mutatedDirectory=!0}
var replace=new RegExp(escapeRegEx(this.filename())+'$');v=URI.recodePath(v);this._parts.path=this._parts.path.replace(replace,v);if(mutatedDirectory){this.normalizePath(build)}else{this.build(!build)}
return this}};p.suffix=function(v,build){if(this._parts.urn){return v===undefined?'':this}
if(v===undefined||v===!0){if(!this._parts.path||this._parts.path==='/'){return''}
var filename=this.filename();var pos=filename.lastIndexOf('.');var s,res;if(pos===-1){return''}
s=filename.substring(pos+1);res=(/^[a-z0-9%]+$/i).test(s)?s:'';return v?URI.decodePathSegment(res):res}else{if(v.charAt(0)==='.'){v=v.substring(1)}
var suffix=this.suffix();var replace;if(!suffix){if(!v){return this}
this._parts.path+='.'+URI.recodePath(v)}else if(!v){replace=new RegExp(escapeRegEx('.'+suffix)+'$')}else{replace=new RegExp(escapeRegEx(suffix)+'$')}
if(replace){v=URI.recodePath(v);this._parts.path=this._parts.path.replace(replace,v)}
this.build(!build);return this}};p.segment=function(segment,v,build){var separator=this._parts.urn?':':'/';var path=this.path();var absolute=path.substring(0,1)==='/';var segments=path.split(separator);if(segment!==undefined&&typeof segment!=='number'){build=v;v=segment;segment=undefined}
if(segment!==undefined&&typeof segment!=='number'){throw new Error('Bad segment "'+segment+'", must be 0-based integer')}
if(absolute){segments.shift()}
if(segment<0){segment=Math.max(segments.length+segment,0)}
if(v===undefined){return segment===undefined?segments:segments[segment]}else if(segment===null||segments[segment]===undefined){if(isArray(v)){segments=[];for(var i=0,l=v.length;i<l;i++){if(!v[i].length&&(!segments.length||!segments[segments.length-1].length)){continue}
if(segments.length&&!segments[segments.length-1].length){segments.pop()}
segments.push(trimSlashes(v[i]))}}else if(v||typeof v==='string'){v=trimSlashes(v);if(segments[segments.length-1]===''){segments[segments.length-1]=v}else{segments.push(v)}}}else{if(v){segments[segment]=trimSlashes(v)}else{segments.splice(segment,1)}}
if(absolute){segments.unshift('')}
return this.path(segments.join(separator),build)};p.segmentCoded=function(segment,v,build){var segments,i,l;if(typeof segment!=='number'){build=v;v=segment;segment=undefined}
if(v===undefined){segments=this.segment(segment,v,build);if(!isArray(segments)){segments=segments!==undefined?URI.decode(segments):undefined}else{for(i=0,l=segments.length;i<l;i++){segments[i]=URI.decode(segments[i])}}
return segments}
if(!isArray(v)){v=(typeof v==='string'||v instanceof String)?URI.encode(v):v}else{for(i=0,l=v.length;i<l;i++){v[i]=URI.encode(v[i])}}
return this.segment(segment,v,build)};var q=p.query;p.query=function(v,build){if(v===!0){return URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace)}else if(typeof v==='function'){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);var result=v.call(this,data);this._parts.query=URI.buildQuery(result||data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!build);return this}else if(v!==undefined&&typeof v!=='string'){this._parts.query=URI.buildQuery(v,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);this.build(!build);return this}else{return q.call(this,v,build)}};p.setQuery=function(name,value,build){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof name==='string'||name instanceof String){data[name]=value!==undefined?value:null}else if(typeof name==='object'){for(var key in name){if(hasOwn.call(name,key)){data[key]=name[key]}}}else{throw new TypeError('URI.addQuery() accepts an object, string as the name parameter')}
this._parts.query=URI.buildQuery(data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof name!=='string'){build=value}
this.build(!build);return this};p.addQuery=function(name,value,build){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);URI.addQuery(data,name,value===undefined?null:value);this._parts.query=URI.buildQuery(data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof name!=='string'){build=value}
this.build(!build);return this};p.removeQuery=function(name,value,build){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);URI.removeQuery(data,name,value);this._parts.query=URI.buildQuery(data,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace);if(typeof name!=='string'){build=value}
this.build(!build);return this};p.hasQuery=function(name,value,withinArray){var data=URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return URI.hasQuery(data,name,value,withinArray)};p.setSearch=p.setQuery;p.addSearch=p.addQuery;p.removeSearch=p.removeQuery;p.hasSearch=p.hasQuery;p.normalize=function(){if(this._parts.urn){return this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()}
return this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()};p.normalizeProtocol=function(build){if(typeof this._parts.protocol==='string'){this._parts.protocol=this._parts.protocol.toLowerCase();this.build(!build)}
return this};p.normalizeHostname=function(build){if(this._parts.hostname){if(this.is('IDN')&&punycode){this._parts.hostname=punycode.toASCII(this._parts.hostname)}else if(this.is('IPv6')&&IPv6){this._parts.hostname=IPv6.best(this._parts.hostname)}
this._parts.hostname=this._parts.hostname.toLowerCase();this.build(!build)}
return this};p.normalizePort=function(build){if(typeof this._parts.protocol==='string'&&this._parts.port===URI.defaultPorts[this._parts.protocol]){this._parts.port=null;this.build(!build)}
return this};p.normalizePath=function(build){var _path=this._parts.path;if(!_path){return this}
if(this._parts.urn){this._parts.path=URI.recodeUrnPath(this._parts.path);this.build(!build);return this}
if(this._parts.path==='/'){return this}
_path=URI.recodePath(_path);var _was_relative;var _leadingParents='';var _parent,_pos;if(_path.charAt(0)!=='/'){_was_relative=!0;_path='/'+_path}
if(_path.slice(-3)==='/..'||_path.slice(-2)==='/.'){_path+='/'}
_path=_path.replace(/(\/(\.\/)+)|(\/\.$)/g,'/').replace(/\/{2,}/g,'/');if(_was_relative){_leadingParents=_path.substring(1).match(/^(\.\.\/)+/)||'';if(_leadingParents){_leadingParents=_leadingParents[0]}}
while(!0){_parent=_path.search(/\/\.\.(\/|$)/);if(_parent===-1){break}else if(_parent===0){_path=_path.substring(3);continue}
_pos=_path.substring(0,_parent).lastIndexOf('/');if(_pos===-1){_pos=_parent}
_path=_path.substring(0,_pos)+_path.substring(_parent+3)}
if(_was_relative&&this.is('relative')){_path=_leadingParents+_path.substring(1)}
this._parts.path=_path;this.build(!build);return this};p.normalizePathname=p.normalizePath;p.normalizeQuery=function(build){if(typeof this._parts.query==='string'){if(!this._parts.query.length){this._parts.query=null}else{this.query(URI.parseQuery(this._parts.query,this._parts.escapeQuerySpace))}
this.build(!build)}
return this};p.normalizeFragment=function(build){if(!this._parts.fragment){this._parts.fragment=null;this.build(!build)}
return this};p.normalizeSearch=p.normalizeQuery;p.normalizeHash=p.normalizeFragment;p.iso8859=function(){var e=URI.encode;var d=URI.decode;URI.encode=escape;URI.decode=decodeURIComponent;try{this.normalize()}finally{URI.encode=e;URI.decode=d}
return this};p.unicode=function(){var e=URI.encode;var d=URI.decode;URI.encode=strictEncodeURIComponent;URI.decode=unescape;try{this.normalize()}finally{URI.encode=e;URI.decode=d}
return this};p.readable=function(){var uri=this.clone();uri.username('').password('').normalize();var t='';if(uri._parts.protocol){t+=uri._parts.protocol+'://'}
if(uri._parts.hostname){if(uri.is('punycode')&&punycode){t+=punycode.toUnicode(uri._parts.hostname);if(uri._parts.port){t+=':'+uri._parts.port}}else{t+=uri.host()}}
if(uri._parts.hostname&&uri._parts.path&&uri._parts.path.charAt(0)!=='/'){t+='/'}
t+=uri.path(!0);if(uri._parts.query){var q='';for(var i=0,qp=uri._parts.query.split('&'),l=qp.length;i<l;i++){var kv=(qp[i]||'').split('=');q+='&'+URI.decodeQuery(kv[0],this._parts.escapeQuerySpace).replace(/&/g,'%26');if(kv[1]!==undefined){q+='='+URI.decodeQuery(kv[1],this._parts.escapeQuerySpace).replace(/&/g,'%26')}}
t+='?'+q.substring(1)}
t+=URI.decodeQuery(uri.hash(),!0);return t};p.absoluteTo=function(base){var resolved=this.clone();var properties=['protocol','username','password','hostname','port'];var basedir,i,p;if(this._parts.urn){throw new Error('URNs do not have any generally defined hierarchical components')}
if(!(base instanceof URI)){base=new URI(base)}
if(resolved._parts.protocol){return resolved}else{resolved._parts.protocol=base._parts.protocol}
if(this._parts.hostname){return resolved}
for(i=0;(p=properties[i]);i++){resolved._parts[p]=base._parts[p]}
if(!resolved._parts.path){resolved._parts.path=base._parts.path;if(!resolved._parts.query){resolved._parts.query=base._parts.query}}else{if(resolved._parts.path.substring(-2)==='..'){resolved._parts.path+='/'}
if(resolved.path().charAt(0)!=='/'){basedir=base.directory();basedir=basedir?basedir:base.path().indexOf('/')===0?'/':'';resolved._parts.path=(basedir?(basedir+'/'):'')+resolved._parts.path;resolved.normalizePath()}}
resolved.build();return resolved};p.relativeTo=function(base){var relative=this.clone().normalize();var relativeParts,baseParts,common,relativePath,basePath;if(relative._parts.urn){throw new Error('URNs do not have any generally defined hierarchical components')}
base=new URI(base).normalize();relativeParts=relative._parts;baseParts=base._parts;relativePath=relative.path();basePath=base.path();if(relativePath.charAt(0)!=='/'){throw new Error('URI is already relative')}
if(basePath.charAt(0)!=='/'){throw new Error('Cannot calculate a URI relative to another relative URI')}
if(relativeParts.protocol===baseParts.protocol){relativeParts.protocol=null}
if(relativeParts.username!==baseParts.username||relativeParts.password!==baseParts.password){return relative.build()}
if(relativeParts.protocol!==null||relativeParts.username!==null||relativeParts.password!==null){return relative.build()}
if(relativeParts.hostname===baseParts.hostname&&relativeParts.port===baseParts.port){relativeParts.hostname=null;relativeParts.port=null}else{return relative.build()}
if(relativePath===basePath){relativeParts.path='';return relative.build()}
common=URI.commonPath(relativePath,basePath);if(!common){return relative.build()}
var parents=baseParts.path.substring(common.length).replace(/[^\/]*$/,'').replace(/.*?\//g,'../');relativeParts.path=(parents+relativeParts.path.substring(common.length))||'./';return relative.build()};p.equals=function(uri){var one=this.clone();var two=new URI(uri);var one_map={};var two_map={};var checked={};var one_query,two_query,key;one.normalize();two.normalize();if(one.toString()===two.toString()){return!0}
one_query=one.query();two_query=two.query();one.query('');two.query('');if(one.toString()!==two.toString()){return!1}
if(one_query.length!==two_query.length){return!1}
one_map=URI.parseQuery(one_query,this._parts.escapeQuerySpace);two_map=URI.parseQuery(two_query,this._parts.escapeQuerySpace);for(key in one_map){if(hasOwn.call(one_map,key)){if(!isArray(one_map[key])){if(one_map[key]!==two_map[key]){return!1}}else if(!arraysEqual(one_map[key],two_map[key])){return!1}
checked[key]=!0}}
for(key in two_map){if(hasOwn.call(two_map,key)){if(!checked[key]){return!1}}}
return!0};p.preventInvalidHostname=function(v){this._parts.preventInvalidHostname=!!v;return this};p.duplicateQueryParameters=function(v){this._parts.duplicateQueryParameters=!!v;return this};p.escapeQuerySpace=function(v){this._parts.escapeQuerySpace=!!v;return this};return URI}))},{"./IPv6":462,"./SecondLevelDomains":463,"./punycode":465}],465:[function(require,module,exports){(function(global){;(function(root){var freeExports=typeof exports=='object'&&exports&&!exports.nodeType&&exports;var freeModule=typeof module=='object'&&module&&!module.nodeType&&module;var freeGlobal=typeof global=='object'&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}
var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter='-',regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={'overflow':'Overflow: input needs wider integers to process','not-basic':'Illegal input >= 0x80 (not a basic code point)','invalid-input':'Invalid input'},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}
function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}
return result}
function mapDomain(string,fn){var parts=string.split('@');var result='';if(parts.length>1){result=parts[0]+'@';string=parts[1]}
string=string.replace(regexSeparators,'\x2E');var labels=string.split('.');var encoded=map(labels,fn).join('.');return result+encoded}
function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=0xD800&&value<=0xDBFF&&counter<length){extra=string.charCodeAt(counter++);if((extra&0xFC00)==0xDC00){output.push(((value&0x3FF)<<10)+(extra&0x3FF)+0x10000)}else{output.push(value);counter--}}else{output.push(value)}}
return output}
function ucs2encode(array){return map(array,function(value){var output='';if(value>0xFFFF){value-=0x10000;output+=stringFromCharCode(value>>>10&0x3FF|0xD800);value=0xDC00|value&0x3FF}
output+=stringFromCharCode(value);return output}).join('')}
function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}
if(codePoint-65<26){return codePoint-65}
if(codePoint-97<26){return codePoint-97}
return base}
function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}
function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}
return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}
function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}
for(j=0;j<basic;++j){if(input.charCodeAt(j)>=0x80){error('not-basic')}
output.push(input.charCodeAt(j))}
for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error('invalid-input')}
digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error('overflow')}
i+=digit*w;t=k<=bias?tMin:(k>=bias+tMax?tMax:k-bias);if(digit<t){break}
baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error('overflow')}
w*=baseMinusT}
out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error('overflow')}
n+=floor(i/out);i%=out;output.splice(i++,0,n)}
return ucs2encode(output)}
function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<0x80){output.push(stringFromCharCode(currentValue))}}
handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}
while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}
handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error('overflow')}
delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error('overflow')}
if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:(k>=bias+tMax?tMax:k-bias);if(q<t){break}
qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}
output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}
++delta;++n}
return output.join('')}
function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}
function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?'xn--'+encode(string):string})}
punycode={'version':'1.3.2','ucs2':{'decode':ucs2decode,'encode':ucs2encode},'decode':decode,'encode':encode,'toASCII':toASCII,'toUnicode':toUnicode};if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){define('punycode',function(){return punycode})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}}(this))}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],466:[function(require,module,exports){(function(Buffer){const{EventEmitter}=require('events')
const bencode=require('bencode')
const BitField=require('bitfield')
const debug=require('debug')('ut_metadata')
const sha1=require('simple-sha1')
const MAX_METADATA_SIZE=1E7
const BITFIELD_GROW=1E3
const PIECE_LENGTH=1<<14
module.exports=metadata=>{class utMetadata extends EventEmitter{constructor(wire){super()
this._wire=wire
this._fetching=!1
this._metadataComplete=!1
this._metadataSize=null
this._remainingRejects=null
this._bitfield=new BitField(0,{grow:BITFIELD_GROW})
if(Buffer.isBuffer(metadata)){this.setMetadata(metadata)}}
onHandshake(infoHash,peerId,extensions){this._infoHash=infoHash}
onExtendedHandshake(handshake){if(!handshake.m||!handshake.m.ut_metadata){return this.emit('warning',new Error('Peer does not support ut_metadata'))}
if(!handshake.metadata_size){return this.emit('warning',new Error('Peer does not have metadata'))}
if(typeof handshake.metadata_size!=='number'||MAX_METADATA_SIZE<handshake.metadata_size||handshake.metadata_size<=0){return this.emit('warning',new Error('Peer gave invalid metadata size'))}
this._metadataSize=handshake.metadata_size
this._numPieces=Math.ceil(this._metadataSize/PIECE_LENGTH)
this._remainingRejects=this._numPieces*2
if(this._fetching){this._requestPieces()}}
onMessage(buf){let dict
let trailer
try{const str=buf.toString()
const trailerIndex=str.indexOf('ee')+2
dict=bencode.decode(str.substring(0,trailerIndex))
trailer=buf.slice(trailerIndex)}catch(err){return}
switch(dict.msg_type){case 0:this._onRequest(dict.piece)
break
case 1:this._onData(dict.piece,trailer,dict.total_size)
break
case 2:this._onReject(dict.piece)
break}}
fetch(){if(this._metadataComplete){return}
this._fetching=!0
if(this._metadataSize){this._requestPieces()}}
cancel(){this._fetching=!1}
setMetadata(metadata){if(this._metadataComplete)return!0
debug('set metadata')
try{const info=bencode.decode(metadata).info
if(info){metadata=bencode.encode(info)}}catch(err){}
if(this._infoHash&&this._infoHash!==sha1.sync(metadata)){return!1}
this.cancel()
this.metadata=metadata
this._metadataComplete=!0
this._metadataSize=this.metadata.length
this._wire.extendedHandshake.metadata_size=this._metadataSize
this.emit('metadata',bencode.encode({info:bencode.decode(this.metadata)}))
return!0}
_send(dict,trailer){let buf=bencode.encode(dict)
if(Buffer.isBuffer(trailer)){buf=Buffer.concat([buf,trailer])}
this._wire.extended('ut_metadata',buf)}
_request(piece){this._send({msg_type:0,piece})}
_data(piece,buf,totalSize){const msg={msg_type:1,piece}
if(typeof totalSize==='number'){msg.total_size=totalSize}
this._send(msg,buf)}
_reject(piece){this._send({msg_type:2,piece})}
_onRequest(piece){if(!this._metadataComplete){this._reject(piece)
return}
const start=piece*PIECE_LENGTH
let end=start+PIECE_LENGTH
if(end>this._metadataSize){end=this._metadataSize}
const buf=this.metadata.slice(start,end)
this._data(piece,buf,this._metadataSize)}
_onData(piece,buf,totalSize){if(buf.length>PIECE_LENGTH){return}
buf.copy(this.metadata,piece*PIECE_LENGTH)
this._bitfield.set(piece)
this._checkDone()}
_onReject(piece){if(this._remainingRejects>0&&this._fetching){this._request(piece)
this._remainingRejects-=1}else{this.emit('warning',new Error('Peer sent "reject" too much'))}}
_requestPieces(){this.metadata=Buffer.alloc(this._metadataSize)
for(let piece=0;piece<this._numPieces;piece++){this._request(piece)}}
_checkDone(){let done=!0
for(let piece=0;piece<this._numPieces;piece++){if(!this._bitfield.get(piece)){done=!1
break}}
if(!done)return
const success=this.setMetadata(this.metadata)
if(!success){this._failedMetadata()}}
_failedMetadata(){this._bitfield=new BitField(0,{grow:BITFIELD_GROW})
this._remainingRejects-=this._numPieces
if(this._remainingRejects>0){this._requestPieces()}else{this.emit('warning',new Error('Peer sent invalid metadata'))}}}
utMetadata.prototype.name='ut_metadata'
return utMetadata}}).call(this,require("buffer").Buffer)},{"bencode":195,"bitfield":197,"buffer":54,"debug":265,"events":90,"simple-sha1":419}],467:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config('noDeprecation')){return fn}
var warned=!1;function deprecated(){if(!warned){if(config('throwDeprecation')){throw new Error(msg)}else if(config('traceDeprecation')){console.trace(msg)}else{console.warn(msg)}
warned=!0}
return fn.apply(this,arguments)}
return deprecated}
function config(name){try{if(!global.localStorage)return!1}catch(_){return!1}
var val=global.localStorage[name];if(null==val)return!1;return String(val).toLowerCase()==='true'}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],468:[function(require,module,exports){(function(Buffer){var bs=require('binary-search')
var EventEmitter=require('events').EventEmitter
var inherits=require('inherits')
var mp4=require('mp4-stream')
var Box=require('mp4-box-encoding')
var RangeSliceStream=require('range-slice-stream')
module.exports=MP4Remuxer
function MP4Remuxer(file){var self=this
EventEmitter.call(self)
self._tracks=[]
self._fragmentSequence=1
self._file=file
self._decoder=null
self._findMoov(0)}
inherits(MP4Remuxer,EventEmitter)
MP4Remuxer.prototype._findMoov=function(offset){var self=this
if(self._decoder){self._decoder.destroy()}
self._decoder=mp4.decode()
var fileStream=self._file.createReadStream({start:offset})
fileStream.pipe(self._decoder)
self._decoder.once('box',function(headers){if(headers.type==='moov'){self._decoder.decode(function(moov){fileStream.destroy()
try{self._processMoov(moov)}catch(err){err.message='Cannot parse mp4 file: '+err.message
self.emit('error',err)}})}else{fileStream.destroy()
self._findMoov(offset+headers.length)}})}
function RunLengthIndex(entries,countName){var self=this
self._entries=entries
self._countName=countName||'count'
self._index=0
self._offset=0
self.value=self._entries[0]}
RunLengthIndex.prototype.inc=function(){var self=this
self._offset++
if(self._offset>=self._entries[self._index][self._countName]){self._index++
self._offset=0}
self.value=self._entries[self._index]}
MP4Remuxer.prototype._processMoov=function(moov){var self=this
var traks=moov.traks
self._tracks=[]
self._hasVideo=!1
self._hasAudio=!1
for(var i=0;i<traks.length;i++){var trak=traks[i]
var stbl=trak.mdia.minf.stbl
var stsdEntry=stbl.stsd.entries[0]
var handlerType=trak.mdia.hdlr.handlerType
var codec
var mime
if(handlerType==='vide'&&stsdEntry.type==='avc1'){if(self._hasVideo){continue}
self._hasVideo=!0
codec='avc1'
if(stsdEntry.avcC){codec+='.'+stsdEntry.avcC.mimeCodec}
mime='video/mp4; codecs="'+codec+'"'}else if(handlerType==='soun'&&stsdEntry.type==='mp4a'){if(self._hasAudio){continue}
self._hasAudio=!0
codec='mp4a'
if(stsdEntry.esds&&stsdEntry.esds.mimeCodec){codec+='.'+stsdEntry.esds.mimeCodec}
mime='audio/mp4; codecs="'+codec+'"'}else{continue}
var samples=[]
var sample=0
var sampleInChunk=0
var chunk=0
var offsetInChunk=0
var sampleToChunkIndex=0
var dts=0
var decodingTimeEntry=new RunLengthIndex(stbl.stts.entries)
var presentationOffsetEntry=null
if(stbl.ctts){presentationOffsetEntry=new RunLengthIndex(stbl.ctts.entries)}
var syncSampleIndex=0
while(!0){var currChunkEntry=stbl.stsc.entries[sampleToChunkIndex]
var size=stbl.stsz.entries[sample]
var duration=decodingTimeEntry.value.duration
var presentationOffset=presentationOffsetEntry?presentationOffsetEntry.value.compositionOffset:0
var sync=!0
if(stbl.stss){sync=stbl.stss.entries[syncSampleIndex]===sample+1}
var chunkOffsetTable=stbl.stco||stbl.co64
samples.push({size:size,duration:duration,dts:dts,presentationOffset:presentationOffset,sync:sync,offset:offsetInChunk+chunkOffsetTable.entries[chunk]})
sample++
if(sample>=stbl.stsz.entries.length){break}
sampleInChunk++
offsetInChunk+=size
if(sampleInChunk>=currChunkEntry.samplesPerChunk){sampleInChunk=0
offsetInChunk=0
chunk++
var nextChunkEntry=stbl.stsc.entries[sampleToChunkIndex+1]
if(nextChunkEntry&&chunk+1>=nextChunkEntry.firstChunk){sampleToChunkIndex++}}
dts+=duration
decodingTimeEntry.inc()
presentationOffsetEntry&&presentationOffsetEntry.inc()
if(sync){syncSampleIndex++}}
trak.mdia.mdhd.duration=0
trak.tkhd.duration=0
var defaultSampleDescriptionIndex=currChunkEntry.sampleDescriptionId
var trackMoov={type:'moov',mvhd:moov.mvhd,traks:[{tkhd:trak.tkhd,mdia:{mdhd:trak.mdia.mdhd,hdlr:trak.mdia.hdlr,elng:trak.mdia.elng,minf:{vmhd:trak.mdia.minf.vmhd,smhd:trak.mdia.minf.smhd,dinf:trak.mdia.minf.dinf,stbl:{stsd:stbl.stsd,stts:empty(),ctts:empty(),stsc:empty(),stsz:empty(),stco:empty(),stss:empty()}}}}],mvex:{mehd:{fragmentDuration:moov.mvhd.duration},trexs:[{trackId:trak.tkhd.trackId,defaultSampleDescriptionIndex:defaultSampleDescriptionIndex,defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0}]}}
self._tracks.push({trackId:trak.tkhd.trackId,timeScale:trak.mdia.mdhd.timeScale,samples:samples,currSample:null,currTime:null,moov:trackMoov,mime:mime})}
if(self._tracks.length===0){self.emit('error',new Error('no playable tracks'))
return}
moov.mvhd.duration=0
self._ftyp={type:'ftyp',brand:'iso5',brandVersion:0,compatibleBrands:['iso5']}
var ftypBuf=Box.encode(self._ftyp)
var data=self._tracks.map(function(track){var moovBuf=Box.encode(track.moov)
return{mime:track.mime,init:Buffer.concat([ftypBuf,moovBuf])}})
self.emit('ready',data)}
function empty(){return{version:0,flags:0,entries:[]}}
MP4Remuxer.prototype.seek=function(time){var self=this
if(!self._tracks){throw new Error('Not ready yet; wait for \'ready\' event')}
if(self._fileStream){self._fileStream.destroy()
self._fileStream=null}
var startOffset=-1
self._tracks.map(function(track,i){if(track.outStream){track.outStream.destroy()}
if(track.inStream){track.inStream.destroy()
track.inStream=null}
var outStream=track.outStream=mp4.encode()
var fragment=self._generateFragment(i,time)
if(!fragment){return outStream.finalize()}
if(startOffset===-1||fragment.ranges[0].start<startOffset){startOffset=fragment.ranges[0].start}
writeFragment(fragment)
function writeFragment(frag){if(outStream.destroyed)return
outStream.box(frag.moof,function(err){if(err)return self.emit('error',err)
if(outStream.destroyed)return
var slicedStream=track.inStream.slice(frag.ranges)
slicedStream.pipe(outStream.mediaData(frag.length,function(err){if(err)return self.emit('error',err)
if(outStream.destroyed)return
var nextFrag=self._generateFragment(i)
if(!nextFrag){return outStream.finalize()}
writeFragment(nextFrag)}))})}})
if(startOffset>=0){var fileStream=self._fileStream=self._file.createReadStream({start:startOffset})
self._tracks.forEach(function(track){track.inStream=new RangeSliceStream(startOffset,{highWaterMark:10000000})
fileStream.pipe(track.inStream)})}
return self._tracks.map(function(track){return track.outStream})}
MP4Remuxer.prototype._findSampleBefore=function(trackInd,time){var self=this
var track=self._tracks[trackInd]
var scaledTime=Math.floor(track.timeScale*time)
var sample=bs(track.samples,scaledTime,function(sample,t){var pts=sample.dts+sample.presentationOffset
return pts-t})
if(sample===-1){sample=0}else if(sample<0){sample=-sample-2}
while(!track.samples[sample].sync){sample--}
return sample}
var MIN_FRAGMENT_DURATION=1
MP4Remuxer.prototype._generateFragment=function(track,time){var self=this
var currTrack=self._tracks[track]
var firstSample
if(time!==undefined){firstSample=self._findSampleBefore(track,time)}else{firstSample=currTrack.currSample}
if(firstSample>=currTrack.samples.length)
return null
var startDts=currTrack.samples[firstSample].dts
var totalLen=0
var ranges=[]
for(var currSample=firstSample;currSample<currTrack.samples.length;currSample++){var sample=currTrack.samples[currSample]
if(sample.sync&&sample.dts-startDts>=currTrack.timeScale*MIN_FRAGMENT_DURATION){break}
totalLen+=sample.size
var currRange=ranges.length-1
if(currRange<0||ranges[currRange].end!==sample.offset){ranges.push({start:sample.offset,end:sample.offset+sample.size})}else{ranges[currRange].end+=sample.size}}
currTrack.currSample=currSample
return{moof:self._generateMoof(track,firstSample,currSample),ranges:ranges,length:totalLen}}
MP4Remuxer.prototype._generateMoof=function(track,firstSample,lastSample){var self=this
var currTrack=self._tracks[track]
var entries=[]
var trunVersion=0
for(var j=firstSample;j<lastSample;j++){var currSample=currTrack.samples[j]
if(currSample.presentationOffset<0)
trunVersion=1
entries.push({sampleDuration:currSample.duration,sampleSize:currSample.size,sampleFlags:currSample.sync?0x2000000:0x1010000,sampleCompositionTimeOffset:currSample.presentationOffset})}
var moof={type:'moof',mfhd:{sequenceNumber:self._fragmentSequence++},trafs:[{tfhd:{flags:0x20000,trackId:currTrack.trackId},tfdt:{baseMediaDecodeTime:currTrack.samples[firstSample].dts},trun:{flags:0xf01,dataOffset:8,entries:entries,version:trunVersion}}]}
moof.trafs[0].trun.dataOffset+=Box.encodingLength(moof)
return moof}}).call(this,require("buffer").Buffer)},{"binary-search":196,"buffer":54,"events":90,"inherits":305,"mp4-box-encoding":331,"mp4-stream":334,"range-slice-stream":380}],469:[function(require,module,exports){var MediaElementWrapper=require('mediasource')
var pump=require('pump')
var MP4Remuxer=require('./mp4-remuxer')
module.exports=VideoStream
function VideoStream(file,mediaElem,opts){var self=this
if(!(this instanceof VideoStream))return new VideoStream(file,mediaElem,opts)
opts=opts||{}
self.detailedError=null
self._elem=mediaElem
self._elemWrapper=new MediaElementWrapper(mediaElem)
self._waitingFired=!1
self._trackMeta=null
self._file=file
self._tracks=null
if(self._elem.preload!=='none'){self._createMuxer()}
self._onError=function(err){self.detailedError=self._elemWrapper.detailedError
self.destroy()}
self._onWaiting=function(){self._waitingFired=!0
if(!self._muxer){self._createMuxer()}else if(self._tracks){self._pump()}}
if(self._elem.autoplay)
self._elem.preload="auto";self._elem.addEventListener('waiting',self._onWaiting)
self._elem.addEventListener('error',self._onError)}
VideoStream.prototype._createMuxer=function(){var self=this
self._muxer=new MP4Remuxer(self._file)
self._muxer.on('ready',function(data){self._tracks=data.map(function(trackData){var mediaSource=self._elemWrapper.createWriteStream(trackData.mime)
mediaSource.on('error',function(err){self._elemWrapper.error(err)})
var track={muxed:null,mediaSource:mediaSource,initFlushed:!1,onInitFlushed:null}
mediaSource.write(trackData.init,function(err){track.initFlushed=!0
if(track.onInitFlushed){track.onInitFlushed(err)}})
return track})
if(self._waitingFired||self._elem.preload==='auto'){self._pump()}})
self._muxer.on('error',function(err){self._elemWrapper.error(err)})}
VideoStream.prototype._pump=function(){var self=this
var muxed=self._muxer.seek(self._elem.currentTime,!self._tracks)
self._tracks.forEach(function(track,i){var pumpTrack=function(){if(track.muxed){track.muxed.destroy()
track.mediaSource=self._elemWrapper.createWriteStream(track.mediaSource)
track.mediaSource.on('error',function(err){self._elemWrapper.error(err)})}
track.muxed=muxed[i]
pump(track.muxed,track.mediaSource)}
if(!track.initFlushed){track.onInitFlushed=function(err){if(err){self._elemWrapper.error(err)
return}
pumpTrack()}}else{pumpTrack()}})}
VideoStream.prototype.destroy=function(){var self=this
if(self.destroyed){return}
self.destroyed=!0
self._elem.removeEventListener('waiting',self._onWaiting)
self._elem.removeEventListener('error',self._onError)
if(self._tracks){self._tracks.forEach(function(track){if(track.muxed){track.muxed.destroy()}})}
self._elem.src=''}},{"./mp4-remuxer":468,"mediasource":312,"pump":375}],470:[function(require,module,exports){require('./lib/global')
module.exports=require('webtorrent')},{"./lib/global":471,"webtorrent":472}],471:[function(require,module,exports){(function(global){global.WRTC=require('electron-webrtc')()
global.WEBTORRENT_ANNOUNCE=['wss://tracker.webtorrent.io','wss://tracker.btorrent.xyz']}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"electron-webrtc":282}],472:[function(require,module,exports){(function(process,global){const{Buffer}=require('safe-buffer')
const{EventEmitter}=require('events')
const concat=require('simple-concat')
const createTorrent=require('create-torrent')
const debug=require('debug')('webtorrent')
const DHT=require('bittorrent-dht/client')
const loadIPSet=require('load-ip-set')
const parallel=require('run-parallel')
const parseTorrent=require('parse-torrent')
const path=require('path')
const Peer=require('simple-peer')
const randombytes=require('randombytes')
const speedometer=require('speedometer')
const TCPPool=require('./lib/tcp-pool')
const Torrent=require('./lib/torrent')
const VERSION=require('./package.json').version
const VERSION_STR=VERSION.replace(/\d*./g,v=>`0${v % 100}`.slice(-2)).slice(0,4)
const VERSION_PREFIX=`-WW${VERSION_STR}-`
class WebTorrent extends EventEmitter{constructor(opts={}){super()
if(typeof opts.peerId==='string'){this.peerId=opts.peerId}else if(Buffer.isBuffer(opts.peerId)){this.peerId=opts.peerId.toString('hex')}else{this.peerId=Buffer.from(VERSION_PREFIX+randombytes(9).toString('base64')).toString('hex')}
this.peerIdBuffer=Buffer.from(this.peerId,'hex')
if(typeof opts.nodeId==='string'){this.nodeId=opts.nodeId}else if(Buffer.isBuffer(opts.nodeId)){this.nodeId=opts.nodeId.toString('hex')}else{this.nodeId=randombytes(20).toString('hex')}
this.nodeIdBuffer=Buffer.from(this.nodeId,'hex')
this._debugId=this.peerId.toString('hex').substring(0,7)
this.destroyed=!1
this.listening=!1
this.torrentPort=opts.torrentPort||0
this.dhtPort=opts.dhtPort||0
this.tracker=opts.tracker!==undefined?opts.tracker:{}
this.torrents=[]
this.maxConns=Number(opts.maxConns)||55
this._debug('new webtorrent (peerId %s, nodeId %s, port %s)',this.peerId,this.nodeId,this.torrentPort)
if(this.tracker){if(typeof this.tracker!=='object')this.tracker={}
if(opts.rtcConfig){console.warn('WebTorrent: opts.rtcConfig is deprecated. Use opts.tracker.rtcConfig instead')
this.tracker.rtcConfig=opts.rtcConfig}
if(opts.wrtc){console.warn('WebTorrent: opts.wrtc is deprecated. Use opts.tracker.wrtc instead')
this.tracker.wrtc=opts.wrtc}
if(global.WRTC&&!this.tracker.wrtc){this.tracker.wrtc=global.WRTC}}
if(typeof TCPPool==='function'){this._tcpPool=new TCPPool(this)}else{process.nextTick(()=>{this._onListening()})}
this._downloadSpeed=speedometer()
this._uploadSpeed=speedometer()
if(opts.dht!==!1&&typeof DHT==='function'){this.dht=new DHT(Object.assign({},{nodeId:this.nodeId},opts.dht))
this.dht.once('error',err=>{this._destroy(err)})
this.dht.once('listening',()=>{const address=this.dht.address()
if(address)this.dhtPort=address.port})
this.dht.setMaxListeners(0)
this.dht.listen(this.dhtPort)}else{this.dht=!1}
this.enableWebSeeds=opts.webSeeds!==!1
const ready=()=>{if(this.destroyed)return
this.ready=!0
this.emit('ready')}
if(typeof loadIPSet==='function'&&opts.blocklist!=null){loadIPSet(opts.blocklist,{headers:{'user-agent':`WebTorrent/${VERSION} (https://webtorrent.io)`}},(err,ipSet)=>{if(err)return this.error(`Failed to load blocklist: ${err.message}`)
this.blocked=ipSet
ready()})}else{process.nextTick(ready)}}
get downloadSpeed(){return this._downloadSpeed()}
get uploadSpeed(){return this._uploadSpeed()}
get progress(){const torrents=this.torrents.filter(torrent=>torrent.progress!==1)
const downloaded=torrents.reduce((total,torrent)=>total+torrent.downloaded,0)
const length=torrents.reduce((total,torrent)=>total+(torrent.length||0),0)||1
return downloaded/length}
get ratio(){const uploaded=this.torrents.reduce((total,torrent)=>total+torrent.uploaded,0)
const received=this.torrents.reduce((total,torrent)=>total+torrent.received,0)||1
return uploaded/received}
get(torrentId){if(torrentId instanceof Torrent){if(this.torrents.includes(torrentId))return torrentId}else{let parsed
try{parsed=parseTorrent(torrentId)}catch(err){}
if(!parsed)return null
if(!parsed.infoHash)throw new Error('Invalid torrent identifier')
for(const torrent of this.torrents){if(torrent.infoHash===parsed.infoHash)return torrent}}
return null}
download(torrentId,opts,ontorrent){console.warn('WebTorrent: client.download() is deprecated. Use client.add() instead')
return this.add(torrentId,opts,ontorrent)}
add(torrentId,opts={},ontorrent){if(this.destroyed)throw new Error('client is destroyed')
if(typeof opts==='function')[opts,ontorrent]=[{},opts]
const onInfoHash=()=>{if(this.destroyed)return
for(const t of this.torrents){if(t.infoHash===torrent.infoHash&&t!==torrent){torrent._destroy(new Error(`Cannot add duplicate torrent ${torrent.infoHash}`))
return}}}
const onReady=()=>{if(this.destroyed)return
if(typeof ontorrent==='function')ontorrent(torrent)
this.emit('torrent',torrent)}
function onClose(){torrent.removeListener('_infoHash',onInfoHash)
torrent.removeListener('ready',onReady)
torrent.removeListener('close',onClose)}
this._debug('add')
opts=opts?Object.assign({},opts):{}
const torrent=new Torrent(torrentId,this,opts)
this.torrents.push(torrent)
torrent.once('_infoHash',onInfoHash)
torrent.once('ready',onReady)
torrent.once('close',onClose)
return torrent}
seed(input,opts,onseed){if(this.destroyed)throw new Error('client is destroyed')
if(typeof opts==='function')[opts,onseed]=[{},opts]
this._debug('seed')
opts=opts?Object.assign({},opts):{}
opts.skipVerify=!0
const isFilePath=typeof input==='string'
if(isFilePath)opts.path=path.dirname(input)
if(!opts.createdBy)opts.createdBy=`WebTorrent/${VERSION_STR}`
const onTorrent=torrent=>{const tasks=[cb=>{if(isFilePath)return cb()
torrent.load(streams,cb)}]
if(this.dht){tasks.push(cb=>{torrent.once('dhtAnnounce',cb)})}
parallel(tasks,err=>{if(this.destroyed)return
if(err)return torrent._destroy(err)
_onseed(torrent)})}
const _onseed=torrent=>{this._debug('on seed')
if(typeof onseed==='function')onseed(torrent)
torrent.emit('seed')
this.emit('seed',torrent)}
const torrent=this.add(null,opts,onTorrent)
let streams
if(isFileList(input))input=Array.from(input)
else if(!Array.isArray(input))input=[input]
parallel(input.map(item=>cb=>{if(isReadable(item))concat(item,cb)
else cb(null,item)}),(err,input)=>{if(this.destroyed)return
if(err)return torrent._destroy(err)
createTorrent.parseInput(input,opts,(err,files)=>{if(this.destroyed)return
if(err)return torrent._destroy(err)
streams=files.map(file=>file.getStream)
createTorrent(input,opts,(err,torrentBuf)=>{if(this.destroyed)return
if(err)return torrent._destroy(err)
const existingTorrent=this.get(torrentBuf)
if(existingTorrent){torrent._destroy(new Error(`Cannot add duplicate torrent ${existingTorrent.infoHash}`))}else{torrent._onTorrentId(torrentBuf)}})})})
return torrent}
remove(torrentId,cb){this._debug('remove')
const torrent=this.get(torrentId)
if(!torrent)throw new Error(`No torrent with id ${torrentId}`)
this._remove(torrentId,cb)}
_remove(torrentId,cb){const torrent=this.get(torrentId)
if(!torrent)return
this.torrents.splice(this.torrents.indexOf(torrent),1)
torrent.destroy(cb)}
address(){if(!this.listening)return null
return this._tcpPool?this._tcpPool.server.address():{address:'0.0.0.0',family:'IPv4',port:0}}
destroy(cb){if(this.destroyed)throw new Error('client already destroyed')
this._destroy(null,cb)}
_destroy(err,cb){this._debug('client destroy')
this.destroyed=!0
const tasks=this.torrents.map(torrent=>cb=>{torrent.destroy(cb)})
if(this._tcpPool){tasks.push(cb=>{this._tcpPool.destroy(cb)})}
if(this.dht){tasks.push(cb=>{this.dht.destroy(cb)})}
parallel(tasks,cb)
if(err)this.emit('error',err)
this.torrents=[]
this._tcpPool=null
this.dht=null}
_onListening(){this._debug('listening')
this.listening=!0
if(this._tcpPool){const address=this._tcpPool.server.address()
if(address)this.torrentPort=address.port}
this.emit('listening')}
_debug(){const args=[].slice.call(arguments)
args[0]=`[${this._debugId}] ${args[0]}`
debug(...args)}}
WebTorrent.WEBRTC_SUPPORT=Peer.WEBRTC_SUPPORT
WebTorrent.VERSION=VERSION
function isReadable(obj){return typeof obj==='object'&&obj!=null&&typeof obj.pipe==='function'}
function isFileList(obj){return typeof FileList!=='undefined'&&obj instanceof FileList}
module.exports=WebTorrent}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./lib/tcp-pool":23,"./lib/torrent":477,"./package.json":497,"_process":139,"bittorrent-dht/client":23,"create-torrent":249,"debug":479,"events":90,"load-ip-set":23,"parse-torrent":372,"path":132,"randombytes":379,"run-parallel":399,"safe-buffer":401,"simple-concat":403,"simple-peer":405,"speedometer":495}],473:[function(require,module,exports){const debug=require('debug')('webtorrent:file-stream')
const stream=require('readable-stream')
class FileStream extends stream.Readable{constructor(file,opts){super(opts)
this.destroyed=!1
this._torrent=file._torrent
const start=(opts&&opts.start)||0
const end=(opts&&opts.end&&opts.end<file.length)?opts.end:file.length-1
const pieceLength=file._torrent.pieceLength
this._startPiece=(start+file.offset)/pieceLength|0
this._endPiece=(end+file.offset)/pieceLength|0
this._piece=this._startPiece
this._offset=(start+file.offset)-(this._startPiece*pieceLength)
this._missing=end-start+1
this._reading=!1
this._notifying=!1
this._criticalLength=Math.min((1024*1024/pieceLength)|0,2)}
_read(){if(this._reading)return
this._reading=!0
this._notify()}
_notify(){if(!this._reading||this._missing===0)return
if(!this._torrent.bitfield.get(this._piece)){return this._torrent.critical(this._piece,this._piece+this._criticalLength)}
if(this._notifying)return
this._notifying=!0
if(this._torrent.destroyed)return this._destroy(new Error('Torrent removed'))
const p=this._piece
this._torrent.store.get(p,(err,buffer)=>{this._notifying=!1
if(this.destroyed)return
if(err)return this._destroy(err)
debug('read %s (length %s) (err %s)',p,buffer.length,err&&err.message)
if(this._offset){buffer=buffer.slice(this._offset)
this._offset=0}
if(this._missing<buffer.length){buffer=buffer.slice(0,this._missing)}
this._missing-=buffer.length
debug('pushing buffer of length %s',buffer.length)
this._reading=!1
this.push(buffer)
if(this._missing===0)this.push(null)})
this._piece+=1}
destroy(onclose){this._destroy(null,onclose)}
_destroy(err,onclose){if(this.destroyed)return
this.destroyed=!0
if(!this._torrent.destroyed){this._torrent.deselect(this._startPiece,this._endPiece,!0)}
if(err)this.emit('error',err)
this.emit('close')
if(onclose)onclose()}}
module.exports=FileStream},{"debug":479,"readable-stream":494}],474:[function(require,module,exports){(function(process){const{EventEmitter}=require('events')
const{PassThrough}=require('readable-stream')
const eos=require('end-of-stream')
const path=require('path')
const render=require('render-media')
const streamToBlob=require('stream-to-blob')
const streamToBlobURL=require('stream-to-blob-url')
const streamToBuffer=require('stream-with-known-length-to-buffer')
const FileStream=require('./file-stream')
class File extends EventEmitter{constructor(torrent,file){super()
this._torrent=torrent
this._destroyed=!1
this.name=file.name
this.path=file.path
this.length=file.length
this.offset=file.offset
this.done=!1
const start=file.offset
const end=start+file.length-1
this._startPiece=start/this._torrent.pieceLength|0
this._endPiece=end/this._torrent.pieceLength|0
if(this.length===0){this.done=!0
this.emit('done')}}
get downloaded(){if(!this._torrent.bitfield)return 0
const{pieces,bitfield,pieceLength}=this._torrent
const{_startPiece:start,_endPiece:end}=this
const piece=pieces[start]
let downloaded=bitfield.get(start)?pieceLength-(this.offset%pieceLength):Math.max(piece.length-piece.missing-this.offset,0)
for(let index=start+1;index<=end;++index){if(bitfield.get(index)){downloaded+=pieceLength}else{const piece=pieces[index]
downloaded+=piece.length-piece.missing}}
return Math.min(downloaded,this.length)}
get progress(){return this.length?this.downloaded/this.length:0}
select(priority){if(this.length===0)return
this._torrent.select(this._startPiece,this._endPiece,priority)}
deselect(){if(this.length===0)return
this._torrent.deselect(this._startPiece,this._endPiece,!1)}
createReadStream(opts){if(this.length===0){const empty=new PassThrough()
process.nextTick(()=>{empty.end()})
return empty}
const fileStream=new FileStream(this,opts)
this._torrent.select(fileStream._startPiece,fileStream._endPiece,!0,()=>{fileStream._notify()})
eos(fileStream,()=>{if(this._destroyed)return
if(!this._torrent.destroyed){this._torrent.deselect(fileStream._startPiece,fileStream._endPiece,!0)}})
return fileStream}
getBuffer(cb){streamToBuffer(this.createReadStream(),this.length,cb)}
getBlob(cb){if(typeof window==='undefined')throw new Error('browser-only method')
streamToBlob(this.createReadStream(),this._getMimeType(),cb)}
getBlobURL(cb){if(typeof window==='undefined')throw new Error('browser-only method')
streamToBlobURL(this.createReadStream(),this._getMimeType(),cb)}
appendTo(elem,opts,cb){if(typeof window==='undefined')throw new Error('browser-only method')
render.append(this,elem,opts,cb)}
renderTo(elem,opts,cb){if(typeof window==='undefined')throw new Error('browser-only method')
render.render(this,elem,opts,cb)}
_getMimeType(){return render.mime[path.extname(this.name).toLowerCase()]}
_destroy(){this._destroyed=!0
this._torrent=null}}
module.exports=File}).call(this,require('_process'))},{"./file-stream":473,"_process":139,"end-of-stream":288,"events":90,"path":132,"readable-stream":494,"render-media":396,"stream-to-blob":450,"stream-to-blob-url":449,"stream-with-known-length-to-buffer":451}],475:[function(require,module,exports){const arrayRemove=require('unordered-array-remove')
const debug=require('debug')('webtorrent:peer')
const Wire=require('bittorrent-protocol')
const WebConn=require('./webconn')
const CONNECT_TIMEOUT_TCP=5000
const CONNECT_TIMEOUT_WEBRTC=25000
const HANDSHAKE_TIMEOUT=25000
exports.createWebRTCPeer=(conn,swarm)=>{const peer=new Peer(conn.id,'webrtc')
peer.conn=conn
peer.swarm=swarm
if(peer.conn.connected){peer.onConnect()}else{peer.conn.once('connect',()=>{peer.onConnect()})
peer.conn.once('error',err=>{peer.destroy(err)})
peer.startConnectTimeout()}
return peer}
exports.createTCPIncomingPeer=conn=>{const addr=`${conn.remoteAddress}:${conn.remotePort}`
const peer=new Peer(addr,'tcpIncoming')
peer.conn=conn
peer.addr=addr
peer.onConnect()
return peer}
exports.createTCPOutgoingPeer=(addr,swarm)=>{const peer=new Peer(addr,'tcpOutgoing')
peer.addr=addr
peer.swarm=swarm
return peer}
exports.createWebSeedPeer=(url,swarm)=>{const peer=new Peer(url,'webSeed')
peer.swarm=swarm
peer.conn=new WebConn(url,swarm)
peer.onConnect()
return peer}
class Peer{constructor(id,type){this.id=id
this.type=type
debug('new %s Peer %s',type,id)
this.addr=null
this.conn=null
this.swarm=null
this.wire=null
this.connected=!1
this.destroyed=!1
this.timeout=null
this.retries=0
this.sentHandshake=!1}
onConnect(){if(this.destroyed)return
this.connected=!0
debug('Peer %s connected',this.id)
clearTimeout(this.connectTimeout)
const conn=this.conn
conn.once('end',()=>{this.destroy()})
conn.once('close',()=>{this.destroy()})
conn.once('finish',()=>{this.destroy()})
conn.once('error',err=>{this.destroy(err)})
const wire=this.wire=new Wire()
wire.type=this.type
wire.once('end',()=>{this.destroy()})
wire.once('close',()=>{this.destroy()})
wire.once('finish',()=>{this.destroy()})
wire.once('error',err=>{this.destroy(err)})
wire.once('handshake',(infoHash,peerId)=>{this.onHandshake(infoHash,peerId)})
this.startHandshakeTimeout()
conn.pipe(wire).pipe(conn)
if(this.swarm&&!this.sentHandshake)this.handshake()}
onHandshake(infoHash,peerId){if(!this.swarm)return
if(this.destroyed)return
if(this.swarm.destroyed){return this.destroy(new Error('swarm already destroyed'))}
if(infoHash!==this.swarm.infoHash){return this.destroy(new Error('unexpected handshake info hash for this swarm'))}
if(peerId===this.swarm.peerId){return this.destroy(new Error('refusing to connect to ourselves'))}
debug('Peer %s got handshake %s',this.id,infoHash)
clearTimeout(this.handshakeTimeout)
this.retries=0
let addr=this.addr
if(!addr&&this.conn.remoteAddress&&this.conn.remotePort){addr=`${this.conn.remoteAddress}:${this.conn.remotePort}`}
this.swarm._onWire(this.wire,addr)
if(!this.swarm||this.swarm.destroyed)return
if(!this.sentHandshake)this.handshake()}
handshake(){const opts={dht:this.swarm.private?!1:!!this.swarm.client.dht}
this.wire.handshake(this.swarm.infoHash,this.swarm.client.peerId,opts)
this.sentHandshake=!0}
startConnectTimeout(){clearTimeout(this.connectTimeout)
this.connectTimeout=setTimeout(()=>{this.destroy(new Error('connect timeout'))},this.type==='webrtc'?CONNECT_TIMEOUT_WEBRTC:CONNECT_TIMEOUT_TCP)
if(this.connectTimeout.unref)this.connectTimeout.unref()}
startHandshakeTimeout(){clearTimeout(this.handshakeTimeout)
this.handshakeTimeout=setTimeout(()=>{this.destroy(new Error('handshake timeout'))},HANDSHAKE_TIMEOUT)
if(this.handshakeTimeout.unref)this.handshakeTimeout.unref()}
destroy(err){if(this.destroyed)return
this.destroyed=!0
this.connected=!1
debug('destroy %s (error: %s)',this.id,err&&(err.message||err))
clearTimeout(this.connectTimeout)
clearTimeout(this.handshakeTimeout)
const swarm=this.swarm
const conn=this.conn
const wire=this.wire
this.swarm=null
this.conn=null
this.wire=null
if(swarm&&wire){arrayRemove(swarm.wires,swarm.wires.indexOf(wire))}
if(conn){conn.on('error',()=>{})
conn.destroy()}
if(wire)wire.destroy()
if(swarm)swarm.removePeer(this.id)}}},{"./webconn":478,"bittorrent-protocol":198,"debug":479,"unordered-array-remove":461}],476:[function(require,module,exports){class RarityMap{constructor(torrent){this._torrent=torrent
this._numPieces=torrent.pieces.length
this._pieces=new Array(this._numPieces)
this._onWire=wire=>{this.recalculate()
this._initWire(wire)}
this._onWireHave=index=>{this._pieces[index]+=1}
this._onWireBitfield=()=>{this.recalculate()}
this._torrent.wires.forEach(wire=>{this._initWire(wire)})
this._torrent.on('wire',this._onWire)
this.recalculate()}
getRarestPiece(pieceFilterFunc){let candidates=[]
let min=Infinity
for(let i=0;i<this._numPieces;++i){if(pieceFilterFunc&&!pieceFilterFunc(i))continue
const availability=this._pieces[i]
if(availability===min){candidates.push(i)}else if(availability<min){candidates=[i]
min=availability}}
if(candidates.length){return candidates[Math.random()*candidates.length|0]}else{return-1}}
destroy(){this._torrent.removeListener('wire',this._onWire)
this._torrent.wires.forEach(wire=>{this._cleanupWireEvents(wire)})
this._torrent=null
this._pieces=null
this._onWire=null
this._onWireHave=null
this._onWireBitfield=null}
_initWire(wire){wire._onClose=()=>{this._cleanupWireEvents(wire)
for(let i=0;i<this._numPieces;++i){this._pieces[i]-=wire.peerPieces.get(i)}}
wire.on('have',this._onWireHave)
wire.on('bitfield',this._onWireBitfield)
wire.once('close',wire._onClose)}
recalculate(){this._pieces.fill(0)
for(const wire of this._torrent.wires){for(let i=0;i<this._numPieces;++i){this._pieces[i]+=wire.peerPieces.get(i)}}}
_cleanupWireEvents(wire){wire.removeListener('have',this._onWireHave)
wire.removeListener('bitfield',this._onWireBitfield)
if(wire._onClose)wire.removeListener('close',wire._onClose)
wire._onClose=null}}
module.exports=RarityMap},{}],477:[function(require,module,exports){(function(process,global){const addrToIPPort=require('addr-to-ip-port')
const BitField=require('bitfield')
const ChunkStoreWriteStream=require('chunk-store-stream/write')
const debug=require('debug')('webtorrent:torrent')
const Discovery=require('torrent-discovery')
const EventEmitter=require('events').EventEmitter
const fs=require('fs')
const FSChunkStore=require('fs-chunk-store')
const get=require('simple-get')
const ImmediateChunkStore=require('immediate-chunk-store')
const MultiStream=require('multistream')
const net=require('net')
const os=require('os')
const parallel=require('run-parallel')
const parallelLimit=require('run-parallel-limit')
const parseTorrent=require('parse-torrent')
const path=require('path')
const Piece=require('torrent-piece')
const pump=require('pump')
const randomIterate=require('random-iterate')
const sha1=require('simple-sha1')
const speedometer=require('speedometer')
const uniq=require('uniq')
const utMetadata=require('ut_metadata')
const utPex=require('ut_pex')
const parseRange=require('parse-numeric-range')
const File=require('./file')
const Peer=require('./peer')
const RarityMap=require('./rarity-map')
const Server=require('./server')
const MAX_BLOCK_LENGTH=128*1024
const PIECE_TIMEOUT=30000
const CHOKE_TIMEOUT=5000
const SPEED_THRESHOLD=3*Piece.BLOCK_LENGTH
const PIPELINE_MIN_DURATION=0.5
const PIPELINE_MAX_DURATION=1
const RECHOKE_INTERVAL=10000
const RECHOKE_OPTIMISTIC_DURATION=2
const FILESYSTEM_CONCURRENCY=process.browser?Infinity:2
const RECONNECT_WAIT=[1000,5000,15000]
const VERSION=require('../package.json').version
const USER_AGENT=`WebTorrent/${VERSION} (https://webtorrent.io)`
let TMP
try{TMP=path.join(fs.statSync('/tmp')&&'/tmp','webtorrent')}catch(err){TMP=path.join(typeof os.tmpdir==='function'?os.tmpdir():'/','webtorrent')}
class Torrent extends EventEmitter{constructor(torrentId,client,opts){super()
this._debugId='unknown infohash'
this.client=client
this.announce=opts.announce
this.urlList=opts.urlList
this.path=opts.path
this.skipVerify=!!opts.skipVerify
this._store=opts.store||FSChunkStore
this._getAnnounceOpts=opts.getAnnounceOpts
this.strategy=opts.strategy||'sequential'
this.maxWebConns=opts.maxWebConns||4
this._rechokeNumSlots=(opts.uploads===!1||opts.uploads===0)?0:(+opts.uploads||10)
this._rechokeOptimisticWire=null
this._rechokeOptimisticTime=0
this._rechokeIntervalId=null
this.ready=!1
this.destroyed=!1
this.paused=!1
this.done=!1
this.metadata=null
this.store=null
this.files=[]
this.pieces=[]
this._amInterested=!1
this._selections=[]
this._critical=[]
this.wires=[]
this._queue=[]
this._peers={}
this._peersLength=0
this.received=0
this.uploaded=0
this._downloadSpeed=speedometer()
this._uploadSpeed=speedometer()
this._servers=[]
this._xsRequests=[]
this._fileModtimes=opts.fileModtimes
if(torrentId!==null)this._onTorrentId(torrentId)
this._debug('new torrent')}
get timeRemaining(){if(this.done)return 0
if(this.downloadSpeed===0)return Infinity
return((this.length-this.downloaded)/this.downloadSpeed)*1000}
get downloaded(){if(!this.bitfield)return 0
let downloaded=0
for(let index=0,len=this.pieces.length;index<len;++index){if(this.bitfield.get(index)){downloaded+=(index===len-1)?this.lastPieceLength:this.pieceLength}else{const piece=this.pieces[index]
downloaded+=(piece.length-piece.missing)}}
return downloaded}
get downloadSpeed(){return this._downloadSpeed()}
get uploadSpeed(){return this._uploadSpeed()}
get progress(){return this.length?this.downloaded/this.length:0}
get ratio(){return this.uploaded/(this.received||1)}
get numPeers(){return this.wires.length}
get torrentFileBlobURL(){if(typeof window==='undefined')throw new Error('browser-only property')
if(!this.torrentFile)return null
return URL.createObjectURL(new Blob([this.torrentFile],{type:'application/x-bittorrent'}))}
get _numQueued(){return this._queue.length+(this._peersLength-this._numConns)}
get _numConns(){let numConns=0
for(const id in this._peers){if(this._peers[id].connected)numConns+=1}
return numConns}
get swarm(){console.warn('WebTorrent: `torrent.swarm` is deprecated. Use `torrent` directly instead.')
return this}
_onTorrentId(torrentId){if(this.destroyed)return
let parsedTorrent
try{parsedTorrent=parseTorrent(torrentId)}catch(err){}
if(parsedTorrent){this.infoHash=parsedTorrent.infoHash
this._debugId=parsedTorrent.infoHash.toString('hex').substring(0,7)
process.nextTick(()=>{if(this.destroyed)return
this._onParsedTorrent(parsedTorrent)})}else{parseTorrent.remote(torrentId,(err,parsedTorrent)=>{if(this.destroyed)return
if(err)return this._destroy(err)
this._onParsedTorrent(parsedTorrent)})}}
_onParsedTorrent(parsedTorrent){if(this.destroyed)return
this._processParsedTorrent(parsedTorrent)
if(!this.infoHash){return this._destroy(new Error('Malformed torrent data: No info hash'))}
if(!this.path)this.path=path.join(TMP,this.infoHash)
this._rechokeIntervalId=setInterval(()=>{this._rechoke()},RECHOKE_INTERVAL)
if(this._rechokeIntervalId.unref)this._rechokeIntervalId.unref()
this.emit('_infoHash',this.infoHash)
if(this.destroyed)return
this.emit('infoHash',this.infoHash)
if(this.destroyed)return
if(this.client.listening){this._onListening()}else{this.client.once('listening',()=>{this._onListening()})}}
_processParsedTorrent(parsedTorrent){this._debugId=parsedTorrent.infoHash.toString('hex').substring(0,7)
if(this.announce){parsedTorrent.announce=parsedTorrent.announce.concat(this.announce)}
if(this.client.tracker&&global.WEBTORRENT_ANNOUNCE&&!this.private){parsedTorrent.announce=parsedTorrent.announce.concat(global.WEBTORRENT_ANNOUNCE)}
if(this.urlList){parsedTorrent.urlList=parsedTorrent.urlList.concat(this.urlList)}
uniq(parsedTorrent.announce)
uniq(parsedTorrent.urlList)
Object.assign(this,parsedTorrent)
this.magnetURI=parseTorrent.toMagnetURI(parsedTorrent)
this.torrentFile=parseTorrent.toTorrentFile(parsedTorrent)}
_onListening(){if(this.discovery||this.destroyed)return
let trackerOpts=this.client.tracker
if(trackerOpts){trackerOpts=Object.assign({},this.client.tracker,{getAnnounceOpts:()=>{const opts={uploaded:this.uploaded,downloaded:this.downloaded,left:Math.max(this.length-this.downloaded,0)}
if(this.client.tracker.getAnnounceOpts){Object.assign(opts,this.client.tracker.getAnnounceOpts())}
if(this._getAnnounceOpts){Object.assign(opts,this._getAnnounceOpts())}
return opts}})}
this.discovery=new Discovery({infoHash:this.infoHash,announce:this.announce,peerId:this.client.peerId,dht:!this.private&&this.client.dht,tracker:trackerOpts,port:this.client.torrentPort,userAgent:USER_AGENT})
this.discovery.on('error',(err)=>{this._destroy(err)})
this.discovery.on('peer',(peer)=>{if(typeof peer==='string'&&this.done)return
this.addPeer(peer)})
this.discovery.on('trackerAnnounce',()=>{this.emit('trackerAnnounce')
if(this.numPeers===0)this.emit('noPeers','tracker')})
this.discovery.on('dhtAnnounce',()=>{this.emit('dhtAnnounce')
if(this.numPeers===0)this.emit('noPeers','dht')})
this.discovery.on('warning',(err)=>{this.emit('warning',err)})
if(this.info){this._onMetadata(this)}else if(this.xs){this._getMetadataFromServer()}}
_getMetadataFromServer(){const self=this
const urls=Array.isArray(this.xs)?this.xs:[this.xs]
const tasks=urls.map(url=>cb=>{getMetadataFromURL(url,cb)})
parallel(tasks)
function getMetadataFromURL(url,cb){if(url.indexOf('http://')!==0&&url.indexOf('https://')!==0){self.emit('warning',new Error(`skipping non-http xs param: ${url}`))
return cb(null)}
const opts={url,method:'GET',headers:{'user-agent':USER_AGENT}}
let req
try{req=get.concat(opts,onResponse)}catch(err){self.emit('warning',new Error(`skipping invalid url xs param: ${url}`))
return cb(null)}
self._xsRequests.push(req)
function onResponse(err,res,torrent){if(self.destroyed)return cb(null)
if(self.metadata)return cb(null)
if(err){self.emit('warning',new Error(`http error from xs param: ${url}`))
return cb(null)}
if(res.statusCode!==200){self.emit('warning',new Error(`non-200 status code ${res.statusCode} from xs param: ${url}`))
return cb(null)}
let parsedTorrent
try{parsedTorrent=parseTorrent(torrent)}catch(err){}
if(!parsedTorrent){self.emit('warning',new Error(`got invalid torrent file from xs param: ${url}`))
return cb(null)}
if(parsedTorrent.infoHash!==self.infoHash){self.emit('warning',new Error(`got torrent file with incorrect info hash from xs param: ${url}`))
return cb(null)}
self._onMetadata(parsedTorrent)
cb(null)}}}
_onMetadata(metadata){if(this.metadata||this.destroyed)return
this._debug('got metadata')
this._xsRequests.forEach(req=>{req.abort()})
this._xsRequests=[]
let parsedTorrent
if(metadata&&metadata.infoHash){parsedTorrent=metadata}else{try{parsedTorrent=parseTorrent(metadata)}catch(err){return this._destroy(err)}}
this._processParsedTorrent(parsedTorrent)
this.metadata=this.torrentFile
if(this.client.enableWebSeeds){this.urlList.forEach(url=>{this.addWebSeed(url)})}
this._rarityMap=new RarityMap(this)
this.store=new ImmediateChunkStore(new this._store(this.pieceLength,{torrent:{infoHash:this.infoHash},files:this.files.map(file=>({path:path.join(this.path,file.path),length:file.length,offset:file.offset})),length:this.length,name:this.infoHash}))
this.files=this.files.map(file=>new File(this,file))
if(this.so){const selectOnlyFiles=parseRange.parse(this.so)
this.files.forEach((v,i)=>{if(selectOnlyFiles.includes(i))this.files[i].select(!0)})}else{if(this.pieces.length!==0){this.select(0,this.pieces.length-1,!1)}}
this._hashes=this.pieces
this.pieces=this.pieces.map((hash,i)=>{const pieceLength=(i===this.pieces.length-1)?this.lastPieceLength:this.pieceLength
return new Piece(pieceLength)})
this._reservations=this.pieces.map(()=>[])
this.bitfield=new BitField(this.pieces.length)
this.wires.forEach(wire=>{if(wire.ut_metadata)wire.ut_metadata.setMetadata(this.metadata)
this._onWireWithMetadata(wire)})
if(this.skipVerify){this._markAllVerified()
this._onStore()}else{this._debug('verifying existing torrent data')
if(this._fileModtimes&&this._store===FSChunkStore){this.getFileModtimes((err,fileModtimes)=>{if(err)return this._destroy(err)
const unchanged=this.files.map((_,index)=>fileModtimes[index]===this._fileModtimes[index]).every(x=>x)
if(unchanged){this._markAllVerified()
this._onStore()}else{this._verifyPieces()}})}else{this._verifyPieces()}}
this.emit('metadata')}
getFileModtimes(cb){const ret=[]
parallelLimit(this.files.map((file,index)=>cb=>{fs.stat(path.join(this.path,file.path),(err,stat)=>{if(err&&err.code!=='ENOENT')return cb(err)
ret[index]=stat&&stat.mtime.getTime()
cb(null)})}),FILESYSTEM_CONCURRENCY,err=>{this._debug('done getting file modtimes')
cb(err,ret)})}
_verifyPieces(){parallelLimit(this.pieces.map((_,index)=>cb=>{if(this.destroyed)return cb(new Error('torrent is destroyed'))
this.store.get(index,(err,buf)=>{if(this.destroyed)return cb(new Error('torrent is destroyed'))
if(err)return process.nextTick(cb,null)
sha1(buf,hash=>{if(this.destroyed)return cb(new Error('torrent is destroyed'))
if(hash===this._hashes[index]){if(!this.pieces[index])return
this._debug('piece verified %s',index)
this._markVerified(index)}else{this._debug('piece invalid %s',index)}
cb(null)})})}),FILESYSTEM_CONCURRENCY,err=>{if(err)return this._destroy(err)
this._debug('done verifying')
this._onStore()})}
_markAllVerified(){for(let index=0;index<this.pieces.length;index++){this._markVerified(index)}}
_markVerified(index){this.pieces[index]=null
this._reservations[index]=null
this.bitfield.set(index,!0)}
_onStore(){if(this.destroyed)return
this._debug('on store')
this.ready=!0
this.emit('ready')
this._checkDone()
this._updateSelections()}
destroy(cb){this._destroy(null,cb)}
_destroy(err,cb){if(this.destroyed)return
this.destroyed=!0
this._debug('destroy')
this.client._remove(this)
clearInterval(this._rechokeIntervalId)
this._xsRequests.forEach(req=>{req.abort()})
if(this._rarityMap){this._rarityMap.destroy()}
for(const id in this._peers){this.removePeer(id)}
this.files.forEach(file=>{if(file instanceof File)file._destroy()})
const tasks=this._servers.map(server=>cb=>{server.destroy(cb)})
if(this.discovery){tasks.push(cb=>{this.discovery.destroy(cb)})}
if(this.store){tasks.push(cb=>{this.store.close(cb)})}
parallel(tasks,cb)
if(err){if(this.listenerCount('error')===0){this.client.emit('error',err)}else{this.emit('error',err)}}
this.emit('close')
this.client=null
this.files=[]
this.discovery=null
this.store=null
this._rarityMap=null
this._peers=null
this._servers=null
this._xsRequests=null}
addPeer(peer){if(this.destroyed)throw new Error('torrent is destroyed')
if(!this.infoHash)throw new Error('addPeer() must not be called before the `infoHash` event')
if(this.client.blocked){let host
if(typeof peer==='string'){let parts
try{parts=addrToIPPort(peer)}catch(e){this._debug('ignoring peer: invalid %s',peer)
this.emit('invalidPeer',peer)
return!1}
host=parts[0]}else if(typeof peer.remoteAddress==='string'){host=peer.remoteAddress}
if(host&&this.client.blocked.contains(host)){this._debug('ignoring peer: blocked %s',peer)
if(typeof peer!=='string')peer.destroy()
this.emit('blockedPeer',peer)
return!1}}
const wasAdded=!!this._addPeer(peer)
if(wasAdded){this.emit('peer',peer)}else{this.emit('invalidPeer',peer)}
return wasAdded}
_addPeer(peer){if(this.destroyed){if(typeof peer!=='string')peer.destroy()
return null}
if(typeof peer==='string'&&!this._validAddr(peer)){this._debug('ignoring peer: invalid %s',peer)
return null}
const id=(peer&&peer.id)||peer
if(this._peers[id]){this._debug('ignoring peer: duplicate (%s)',id)
if(typeof peer!=='string')peer.destroy()
return null}
if(this.paused){this._debug('ignoring peer: torrent is paused')
if(typeof peer!=='string')peer.destroy()
return null}
this._debug('add peer %s',id)
let newPeer
if(typeof peer==='string'){newPeer=Peer.createTCPOutgoingPeer(peer,this)}else{newPeer=Peer.createWebRTCPeer(peer,this)}
this._peers[newPeer.id]=newPeer
this._peersLength+=1
if(typeof peer==='string'){this._queue.push(newPeer)
this._drain()}
return newPeer}
addWebSeed(url){if(this.destroyed)throw new Error('torrent is destroyed')
if(!/^https?:\/\/.+/.test(url)){this.emit('warning',new Error(`ignoring invalid web seed: ${url}`))
this.emit('invalidPeer',url)
return}
if(this._peers[url]){this.emit('warning',new Error(`ignoring duplicate web seed: ${url}`))
this.emit('invalidPeer',url)
return}
this._debug('add web seed %s',url)
const newPeer=Peer.createWebSeedPeer(url,this)
this._peers[newPeer.id]=newPeer
this._peersLength+=1
this.emit('peer',url)}
_addIncomingPeer(peer){if(this.destroyed)return peer.destroy(new Error('torrent is destroyed'))
if(this.paused)return peer.destroy(new Error('torrent is paused'))
this._debug('add incoming peer %s',peer.id)
this._peers[peer.id]=peer
this._peersLength+=1}
removePeer(peer){const id=(peer&&peer.id)||peer
peer=this._peers[id]
if(!peer)return
this._debug('removePeer %s',id)
delete this._peers[id]
this._peersLength-=1
peer.destroy()
this._drain()}
select(start,end,priority,notify){if(this.destroyed)throw new Error('torrent is destroyed')
if(start<0||end<start||this.pieces.length<=end){throw new Error('invalid selection ',start,':',end)}
priority=Number(priority)||0
this._debug('select %s-%s (priority %s)',start,end,priority)
this._selections.push({from:start,to:end,offset:0,priority,notify:notify||noop})
this._selections.sort((a,b)=>b.priority-a.priority)
this._updateSelections()}
deselect(start,end,priority){if(this.destroyed)throw new Error('torrent is destroyed')
priority=Number(priority)||0
this._debug('deselect %s-%s (priority %s)',start,end,priority)
for(let i=0;i<this._selections.length;++i){const s=this._selections[i]
if(s.from===start&&s.to===end&&s.priority===priority){this._selections.splice(i,1)
break}}
this._updateSelections()}
critical(start,end){if(this.destroyed)throw new Error('torrent is destroyed')
this._debug('critical %s-%s',start,end)
for(let i=start;i<=end;++i){this._critical[i]=!0}
this._updateSelections()}
_onWire(wire,addr){this._debug('got wire %s (%s)',wire._debugId,addr||'Unknown')
wire.on('download',downloaded=>{if(this.destroyed)return
this.received+=downloaded
this._downloadSpeed(downloaded)
this.client._downloadSpeed(downloaded)
this.emit('download',downloaded)
this.client.emit('download',downloaded)})
wire.on('upload',uploaded=>{if(this.destroyed)return
this.uploaded+=uploaded
this._uploadSpeed(uploaded)
this.client._uploadSpeed(uploaded)
this.emit('upload',uploaded)
this.client.emit('upload',uploaded)})
this.wires.push(wire)
if(addr){const parts=addrToIPPort(addr)
wire.remoteAddress=parts[0]
wire.remotePort=parts[1]}
if(this.client.dht&&this.client.dht.listening){wire.on('port',port=>{if(this.destroyed||this.client.dht.destroyed){return}
if(!wire.remoteAddress){return this._debug('ignoring PORT from peer with no address')}
if(port===0||port>65536){return this._debug('ignoring invalid PORT from peer')}
this._debug('port: %s (from %s)',port,addr)
this.client.dht.addNode({host:wire.remoteAddress,port})})}
wire.on('timeout',()=>{this._debug('wire timeout (%s)',addr)
wire.destroy()})
wire.setTimeout(PIECE_TIMEOUT,!0)
wire.setKeepAlive(!0)
wire.use(utMetadata(this.metadata))
wire.ut_metadata.on('warning',err=>{this._debug('ut_metadata warning: %s',err.message)})
if(!this.metadata){wire.ut_metadata.on('metadata',metadata=>{this._debug('got metadata via ut_metadata')
this._onMetadata(metadata)})
wire.ut_metadata.fetch()}
if(typeof utPex==='function'&&!this.private){wire.use(utPex())
wire.ut_pex.on('peer',peer=>{if(this.done)return
this._debug('ut_pex: got peer: %s (from %s)',peer,addr)
this.addPeer(peer)})
wire.ut_pex.on('dropped',peer=>{const peerObj=this._peers[peer]
if(peerObj&&!peerObj.connected){this._debug('ut_pex: dropped peer: %s (from %s)',peer,addr)
this.removePeer(peer)}})
wire.once('close',()=>{wire.ut_pex.reset()})}
this.emit('wire',wire,addr)
if(this.metadata){process.nextTick(()=>{this._onWireWithMetadata(wire)})}}
_onWireWithMetadata(wire){let timeoutId=null
const onChokeTimeout=()=>{if(this.destroyed||wire.destroyed)return
if(this._numQueued>2*(this._numConns-this.numPeers)&&wire.amInterested){wire.destroy()}else{timeoutId=setTimeout(onChokeTimeout,CHOKE_TIMEOUT)
if(timeoutId.unref)timeoutId.unref()}}
let i
const updateSeedStatus=()=>{if(wire.peerPieces.buffer.length!==this.bitfield.buffer.length)return
for(i=0;i<this.pieces.length;++i){if(!wire.peerPieces.get(i))return}
wire.isSeeder=!0
wire.choke()}
wire.on('bitfield',()=>{updateSeedStatus()
this._update()})
wire.on('have',()=>{updateSeedStatus()
this._update()})
wire.once('interested',()=>{wire.unchoke()})
wire.once('close',()=>{clearTimeout(timeoutId)})
wire.on('choke',()=>{clearTimeout(timeoutId)
timeoutId=setTimeout(onChokeTimeout,CHOKE_TIMEOUT)
if(timeoutId.unref)timeoutId.unref()})
wire.on('unchoke',()=>{clearTimeout(timeoutId)
this._update()})
wire.on('request',(index,offset,length,cb)=>{if(length>MAX_BLOCK_LENGTH){return wire.destroy()}
if(this.pieces[index])return
this.store.get(index,{offset,length},cb)})
wire.bitfield(this.bitfield)
wire.uninterested()
if(wire.peerExtensions.dht&&this.client.dht&&this.client.dht.listening){wire.port(this.client.dht.address().port)}
if(wire.type!=='webSeed'){timeoutId=setTimeout(onChokeTimeout,CHOKE_TIMEOUT)
if(timeoutId.unref)timeoutId.unref()}
wire.isSeeder=!1
updateSeedStatus()}
_updateSelections(){if(!this.ready||this.destroyed)return
process.nextTick(()=>{this._gcSelections()})
this._updateInterest()
this._update()}
_gcSelections(){for(let i=0;i<this._selections.length;++i){const s=this._selections[i]
const oldOffset=s.offset
while(this.bitfield.get(s.from+s.offset)&&s.from+s.offset<s.to){s.offset+=1}
if(oldOffset!==s.offset)s.notify()
if(s.to!==s.from+s.offset)continue
if(!this.bitfield.get(s.from+s.offset))continue
this._selections.splice(i,1)
i-=1
s.notify()
this._updateInterest()}
if(!this._selections.length)this.emit('idle')}
_updateInterest(){const prev=this._amInterested
this._amInterested=!!this._selections.length
this.wires.forEach(wire=>{let interested=!1
for(let index=0;index<this.pieces.length;++index){if(this.pieces[index]&&wire.peerPieces.get(index)){interested=!0
break}}
if(interested)wire.interested()
else wire.uninterested()})
if(prev===this._amInterested)return
if(this._amInterested)this.emit('interested')
else this.emit('uninterested')}
_update(){if(this.destroyed)return
const ite=randomIterate(this.wires)
let wire
while((wire=ite())){this._updateWireWrapper(wire)}}
_updateWireWrapper(wire){const self=this
if(typeof window!=='undefined'&&typeof window.requestIdleCallback==='function'){window.requestIdleCallback(function(){self._updateWire(wire)})}else{self._updateWire(wire)}}
_updateWire(wire){const self=this
if(wire.peerChoking)return
if(!wire.downloaded)return validateWire()
const minOutstandingRequests=getBlockPipelineLength(wire,PIPELINE_MIN_DURATION)
if(wire.requests.length>=minOutstandingRequests)return
const maxOutstandingRequests=getBlockPipelineLength(wire,PIPELINE_MAX_DURATION)
trySelectWire(!1)||trySelectWire(!0)
function genPieceFilterFunc(start,end,tried,rank){return i=>i>=start&&i<=end&&!(i in tried)&&wire.peerPieces.get(i)&&(!rank||rank(i))}
function validateWire(){if(wire.requests.length)return
let i=self._selections.length
while(i--){const next=self._selections[i]
let piece
if(self.strategy==='rarest'){const start=next.from+next.offset
const end=next.to
const len=end-start+1
const tried={}
let tries=0
const filter=genPieceFilterFunc(start,end,tried)
while(tries<len){piece=self._rarityMap.getRarestPiece(filter)
if(piece<0)break
if(self._request(wire,piece,!1))return
tried[piece]=!0
tries+=1}}else{for(piece=next.to;piece>=next.from+next.offset;--piece){if(!wire.peerPieces.get(piece))continue
if(self._request(wire,piece,!1))return}}}}
function speedRanker(){const speed=wire.downloadSpeed()||1
if(speed>SPEED_THRESHOLD)return()=>!0
const secs=Math.max(1,wire.requests.length)*Piece.BLOCK_LENGTH/speed
let tries=10
let ptr=0
return index=>{if(!tries||self.bitfield.get(index))return!0
let missing=self.pieces[index].missing
for(;ptr<self.wires.length;ptr++){const otherWire=self.wires[ptr]
const otherSpeed=otherWire.downloadSpeed()
if(otherSpeed<SPEED_THRESHOLD)continue
if(otherSpeed<=speed)continue
if(!otherWire.peerPieces.get(index))continue
if((missing-=otherSpeed*secs)>0)continue
tries--
return!1}
return!0}}
function shufflePriority(i){let last=i
for(let j=i;j<self._selections.length&&self._selections[j].priority;j++){last=j}
const tmp=self._selections[i]
self._selections[i]=self._selections[last]
self._selections[last]=tmp}
function trySelectWire(hotswap){if(wire.requests.length>=maxOutstandingRequests)return!0
const rank=speedRanker()
for(let i=0;i<self._selections.length;i++){const next=self._selections[i]
let piece
if(self.strategy==='rarest'){const start=next.from+next.offset
const end=next.to
const len=end-start+1
const tried={}
let tries=0
const filter=genPieceFilterFunc(start,end,tried,rank)
while(tries<len){piece=self._rarityMap.getRarestPiece(filter)
if(piece<0)break
while(self._request(wire,piece,self._critical[piece]||hotswap)){}
if(wire.requests.length<maxOutstandingRequests){tried[piece]=!0
tries++
continue}
if(next.priority)shufflePriority(i)
return!0}}else{for(piece=next.from+next.offset;piece<=next.to;piece++){if(!wire.peerPieces.get(piece)||!rank(piece))continue
while(self._request(wire,piece,self._critical[piece]||hotswap)){}
if(wire.requests.length<maxOutstandingRequests)continue
if(next.priority)shufflePriority(i)
return!0}}}
return!1}}
_rechoke(){if(!this.ready)return
if(this._rechokeOptimisticTime>0)this._rechokeOptimisticTime-=1
else this._rechokeOptimisticWire=null
const peers=[]
this.wires.forEach(wire=>{if(!wire.isSeeder&&wire!==this._rechokeOptimisticWire){peers.push({wire,downloadSpeed:wire.downloadSpeed(),uploadSpeed:wire.uploadSpeed(),salt:Math.random(),isChoked:!0})}})
peers.sort(rechokeSort)
let unchokeInterested=0
let i=0
for(;i<peers.length&&unchokeInterested<this._rechokeNumSlots;++i){peers[i].isChoked=!1
if(peers[i].wire.peerInterested)unchokeInterested+=1}
if(!this._rechokeOptimisticWire&&i<peers.length&&this._rechokeNumSlots){const candidates=peers.slice(i).filter(peer=>peer.wire.peerInterested)
const optimistic=candidates[randomInt(candidates.length)]
if(optimistic){optimistic.isChoked=!1
this._rechokeOptimisticWire=optimistic.wire
this._rechokeOptimisticTime=RECHOKE_OPTIMISTIC_DURATION}}
peers.forEach(peer=>{if(peer.wire.amChoking!==peer.isChoked){if(peer.isChoked)peer.wire.choke()
else peer.wire.unchoke()}})
function rechokeSort(peerA,peerB){if(peerA.downloadSpeed!==peerB.downloadSpeed){return peerB.downloadSpeed-peerA.downloadSpeed}
if(peerA.uploadSpeed!==peerB.uploadSpeed){return peerB.uploadSpeed-peerA.uploadSpeed}
if(peerA.wire.amChoking!==peerB.wire.amChoking){return peerA.wire.amChoking?1:-1}
return peerA.salt-peerB.salt}}
_hotswap(wire,index){const speed=wire.downloadSpeed()
if(speed<Piece.BLOCK_LENGTH)return!1
if(!this._reservations[index])return!1
const r=this._reservations[index]
if(!r){return!1}
let minSpeed=Infinity
let minWire
let i
for(i=0;i<r.length;i++){const otherWire=r[i]
if(!otherWire||otherWire===wire)continue
const otherSpeed=otherWire.downloadSpeed()
if(otherSpeed>=SPEED_THRESHOLD)continue
if(2*otherSpeed>speed||otherSpeed>minSpeed)continue
minWire=otherWire
minSpeed=otherSpeed}
if(!minWire)return!1
for(i=0;i<r.length;i++){if(r[i]===minWire)r[i]=null}
for(i=0;i<minWire.requests.length;i++){const req=minWire.requests[i]
if(req.piece!==index)continue
this.pieces[index].cancel((req.offset/Piece.BLOCK_LENGTH)|0)}
this.emit('hotswap',minWire,wire,index)
return!0}
_request(wire,index,hotswap){const self=this
const numRequests=wire.requests.length
const isWebSeed=wire.type==='webSeed'
if(self.bitfield.get(index))return!1
const maxOutstandingRequests=isWebSeed?Math.min(getPiecePipelineLength(wire,PIPELINE_MAX_DURATION,self.pieceLength),self.maxWebConns):getBlockPipelineLength(wire,PIPELINE_MAX_DURATION)
if(numRequests>=maxOutstandingRequests)return!1
const piece=self.pieces[index]
let reservation=isWebSeed?piece.reserveRemaining():piece.reserve()
if(reservation===-1&&hotswap&&self._hotswap(wire,index)){reservation=isWebSeed?piece.reserveRemaining():piece.reserve()}
if(reservation===-1)return!1
let r=self._reservations[index]
if(!r)r=self._reservations[index]=[]
let i=r.indexOf(null)
if(i===-1)i=r.length
r[i]=wire
const chunkOffset=piece.chunkOffset(reservation)
const chunkLength=isWebSeed?piece.chunkLengthRemaining(reservation):piece.chunkLength(reservation)
wire.request(index,chunkOffset,chunkLength,function onChunk(err,chunk){if(self.destroyed)return
if(!self.ready)return self.once('ready',()=>{onChunk(err,chunk)})
if(r[i]===wire)r[i]=null
if(piece!==self.pieces[index])return onUpdateTick()
if(err){self._debug('error getting piece %s (offset: %s length: %s) from %s: %s',index,chunkOffset,chunkLength,`${wire.remoteAddress}:${wire.remotePort}`,err.message)
isWebSeed?piece.cancelRemaining(reservation):piece.cancel(reservation)
onUpdateTick()
return}
self._debug('got piece %s (offset: %s length: %s) from %s',index,chunkOffset,chunkLength,`${wire.remoteAddress}:${wire.remotePort}`)
if(!piece.set(reservation,chunk,wire))return onUpdateTick()
const buf=piece.flush()
sha1(buf,hash=>{if(self.destroyed)return
if(hash===self._hashes[index]){if(!self.pieces[index])return
self._debug('piece verified %s',index)
self.pieces[index]=null
self._reservations[index]=null
self.bitfield.set(index,!0)
self.store.put(index,buf)
self.wires.forEach(wire=>{wire.have(index)})
if(self._checkDone()&&!self.destroyed)self.discovery.complete()}else{self.pieces[index]=new Piece(piece.length)
self.emit('warning',new Error(`Piece ${index} failed verification`))}
onUpdateTick()})})
function onUpdateTick(){process.nextTick(()=>{self._update()})}
return!0}
_checkDone(){if(this.destroyed)return
this.files.forEach(file=>{if(file.done)return
for(let i=file._startPiece;i<=file._endPiece;++i){if(!this.bitfield.get(i))return}
file.done=!0
file.emit('done')
this._debug(`file done: ${file.name}`)})
let done=!0
for(let i=0;i<this._selections.length;i++){const selection=this._selections[i]
for(let piece=selection.from;piece<=selection.to;piece++){if(!this.bitfield.get(piece)){done=!1
break}}
if(!done)break}
if(!this.done&&done){this.done=!0
this._debug(`torrent done: ${this.infoHash}`)
this.emit('done')}
this._gcSelections()
return done}
load(streams,cb){if(this.destroyed)throw new Error('torrent is destroyed')
if(!this.ready)return this.once('ready',()=>{this.load(streams,cb)})
if(!Array.isArray(streams))streams=[streams]
if(!cb)cb=noop
const readable=new MultiStream(streams)
const writable=new ChunkStoreWriteStream(this.store,this.pieceLength)
pump(readable,writable,err=>{if(err)return cb(err)
this._markAllVerified()
this._checkDone()
cb(null)})}
createServer(requestListener){if(typeof Server!=='function')throw new Error('node.js-only method')
if(this.destroyed)throw new Error('torrent is destroyed')
const server=new Server(this,requestListener)
this._servers.push(server)
return server}
pause(){if(this.destroyed)return
this._debug('pause')
this.paused=!0}
resume(){if(this.destroyed)return
this._debug('resume')
this.paused=!1
this._drain()}
_debug(){const args=[].slice.call(arguments)
args[0]=`[${this.client._debugId}] [${this._debugId}] ${args[0]}`
debug(...args)}
_drain(){this._debug('_drain numConns %s maxConns %s',this._numConns,this.client.maxConns)
if(typeof net.connect!=='function'||this.destroyed||this.paused||this._numConns>=this.client.maxConns){return}
this._debug('drain (%s queued, %s/%s peers)',this._numQueued,this.numPeers,this.client.maxConns)
const peer=this._queue.shift()
if(!peer)return
this._debug('tcp connect attempt to %s',peer.addr)
const parts=addrToIPPort(peer.addr)
const opts={host:parts[0],port:parts[1]}
const conn=peer.conn=net.connect(opts)
conn.once('connect',()=>{peer.onConnect()})
conn.once('error',err=>{peer.destroy(err)})
peer.startConnectTimeout()
conn.on('close',()=>{if(this.destroyed)return
if(peer.retries>=RECONNECT_WAIT.length){this._debug('conn %s closed: will not re-add (max %s attempts)',peer.addr,RECONNECT_WAIT.length)
return}
const ms=RECONNECT_WAIT[peer.retries]
this._debug('conn %s closed: will re-add to queue in %sms (attempt %s)',peer.addr,ms,peer.retries+1)
const reconnectTimeout=setTimeout(()=>{const newPeer=this._addPeer(peer.addr)
if(newPeer)newPeer.retries=peer.retries+1},ms)
if(reconnectTimeout.unref)reconnectTimeout.unref()})}
_validAddr(addr){let parts
try{parts=addrToIPPort(addr)}catch(e){return!1}
const host=parts[0]
const port=parts[1]
return port>0&&port<65535&&!(host==='127.0.0.1'&&port===this.client.torrentPort)}}
function getBlockPipelineLength(wire,duration){return 2+Math.ceil(duration*wire.downloadSpeed()/Piece.BLOCK_LENGTH)}
function getPiecePipelineLength(wire,duration,pieceLength){return 1+Math.ceil(duration*wire.downloadSpeed()/pieceLength)}
function randomInt(high){return Math.random()*high|0}
function noop(){}
module.exports=Torrent}).call(this,require('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":497,"./file":474,"./peer":475,"./rarity-map":476,"./server":23,"_process":139,"addr-to-ip-port":192,"bitfield":197,"chunk-store-stream/write":246,"debug":479,"events":90,"fs":1,"fs-chunk-store":328,"immediate-chunk-store":304,"multistream":347,"net":23,"os":23,"parse-numeric-range":371,"parse-torrent":372,"path":132,"pump":375,"random-iterate":378,"run-parallel":399,"run-parallel-limit":398,"simple-get":404,"simple-sha1":419,"speedometer":495,"torrent-discovery":456,"torrent-piece":457,"uniq":460,"ut_metadata":466,"ut_pex":23}],478:[function(require,module,exports){const BitField=require('bitfield')
const Buffer=require('safe-buffer').Buffer
const debug=require('debug')('webtorrent:webconn')
const get=require('simple-get')
const sha1=require('simple-sha1')
const Wire=require('bittorrent-protocol')
const VERSION=require('../package.json').version
class WebConn extends Wire{constructor(url,torrent){super()
this.url=url
this.webPeerId=sha1.sync(url)
this._torrent=torrent
this._init()}
_init(){this.setKeepAlive(!0)
this.once('handshake',(infoHash,peerId)=>{if(this.destroyed)return
this.handshake(infoHash,this.webPeerId)
const numPieces=this._torrent.pieces.length
const bitfield=new BitField(numPieces)
for(let i=0;i<=numPieces;i++){bitfield.set(i,!0)}
this.bitfield(bitfield)})
this.once('interested',()=>{debug('interested')
this.unchoke()})
this.on('uninterested',()=>{debug('uninterested')})
this.on('choke',()=>{debug('choke')})
this.on('unchoke',()=>{debug('unchoke')})
this.on('bitfield',()=>{debug('bitfield')})
this.on('request',(pieceIndex,offset,length,callback)=>{debug('request pieceIndex=%d offset=%d length=%d',pieceIndex,offset,length)
this.httpRequest(pieceIndex,offset,length,callback)})}
httpRequest(pieceIndex,offset,length,cb){const pieceOffset=pieceIndex*this._torrent.pieceLength
const rangeStart=pieceOffset+offset
const rangeEnd=rangeStart+length-1
const files=this._torrent.files
let requests
if(files.length<=1){requests=[{url:this.url,start:rangeStart,end:rangeEnd}]}else{const requestedFiles=files.filter(file=>{return file.offset<=rangeEnd&&(file.offset+file.length)>rangeStart})
if(requestedFiles.length<1){return cb(new Error('Could not find file corresponnding to web seed range request'))}
requests=requestedFiles.map(requestedFile=>{const fileEnd=requestedFile.offset+requestedFile.length-1
const url=this.url+(this.url[this.url.length-1]==='/'?'':'/')+requestedFile.path
return{url,fileOffsetInRange:Math.max(requestedFile.offset-rangeStart,0),start:Math.max(rangeStart-requestedFile.offset,0),end:Math.min(fileEnd,rangeEnd-requestedFile.offset)}})}
let numRequestsSucceeded=0
let hasError=!1
let ret
if(requests.length>1){ret=Buffer.alloc(length)}
requests.forEach(request=>{const url=request.url
const start=request.start
const end=request.end
debug('Requesting url=%s pieceIndex=%d offset=%d length=%d start=%d end=%d',url,pieceIndex,offset,length,start,end)
const opts={url,method:'GET',headers:{'user-agent':`WebTorrent/${VERSION} (https://webtorrent.io)`,range:`bytes=${start}-${end}`}}
function onResponse(res,data){if(res.statusCode<200||res.statusCode>=300){hasError=!0
return cb(new Error(`Unexpected HTTP status code ${res.statusCode}`))}
debug('Got data of length %d',data.length)
if(requests.length===1){cb(null,data)}else{data.copy(ret,request.fileOffsetInRange)
if(++numRequestsSucceeded===requests.length){cb(null,ret)}}}
get.concat(opts,(err,res,data)=>{if(hasError)return
if(err){if(typeof window==='undefined'||url.startsWith(`${window.location.origin}/`)){hasError=!0
return cb(err)}
return get.head(url,(errHead,res)=>{if(hasError)return
if(errHead){hasError=!0
return cb(errHead)}
if(res.statusCode<200||res.statusCode>=300){hasError=!0
return cb(new Error(`Unexpected HTTP status code ${res.statusCode}`))}
if(res.url===url){hasError=!0
return cb(err)}
opts.url=res.url
get.concat(opts,(err,res,data)=>{if(hasError)return
if(err){hasError=!0
return cb(err)}
onResponse(res,data)})})}
onResponse(res,data)})})}
destroy(){super.destroy()
this._torrent=null}}
module.exports=WebConn},{"../package.json":497,"bitfield":197,"bittorrent-protocol":198,"debug":479,"safe-buffer":401,"simple-get":404,"simple-sha1":419}],479:[function(require,module,exports){arguments[4][216][0].apply(exports,arguments)},{"./common":480,"_process":139,"dup":216}],480:[function(require,module,exports){arguments[4][217][0].apply(exports,arguments)},{"dup":217,"ms":346}],481:[function(require,module,exports){arguments[4][250][0].apply(exports,arguments)},{"dup":250}],482:[function(require,module,exports){arguments[4][251][0].apply(exports,arguments)},{"_process":139,"dup":251}],483:[function(require,module,exports){arguments[4][252][0].apply(exports,arguments)},{"./_stream_readable":485,"./_stream_writable":487,"_process":139,"dup":252,"inherits":305}],484:[function(require,module,exports){arguments[4][253][0].apply(exports,arguments)},{"./_stream_transform":486,"dup":253,"inherits":305}],485:[function(require,module,exports){arguments[4][254][0].apply(exports,arguments)},{"../errors":481,"../experimentalWarning":482,"./_stream_duplex":483,"./internal/streams/async_iterator":488,"./internal/streams/buffer_list":489,"./internal/streams/destroy":490,"./internal/streams/state":492,"./internal/streams/stream":493,"_process":139,"buffer":54,"dup":254,"events":90,"inherits":305,"string_decoder/":496,"util":23}],486:[function(require,module,exports){arguments[4][255][0].apply(exports,arguments)},{"../errors":481,"./_stream_duplex":483,"dup":255,"inherits":305}],487:[function(require,module,exports){arguments[4][256][0].apply(exports,arguments)},{"../errors":481,"./_stream_duplex":483,"./internal/streams/destroy":490,"./internal/streams/state":492,"./internal/streams/stream":493,"_process":139,"buffer":54,"dup":256,"inherits":305,"util-deprecate":467}],488:[function(require,module,exports){arguments[4][257][0].apply(exports,arguments)},{"./end-of-stream":491,"_process":139,"dup":257}],489:[function(require,module,exports){arguments[4][258][0].apply(exports,arguments)},{"buffer":54,"dup":258,"util":23}],490:[function(require,module,exports){arguments[4][259][0].apply(exports,arguments)},{"_process":139,"dup":259}],491:[function(require,module,exports){arguments[4][260][0].apply(exports,arguments)},{"../../../errors":481,"dup":260}],492:[function(require,module,exports){arguments[4][261][0].apply(exports,arguments)},{"../../../errors":481,"dup":261}],493:[function(require,module,exports){arguments[4][207][0].apply(exports,arguments)},{"dup":207,"events":90}],494:[function(require,module,exports){arguments[4][208][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":483,"./lib/_stream_passthrough.js":484,"./lib/_stream_readable.js":485,"./lib/_stream_transform.js":486,"./lib/_stream_writable.js":487,"dup":208}],495:[function(require,module,exports){arguments[4][209][0].apply(exports,arguments)},{"dup":209}],496:[function(require,module,exports){arguments[4][210][0].apply(exports,arguments)},{"dup":210,"safe-buffer":401}],497:[function(require,module,exports){module.exports={"version":"0.103.1"}},{}],498:[function(require,module,exports){module.exports=wrappy
function wrappy(fn,cb){if(fn&&cb)return wrappy(fn)(cb)
if(typeof fn!=='function')
throw new TypeError('need wrapper function')
Object.keys(fn).forEach(function(k){wrapper[k]=fn[k]})
return wrapper
function wrapper(){var args=new Array(arguments.length)
for(var i=0;i<args.length;i++){args[i]=arguments[i]}
var ret=fn.apply(this,args)
var cb=args[args.length-1]
if(typeof ret==='function'&&ret!==cb){Object.keys(cb).forEach(function(k){ret[k]=cb[k]})}
return ret}}},{}],499:[function(require,module,exports){(function(){var assign,camelCase,capitalize,isArray,isEmpty,isFunction,isObject,isPlainObject,kebabCase,snakeCase,titleCase,words,slice=[].slice,hasProp={}.hasOwnProperty;assign=function(){var i,key,len,source,sources,target;target=arguments[0],sources=2<=arguments.length?slice.call(arguments,1):[];if(isFunction(Object.assign)){Object.assign.apply(null,arguments)}else{for(i=0,len=sources.length;i<len;i++){source=sources[i];if(source!=null){for(key in source){if(!hasProp.call(source,key))continue;target[key]=source[key]}}}}
return target};isFunction=function(val){return!!val&&Object.prototype.toString.call(val)==='[object Function]'};isObject=function(val){var ref;return!!val&&((ref=typeof val)==='function'||ref==='object')};isArray=function(val){if(isFunction(Array.isArray)){return Array.isArray(val)}else{return Object.prototype.toString.call(val)==='[object Array]'}};isEmpty=function(val){var key;if(isArray(val)){return!val.length}else{for(key in val){if(!hasProp.call(val,key))continue;return!1}
return!0}};isPlainObject=function(val){var ctor,proto;return isObject(val)&&(proto=Object.getPrototypeOf(val))&&(ctor=proto.constructor)&&(typeof ctor==='function')&&(ctor instanceof ctor)&&(Function.prototype.toString.call(ctor)===Function.prototype.toString.call(Object))};words=function(val){return(val.split(/[-_\s]+|(?=[A-Z][a-z])/)||[]).filter(function(n){return!!n})};camelCase=function(val){var i,index,len,r,ref,word;r='';ref=words(val);for(index=i=0,len=ref.length;i<len;index=++i){word=ref[index];r+=index?capitalize(word.toLowerCase()):word.toLowerCase()}
return r};titleCase=function(val){var i,index,len,r,ref,word;r='';ref=words(val);for(index=i=0,len=ref.length;i<len;index=++i){word=ref[index];r+=capitalize(word.toLowerCase())}
return r};kebabCase=function(val){var i,index,len,r,ref,word;r='';ref=words(val);for(index=i=0,len=ref.length;i<len;index=++i){word=ref[index];r+=(index?'-':'')+word.toLowerCase()}
return r};snakeCase=function(val){var i,index,len,r,ref,word;r='';ref=words(val);for(index=i=0,len=ref.length;i<len;index=++i){word=ref[index];r+=(index?'_':'')+word.toLowerCase()}
return r};capitalize=function(val){return val.charAt(0).toUpperCase()+val.slice(1)};module.exports.assign=assign;module.exports.isFunction=isFunction;module.exports.isObject=isObject;module.exports.isArray=isArray;module.exports.isEmpty=isEmpty;module.exports.isPlainObject=isPlainObject;module.exports.camelCase=camelCase;module.exports.titleCase=titleCase;module.exports.kebabCase=kebabCase;module.exports.snakeCase=snakeCase;module.exports.capitalize=capitalize;module.exports.words=words}).call(this)},{}],500:[function(require,module,exports){(function(){var XMLAttribute;module.exports=XMLAttribute=(function(){function XMLAttribute(parent,name,value){this.options=parent.options;this.stringify=parent.stringify;if(name==null){throw new Error("Missing attribute name of element "+parent.name)}
if(value==null){throw new Error("Missing attribute value for attribute "+name+" of element "+parent.name)}
this.name=this.stringify.attName(name);this.value=this.stringify.attValue(value)}
XMLAttribute.prototype.clone=function(){return Object.create(this)};XMLAttribute.prototype.toString=function(options){return this.options.writer.set(options).attribute(this)};return XMLAttribute})()}).call(this)},{}],501:[function(require,module,exports){(function(){var XMLCData,XMLNode,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLNode=require('./XMLNode');module.exports=XMLCData=(function(superClass){extend(XMLCData,superClass);function XMLCData(parent,text){XMLCData.__super__.constructor.call(this,parent);if(text==null){throw new Error("Missing CDATA text")}
this.text=this.stringify.cdata(text)}
XMLCData.prototype.clone=function(){return Object.create(this)};XMLCData.prototype.toString=function(options){return this.options.writer.set(options).cdata(this)};return XMLCData})(XMLNode)}).call(this)},{"./XMLNode":512}],502:[function(require,module,exports){(function(){var XMLComment,XMLNode,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLNode=require('./XMLNode');module.exports=XMLComment=(function(superClass){extend(XMLComment,superClass);function XMLComment(parent,text){XMLComment.__super__.constructor.call(this,parent);if(text==null){throw new Error("Missing comment text")}
this.text=this.stringify.comment(text)}
XMLComment.prototype.clone=function(){return Object.create(this)};XMLComment.prototype.toString=function(options){return this.options.writer.set(options).comment(this)};return XMLComment})(XMLNode)}).call(this)},{"./XMLNode":512}],503:[function(require,module,exports){(function(){var XMLDTDAttList,XMLNode,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLNode=require('./XMLNode');module.exports=XMLDTDAttList=(function(superClass){extend(XMLDTDAttList,superClass);function XMLDTDAttList(parent,elementName,attributeName,attributeType,defaultValueType,defaultValue){XMLDTDAttList.__super__.constructor.call(this,parent);if(elementName==null){throw new Error("Missing DTD element name")}
if(attributeName==null){throw new Error("Missing DTD attribute name")}
if(!attributeType){throw new Error("Missing DTD attribute type")}
if(!defaultValueType){throw new Error("Missing DTD attribute default")}
if(defaultValueType.indexOf('#')!==0){defaultValueType='#'+defaultValueType}
if(!defaultValueType.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/)){throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT")}
if(defaultValue&&!defaultValueType.match(/^(#FIXED|#DEFAULT)$/)){throw new Error("Default value only applies to #FIXED or #DEFAULT")}
this.elementName=this.stringify.eleName(elementName);this.attributeName=this.stringify.attName(attributeName);this.attributeType=this.stringify.dtdAttType(attributeType);this.defaultValue=this.stringify.dtdAttDefault(defaultValue);this.defaultValueType=defaultValueType}
XMLDTDAttList.prototype.toString=function(options){return this.options.writer.set(options).dtdAttList(this)};return XMLDTDAttList})(XMLNode)}).call(this)},{"./XMLNode":512}],504:[function(require,module,exports){(function(){var XMLDTDElement,XMLNode,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLNode=require('./XMLNode');module.exports=XMLDTDElement=(function(superClass){extend(XMLDTDElement,superClass);function XMLDTDElement(parent,name,value){XMLDTDElement.__super__.constructor.call(this,parent);if(name==null){throw new Error("Missing DTD element name")}
if(!value){value='(#PCDATA)'}
if(Array.isArray(value)){value='('+value.join(',')+')'}
this.name=this.stringify.eleName(name);this.value=this.stringify.dtdElementValue(value)}
XMLDTDElement.prototype.toString=function(options){return this.options.writer.set(options).dtdElement(this)};return XMLDTDElement})(XMLNode)}).call(this)},{"./XMLNode":512}],505:[function(require,module,exports){(function(){var XMLDTDEntity,XMLNode,isObject,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;isObject=require('./Utility').isObject;XMLNode=require('./XMLNode');module.exports=XMLDTDEntity=(function(superClass){extend(XMLDTDEntity,superClass);function XMLDTDEntity(parent,pe,name,value){XMLDTDEntity.__super__.constructor.call(this,parent);if(name==null){throw new Error("Missing entity name")}
if(value==null){throw new Error("Missing entity value")}
this.pe=!!pe;this.name=this.stringify.eleName(name);if(!isObject(value)){this.value=this.stringify.dtdEntityValue(value)}else{if(!value.pubID&&!value.sysID){throw new Error("Public and/or system identifiers are required for an external entity")}
if(value.pubID&&!value.sysID){throw new Error("System identifier is required for a public external entity")}
if(value.pubID!=null){this.pubID=this.stringify.dtdPubID(value.pubID)}
if(value.sysID!=null){this.sysID=this.stringify.dtdSysID(value.sysID)}
if(value.nData!=null){this.nData=this.stringify.dtdNData(value.nData)}
if(this.pe&&this.nData){throw new Error("Notation declaration is not allowed in a parameter entity")}}}
XMLDTDEntity.prototype.toString=function(options){return this.options.writer.set(options).dtdEntity(this)};return XMLDTDEntity})(XMLNode)}).call(this)},{"./Utility":499,"./XMLNode":512}],506:[function(require,module,exports){(function(){var XMLDTDNotation,XMLNode,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLNode=require('./XMLNode');module.exports=XMLDTDNotation=(function(superClass){extend(XMLDTDNotation,superClass);function XMLDTDNotation(parent,name,value){XMLDTDNotation.__super__.constructor.call(this,parent);if(name==null){throw new Error("Missing notation name")}
if(!value.pubID&&!value.sysID){throw new Error("Public or system identifiers are required for an external entity")}
this.name=this.stringify.eleName(name);if(value.pubID!=null){this.pubID=this.stringify.dtdPubID(value.pubID)}
if(value.sysID!=null){this.sysID=this.stringify.dtdSysID(value.sysID)}}
XMLDTDNotation.prototype.toString=function(options){return this.options.writer.set(options).dtdNotation(this)};return XMLDTDNotation})(XMLNode)}).call(this)},{"./XMLNode":512}],507:[function(require,module,exports){(function(){var XMLDeclaration,XMLNode,isObject,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;isObject=require('./Utility').isObject;XMLNode=require('./XMLNode');module.exports=XMLDeclaration=(function(superClass){extend(XMLDeclaration,superClass);function XMLDeclaration(parent,version,encoding,standalone){var ref;XMLDeclaration.__super__.constructor.call(this,parent);if(isObject(version)){ref=version,version=ref.version,encoding=ref.encoding,standalone=ref.standalone}
if(!version){version='1.0'}
this.version=this.stringify.xmlVersion(version);if(encoding!=null){this.encoding=this.stringify.xmlEncoding(encoding)}
if(standalone!=null){this.standalone=this.stringify.xmlStandalone(standalone)}}
XMLDeclaration.prototype.toString=function(options){return this.options.writer.set(options).declaration(this)};return XMLDeclaration})(XMLNode)}).call(this)},{"./Utility":499,"./XMLNode":512}],508:[function(require,module,exports){(function(){var XMLDTDAttList,XMLDTDElement,XMLDTDEntity,XMLDTDNotation,XMLDocType,XMLNode,isObject,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;isObject=require('./Utility').isObject;XMLNode=require('./XMLNode');XMLDTDAttList=require('./XMLDTDAttList');XMLDTDEntity=require('./XMLDTDEntity');XMLDTDElement=require('./XMLDTDElement');XMLDTDNotation=require('./XMLDTDNotation');module.exports=XMLDocType=(function(superClass){extend(XMLDocType,superClass);function XMLDocType(parent,pubID,sysID){var ref,ref1;XMLDocType.__super__.constructor.call(this,parent);this.documentObject=parent;if(isObject(pubID)){ref=pubID,pubID=ref.pubID,sysID=ref.sysID}
if(sysID==null){ref1=[pubID,sysID],sysID=ref1[0],pubID=ref1[1]}
if(pubID!=null){this.pubID=this.stringify.dtdPubID(pubID)}
if(sysID!=null){this.sysID=this.stringify.dtdSysID(sysID)}}
XMLDocType.prototype.element=function(name,value){var child;child=new XMLDTDElement(this,name,value);this.children.push(child);return this};XMLDocType.prototype.attList=function(elementName,attributeName,attributeType,defaultValueType,defaultValue){var child;child=new XMLDTDAttList(this,elementName,attributeName,attributeType,defaultValueType,defaultValue);this.children.push(child);return this};XMLDocType.prototype.entity=function(name,value){var child;child=new XMLDTDEntity(this,!1,name,value);this.children.push(child);return this};XMLDocType.prototype.pEntity=function(name,value){var child;child=new XMLDTDEntity(this,!0,name,value);this.children.push(child);return this};XMLDocType.prototype.notation=function(name,value){var child;child=new XMLDTDNotation(this,name,value);this.children.push(child);return this};XMLDocType.prototype.toString=function(options){return this.options.writer.set(options).docType(this)};XMLDocType.prototype.ele=function(name,value){return this.element(name,value)};XMLDocType.prototype.att=function(elementName,attributeName,attributeType,defaultValueType,defaultValue){return this.attList(elementName,attributeName,attributeType,defaultValueType,defaultValue)};XMLDocType.prototype.ent=function(name,value){return this.entity(name,value)};XMLDocType.prototype.pent=function(name,value){return this.pEntity(name,value)};XMLDocType.prototype.not=function(name,value){return this.notation(name,value)};XMLDocType.prototype.up=function(){return this.root()||this.documentObject};return XMLDocType})(XMLNode)}).call(this)},{"./Utility":499,"./XMLDTDAttList":503,"./XMLDTDElement":504,"./XMLDTDEntity":505,"./XMLDTDNotation":506,"./XMLNode":512}],509:[function(require,module,exports){(function(){var XMLDocument,XMLNode,XMLStringWriter,XMLStringifier,isPlainObject,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;isPlainObject=require('./Utility').isPlainObject;XMLNode=require('./XMLNode');XMLStringifier=require('./XMLStringifier');XMLStringWriter=require('./XMLStringWriter');module.exports=XMLDocument=(function(superClass){extend(XMLDocument,superClass);function XMLDocument(options){XMLDocument.__super__.constructor.call(this,null);options||(options={});if(!options.writer){options.writer=new XMLStringWriter()}
this.options=options;this.stringify=new XMLStringifier(options);this.isDocument=!0}
XMLDocument.prototype.end=function(writer){var writerOptions;if(!writer){writer=this.options.writer}else if(isPlainObject(writer)){writerOptions=writer;writer=this.options.writer.set(writerOptions)}
return writer.document(this)};XMLDocument.prototype.toString=function(options){return this.options.writer.set(options).document(this)};return XMLDocument})(XMLNode)}).call(this)},{"./Utility":499,"./XMLNode":512,"./XMLStringWriter":516,"./XMLStringifier":517}],510:[function(require,module,exports){(function(){var XMLAttribute,XMLCData,XMLComment,XMLDTDAttList,XMLDTDElement,XMLDTDEntity,XMLDTDNotation,XMLDeclaration,XMLDocType,XMLDocumentCB,XMLElement,XMLProcessingInstruction,XMLRaw,XMLStringWriter,XMLStringifier,XMLText,isFunction,isObject,isPlainObject,ref,hasProp={}.hasOwnProperty;ref=require('./Utility'),isObject=ref.isObject,isFunction=ref.isFunction,isPlainObject=ref.isPlainObject;XMLElement=require('./XMLElement');XMLCData=require('./XMLCData');XMLComment=require('./XMLComment');XMLRaw=require('./XMLRaw');XMLText=require('./XMLText');XMLProcessingInstruction=require('./XMLProcessingInstruction');XMLDeclaration=require('./XMLDeclaration');XMLDocType=require('./XMLDocType');XMLDTDAttList=require('./XMLDTDAttList');XMLDTDEntity=require('./XMLDTDEntity');XMLDTDElement=require('./XMLDTDElement');XMLDTDNotation=require('./XMLDTDNotation');XMLAttribute=require('./XMLAttribute');XMLStringifier=require('./XMLStringifier');XMLStringWriter=require('./XMLStringWriter');module.exports=XMLDocumentCB=(function(){function XMLDocumentCB(options,onData,onEnd){var writerOptions;options||(options={});if(!options.writer){options.writer=new XMLStringWriter(options)}else if(isPlainObject(options.writer)){writerOptions=options.writer;options.writer=new XMLStringWriter(writerOptions)}
this.options=options;this.writer=options.writer;this.stringify=new XMLStringifier(options);this.onDataCallback=onData||function(){};this.onEndCallback=onEnd||function(){};this.currentNode=null;this.currentLevel=-1;this.openTags={};this.documentStarted=!1;this.documentCompleted=!1;this.root=null}
XMLDocumentCB.prototype.node=function(name,attributes,text){var ref1;if(name==null){throw new Error("Missing node name")}
if(this.root&&this.currentLevel===-1){throw new Error("Document can only have one root node")}
this.openCurrent();name=name.valueOf();if(attributes==null){attributes={}}
attributes=attributes.valueOf();if(!isObject(attributes)){ref1=[attributes,text],text=ref1[0],attributes=ref1[1]}
this.currentNode=new XMLElement(this,name,attributes);this.currentNode.children=!1;this.currentLevel++;this.openTags[this.currentLevel]=this.currentNode;if(text!=null){this.text(text)}
return this};XMLDocumentCB.prototype.element=function(name,attributes,text){if(this.currentNode&&this.currentNode instanceof XMLDocType){return this.dtdElement.apply(this,arguments)}else{return this.node(name,attributes,text)}};XMLDocumentCB.prototype.attribute=function(name,value){var attName,attValue;if(!this.currentNode||this.currentNode.children){throw new Error("att() can only be used immediately after an ele() call in callback mode")}
if(name!=null){name=name.valueOf()}
if(isObject(name)){for(attName in name){if(!hasProp.call(name,attName))continue;attValue=name[attName];this.attribute(attName,attValue)}}else{if(isFunction(value)){value=value.apply()}
if(!this.options.skipNullAttributes||(value!=null)){this.currentNode.attributes[name]=new XMLAttribute(this,name,value)}}
return this};XMLDocumentCB.prototype.text=function(value){var node;this.openCurrent();node=new XMLText(this,value);this.onData(this.writer.text(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.cdata=function(value){var node;this.openCurrent();node=new XMLCData(this,value);this.onData(this.writer.cdata(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.comment=function(value){var node;this.openCurrent();node=new XMLComment(this,value);this.onData(this.writer.comment(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.raw=function(value){var node;this.openCurrent();node=new XMLRaw(this,value);this.onData(this.writer.raw(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.instruction=function(target,value){var i,insTarget,insValue,len,node;this.openCurrent();if(target!=null){target=target.valueOf()}
if(value!=null){value=value.valueOf()}
if(Array.isArray(target)){for(i=0,len=target.length;i<len;i++){insTarget=target[i];this.instruction(insTarget)}}else if(isObject(target)){for(insTarget in target){if(!hasProp.call(target,insTarget))continue;insValue=target[insTarget];this.instruction(insTarget,insValue)}}else{if(isFunction(value)){value=value.apply()}
node=new XMLProcessingInstruction(this,target,value);this.onData(this.writer.processingInstruction(node,this.currentLevel+1))}
return this};XMLDocumentCB.prototype.declaration=function(version,encoding,standalone){var node;this.openCurrent();if(this.documentStarted){throw new Error("declaration() must be the first node")}
node=new XMLDeclaration(this,version,encoding,standalone);this.onData(this.writer.declaration(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.doctype=function(root,pubID,sysID){this.openCurrent();if(root==null){throw new Error("Missing root node name")}
if(this.root){throw new Error("dtd() must come before the root node")}
this.currentNode=new XMLDocType(this,pubID,sysID);this.currentNode.rootNodeName=root;this.currentNode.children=!1;this.currentLevel++;this.openTags[this.currentLevel]=this.currentNode;return this};XMLDocumentCB.prototype.dtdElement=function(name,value){var node;this.openCurrent();node=new XMLDTDElement(this,name,value);this.onData(this.writer.dtdElement(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.attList=function(elementName,attributeName,attributeType,defaultValueType,defaultValue){var node;this.openCurrent();node=new XMLDTDAttList(this,elementName,attributeName,attributeType,defaultValueType,defaultValue);this.onData(this.writer.dtdAttList(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.entity=function(name,value){var node;this.openCurrent();node=new XMLDTDEntity(this,!1,name,value);this.onData(this.writer.dtdEntity(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.pEntity=function(name,value){var node;this.openCurrent();node=new XMLDTDEntity(this,!0,name,value);this.onData(this.writer.dtdEntity(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.notation=function(name,value){var node;this.openCurrent();node=new XMLDTDNotation(this,name,value);this.onData(this.writer.dtdNotation(node,this.currentLevel+1));return this};XMLDocumentCB.prototype.up=function(){if(this.currentLevel<0){throw new Error("The document node has no parent")}
if(this.currentNode){if(this.currentNode.children){this.closeNode(this.currentNode)}else{this.openNode(this.currentNode)}
this.currentNode=null}else{this.closeNode(this.openTags[this.currentLevel])}
delete this.openTags[this.currentLevel];this.currentLevel--;return this};XMLDocumentCB.prototype.end=function(){while(this.currentLevel>=0){this.up()}
return this.onEnd()};XMLDocumentCB.prototype.openCurrent=function(){if(this.currentNode){this.currentNode.children=!0;return this.openNode(this.currentNode)}};XMLDocumentCB.prototype.openNode=function(node){if(!node.isOpen){if(!this.root&&this.currentLevel===0&&node instanceof XMLElement){this.root=node}
this.onData(this.writer.openNode(node,this.currentLevel));return node.isOpen=!0}};XMLDocumentCB.prototype.closeNode=function(node){if(!node.isClosed){this.onData(this.writer.closeNode(node,this.currentLevel));return node.isClosed=!0}};XMLDocumentCB.prototype.onData=function(chunk){this.documentStarted=!0;return this.onDataCallback(chunk)};XMLDocumentCB.prototype.onEnd=function(){this.documentCompleted=!0;return this.onEndCallback()};XMLDocumentCB.prototype.ele=function(){return this.element.apply(this,arguments)};XMLDocumentCB.prototype.nod=function(name,attributes,text){return this.node(name,attributes,text)};XMLDocumentCB.prototype.txt=function(value){return this.text(value)};XMLDocumentCB.prototype.dat=function(value){return this.cdata(value)};XMLDocumentCB.prototype.com=function(value){return this.comment(value)};XMLDocumentCB.prototype.ins=function(target,value){return this.instruction(target,value)};XMLDocumentCB.prototype.dec=function(version,encoding,standalone){return this.declaration(version,encoding,standalone)};XMLDocumentCB.prototype.dtd=function(root,pubID,sysID){return this.doctype(root,pubID,sysID)};XMLDocumentCB.prototype.e=function(name,attributes,text){return this.element(name,attributes,text)};XMLDocumentCB.prototype.n=function(name,attributes,text){return this.node(name,attributes,text)};XMLDocumentCB.prototype.t=function(value){return this.text(value)};XMLDocumentCB.prototype.d=function(value){return this.cdata(value)};XMLDocumentCB.prototype.c=function(value){return this.comment(value)};XMLDocumentCB.prototype.r=function(value){return this.raw(value)};XMLDocumentCB.prototype.i=function(target,value){return this.instruction(target,value)};XMLDocumentCB.prototype.att=function(){if(this.currentNode&&this.currentNode instanceof XMLDocType){return this.attList.apply(this,arguments)}else{return this.attribute.apply(this,arguments)}};XMLDocumentCB.prototype.a=function(){if(this.currentNode&&this.currentNode instanceof XMLDocType){return this.attList.apply(this,arguments)}else{return this.attribute.apply(this,arguments)}};XMLDocumentCB.prototype.ent=function(name,value){return this.entity(name,value)};XMLDocumentCB.prototype.pent=function(name,value){return this.pEntity(name,value)};XMLDocumentCB.prototype.not=function(name,value){return this.notation(name,value)};return XMLDocumentCB})()}).call(this)},{"./Utility":499,"./XMLAttribute":500,"./XMLCData":501,"./XMLComment":502,"./XMLDTDAttList":503,"./XMLDTDElement":504,"./XMLDTDEntity":505,"./XMLDTDNotation":506,"./XMLDeclaration":507,"./XMLDocType":508,"./XMLElement":511,"./XMLProcessingInstruction":513,"./XMLRaw":514,"./XMLStringWriter":516,"./XMLStringifier":517,"./XMLText":518}],511:[function(require,module,exports){(function(){var XMLAttribute,XMLElement,XMLNode,isFunction,isObject,ref,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;ref=require('./Utility'),isObject=ref.isObject,isFunction=ref.isFunction;XMLNode=require('./XMLNode');XMLAttribute=require('./XMLAttribute');module.exports=XMLElement=(function(superClass){extend(XMLElement,superClass);function XMLElement(parent,name,attributes){XMLElement.__super__.constructor.call(this,parent);if(name==null){throw new Error("Missing element name")}
this.name=this.stringify.eleName(name);this.attributes={};if(attributes!=null){this.attribute(attributes)}
if(parent.isDocument){this.isRoot=!0;this.documentObject=parent;parent.rootObject=this}}
XMLElement.prototype.clone=function(){var att,attName,clonedSelf,ref1;clonedSelf=Object.create(this);if(clonedSelf.isRoot){clonedSelf.documentObject=null}
clonedSelf.attributes={};ref1=this.attributes;for(attName in ref1){if(!hasProp.call(ref1,attName))continue;att=ref1[attName];clonedSelf.attributes[attName]=att.clone()}
clonedSelf.children=[];this.children.forEach(function(child){var clonedChild;clonedChild=child.clone();clonedChild.parent=clonedSelf;return clonedSelf.children.push(clonedChild)});return clonedSelf};XMLElement.prototype.attribute=function(name,value){var attName,attValue;if(name!=null){name=name.valueOf()}
if(isObject(name)){for(attName in name){if(!hasProp.call(name,attName))continue;attValue=name[attName];this.attribute(attName,attValue)}}else{if(isFunction(value)){value=value.apply()}
if(!this.options.skipNullAttributes||(value!=null)){this.attributes[name]=new XMLAttribute(this,name,value)}}
return this};XMLElement.prototype.removeAttribute=function(name){var attName,i,len;if(name==null){throw new Error("Missing attribute name")}
name=name.valueOf();if(Array.isArray(name)){for(i=0,len=name.length;i<len;i++){attName=name[i];delete this.attributes[attName]}}else{delete this.attributes[name]}
return this};XMLElement.prototype.toString=function(options){return this.options.writer.set(options).element(this)};XMLElement.prototype.att=function(name,value){return this.attribute(name,value)};XMLElement.prototype.a=function(name,value){return this.attribute(name,value)};return XMLElement})(XMLNode)}).call(this)},{"./Utility":499,"./XMLAttribute":500,"./XMLNode":512}],512:[function(require,module,exports){(function(){var XMLCData,XMLComment,XMLDeclaration,XMLDocType,XMLElement,XMLNode,XMLProcessingInstruction,XMLRaw,XMLText,isEmpty,isFunction,isObject,ref,hasProp={}.hasOwnProperty;ref=require('./Utility'),isObject=ref.isObject,isFunction=ref.isFunction,isEmpty=ref.isEmpty;XMLElement=null;XMLCData=null;XMLComment=null;XMLDeclaration=null;XMLDocType=null;XMLRaw=null;XMLText=null;XMLProcessingInstruction=null;module.exports=XMLNode=(function(){function XMLNode(parent){this.parent=parent;if(this.parent){this.options=this.parent.options;this.stringify=this.parent.stringify}
this.children=[];if(!XMLElement){XMLElement=require('./XMLElement');XMLCData=require('./XMLCData');XMLComment=require('./XMLComment');XMLDeclaration=require('./XMLDeclaration');XMLDocType=require('./XMLDocType');XMLRaw=require('./XMLRaw');XMLText=require('./XMLText');XMLProcessingInstruction=require('./XMLProcessingInstruction')}}
XMLNode.prototype.element=function(name,attributes,text){var childNode,item,j,k,key,lastChild,len,len1,ref1,val;lastChild=null;if(attributes==null){attributes={}}
attributes=attributes.valueOf();if(!isObject(attributes)){ref1=[attributes,text],text=ref1[0],attributes=ref1[1]}
if(name!=null){name=name.valueOf()}
if(Array.isArray(name)){for(j=0,len=name.length;j<len;j++){item=name[j];lastChild=this.element(item)}}else if(isFunction(name)){lastChild=this.element(name.apply())}else if(isObject(name)){for(key in name){if(!hasProp.call(name,key))continue;val=name[key];if(isFunction(val)){val=val.apply()}
if((isObject(val))&&(isEmpty(val))){val=null}
if(!this.options.ignoreDecorators&&this.stringify.convertAttKey&&key.indexOf(this.stringify.convertAttKey)===0){lastChild=this.attribute(key.substr(this.stringify.convertAttKey.length),val)}else if(!this.options.separateArrayItems&&Array.isArray(val)){for(k=0,len1=val.length;k<len1;k++){item=val[k];childNode={};childNode[key]=item;lastChild=this.element(childNode)}}else if(isObject(val)){lastChild=this.element(key);lastChild.element(val)}else{lastChild=this.element(key,val)}}}else{if(!this.options.ignoreDecorators&&this.stringify.convertTextKey&&name.indexOf(this.stringify.convertTextKey)===0){lastChild=this.text(text)}else if(!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&name.indexOf(this.stringify.convertCDataKey)===0){lastChild=this.cdata(text)}else if(!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&name.indexOf(this.stringify.convertCommentKey)===0){lastChild=this.comment(text)}else if(!this.options.ignoreDecorators&&this.stringify.convertRawKey&&name.indexOf(this.stringify.convertRawKey)===0){lastChild=this.raw(text)}else if(!this.options.ignoreDecorators&&this.stringify.convertPIKey&&name.indexOf(this.stringify.convertPIKey)===0){lastChild=this.instruction(name.substr(this.stringify.convertPIKey.length),text)}else{lastChild=this.node(name,attributes,text)}}
if(lastChild==null){throw new Error("Could not create any elements with: "+name)}
return lastChild};XMLNode.prototype.insertBefore=function(name,attributes,text){var child,i,removed;if(this.isRoot){throw new Error("Cannot insert elements at root level")}
i=this.parent.children.indexOf(this);removed=this.parent.children.splice(i);child=this.parent.element(name,attributes,text);Array.prototype.push.apply(this.parent.children,removed);return child};XMLNode.prototype.insertAfter=function(name,attributes,text){var child,i,removed;if(this.isRoot){throw new Error("Cannot insert elements at root level")}
i=this.parent.children.indexOf(this);removed=this.parent.children.splice(i+1);child=this.parent.element(name,attributes,text);Array.prototype.push.apply(this.parent.children,removed);return child};XMLNode.prototype.remove=function(){var i,ref1;if(this.isRoot){throw new Error("Cannot remove the root element")}
i=this.parent.children.indexOf(this);[].splice.apply(this.parent.children,[i,i-i+1].concat(ref1=[])),ref1;return this.parent};XMLNode.prototype.node=function(name,attributes,text){var child,ref1;if(name!=null){name=name.valueOf()}
attributes||(attributes={});attributes=attributes.valueOf();if(!isObject(attributes)){ref1=[attributes,text],text=ref1[0],attributes=ref1[1]}
child=new XMLElement(this,name,attributes);if(text!=null){child.text(text)}
this.children.push(child);return child};XMLNode.prototype.text=function(value){var child;child=new XMLText(this,value);this.children.push(child);return this};XMLNode.prototype.cdata=function(value){var child;child=new XMLCData(this,value);this.children.push(child);return this};XMLNode.prototype.comment=function(value){var child;child=new XMLComment(this,value);this.children.push(child);return this};XMLNode.prototype.commentBefore=function(value){var child,i,removed;i=this.parent.children.indexOf(this);removed=this.parent.children.splice(i);child=this.parent.comment(value);Array.prototype.push.apply(this.parent.children,removed);return this};XMLNode.prototype.commentAfter=function(value){var child,i,removed;i=this.parent.children.indexOf(this);removed=this.parent.children.splice(i+1);child=this.parent.comment(value);Array.prototype.push.apply(this.parent.children,removed);return this};XMLNode.prototype.raw=function(value){var child;child=new XMLRaw(this,value);this.children.push(child);return this};XMLNode.prototype.instruction=function(target,value){var insTarget,insValue,instruction,j,len;if(target!=null){target=target.valueOf()}
if(value!=null){value=value.valueOf()}
if(Array.isArray(target)){for(j=0,len=target.length;j<len;j++){insTarget=target[j];this.instruction(insTarget)}}else if(isObject(target)){for(insTarget in target){if(!hasProp.call(target,insTarget))continue;insValue=target[insTarget];this.instruction(insTarget,insValue)}}else{if(isFunction(value)){value=value.apply()}
instruction=new XMLProcessingInstruction(this,target,value);this.children.push(instruction)}
return this};XMLNode.prototype.instructionBefore=function(target,value){var child,i,removed;i=this.parent.children.indexOf(this);removed=this.parent.children.splice(i);child=this.parent.instruction(target,value);Array.prototype.push.apply(this.parent.children,removed);return this};XMLNode.prototype.instructionAfter=function(target,value){var child,i,removed;i=this.parent.children.indexOf(this);removed=this.parent.children.splice(i+1);child=this.parent.instruction(target,value);Array.prototype.push.apply(this.parent.children,removed);return this};XMLNode.prototype.declaration=function(version,encoding,standalone){var doc,xmldec;doc=this.document();xmldec=new XMLDeclaration(doc,version,encoding,standalone);if(doc.children[0]instanceof XMLDeclaration){doc.children[0]=xmldec}else{doc.children.unshift(xmldec)}
return doc.root()||doc};XMLNode.prototype.doctype=function(pubID,sysID){var child,doc,doctype,i,j,k,len,len1,ref1,ref2;doc=this.document();doctype=new XMLDocType(doc,pubID,sysID);ref1=doc.children;for(i=j=0,len=ref1.length;j<len;i=++j){child=ref1[i];if(child instanceof XMLDocType){doc.children[i]=doctype;return doctype}}
ref2=doc.children;for(i=k=0,len1=ref2.length;k<len1;i=++k){child=ref2[i];if(child.isRoot){doc.children.splice(i,0,doctype);return doctype}}
doc.children.push(doctype);return doctype};XMLNode.prototype.up=function(){if(this.isRoot){throw new Error("The root node has no parent. Use doc() if you need to get the document object.")}
return this.parent};XMLNode.prototype.root=function(){var node;node=this;while(node){if(node.isDocument){return node.rootObject}else if(node.isRoot){return node}else{node=node.parent}}};XMLNode.prototype.document=function(){var node;node=this;while(node){if(node.isDocument){return node}else{node=node.parent}}};XMLNode.prototype.end=function(options){return this.document().end(options)};XMLNode.prototype.prev=function(){var i;i=this.parent.children.indexOf(this);if(i<1){throw new Error("Already at the first node")}
return this.parent.children[i-1]};XMLNode.prototype.next=function(){var i;i=this.parent.children.indexOf(this);if(i===-1||i===this.parent.children.length-1){throw new Error("Already at the last node")}
return this.parent.children[i+1]};XMLNode.prototype.importDocument=function(doc){var clonedRoot;clonedRoot=doc.root().clone();clonedRoot.parent=this;clonedRoot.isRoot=!1;this.children.push(clonedRoot);return this};XMLNode.prototype.ele=function(name,attributes,text){return this.element(name,attributes,text)};XMLNode.prototype.nod=function(name,attributes,text){return this.node(name,attributes,text)};XMLNode.prototype.txt=function(value){return this.text(value)};XMLNode.prototype.dat=function(value){return this.cdata(value)};XMLNode.prototype.com=function(value){return this.comment(value)};XMLNode.prototype.ins=function(target,value){return this.instruction(target,value)};XMLNode.prototype.doc=function(){return this.document()};XMLNode.prototype.dec=function(version,encoding,standalone){return this.declaration(version,encoding,standalone)};XMLNode.prototype.dtd=function(pubID,sysID){return this.doctype(pubID,sysID)};XMLNode.prototype.e=function(name,attributes,text){return this.element(name,attributes,text)};XMLNode.prototype.n=function(name,attributes,text){return this.node(name,attributes,text)};XMLNode.prototype.t=function(value){return this.text(value)};XMLNode.prototype.d=function(value){return this.cdata(value)};XMLNode.prototype.c=function(value){return this.comment(value)};XMLNode.prototype.r=function(value){return this.raw(value)};XMLNode.prototype.i=function(target,value){return this.instruction(target,value)};XMLNode.prototype.u=function(){return this.up()};XMLNode.prototype.importXMLBuilder=function(doc){return this.importDocument(doc)};return XMLNode})()}).call(this)},{"./Utility":499,"./XMLCData":501,"./XMLComment":502,"./XMLDeclaration":507,"./XMLDocType":508,"./XMLElement":511,"./XMLProcessingInstruction":513,"./XMLRaw":514,"./XMLText":518}],513:[function(require,module,exports){(function(){var XMLNode,XMLProcessingInstruction,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLNode=require('./XMLNode');module.exports=XMLProcessingInstruction=(function(superClass){extend(XMLProcessingInstruction,superClass);function XMLProcessingInstruction(parent,target,value){XMLProcessingInstruction.__super__.constructor.call(this,parent);if(target==null){throw new Error("Missing instruction target")}
this.target=this.stringify.insTarget(target);if(value){this.value=this.stringify.insValue(value)}}
XMLProcessingInstruction.prototype.clone=function(){return Object.create(this)};XMLProcessingInstruction.prototype.toString=function(options){return this.options.writer.set(options).processingInstruction(this)};return XMLProcessingInstruction})(XMLNode)}).call(this)},{"./XMLNode":512}],514:[function(require,module,exports){(function(){var XMLNode,XMLRaw,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLNode=require('./XMLNode');module.exports=XMLRaw=(function(superClass){extend(XMLRaw,superClass);function XMLRaw(parent,text){XMLRaw.__super__.constructor.call(this,parent);if(text==null){throw new Error("Missing raw text")}
this.value=this.stringify.raw(text)}
XMLRaw.prototype.clone=function(){return Object.create(this)};XMLRaw.prototype.toString=function(options){return this.options.writer.set(options).raw(this)};return XMLRaw})(XMLNode)}).call(this)},{"./XMLNode":512}],515:[function(require,module,exports){(function(){var XMLCData,XMLComment,XMLDTDAttList,XMLDTDElement,XMLDTDEntity,XMLDTDNotation,XMLDeclaration,XMLDocType,XMLElement,XMLProcessingInstruction,XMLRaw,XMLStreamWriter,XMLText,XMLWriterBase,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLDeclaration=require('./XMLDeclaration');XMLDocType=require('./XMLDocType');XMLCData=require('./XMLCData');XMLComment=require('./XMLComment');XMLElement=require('./XMLElement');XMLRaw=require('./XMLRaw');XMLText=require('./XMLText');XMLProcessingInstruction=require('./XMLProcessingInstruction');XMLDTDAttList=require('./XMLDTDAttList');XMLDTDElement=require('./XMLDTDElement');XMLDTDEntity=require('./XMLDTDEntity');XMLDTDNotation=require('./XMLDTDNotation');XMLWriterBase=require('./XMLWriterBase');module.exports=XMLStreamWriter=(function(superClass){extend(XMLStreamWriter,superClass);function XMLStreamWriter(stream,options){this.stream=stream;XMLStreamWriter.__super__.constructor.call(this,options)}
XMLStreamWriter.prototype.document=function(doc){var child,i,j,len,len1,ref,ref1,results;ref=doc.children;for(i=0,len=ref.length;i<len;i++){child=ref[i];child.isLastRootNode=!1}
doc.children[doc.children.length-1].isLastRootNode=!0;ref1=doc.children;results=[];for(j=0,len1=ref1.length;j<len1;j++){child=ref1[j];switch(!1){case!(child instanceof XMLDeclaration):results.push(this.declaration(child));break;case!(child instanceof XMLDocType):results.push(this.docType(child));break;case!(child instanceof XMLComment):results.push(this.comment(child));break;case!(child instanceof XMLProcessingInstruction):results.push(this.processingInstruction(child));break;default:results.push(this.element(child))}}
return results};XMLStreamWriter.prototype.attribute=function(att){return this.stream.write(' '+att.name+'="'+att.value+'"')};XMLStreamWriter.prototype.cdata=function(node,level){return this.stream.write(this.space(level)+'<![CDATA['+node.text+']]>'+this.endline(node))};XMLStreamWriter.prototype.comment=function(node,level){return this.stream.write(this.space(level)+'<!-- '+node.text+' -->'+this.endline(node))};XMLStreamWriter.prototype.declaration=function(node,level){this.stream.write(this.space(level));this.stream.write('<?xml version="'+node.version+'"');if(node.encoding!=null){this.stream.write(' encoding="'+node.encoding+'"')}
if(node.standalone!=null){this.stream.write(' standalone="'+node.standalone+'"')}
this.stream.write('?>');return this.stream.write(this.endline(node))};XMLStreamWriter.prototype.docType=function(node,level){var child,i,len,ref;level||(level=0);this.stream.write(this.space(level));this.stream.write('<!DOCTYPE '+node.root().name);if(node.pubID&&node.sysID){this.stream.write(' PUBLIC "'+node.pubID+'" "'+node.sysID+'"')}else if(node.sysID){this.stream.write(' SYSTEM "'+node.sysID+'"')}
if(node.children.length>0){this.stream.write(' [');this.stream.write(this.endline(node));ref=node.children;for(i=0,len=ref.length;i<len;i++){child=ref[i];switch(!1){case!(child instanceof XMLDTDAttList):this.dtdAttList(child,level+1);break;case!(child instanceof XMLDTDElement):this.dtdElement(child,level+1);break;case!(child instanceof XMLDTDEntity):this.dtdEntity(child,level+1);break;case!(child instanceof XMLDTDNotation):this.dtdNotation(child,level+1);break;case!(child instanceof XMLCData):this.cdata(child,level+1);break;case!(child instanceof XMLComment):this.comment(child,level+1);break;case!(child instanceof XMLProcessingInstruction):this.processingInstruction(child,level+1);break;default:throw new Error("Unknown DTD node type: "+child.constructor.name)}}
this.stream.write(']')}
this.stream.write('>');return this.stream.write(this.endline(node))};XMLStreamWriter.prototype.element=function(node,level){var att,child,i,len,name,ref,ref1,space;level||(level=0);space=this.space(level);this.stream.write(space+'<'+node.name);ref=node.attributes;for(name in ref){if(!hasProp.call(ref,name))continue;att=ref[name];this.attribute(att)}
if(node.children.length===0||node.children.every(function(e){return e.value===''})){if(this.allowEmpty){this.stream.write('></'+node.name+'>')}else{this.stream.write('/>')}}else if(this.pretty&&node.children.length===1&&(node.children[0].value!=null)){this.stream.write('>');this.stream.write(node.children[0].value);this.stream.write('</'+node.name+'>')}else{this.stream.write('>'+this.newline);ref1=node.children;for(i=0,len=ref1.length;i<len;i++){child=ref1[i];switch(!1){case!(child instanceof XMLCData):this.cdata(child,level+1);break;case!(child instanceof XMLComment):this.comment(child,level+1);break;case!(child instanceof XMLElement):this.element(child,level+1);break;case!(child instanceof XMLRaw):this.raw(child,level+1);break;case!(child instanceof XMLText):this.text(child,level+1);break;case!(child instanceof XMLProcessingInstruction):this.processingInstruction(child,level+1);break;default:throw new Error("Unknown XML node type: "+child.constructor.name)}}
this.stream.write(space+'</'+node.name+'>')}
return this.stream.write(this.endline(node))};XMLStreamWriter.prototype.processingInstruction=function(node,level){this.stream.write(this.space(level)+'<?'+node.target);if(node.value){this.stream.write(' '+node.value)}
return this.stream.write('?>'+this.endline(node))};XMLStreamWriter.prototype.raw=function(node,level){return this.stream.write(this.space(level)+node.value+this.endline(node))};XMLStreamWriter.prototype.text=function(node,level){return this.stream.write(this.space(level)+node.value+this.endline(node))};XMLStreamWriter.prototype.dtdAttList=function(node,level){this.stream.write(this.space(level)+'<!ATTLIST '+node.elementName+' '+node.attributeName+' '+node.attributeType);if(node.defaultValueType!=='#DEFAULT'){this.stream.write(' '+node.defaultValueType)}
if(node.defaultValue){this.stream.write(' "'+node.defaultValue+'"')}
return this.stream.write('>'+this.endline(node))};XMLStreamWriter.prototype.dtdElement=function(node,level){return this.stream.write(this.space(level)+'<!ELEMENT '+node.name+' '+node.value+'>'+this.endline(node))};XMLStreamWriter.prototype.dtdEntity=function(node,level){this.stream.write(this.space(level)+'<!ENTITY');if(node.pe){this.stream.write(' %')}
this.stream.write(' '+node.name);if(node.value){this.stream.write(' "'+node.value+'"')}else{if(node.pubID&&node.sysID){this.stream.write(' PUBLIC "'+node.pubID+'" "'+node.sysID+'"')}else if(node.sysID){this.stream.write(' SYSTEM "'+node.sysID+'"')}
if(node.nData){this.stream.write(' NDATA '+node.nData)}}
return this.stream.write('>'+this.endline(node))};XMLStreamWriter.prototype.dtdNotation=function(node,level){this.stream.write(this.space(level)+'<!NOTATION '+node.name);if(node.pubID&&node.sysID){this.stream.write(' PUBLIC "'+node.pubID+'" "'+node.sysID+'"')}else if(node.pubID){this.stream.write(' PUBLIC "'+node.pubID+'"')}else if(node.sysID){this.stream.write(' SYSTEM "'+node.sysID+'"')}
return this.stream.write('>'+this.endline(node))};XMLStreamWriter.prototype.endline=function(node){if(!node.isLastRootNode){return this.newline}else{return''}};return XMLStreamWriter})(XMLWriterBase)}).call(this)},{"./XMLCData":501,"./XMLComment":502,"./XMLDTDAttList":503,"./XMLDTDElement":504,"./XMLDTDEntity":505,"./XMLDTDNotation":506,"./XMLDeclaration":507,"./XMLDocType":508,"./XMLElement":511,"./XMLProcessingInstruction":513,"./XMLRaw":514,"./XMLText":518,"./XMLWriterBase":519}],516:[function(require,module,exports){(function(){var XMLCData,XMLComment,XMLDTDAttList,XMLDTDElement,XMLDTDEntity,XMLDTDNotation,XMLDeclaration,XMLDocType,XMLElement,XMLProcessingInstruction,XMLRaw,XMLStringWriter,XMLText,XMLWriterBase,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLDeclaration=require('./XMLDeclaration');XMLDocType=require('./XMLDocType');XMLCData=require('./XMLCData');XMLComment=require('./XMLComment');XMLElement=require('./XMLElement');XMLRaw=require('./XMLRaw');XMLText=require('./XMLText');XMLProcessingInstruction=require('./XMLProcessingInstruction');XMLDTDAttList=require('./XMLDTDAttList');XMLDTDElement=require('./XMLDTDElement');XMLDTDEntity=require('./XMLDTDEntity');XMLDTDNotation=require('./XMLDTDNotation');XMLWriterBase=require('./XMLWriterBase');module.exports=XMLStringWriter=(function(superClass){extend(XMLStringWriter,superClass);function XMLStringWriter(options){XMLStringWriter.__super__.constructor.call(this,options)}
XMLStringWriter.prototype.document=function(doc){var child,i,len,r,ref;r='';ref=doc.children;for(i=0,len=ref.length;i<len;i++){child=ref[i];r+=(function(){switch(!1){case!(child instanceof XMLDeclaration):return this.declaration(child);case!(child instanceof XMLDocType):return this.docType(child);case!(child instanceof XMLComment):return this.comment(child);case!(child instanceof XMLProcessingInstruction):return this.processingInstruction(child);default:return this.element(child,0)}}).call(this)}
if(this.pretty&&r.slice(-this.newline.length)===this.newline){r=r.slice(0,-this.newline.length)}
return r};XMLStringWriter.prototype.attribute=function(att){return' '+att.name+'="'+att.value+'"'};XMLStringWriter.prototype.cdata=function(node,level){return this.space(level)+'<![CDATA['+node.text+']]>'+this.newline};XMLStringWriter.prototype.comment=function(node,level){return this.space(level)+'<!-- '+node.text+' -->'+this.newline};XMLStringWriter.prototype.declaration=function(node,level){var r;r=this.space(level);r+='<?xml version="'+node.version+'"';if(node.encoding!=null){r+=' encoding="'+node.encoding+'"'}
if(node.standalone!=null){r+=' standalone="'+node.standalone+'"'}
r+='?>';r+=this.newline;return r};XMLStringWriter.prototype.docType=function(node,level){var child,i,len,r,ref;level||(level=0);r=this.space(level);r+='<!DOCTYPE '+node.root().name;if(node.pubID&&node.sysID){r+=' PUBLIC "'+node.pubID+'" "'+node.sysID+'"'}else if(node.sysID){r+=' SYSTEM "'+node.sysID+'"'}
if(node.children.length>0){r+=' [';r+=this.newline;ref=node.children;for(i=0,len=ref.length;i<len;i++){child=ref[i];r+=(function(){switch(!1){case!(child instanceof XMLDTDAttList):return this.dtdAttList(child,level+1);case!(child instanceof XMLDTDElement):return this.dtdElement(child,level+1);case!(child instanceof XMLDTDEntity):return this.dtdEntity(child,level+1);case!(child instanceof XMLDTDNotation):return this.dtdNotation(child,level+1);case!(child instanceof XMLCData):return this.cdata(child,level+1);case!(child instanceof XMLComment):return this.comment(child,level+1);case!(child instanceof XMLProcessingInstruction):return this.processingInstruction(child,level+1);default:throw new Error("Unknown DTD node type: "+child.constructor.name)}}).call(this)}
r+=']'}
r+='>';r+=this.newline;return r};XMLStringWriter.prototype.element=function(node,level){var att,child,i,len,name,r,ref,ref1,space;level||(level=0);space=this.space(level);r='';r+=space+'<'+node.name;ref=node.attributes;for(name in ref){if(!hasProp.call(ref,name))continue;att=ref[name];r+=this.attribute(att)}
if(node.children.length===0||node.children.every(function(e){return e.value===''})){if(this.allowEmpty){r+='></'+node.name+'>'+this.newline}else{r+='/>'+this.newline}}else if(this.pretty&&node.children.length===1&&(node.children[0].value!=null)){r+='>';r+=node.children[0].value;r+='</'+node.name+'>'+this.newline}else{r+='>'+this.newline;ref1=node.children;for(i=0,len=ref1.length;i<len;i++){child=ref1[i];r+=(function(){switch(!1){case!(child instanceof XMLCData):return this.cdata(child,level+1);case!(child instanceof XMLComment):return this.comment(child,level+1);case!(child instanceof XMLElement):return this.element(child,level+1);case!(child instanceof XMLRaw):return this.raw(child,level+1);case!(child instanceof XMLText):return this.text(child,level+1);case!(child instanceof XMLProcessingInstruction):return this.processingInstruction(child,level+1);default:throw new Error("Unknown XML node type: "+child.constructor.name)}}).call(this)}
r+=space+'</'+node.name+'>'+this.newline}
return r};XMLStringWriter.prototype.processingInstruction=function(node,level){var r;r=this.space(level)+'<?'+node.target;if(node.value){r+=' '+node.value}
r+='?>'+this.newline;return r};XMLStringWriter.prototype.raw=function(node,level){return this.space(level)+node.value+this.newline};XMLStringWriter.prototype.text=function(node,level){return this.space(level)+node.value+this.newline};XMLStringWriter.prototype.dtdAttList=function(node,level){var r;r=this.space(level)+'<!ATTLIST '+node.elementName+' '+node.attributeName+' '+node.attributeType;if(node.defaultValueType!=='#DEFAULT'){r+=' '+node.defaultValueType}
if(node.defaultValue){r+=' "'+node.defaultValue+'"'}
r+='>'+this.newline;return r};XMLStringWriter.prototype.dtdElement=function(node,level){return this.space(level)+'<!ELEMENT '+node.name+' '+node.value+'>'+this.newline};XMLStringWriter.prototype.dtdEntity=function(node,level){var r;r=this.space(level)+'<!ENTITY';if(node.pe){r+=' %'}
r+=' '+node.name;if(node.value){r+=' "'+node.value+'"'}else{if(node.pubID&&node.sysID){r+=' PUBLIC "'+node.pubID+'" "'+node.sysID+'"'}else if(node.sysID){r+=' SYSTEM "'+node.sysID+'"'}
if(node.nData){r+=' NDATA '+node.nData}}
r+='>'+this.newline;return r};XMLStringWriter.prototype.dtdNotation=function(node,level){var r;r=this.space(level)+'<!NOTATION '+node.name;if(node.pubID&&node.sysID){r+=' PUBLIC "'+node.pubID+'" "'+node.sysID+'"'}else if(node.pubID){r+=' PUBLIC "'+node.pubID+'"'}else if(node.sysID){r+=' SYSTEM "'+node.sysID+'"'}
r+='>'+this.newline;return r};XMLStringWriter.prototype.openNode=function(node,level){var att,name,r,ref;level||(level=0);if(node instanceof XMLElement){r=this.space(level)+'<'+node.name;ref=node.attributes;for(name in ref){if(!hasProp.call(ref,name))continue;att=ref[name];r+=this.attribute(att)}
r+=(node.children?'>':'/>')+this.newline;return r}else{r=this.space(level)+'<!DOCTYPE '+node.rootNodeName;if(node.pubID&&node.sysID){r+=' PUBLIC "'+node.pubID+'" "'+node.sysID+'"'}else if(node.sysID){r+=' SYSTEM "'+node.sysID+'"'}
r+=(node.children?' [':'>')+this.newline;return r}};XMLStringWriter.prototype.closeNode=function(node,level){level||(level=0);switch(!1){case!(node instanceof XMLElement):return this.space(level)+'</'+node.name+'>'+this.newline;case!(node instanceof XMLDocType):return this.space(level)+']>'+this.newline}};return XMLStringWriter})(XMLWriterBase)}).call(this)},{"./XMLCData":501,"./XMLComment":502,"./XMLDTDAttList":503,"./XMLDTDElement":504,"./XMLDTDEntity":505,"./XMLDTDNotation":506,"./XMLDeclaration":507,"./XMLDocType":508,"./XMLElement":511,"./XMLProcessingInstruction":513,"./XMLRaw":514,"./XMLText":518,"./XMLWriterBase":519}],517:[function(require,module,exports){(function(){var XMLStringifier,camelCase,kebabCase,ref,snakeCase,titleCase,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},hasProp={}.hasOwnProperty;ref=require('./Utility'),camelCase=ref.camelCase,titleCase=ref.titleCase,kebabCase=ref.kebabCase,snakeCase=ref.snakeCase;module.exports=XMLStringifier=(function(){function XMLStringifier(options){this.assertLegalChar=bind(this.assertLegalChar,this);var key,ref1,value;options||(options={});this.allowSurrogateChars=options.allowSurrogateChars;this.noDoubleEncoding=options.noDoubleEncoding;this.textCase=options.textCase;ref1=options.stringify||{};for(key in ref1){if(!hasProp.call(ref1,key))continue;value=ref1[key];this[key]=value}}
XMLStringifier.prototype.eleName=function(val){val=''+val||'';val=this.applyCase(val);return this.assertLegalChar(val)};XMLStringifier.prototype.eleText=function(val){val=''+val||'';return this.assertLegalChar(this.elEscape(val))};XMLStringifier.prototype.cdata=function(val){val=''+val||'';val=val.replace(']]>',']]]]><![CDATA[>');return this.assertLegalChar(val)};XMLStringifier.prototype.comment=function(val){val=''+val||'';if(val.match(/--/)){throw new Error("Comment text cannot contain double-hypen: "+val)}
return this.assertLegalChar(val)};XMLStringifier.prototype.raw=function(val){return''+val||''};XMLStringifier.prototype.attName=function(val){val=''+val||'';return val=this.applyCase(val)};XMLStringifier.prototype.attValue=function(val){val=''+val||'';return this.attEscape(val)};XMLStringifier.prototype.insTarget=function(val){return''+val||''};XMLStringifier.prototype.insValue=function(val){val=''+val||'';if(val.match(/\?>/)){throw new Error("Invalid processing instruction value: "+val)}
return val};XMLStringifier.prototype.xmlVersion=function(val){val=''+val||'';if(!val.match(/1\.[0-9]+/)){throw new Error("Invalid version number: "+val)}
return val};XMLStringifier.prototype.xmlEncoding=function(val){val=''+val||'';if(!val.match(/^[A-Za-z](?:[A-Za-z0-9._-]|-)*$/)){throw new Error("Invalid encoding: "+val)}
return val};XMLStringifier.prototype.xmlStandalone=function(val){if(val){return"yes"}else{return"no"}};XMLStringifier.prototype.dtdPubID=function(val){return''+val||''};XMLStringifier.prototype.dtdSysID=function(val){return''+val||''};XMLStringifier.prototype.dtdElementValue=function(val){return''+val||''};XMLStringifier.prototype.dtdAttType=function(val){return''+val||''};XMLStringifier.prototype.dtdAttDefault=function(val){if(val!=null){return''+val||''}else{return val}};XMLStringifier.prototype.dtdEntityValue=function(val){return''+val||''};XMLStringifier.prototype.dtdNData=function(val){return''+val||''};XMLStringifier.prototype.convertAttKey='@';XMLStringifier.prototype.convertPIKey='?';XMLStringifier.prototype.convertTextKey='#text';XMLStringifier.prototype.convertCDataKey='#cdata';XMLStringifier.prototype.convertCommentKey='#comment';XMLStringifier.prototype.convertRawKey='#raw';XMLStringifier.prototype.assertLegalChar=function(str){var chars,chr;if(this.allowSurrogateChars){chars=/[\u0000-\u0008\u000B-\u000C\u000E-\u001F\uFFFE-\uFFFF]/}else{chars=/[\u0000-\u0008\u000B-\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE-\uFFFF]/}
chr=str.match(chars);if(chr){throw new Error("Invalid character ("+chr+") in string: "+str+" at index "+chr.index)}
return str};XMLStringifier.prototype.applyCase=function(str){switch(this.textCase){case "camel":return camelCase(str);case "title":return titleCase(str);case "kebab":case "lower":return kebabCase(str);case "snake":return snakeCase(str);case "upper":return kebabCase(str).toUpperCase();default:return str}};XMLStringifier.prototype.elEscape=function(str){var ampregex;ampregex=this.noDoubleEncoding?/(?!&\S+;)&/g : /&/g;return str.replace(ampregex,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\r/g,'&#xD;')};XMLStringifier.prototype.attEscape=function(str){var ampregex;ampregex=this.noDoubleEncoding?/(?!&\S+;)&/g : /&/g;return str.replace(ampregex,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;').replace(/\t/g,'&#x9;').replace(/\n/g,'&#xA;').replace(/\r/g,'&#xD;')};return XMLStringifier})()}).call(this)},{"./Utility":499}],518:[function(require,module,exports){(function(){var XMLNode,XMLText,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;XMLNode=require('./XMLNode');module.exports=XMLText=(function(superClass){extend(XMLText,superClass);function XMLText(parent,text){XMLText.__super__.constructor.call(this,parent);if(text==null){throw new Error("Missing element text")}
this.value=this.stringify.eleText(text)}
XMLText.prototype.clone=function(){return Object.create(this)};XMLText.prototype.toString=function(options){return this.options.writer.set(options).text(this)};return XMLText})(XMLNode)}).call(this)},{"./XMLNode":512}],519:[function(require,module,exports){(function(){var XMLWriterBase,hasProp={}.hasOwnProperty;module.exports=XMLWriterBase=(function(){function XMLWriterBase(options){var key,ref,ref1,ref2,ref3,ref4,value;options||(options={});this.pretty=options.pretty||!1;this.allowEmpty=(ref=options.allowEmpty)!=null?ref:!1;if(this.pretty){this.indent=(ref1=options.indent)!=null?ref1:'  ';this.newline=(ref2=options.newline)!=null?ref2:'\n';this.offset=(ref3=options.offset)!=null?ref3:0}else{this.indent='';this.newline='';this.offset=0}
ref4=options.writer||{};for(key in ref4){if(!hasProp.call(ref4,key))continue;value=ref4[key];this[key]=value}}
XMLWriterBase.prototype.set=function(options){var key,ref,value;options||(options={});if("pretty" in options){this.pretty=options.pretty}
if("allowEmpty" in options){this.allowEmpty=options.allowEmpty}
if(this.pretty){this.indent="indent" in options?options.indent:'  ';this.newline="newline" in options?options.newline:'\n';this.offset="offset" in options?options.offset:0}else{this.indent='';this.newline='';this.offset=0}
ref=options.writer||{};for(key in ref){if(!hasProp.call(ref,key))continue;value=ref[key];this[key]=value}
return this};XMLWriterBase.prototype.space=function(level){if(this.pretty){return new Array((level||0)+this.offset+1).join(this.indent)}else{return''}};return XMLWriterBase})()}).call(this)},{}],520:[function(require,module,exports){(function(){var XMLDocument,XMLDocumentCB,XMLStreamWriter,XMLStringWriter,assign,isFunction,ref;ref=require('./Utility'),assign=ref.assign,isFunction=ref.isFunction;XMLDocument=require('./XMLDocument');XMLDocumentCB=require('./XMLDocumentCB');XMLStringWriter=require('./XMLStringWriter');XMLStreamWriter=require('./XMLStreamWriter');module.exports.create=function(name,xmldec,doctype,options){var doc,root;if(name==null){throw new Error("Root element needs a name")}
options=assign({},xmldec,doctype,options);doc=new XMLDocument(options);root=doc.element(name);if(!options.headless){doc.declaration(options);if((options.pubID!=null)||(options.sysID!=null)){doc.doctype(options)}}
return root};module.exports.begin=function(options,onData,onEnd){var ref1;if(isFunction(options)){ref1=[options,onData],onData=ref1[0],onEnd=ref1[1];options={}}
if(onData){return new XMLDocumentCB(options,onData,onEnd)}else{return new XMLDocument(options)}};module.exports.stringWriter=function(options){return new XMLStringWriter(options)};module.exports.streamWriter=function(stream,options){return new XMLStreamWriter(stream,options)}}).call(this)},{"./Utility":499,"./XMLDocument":509,"./XMLDocumentCB":510,"./XMLStreamWriter":515,"./XMLStringWriter":516}],521:[function(require,module,exports){(function(Buffer){var http=require('http'),https=require('https'),url=require('url'),Serializer=require('./serializer'),Deserializer=require('./deserializer'),Cookies=require('./cookies')
function Client(options,isSecure){if(!1===(this instanceof Client)){return new Client(options,isSecure)}
if(typeof options==='string'){options=url.parse(options)
options.host=options.hostname
options.path=options.pathname}
if(typeof options.url!=='undefined'){var parsedUrl=url.parse(options.url);options.host=parsedUrl.hostname;options.path=parsedUrl.pathname;options.port=parsedUrl.port}
var headers={'User-Agent':'NodeJS XML-RPC Client','Content-Type':'text/xml','Accept':'text/xml','Accept-Charset':'UTF8','Connection':'Keep-Alive'}
options.headers=options.headers||{}
if(options.headers.Authorization==null&&options.basic_auth!=null&&options.basic_auth.user!=null&&options.basic_auth.pass!=null)
{var auth=options.basic_auth.user+':'+options.basic_auth.pass
options.headers.Authorization='Basic '+new Buffer(auth).toString('base64')}
for(var attribute in headers){if(options.headers[attribute]===undefined){options.headers[attribute]=headers[attribute]}}
options.method='POST'
this.options=options
this.isSecure=isSecure
this.headersProcessors={processors:[],composeRequest:function(headers){this.processors.forEach(function(p){p.composeRequest(headers)})},parseResponse:function(headers){this.processors.forEach(function(p){p.parseResponse(headers)})}};if(options.cookies){this.cookies=new Cookies();this.headersProcessors.processors.unshift(this.cookies)}}
Client.prototype.methodCall=function methodCall(method,params,callback){var options=this.options
var xml=Serializer.serializeMethodCall(method,params,options.encoding)
var transport=this.isSecure?https:http
options.headers['Content-Length']=Buffer.byteLength(xml,'utf8')
this.headersProcessors.composeRequest(options.headers)
var request=transport.request(options,function(response){var body=[]
response.on('data',function(chunk){body.push(chunk)})
function __enrichError(err){Object.defineProperty(err,'req',{value:request})
Object.defineProperty(err,'res',{value:response})
Object.defineProperty(err,'body',{value:body.join('')})
return err}
if(response.statusCode==404){callback(__enrichError(new Error('Not Found')))}
else{this.headersProcessors.parseResponse(response.headers)
var deserializer=new Deserializer(options.responseEncoding)
deserializer.deserializeMethodResponse(response,function(err,result){if(err){err=__enrichError(err)}
callback(err,result)})}}.bind(this))
request.on('error',callback)
request.write(xml,'utf8')
request.end()}
Client.prototype.getCookie=function getCookie(name){if(!this.cookies){throw 'Cookies support is not turned on for this client instance'}
return this.cookies.get(name)}
Client.prototype.setCookie=function setCookie(name,value){if(!this.cookies){throw 'Cookies support is not turned on for this client instance'}
this.cookies.set(name,value);return this}
module.exports=Client}).call(this,require("buffer").Buffer)},{"./cookies":522,"./deserializer":525,"./serializer":526,"buffer":54,"http":177,"https":106,"url":184}],522:[function(require,module,exports){function Cookies(){this.cookies={}}
Cookies.prototype={get:function(name){var cookie=this.cookies[name]
if(cookie&&this.checkNotExpired(name)){return this.cookies[name].value}
return null},set:function(name,value,options){var cookie=typeof options=='object'?{value:value,expires:options.expires,secure:options.secure||!1,new:options.new||!1}:{value:value}
if(this.checkNotExpired(name,cookie)){this.cookies[name]=cookie}},getExpirationDate:function(name){return this.cookies[name]?this.cookies[name].expires:null},checkNotExpired:function(name,cookie){if(typeof cookie==='undefined'){cookie=this.cookies[name]}
var now=new Date()
if(cookie&&cookie.expires&&now>cookie.expires){delete this.cookies[name]
return!1}
return!0},parseResponse:function(headers){var cookies=headers['set-cookie']
if(cookies){cookies.forEach(function(c){var cookiesParams=c.split(';')
var cookiePair=cookiesParams.shift().split('=')
var options={}
cookiesParams.forEach(function(param){param=param.trim()
if(param.toLowerCase().indexOf('expires')==0){var date=param.split('=')[1].trim()
options.expires=new Date(date)}})
this.set(cookiePair[0].trim(),cookiePair[1].trim(),options)}.bind(this))}},composeRequest:function(headers){if(Object.keys(this.cookies).length==0){return}
headers.Cookie=this.toString()},toString:function(){return Object.keys(this.cookies).filter(this.checkNotExpired.bind(this)).map(function(name){return name+'='+this.cookies[name].value}.bind(this)).join(';')}}
module.exports=Cookies},{}],523:[function(require,module,exports){var CustomType=module.exports=function(raw){this.raw=raw}
CustomType.prototype.serialize=function(xml){return xml.ele(this.tagName).txt(this.raw)}
CustomType.prototype.tagName='customType'},{}],524:[function(require,module,exports){var DateFormatter=function(opts){this.opts={}
this.setOpts(opts)}
DateFormatter.DEFAULT_OPTIONS={colons:!0,hyphens:!1,local:!0,ms:!1,offset:!1}
DateFormatter.ISO8601=new RegExp('([0-9]{4})([-]?([0-9]{2}))([-]?([0-9]{2}))'+'(T([0-9]{2})(((:?([0-9]{2}))?((:?([0-9]{2}))?(\.([0-9]+))?))?)'+'(Z|([+-]([0-9]{2}(:?([0-9]{2}))?)))?)?')
DateFormatter.prototype.setOpts=function(opts){if(!opts)opts=DateFormatter.DEFAULT_OPTIONS
var ctx=this
Object.keys(DateFormatter.DEFAULT_OPTIONS).forEach(function(k){ctx.opts[k]=opts.hasOwnProperty(k)?opts[k]:DateFormatter.DEFAULT_OPTIONS[k]})}
DateFormatter.prototype.decodeIso8601=function(time){var dateParts=time.toString().match(DateFormatter.ISO8601)
if(!dateParts){throw new Error('Expected a ISO8601 datetime but got \''+time+'\'')}
var date=[[dateParts[1],dateParts[3]||'01',dateParts[5]||'01'].join('-'),'T',[dateParts[7]||'00',dateParts[11]||'00',dateParts[14]||'00'].join(':'),'.',dateParts[16]||'000'].join('')
date+=(dateParts[17]!==undefined)?dateParts[17]+((dateParts[19]&&dateParts[20]===undefined)?'00':''):DateFormatter.formatCurrentOffset(new Date(date))
return new Date(date)}
DateFormatter.prototype.encodeIso8601=function(date){var parts=this.opts.local?DateFormatter.getLocalDateParts(date):DateFormatter.getUTCDateParts(date)
return[[parts[0],parts[1],parts[2]].join(this.opts.hyphens?'-':''),'T',[parts[3],parts[4],parts[5]].join(this.opts.colons?':':''),(this.opts.ms)?'.'+parts[6]:'',(this.opts.local)?((this.opts.offset)?DateFormatter.formatCurrentOffset(date):''):'Z'].join('')}
DateFormatter.getUTCDateParts=function(date){return[date.getUTCFullYear(),DateFormatter.zeroPad(date.getUTCMonth()+1,2),DateFormatter.zeroPad(date.getUTCDate(),2),DateFormatter.zeroPad(date.getUTCHours(),2),DateFormatter.zeroPad(date.getUTCMinutes(),2),DateFormatter.zeroPad(date.getUTCSeconds(),2),DateFormatter.zeroPad(date.getUTCMilliseconds(),3)]}
DateFormatter.getLocalDateParts=function(date){return[date.getFullYear(),DateFormatter.zeroPad(date.getMonth()+1,2),DateFormatter.zeroPad(date.getDate(),2),DateFormatter.zeroPad(date.getHours(),2),DateFormatter.zeroPad(date.getMinutes(),2),DateFormatter.zeroPad(date.getSeconds(),2),DateFormatter.zeroPad(date.getMilliseconds(),3)]}
DateFormatter.zeroPad=function(digit,length){var padded=''+digit
while(padded.length<length){padded='0'+padded}
return padded}
DateFormatter.formatCurrentOffset=function(d){var offset=(d||new Date()).getTimezoneOffset()
return(offset===0)?'Z':[(offset<0)?'+':'-',DateFormatter.zeroPad(Math.abs(Math.floor(offset/60)),2),':',DateFormatter.zeroPad(Math.abs(offset%60),2)].join('')}
module.exports=new DateFormatter()},{}],525:[function(require,module,exports){(function(Buffer){var sax=require('sax'),dateFormatter=require('./date_formatter')
var Deserializer=function(encoding){this.type=null
this.responseType=null
this.stack=[]
this.marks=[]
this.data=[]
this.methodname=null
this.encoding=encoding||'utf8'
this.value=!1
this.callback=null
this.error=null
this.parser=sax.createStream()
this.parser.on('opentag',this.onOpentag.bind(this))
this.parser.on('closetag',this.onClosetag.bind(this))
this.parser.on('text',this.onText.bind(this))
this.parser.on('cdata',this.onCDATA.bind(this))
this.parser.on('end',this.onDone.bind(this))
this.parser.on('error',this.onError.bind(this))}
Deserializer.prototype.deserializeMethodResponse=function(stream,callback){var that=this
this.callback=function(error,result){if(error){callback(error)}
else if(result.length>1){callback(new Error('Response has more than one param'))}
else if(that.type!=='methodresponse'){callback(new Error('Not a method response'))}
else if(!that.responseType){callback(new Error('Invalid method response'))}
else{callback(null,result[0])}}
stream.setEncoding(this.encoding)
stream.on('error',this.onError.bind(this))
stream.pipe(this.parser)}
Deserializer.prototype.deserializeMethodCall=function(stream,callback){var that=this
this.callback=function(error,result){if(error){callback(error)}
else if(that.type!=='methodcall'){callback(new Error('Not a method call'))}
else if(!that.methodname){callback(new Error('Method call did not contain a method name'))}
else{callback(null,that.methodname,result)}}
stream.setEncoding(this.encoding)
stream.on('error',this.onError.bind(this))
stream.pipe(this.parser)}
Deserializer.prototype.onDone=function(){var that=this
if(!this.error){if(this.type===null||this.marks.length){this.callback(new Error('Invalid XML-RPC message'))}
else if(this.responseType==='fault'){var createFault=function(fault){var error=new Error('XML-RPC fault'+(fault.faultString?': '+fault.faultString:''))
error.code=fault.faultCode
error.faultCode=fault.faultCode
error.faultString=fault.faultString
return error}
this.callback(createFault(this.stack[0]))}
else{this.callback(undefined,this.stack)}}}
Deserializer.prototype.onError=function(msg){if(!this.error){if(typeof msg==='string'){this.error=new Error(msg)}
else{this.error=msg}
this.callback(this.error)}}
Deserializer.prototype.push=function(value){this.stack.push(value)}
Deserializer.prototype.onOpentag=function(node){if(node.name==='ARRAY'||node.name==='STRUCT'){this.marks.push(this.stack.length)}
this.data=[]
this.value=(node.name==='VALUE')}
Deserializer.prototype.onText=function(text){this.data.push(text)}
Deserializer.prototype.onCDATA=function(cdata){this.data.push(cdata)}
Deserializer.prototype.onClosetag=function(el){var data=this.data.join('')
try{switch(el){case 'BOOLEAN':this.endBoolean(data)
break
case 'INT':case 'I4':this.endInt(data)
break
case 'I8':this.endI8(data)
break
case 'DOUBLE':this.endDouble(data)
break
case 'STRING':case 'NAME':this.endString(data)
break
case 'ARRAY':this.endArray(data)
break
case 'STRUCT':this.endStruct(data)
break
case 'BASE64':this.endBase64(data)
break
case 'DATETIME.ISO8601':this.endDateTime(data)
break
case 'VALUE':this.endValue(data)
break
case 'PARAMS':this.endParams(data)
break
case 'FAULT':this.endFault(data)
break
case 'METHODRESPONSE':this.endMethodResponse(data)
break
case 'METHODNAME':this.endMethodName(data)
break
case 'METHODCALL':this.endMethodCall(data)
break
case 'NIL':this.endNil(data)
break
case 'DATA':case 'PARAM':case 'MEMBER':break
default:this.onError('Unknown XML-RPC tag \''+el+'\'')
break}}
catch(e){this.onError(e)}}
Deserializer.prototype.endNil=function(data){this.push(null)
this.value=!1}
Deserializer.prototype.endBoolean=function(data){if(data==='1'){this.push(!0)}
else if(data==='0'){this.push(!1)}
else{throw new Error('Illegal boolean value \''+data+'\'')}
this.value=!1}
Deserializer.prototype.endInt=function(data){var value=parseInt(data,10)
if(isNaN(value)){throw new Error('Expected an integer but got \''+data+'\'')}
else{this.push(value)
this.value=!1}}
Deserializer.prototype.endDouble=function(data){var value=parseFloat(data)
if(isNaN(value)){throw new Error('Expected a double but got \''+data+'\'')}
else{this.push(value)
this.value=!1}}
Deserializer.prototype.endString=function(data){this.push(data)
this.value=!1}
Deserializer.prototype.endArray=function(data){var mark=this.marks.pop()
this.stack.splice(mark,this.stack.length-mark,this.stack.slice(mark))
this.value=!1}
Deserializer.prototype.endStruct=function(data){var mark=this.marks.pop(),struct={},items=this.stack.slice(mark),i=0
for(;i<items.length;i+=2){struct[items[i]]=items[i+1]}
this.stack.splice(mark,this.stack.length-mark,struct)
this.value=!1}
Deserializer.prototype.endBase64=function(data){var buffer=new Buffer(data,'base64')
this.push(buffer)
this.value=!1}
Deserializer.prototype.endDateTime=function(data){var date=dateFormatter.decodeIso8601(data)
this.push(date)
this.value=!1}
var isInteger=/^-?\d+$/Deserializer.prototype.endI8=function(data){if(!isInteger.test(data)){throw new Error('Expected integer (I8) value but got \''+data+'\'')}
else{this.endString(data)}}
Deserializer.prototype.endValue=function(data){if(this.value){this.endString(data)}}
Deserializer.prototype.endParams=function(data){this.responseType='params'}
Deserializer.prototype.endFault=function(data){this.responseType='fault'}
Deserializer.prototype.endMethodResponse=function(data){this.type='methodresponse'}
Deserializer.prototype.endMethodName=function(data){this.methodname=data}
Deserializer.prototype.endMethodCall=function(data){this.type='methodcall'}
module.exports=Deserializer}).call(this,require("buffer").Buffer)},{"./date_formatter":524,"buffer":54,"sax":402}],526:[function(require,module,exports){(function(Buffer){var xmlBuilder=require('xmlbuilder'),dateFormatter=require('./date_formatter'),CustomType=require('./customtype')
exports.serializeMethodCall=function(method,params,encoding){var params=params||[]
var options={version:'1.0',allowSurrogateChars:!0}
if(encoding){options.encoding=encoding}
var xml=xmlBuilder.create('methodCall',options).ele('methodName').txt(method).up().ele('params')
params.forEach(function(param){serializeValue(param,xml.ele('param'))})
return xml.doc().toString()}
exports.serializeMethodResponse=function(result){var xml=xmlBuilder.create('methodResponse',{version:'1.0',allowSurrogateChars:!0}).ele('params').ele('param')
serializeValue(result,xml)
return xml.doc().toString()}
exports.serializeFault=function(fault){var xml=xmlBuilder.create('methodResponse',{version:'1.0',allowSurrogateChars:!0}).ele('fault')
serializeValue(fault,xml)
return xml.doc().toString()}
function serializeValue(value,xml){var stack=[{value:value,xml:xml}],current=null,valueNode=null,next=null
while(stack.length>0){current=stack[stack.length-1]
if(current.index!==undefined){next=getNextItemsFrame(current)
if(next){stack.push(next)}
else{stack.pop()}}
else{valueNode=current.xml.ele('value')
switch(typeof current.value){case 'boolean':appendBoolean(current.value,valueNode)
stack.pop()
break
case 'string':appendString(current.value,valueNode)
stack.pop()
break
case 'number':appendNumber(current.value,valueNode)
stack.pop()
break
case 'object':if(current.value===null){valueNode.ele('nil')
stack.pop()}
else if(current.value instanceof Date){appendDatetime(current.value,valueNode)
stack.pop()}
else if(Buffer.isBuffer(current.value)){appendBuffer(current.value,valueNode)
stack.pop()}
else if(current.value instanceof CustomType){current.value.serialize(valueNode)
stack.pop()}
else{if(Array.isArray(current.value)){current.xml=valueNode.ele('array').ele('data')}
else{current.xml=valueNode.ele('struct')
current.keys=Object.keys(current.value)}
current.index=0
next=getNextItemsFrame(current)
if(next){stack.push(next)}
else{stack.pop()}}
break
default:stack.pop()
break}}}}
function getNextItemsFrame(frame){var nextFrame=null
if(frame.keys){if(frame.index<frame.keys.length){var key=frame.keys[frame.index++],member=frame.xml.ele('member').ele('name').text(key).up()
nextFrame={value:frame.value[key],xml:member}}}
else if(frame.index<frame.value.length){nextFrame={value:frame.value[frame.index],xml:frame.xml}
frame.index++}
return nextFrame}
function appendBoolean(value,xml){xml.ele('boolean').txt(value?1:0)}
var illegalChars=/^(?![^<&]*]]>[^<&]*)[^<&]*$/
function appendString(value,xml){if(value.length===0){xml.ele('string')}
else if(!illegalChars.test(value)){xml.ele('string').d(value)}
else{xml.ele('string').txt(value)}}
function appendNumber(value,xml){if(value%1==0){xml.ele('int').txt(value)}
else{xml.ele('double').txt(value)}}
function appendDatetime(value,xml){xml.ele('dateTime.iso8601').txt(dateFormatter.encodeIso8601(value))}
function appendBuffer(value,xml){xml.ele('base64').txt(value.toString('base64'))}}).call(this,{"isBuffer":require("../../../../../Users/barbanarca/nvm/v12.0.0/node_modules/browserify/node_modules/is-buffer/index.js")})},{"../../../../../Users/barbanarca/nvm/v12.0.0/node_modules/browserify/node_modules/is-buffer/index.js":109,"./customtype":523,"./date_formatter":524,"xmlbuilder":520}],527:[function(require,module,exports){(function(process){var http=require('http'),https=require('https'),url=require('url'),EventEmitter=require('events').EventEmitter,Serializer=require('./serializer'),Deserializer=require('./deserializer')
function Server(options,isSecure,onListening){if(!1===(this instanceof Server)){return new Server(options,isSecure)}
onListening=onListening||function(){}
var that=this
if(typeof options==='string'){options=url.parse(options)
options.host=options.hostname
options.path=options.pathname}
function handleMethodCall(request,response){var deserializer=new Deserializer()
deserializer.deserializeMethodCall(request,function(error,methodName,params){if(Object.prototype.hasOwnProperty.call(that._events,methodName)){that.emit(methodName,null,params,function(error,value){var xml=null
if(error!==null){xml=Serializer.serializeFault(error)}
else{xml=Serializer.serializeMethodResponse(value)}
response.writeHead(200,{'Content-Type':'text/xml'})
response.end(xml)})}
else{that.emit('NotFound',methodName,params)
response.writeHead(404)
response.end()}})}
this.httpServer=isSecure?https.createServer(options,handleMethodCall):http.createServer(handleMethodCall)
process.nextTick(function(){this.httpServer.listen(options.port,options.host,onListening)}.bind(this))
this.close=function(callback){this.httpServer.once('close',callback)
this.httpServer.close()}.bind(this)}
Server.prototype.__proto__=EventEmitter.prototype
module.exports=Server}).call(this,require('_process'))},{"./deserializer":525,"./serializer":526,"_process":139,"events":90,"http":177,"https":106,"url":184}],528:[function(require,module,exports){var Client=require('./client'),Server=require('./server'),CustomType=require('./customtype'),dateFormatter=require('./date_formatter')
var xmlrpc=exports
xmlrpc.createClient=function(options){return new Client(options,!1)}
xmlrpc.createSecureClient=function(options){return new Client(options,!0)}
xmlrpc.createServer=function(options,callback){return new Server(options,!1,callback)}
xmlrpc.createSecureServer=function(options,callback){return new Server(options,!0,callback)}
xmlrpc.CustomType=CustomType
xmlrpc.dateFormatter=dateFormatter},{"./client":521,"./customtype":523,"./date_formatter":524,"./server":527}],529:[function(require,module,exports){},{}]},{},[191])